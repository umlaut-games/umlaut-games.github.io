{"version":3,"sources":["game/tools/index.ts","game/tools/animation-helper.ts","game/tools/gamepads.ts","game/tools/keyboard.ts","game/tools/math-helper.ts","game/tools/enums.ts","game/tools/pixi/pixi.ts","serviceWorker.ts","components/Header.tsx","components/Footer.tsx","components/About.tsx","game/tools/pixi/index.ts","game/config.ts","game/objects/object-base.ts","game/objects/animation-base.ts","game/objects/decale.ts","game/objects/door.ts","game/objects/crosshair.ts","game/objects/blood.ts","game/objects/beacon.ts","game/objects/text-with-background.ts","game/objects/text-bubble.ts","game/actors/actor-base.ts","game/objects/shell.ts","game/objects/muzzle.ts","game/objects/weapons/weapon-base.ts","game/objects/weapons/shotgun.ts","game/objects/weapons/beretta.ts","game/objects/flashlight.ts","game/actors/player.ts","game/maps/map-base.ts","game/maps/maension-outside.ts","game/maps/house-outside.ts","game/maps/street.ts","game/maps/loading.ts","game/maps/title.ts","game/ui/hud.ts","game/game.ts","game/maension.ts","components/MaensionComponent.tsx","components/HowToPlay.tsx","Page.tsx","index.tsx"],"names":["AnimationHelper","resources","which","speed","scale","frames","Error","textureId","textures","texture","push","clip","AnimatedSprite","animationSpeed","x","y","anchor","Gamepads","events","_events","scanGamepads","_gamepads","event","console","log","addGamepad","gamepad","index","_state","removeGamepad","gamepadIndex","hasOwnProperty","axes","buttons","buttonIndex","button","state","pressed","isPressed","pressEvent","releaseEvent","gamepads","navigator","getGamepads","webkitGetGamepads","window","addEventListener","connectHandler","disconnectHandler","Keyboard","_key","_ignoreKeyup","_isDown","_isUp","this","_downHandler","bind","_upHandler","key","preventDefault","MathHelper","min","max","Math","floor","random","v1","v2","atan2","sqrt","distanceToSq","dx","dy","ActorStates","idle","Symbol","for","walking","fire","died","global","PIXI","isLocalhost","Boolean","location","hostname","match","registerValidSW","swUrl","config","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","catch","error","Header","Footer","className","href","target","rel","About","Config","process","black","white","ObjectBase","_outlineContainer","_map","_baseScale","_resources","_isFacingRight","_vx","_vy","_vr","delta","vx","vy","vr","rotation","actor","actorBounds","getBounds","thisBounds","collides","width","height","scaleOffset","_adaptScaleBasedOnOrientation","abs","parent","removeChild","Container","b","lb","toLocal","coordinates","Text","toFixed","fontSize","fill","addChild","outline","Graphics","lineStyle","drawRect","endFill","map","AnimationBase","_clips","_currentClip","isFacingRight","loop","dontRemove","undefined","Promise","resolve","reject","clipToPlay","err","zIndex","gotoAndPlay","children","sort","a","onComplete","stop","Decale","res","decale","Sprite","Door","done","loadClip","filters","BlurFilter","_playClip","Crosshair","Blood","Beacon","bg","Texture","WHITE","EMPTY","tint","settings","SCALE_MODE","SCALE_MODES","NEAREST","TextWithBackground","text","fontColor","background","dropShadowColor","style","fontFamily","dropShadow","t","isNaN","TextBubble","duration","setTimeout","ActorBase","skin","_text","_lastFlip","_skin","_speed","_health","_power","_canGetHitAgain","constructor","name","_setState","objectTookDamage","power","_died","_idle","direction","_setIsFacingRight","distanceTo","position","angleToTarget","angleBetweenRad","sin","cos","_canFlipAgain","flip","canFlip","Date","now","realx","_logActorCoordinates","maxHeight","maxWidth","Shell","pivot","sprite","getRandomInt","start","TWEEN","Tween","to","repeat","coords","easing","Easing","Bounce","Out","yoyo","Muzzle","WeaponBase","rounds","_reloadTime","_isReloading","_maxRounds","_rounds","_sprite","_roundsSprite","_shellSprites","muzzleFlash","shell","p","splice","findIndex","s","tick","isReloading","Shotgun","Beretta","fireSound","reloadSound","sound","f","play","didReload","Flashlight","lightCone","set","alpha","SimpleLightmapFilter","blendMode","BLEND_MODES","ADD","NoiseFilter","weapons","Player","_weapon","_name","flashlight","shotgun","beretta","relax","reload","weapon","toggleFlashlight","foregroundContainer","find","c","crosshairPosition","angle","weaponLocation","_canBeControlled","speak","playerMoved","adaptScale","moved","toGlobal","MapBase","_width","mapToLoad","onDone","_explorationOffset","_textures","_backgroundContainer","_actorContainer","_foregroundContainer","_onDone","withHud","withCrosshair","withPlayer","withMouse","withDarkness","playerX","scrollAmount","MaensionOutside","starryNight","maension","tree","tree1","tree_dead","tree2","darkness","MULTIPLY","_setup","setInterval","HouseOutside","city","Street","cityWidth","concret","TilingSprite","police","Loading","_door","Title","enterText","bgm","rainShader","godFilter","count","volume","brand","isInteractive","search","endsWith","god","GodrayFilter","gain","lacunarity","rain","rainFrag","data","Filter","uniforms","dimensions","time","u_mouse","u_frame","interactive","wireEvents","on","HUD","player","_player","_gameOverSign","_height","smallTextConfig","bigText","playerName","healthBorder","roundsBorder","weaponBorder","update","removeChildren","roundSprite","roundsSprite","health","_renderRounds","_renderWeapon","fontWeight","align","maps","Game","stage","_stage","_hud","_beacon","_enemies","_mouseLocation","_isRunning","_startOffset","_elapsedSeconds","_mouseLine","_crosshair","street","house","loading","title","_init","newMap","actorContainer","cursor","_updateHud","_attachMouse","_updateMouseLocation","Point","switchMap","_attachGamepad","_attachKeyboard","e","_fire","updateCrosshairPosition","impact","impactLocation","backgroundContainer","moveRight","moveLeft","moveUp","moveDown","stopMoveVertically","stopMoveHorizontally","left","up","right","down","w","r","enter","_switchWeapon","_reload","_moveRight","isDown","_stopMoveHorizontally","_moveLeft","_moveUp","_stopMoveVertically","_moveDown","init","0","1","15","14","12","13","9","renderGameOver","enemy","playerHit","hitBy","_drawBlood","_end","i","blood","moveTowards","move","shallScroll","_updateCrosshair","clear","lineTo","switchWeapon","mouseLocation","elapsed","updateStatus","elapsedSeconds","parseInt","toString","correctedElapsedSeconds","_detectCollisions","_updateKI","_moveActors","ab","bb","_outlineMouse","Maension","container","_lastFrame","_fpsCount","_fpsTimer","_game","_container","_app","_root","_loadingBar","_fps","Application","backgroundColor","appendChild","view","clientWidth","clientHeight","resize","drawLoadingBar","requestAnimationFrame","_tick","nvw","nvh","vpw","innerWidth","vph","innerHeight","renderer","options","crossOrigin","loader","Loader","add","assetPath","once","_assetsLoaded","load","onProgress","updateLoadingBar","progress","pct","beginFill","lWidth","render","MaensionComponent","useRef","useState","setMaension","useEffect","current","m","run","ref","HowToPlay","textAlign","Page","ReactDOM","StrictMode","document","getElementById","URL","origin","fetch","headers","response","contentType","get","status","indexOf","ready","unregister","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.bd25ac80.chunk.js","sourcesContent":["export * from \"./animation-helper\"\nexport * from \"./gamepads\"\nexport * from \"./keyboard\"\nexport * from \"./math-helper\"\nexport * from \"./enums\"\nexport * from \"./IDictionary\"\n","import {\n  AnimatedSprite,\n  IResourceDictionary,\n  Texture\n} from \"pixi.js\"\n\n/**\n * @class\n */\nexport class AnimationHelper {\n  static loadClip(\n    resources: IResourceDictionary,\n    which: string,\n    speed: number,\n    scale: number\n  ): AnimatedSprite {\n    const frames: Texture[] = []\n\n    if (!resources[which]) {\n      throw new Error(`resources for ${which} not found!`)\n    }\n\n    for (const textureId in resources[which].textures) {\n      let texture = resources[which]!.textures![textureId]\n      frames.push(texture)\n    }\n\n    const clip = new AnimatedSprite(frames)\n\n    clip.animationSpeed = speed\n    clip.scale.x = scale\n    clip.scale.y = scale\n    clip.anchor.x = 0.5\n\n    return clip\n  }\n}\n","import { IDictionary } from \"./IDictionary\"\n\ntype d<T> = IDictionary<IDictionary<T>>\n\ninterface Event {\n  pressEvent?: () => void\n  releaseEvent?: () => void\n}\n\ntype Events = d<Event>\n\ninterface State {\n  isPressed: boolean\n}\n\ntype States = d<State>\n\nexport class Gamepads {\n  static _gamepads: IDictionary<Gamepad> = {}\n  static _state: States = {}\n  static _events: Events = {}\n\n  static init(events: Events) {\n    Gamepads._events = events\n\n    Gamepads.scanGamepads()\n\n    return Gamepads._gamepads[0] || null\n  }\n\n  static connectHandler(event: GamepadEvent) {\n    console.log(\"gamepad connected\")\n\n    Gamepads.addGamepad(event.gamepad)\n  }\n\n  static addGamepad(gamepad: Gamepad) {\n    console.log(\"adding gamepad\", gamepad)\n\n    Gamepads._gamepads[gamepad.index] = gamepad\n    Gamepads._state[gamepad.index] = {}\n  }\n\n  static disconnectHandler(event: GamepadEvent) {\n    console.log(\"gamepad disconnected\")\n\n    Gamepads.removeGamepad(event.gamepad)\n  }\n\n  static removeGamepad(gamepad: Gamepad) {\n    console.log(\"removing gamepad\")\n    delete Gamepads._gamepads[gamepad.index]\n    delete Gamepads._state[gamepad.index]\n  }\n\n  static updateStatus() {\n    Gamepads.scanGamepads()\n    for (const gamepadIndex in Gamepads._gamepads) {\n      if (Gamepads._gamepads.hasOwnProperty(gamepadIndex)) {\n        const gamepad: Gamepad =\n          Gamepads._gamepads[gamepadIndex]\n\n        if (gamepad.axes) {\n          //console.log(gamepad.axes)\n        }\n\n        // sometimes controllers dont have buttons\n        if (gamepad.buttons) {\n          for (const buttonIndex in gamepad.buttons) {\n            if (\n              gamepad.buttons.hasOwnProperty(buttonIndex)\n            ) {\n              const button: GamepadButton =\n                gamepad.buttons[buttonIndex]\n\n              Gamepads._state[gamepadIndex][buttonIndex] =\n                Gamepads._state[gamepadIndex][\n                  buttonIndex\n                ] || {}\n              Gamepads._events[gamepadIndex][buttonIndex] =\n                Gamepads._events[gamepadIndex][\n                  buttonIndex\n                ] || {}\n\n              const state: State =\n                Gamepads._state[gamepadIndex][buttonIndex]\n              const event: Event =\n                Gamepads._events[gamepadIndex][buttonIndex]\n\n              if (button.pressed && !state.isPressed) {\n                console.log(\n                  \"button pressed\",\n                  gamepadIndex,\n                  buttonIndex\n                )\n\n                state.isPressed = true\n\n                if (event.pressEvent) {\n                  event.pressEvent()\n                }\n              }\n\n              if (!button.pressed && state.isPressed) {\n                console.log(\n                  \"button released\",\n                  gamepadIndex,\n                  buttonIndex\n                )\n\n                state.isPressed = false\n\n                if (event.releaseEvent) {\n                  event.releaseEvent()\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  static scanGamepads() {\n    const gamepads: Gamepad[] = navigator.getGamepads\n      ? navigator.getGamepads()\n      : // @ts-ignore\n      navigator.webkitGetGamepads\n      ? // @ts-ignore\n        navigator.webkitGetGamepads()\n      : []\n\n    for (const gamepad of gamepads) {\n      // sometimes gamepad is undefined?!\n      if (gamepad) {\n        const gamepadIndex = gamepad.index\n\n        // do we have this already in records?\n        if (gamepadIndex in Gamepads._gamepads) {\n          Gamepads._gamepads[gamepadIndex] = gamepad\n        } else {\n          console.log(\n            \"found new gamepad during scan, adding\",\n            gamepadIndex\n          )\n\n          Gamepads.addGamepad(gamepad)\n        }\n      }\n    }\n  }\n}\n\n// register events\n// @ts-ignore\nwindow.addEventListener(\n  \"gamepadconnected\",\n  Gamepads.connectHandler\n)\n// @ts-ignore\nwindow.addEventListener(\n  \"gamepaddisconnected\",\n  Gamepads.disconnectHandler\n)\n","/**\n * @class\n */\nexport class Keyboard {\n  /**\n   *\n   * @type {boolean}\n   * @private\n   */\n  private _isDown = false\n  /**\n   *\n   * @type {boolean}\n   * @private\n   */\n  private _isUp = true\n\n  // events\n  /**\n   *\n   * @type {KeyboardEvent}\n   */\n  public pressEvent: (() => void) | null = null\n  /**\n   *\n   * @type {KeyboardEvent}\n   */\n  public releaseEvent: (() => void) | null = null\n\n  constructor(\n    private readonly _key: string,\n    private readonly _ignoreKeyup: boolean\n  ) {\n    //Attach event listeners\n    window.addEventListener(\n      \"keydown\",\n      this._downHandler.bind(this),\n      false\n    )\n    window.addEventListener(\n      \"keyup\",\n      this._upHandler.bind(this),\n      false\n    )\n  }\n\n  get isDown() {\n    return this._isDown\n  }\n\n  /**\n   *\n   * @param event\n   * @private\n   */\n  private _downHandler(event: KeyboardEvent) {\n    if (event.key === this._key) {\n      event.preventDefault()\n\n      // if the key is up and we have a press handler\n      if (this._isUp && this.pressEvent) {\n        this.pressEvent()\n      }\n\n      this._isDown = true\n      this._isUp = false\n    }\n  }\n\n  /**\n   *\n   * @param event\n   * @private\n   */\n  private _upHandler(event: KeyboardEvent) {\n    if (event.key === this._key) {\n      event.preventDefault()\n\n      // if the key is down and we have a press handler\n      if (this._isDown && this.releaseEvent) {\n        this.releaseEvent()\n      }\n\n      this._isDown = false\n      this._isUp = true\n    }\n  }\n}\n","import { Point } from \"pixi.js\"\n\nexport class MathHelper {\n  /**\n   *\n   * @param min\n   * @param max\n   * @returns {number}\n   * @public\n   */\n  static getRandomInt(min: number, max: number) {\n    return Math.floor(Math.random() * (max - min)) + min\n  }\n\n  /**\n   *\n   * @param v2\n   * @param v1\n   * @returns {number}\n   */\n  static angleBetweenRad(v1: Point, v2: Point) {\n    return Math.atan2(v2.y - v1.y, v2.x - v1.x)\n  }\n\n  /**\n   *\n   * @param v1\n   * @param v2\n   * @returns {number}\n   */\n  static distanceTo(v1: Point, v2: Point) {\n    return Math.sqrt(MathHelper.distanceToSq(v1, v2))\n  }\n\n  /**\n   *\n   * @param v2\n   * @param v1\n   * @returns {number}\n   */\n  static distanceToSq(v1: Point, v2: Point) {\n    let dx = v1.x - v2.x,\n      dy = v1.y - v2.y\n\n    return dx * dx + dy * dy\n  }\n}\n","export const ActorStates = {\n  idle: Symbol.for(\"Idle\"),\n  walking: Symbol.for(\"Walking\"),\n  fire: Symbol.for(\"Fire\"),\n  died: Symbol.for(\"Died\")\n}\n\nexport const HitLocations = {\n  Head: Symbol.for(\"Head\"),\n  Feet: Symbol.for(\"Feet\"),\n  Front: Symbol.for(\"Front\"),\n  Back: Symbol.for(\"Back\")\n}\n","import * as PIXI from \"pixi.js\"\nglobal.PIXI = PIXI\n\nexport default PIXI\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n)\n\ntype Config = {\n  onSuccess?: (\n    registration: ServiceWorkerRegistration\n  ) => void\n  onUpdate?: (\n    registration: ServiceWorkerRegistration\n  ) => void\n}\n\nexport function register(config?: Config) {\n  if (\n    process.env.NODE_ENV === \"production\" &&\n    \"serviceWorker\" in navigator\n  ) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    )\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config)\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit https://bit.ly/CRA-PWA\"\n          )\n        })\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config)\n      }\n    })\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing\n        if (installingWorker == null) {\n          return\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === \"installed\") {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                \"New content is available and will be used when all \" +\n                  \"tabs for this page are closed. See https://bit.ly/CRA-PWA.\"\n              )\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration)\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log(\n                \"Content is cached for offline use.\"\n              )\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration)\n              }\n            }\n          }\n        }\n      }\n    })\n    .catch((error) => {\n      console.error(\n        \"Error during service worker registration:\",\n        error\n      )\n    })\n}\n\nfunction checkValidServiceWorker(\n  swUrl: string,\n  config?: Config\n) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { \"Service-Worker\": \"script\" }\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get(\n        \"content-type\"\n      )\n      if (\n        response.status === 404 ||\n        (contentType != null &&\n          contentType.indexOf(\"javascript\") === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(\n          (registration) => {\n            registration.unregister().then(() => {\n              window.location.reload()\n            })\n          }\n        )\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config)\n      }\n    })\n    .catch(() => {\n      console.log(\n        \"No internet connection found. App is running in offline mode.\"\n      )\n    })\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready\n      .then((registration) => {\n        registration.unregister()\n      })\n      .catch((error) => {\n        console.error(error.message)\n      })\n  }\n}\n","import React from \"react\"\nimport \"./Header.css\"\n\nexport default function Header() {\n  return (\n    <header>\n      <h1>Mnsion</h1>\n      <hr />\n    </header>\n  )\n}\n","import React from \"react\"\nimport \"./Footer.css\"\n\nexport default function Footer() {\n  return (\n    <footer>\n      <div>\n        <div className=\"entry inline\">\n          <a\n            href=\"https://twitter.com/umlautgames\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            Twitter\n          </a>{\" \"}\n          |\n        </div>\n        <div className=\"entry inline\">\n          <a\n            href=\"https://www.linkedin.com/company/umlaut-games\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            LinkedIn\n          </a>{\" \"}\n          |\n        </div>\n        <div className=\"entry inline\">\n          <a\n            href=\"https://umlaut-games.itch.io\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            itch.io\n          </a>\n        </div>\n      </div>\n\n      <div className=\"copyright\">\n         2020{\" \"}\n        <a\n          href=\"https://umlaut.games\"\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n        >\n          Umlaut Games\n        </a>\n        <span>  All Rights Reserved</span>\n      </div>\n    </footer>\n  )\n}\n","import React from \"react\"\nimport \"./About.css\"\n\nexport default function About() {\n  return (\n    <div className=\"blocks\">\n      <div className=\"block\">\n        <h2>Kickstarter</h2>\n        <p>\n          Lorem ipsum dolor sit amet, consectetur adipiscing\n          elit. Sed mattis sem nunc, vitae consectetur purus\n          volutpat at. Integer at consequat arcu. Curabitur\n          aliquam ex sit amet consectetur bibendum.\n          Phasellus nec metus aliquam, vestibulum est et,\n          efficitur metus. Fusce consectetur vel lectus non\n          feugiat. Nam et ipsum leo. Mauris bibendum semper\n          augue, non dapibus dui vestibulum id. In eget\n          metus nec odio consectetur ultrices ut congue\n          nisi. Vivamus et augue vel risus posuere pulvinar.\n          Vestibulum placerat justo mi, sed aliquam massa\n          lobortis vitae.\n        </p>\n\n        <div className=\"cta\">\n          <button>Preorder Now!</button>\n        </div>\n      </div>\n      <div className=\"block\">\n        <h2>Patreon</h2>\n        <p>\n          Ut vestibulum bibendum enim ut sodales. Nam\n          efficitur, sapien consectetur porttitor dapibus,\n          dolor felis lacinia velit, ut commodo odio leo eu\n          nunc. Curabitur vel libero aliquam, malesuada\n          mauris vel, ornare elit. Sed consectetur mauris eu\n          ante maximus pulvinar. Aliquam arcu metus,\n          pellentesque non nibh id, scelerisque placerat\n          mauris. Cras vel elit metus. Donec pulvinar purus\n          ac ipsum tristique tincidunt. Quisque non placerat\n          sapien. In ut iaculis libero, id dictum sem.\n          Mauris pulvinar vel lorem nec cursus.\n        </p>\n\n        <div className=\"cta\">\n          <button className=\"secondary\">Support us!</button>\n        </div>\n      </div>\n\n      <div className=\"block\">\n        <h2>itch.io</h2>\n        <p>\n          Ut vestibulum bibendum enim ut sodales. Nam\n          efficitur, sapien consectetur porttitor dapibus,\n          dolor felis lacinia velit, ut commodo odio leo eu\n          nunc. Curabitur vel libero aliquam, malesuada\n          mauris vel, ornare elit. Sed consectetur mauris eu\n          ante maximus pulvinar. Aliquam arcu metus,\n          pellentesque non nibh id, scelerisque placerat\n          mauris. Cras vel elit metus. Donec pulvinar purus\n          ac ipsum tristique tincidunt. Quisque non placerat\n          sapien. In ut iaculis libero, id dictum sem.\n          Mauris pulvinar vel lorem nec cursus.\n        </p>\n\n        <div className=\"cta\">\n          <button className=\"secondary\">\n            Get Early Access!\n          </button>\n        </div>\n      </div>\n    </div>\n  )\n}\n","import PIXI from \"./pixi\"\nimport \"pixi-layers\"\nimport \"pixi-sound\"\n\nexport default PIXI\n","export const Config = {\n  /**\n   * shall the objects be outlined in renderer or not\n   */\n  outlineObjects:\n    process.env.NODE_ENV !== \"production\" && false,\n\n  /**\n   * Shall the title screen be locked and only allow access with the magic phrase\n   */\n  lockTitleScreen: true,\n\n  /**\n   * show actor coordinates inside the outlines\n   */\n  showObjectCoordinates:\n    process.env.NODE_ENV !== \"production\" && false,\n\n  /**\n   * shall we show the fps or not?\n   */\n  showFPS: process.env.NODE_ENV !== \"production\" && true,\n\n  /**\n   * shall we log the actor coordinates to the console?\n   */\n  logActorCoordinates:\n    process.env.NODE_ENV !== \"production\" && false,\n\n  /**\n   * shall we log actor collisions?\n   */\n  logCollisions:\n    process.env.NODE_ENV !== \"production\" && false,\n\n  /**\n   * highlight beacons\n   */\n  highlightBeacons:\n    process.env.NODE_ENV !== \"production\" && false,\n\n  constants: {\n    black: 0x000000,\n    white: 0xffffff\n  }\n}\n","import { Config } from \"../config\"\nimport {\n  Text,\n  Container,\n  Graphics,\n  IResourceDictionary,\n  TextStyle\n} from \"pixi.js\"\nimport { MapBase } from \"../maps\"\n\n/**\n *\n */\nexport class ObjectBase extends Container {\n  protected _outlineContainer?: Container\n  protected _map?: MapBase\n\n  protected _baseScale: number = 1\n\n  /**\n   *\n   * @type {Object}\n   * @protected\n   */\n  protected _resources: IResourceDictionary\n\n  /**\n   * Is the this one facing right?\n   * @type {boolean}\n   * @protected\n   */\n  protected _isFacingRight: boolean = true\n\n  /**\n   * the object velocity x\n   * @type {number}\n   * @protected\n   */\n  protected _vx = 0\n\n  /**\n   * the object velocity y\n   * @type {number}\n   * @protected\n   */\n  protected _vy = 0\n\n  /**\n   * the objects rotation velocity\n   * @type {number}\n   * @private\n   */\n  protected _vr = 0\n\n  /**\n   *\n   * @param resources\n   */\n  constructor(resources: IResourceDictionary) {\n    super()\n\n    this._resources = resources\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get vx() {\n    return this._vx\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get vy() {\n    return this._vy\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get vr() {\n    return this._vr\n  }\n\n  /**\n   *\n   * @returns {Number}\n   */\n  get realx() {\n    return this.x - Math.abs(this.width) / 2\n  }\n\n  set map(map: MapBase) {\n    this._map = map\n  }\n\n  public tick(delta: number) {\n    if (this.vx !== 0 || this.vy !== 0 || this.vr !== 0) {\n      this.x += this.vx\n      this.y += this.vy\n      this.rotation += this.vr\n    }\n  }\n\n  /**\n   *\n   * @param actor\n   * @public\n   */\n  public collides(actor: ObjectBase) {\n    const actorBounds = actor.getBounds()\n    const thisBounds = this.getBounds()\n\n    const collides =\n      actorBounds.x + actorBounds.width > thisBounds.x &&\n      actorBounds.x < thisBounds.x + thisBounds.width &&\n      actorBounds.y + actorBounds.height > thisBounds.y &&\n      actorBounds.y < thisBounds.y + thisBounds.height\n\n    if (collides && Config.logCollisions) {\n      console.log(\"this\", thisBounds)\n      console.log(\"actor\", actorBounds)\n    }\n\n    return collides\n  }\n\n  public adaptScale(y: number, height: number) {\n    const scaleOffset = height - y\n    let scale = this._baseScale - scaleOffset / 1000\n\n    this.scale.x = scale\n    this.scale.y = scale\n\n    this._adaptScaleBasedOnOrientation()\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _adaptScaleBasedOnOrientation() {\n    let scale = this.scale.x\n    if (!this._isFacingRight && scale > 0) {\n      this.scale.x = -scale\n    }\n\n    if (this._isFacingRight && scale < 0) {\n      this.scale.x = Math.abs(scale)\n    }\n  }\n\n  public outline() {\n    // do we have a outline?\n    if (this._outlineContainer) {\n      // yep remove if from child\n      this.parent.removeChild(this._outlineContainer)\n      // delete it\n      delete this._outlineContainer\n    }\n\n    this._adaptScaleBasedOnOrientation()\n\n    this._outlineContainer = new Container()\n    const b = this.getBounds()\n    const lb = this.parent.toLocal(b)\n\n    if (Config.showObjectCoordinates) {\n      const coordinates = new Text(\n        `x: ${b.x.toFixed(0)} y: ${b.y.toFixed(\n          0\n        )}\\nw: ${b.width.toFixed(0)} h: ${b.height.toFixed(\n          0\n        )}`,\n        {\n          fontSize: \"10px\",\n          fill: \"#fff\"\n        } as TextStyle\n      )\n\n      coordinates.x = lb.x\n      coordinates.y = lb.y\n\n      this._outlineContainer.addChild(coordinates)\n    }\n\n    // create new\n    const outline = new Graphics()\n    outline.lineStyle(1, 0x000)\n\n    outline.drawRect(lb.x, lb.y, b.width, b.height)\n\n    outline.endFill()\n\n    // attach to object\n    this._outlineContainer.addChild(outline)\n\n    this.parent.addChild(this._outlineContainer)\n  }\n}\n","import { IDictionary } from \"../tools/IDictionary\"\nimport { ObjectBase } from \"./object-base\"\nimport { AnimatedSprite } from \"pixi.js\"\n\n/**\n *\n */\nexport class AnimationBase extends ObjectBase {\n  /**\n   * array for animations\n   * @type {{}}\n   * @protected\n   */\n  protected _clips: IDictionary<AnimatedSprite> = {}\n\n  /**\n   * current clip that is beeing played\n   * @type {null}\n   * @private\n   */\n  protected _currentClip?: AnimatedSprite\n\n  /**\n   *\n   * @param isFacingRight\n   * @protected\n   */\n  protected _setIsFacingRight(isFacingRight: boolean) {\n    this._isFacingRight = isFacingRight\n    this._adaptScaleBasedOnOrientation()\n  }\n\n  protected _playClip(\n    which: string,\n    loop: boolean,\n    dontRemove?: boolean\n  ) {\n    if (this._currentClip) {\n      this.removeChild(this._currentClip)\n      this._currentClip = undefined\n    }\n\n    return new Promise(\n      (resolve: Function, reject: Function) => {\n        // load punch clip\n        const clipToPlay = this._clips[which]\n\n        if (!clipToPlay) {\n          const err =\n            \"AnimationBase: failed to load clip: \" + which\n          console.log(err, this._clips)\n          reject(err)\n        }\n\n        clipToPlay.zIndex = 1\n\n        // play clip\n        this.addChild(clipToPlay)\n\n        // set the current playing clip\n        this._currentClip = clipToPlay\n\n        this._adaptScaleBasedOnOrientation()\n\n        this._currentClip.loop = loop\n        this._currentClip.gotoAndPlay(0)\n\n        this.children.sort((a, b) => a.zIndex - b.zIndex)\n\n        if (!loop) {\n          clipToPlay.onComplete = () => {\n            clipToPlay.stop()\n\n            if (!dontRemove) {\n              this.removeChild(clipToPlay)\n            }\n\n            resolve()\n          }\n        }\n      }\n    )\n  }\n}\n","import { AnimationBase } from \"./animation-base\"\nimport { IResourceDictionary, Sprite } from \"pixi.js\"\n\n/**\n *\n */\nexport class Decale extends AnimationBase {\n  constructor(\n    resources: IResourceDictionary,\n    which: string\n  ) {\n    super(resources)\n\n    const res = this._resources[\"things.decals\"]\n\n    const decale = new Sprite(res.textures![which])\n\n    this.addChild(decale)\n  }\n}\n","import { AnimationBase } from \"./animation-base\"\nimport { AnimationHelper } from \"../tools\"\nimport { IResourceDictionary, filters } from \"pixi.js\"\n\n/**\n *\n */\nexport class Door extends AnimationBase {\n  constructor(\n    resources: IResourceDictionary,\n    done?: () => void\n  ) {\n    super(resources)\n\n    const which = \"things.door\"\n\n    this._clips = {\n      [which]: AnimationHelper.loadClip(\n        this._resources,\n        which,\n        0.01,\n        8\n      )\n    }\n\n    this._clips[which].filters = [\n      new filters.BlurFilter(0.2)\n    ]\n\n    this._playClip(which, false, false).then(() => {\n      if (done) {\n        done()\n      }\n    })\n  }\n}\n","import { ObjectBase } from \"./object-base\"\nimport {\n  Text,\n  IResourceDictionary,\n  TextStyle\n} from \"pixi.js\"\n\nexport class Crosshair extends ObjectBase {\n  constructor(resources: IResourceDictionary) {\n    super(resources)\n\n    this.addChild(\n      new Text(\"x\", {\n        fill: \"#fff\"\n      } as TextStyle)\n    )\n  }\n}\n","import { AnimationBase } from \"./animation-base\"\nimport { AnimationHelper } from \"../tools\"\nimport { IResourceDictionary } from \"pixi.js\"\n\n/**\n *\n */\nexport class Blood extends AnimationBase {\n  constructor(\n    resources: IResourceDictionary,\n    speed: number = 0.01\n  ) {\n    super(resources)\n    const which = \"things.blood\"\n\n    this._clips = {\n      [which]: AnimationHelper.loadClip(\n        this._resources,\n        which,\n        speed,\n        1\n      )\n    }\n\n    this._playClip(which, false, false)\n  }\n}\n","import { Config } from \"../config\"\nimport { ObjectBase } from \"./object-base\"\nimport {\n  IResourceDictionary,\n  Sprite,\n  Texture\n} from \"pixi.js\"\n\nexport class Beacon extends ObjectBase {\n  constructor(\n    resources: IResourceDictionary,\n    width: number,\n    height: number\n  ) {\n    super(resources)\n\n    this._isFacingRight = true\n\n    this.height = height\n    this.width = width\n\n    const bg = new Sprite(\n      Config.highlightBeacons\n        ? Texture.WHITE\n        : Texture.EMPTY\n    )\n\n    bg.width = width\n    bg.height = height\n\n    if (Config.highlightBeacons) {\n      bg.tint = 0xff0000\n    }\n\n    this.addChild(bg)\n  }\n}\n","import { AnimationBase } from \"./animation-base\"\nimport {\n  Text,\n  IResourceDictionary,\n  SCALE_MODES,\n  Sprite,\n  TextStyle,\n  Texture,\n  settings\n} from \"pixi.js\"\n\nsettings.SCALE_MODE = SCALE_MODES.NEAREST\n\n/**\n *\n */\nexport class TextWithBackground extends AnimationBase {\n  constructor(\n    resources: IResourceDictionary,\n    text: string,\n    fontSize: string = \"8px\",\n    fontColor: string = \"#fff\",\n    background?: number,\n    dropShadowColor?: string\n  ) {\n    super(resources)\n\n    const style: TextStyle = {\n      fontSize,\n      fill: fontColor,\n      fontFamily: \"Press Start 2P\"\n    } as TextStyle\n\n    if (dropShadowColor) {\n      style.dropShadow = true\n      style.dropShadowColor = dropShadowColor\n    }\n\n    const t = new Text(text, style)\n\n    if (!isNaN(background!)) {\n      const bg = new Sprite(Texture.WHITE)\n\n      bg.width = t.width\n      bg.height = t.height\n      bg.tint = background!\n\n      this.addChild(bg)\n    }\n\n    this.addChild(t)\n  }\n}\n","import { AnimationBase } from \"./animation-base\"\nimport { TextWithBackground } from \"./text-with-background\"\nimport { IResourceDictionary } from \"pixi.js\"\nimport { Config } from \"../config\"\n\n/**\n *\n */\nexport class TextBubble extends AnimationBase {\n  constructor(\n    resources: IResourceDictionary,\n    text: string,\n    duration: number,\n    done: () => void\n  ) {\n    super(resources)\n\n    this.addChild(\n      new TextWithBackground(\n        resources,\n        text,\n        \"8px\",\n        \"#fff\",\n        Config.constants.black\n      )\n    )\n\n    setTimeout(() => {\n      done()\n    }, duration * 1000)\n  }\n}\n","import { IResourceDictionary, Point } from \"pixi.js\"\nimport { ActorStates, MathHelper } from \"../tools\"\nimport { AnimationBase } from \"../objects\"\nimport { TextBubble } from \"../objects/text-bubble\"\nimport { Config } from \"../config\"\n\n/**\n * @class\n */\nexport class ActorBase extends AnimationBase {\n  protected _text?: TextBubble\n\n  // time delta of last sprite flip\n  private _lastFlip = 0\n\n  /**\n   *\n   * @type {null}\n   * @protected\n   */\n  protected _skin?: string\n\n  /**\n   *\n   * @type {number}\n   * @protected\n   */\n  protected _speed = 1\n\n  /**\n   * the objects health\n   * @type {number}\n   * @protected\n   */\n  protected _health = 100\n\n  /**\n   * the objects striking power\n   * @type {number}\n   * @protected\n   */\n  protected _power = 12\n\n  /**\n   * @type {Symbol}\n   * @protected\n   */\n  protected _state: Symbol = ActorStates.idle\n\n  /**\n   * can we get git again helper\n   * @type {boolean}\n   * @protected\n   */\n  protected _canGetHitAgain = true\n\n  /**\n   * @constructor\n   */\n  constructor(\n    resources: IResourceDictionary,\n    skin: string,\n    speed: number\n  ) {\n    super(resources)\n\n    /**\n     * set the actor skin\n     * @type {String}\n     * @protected\n     */\n    this._skin = skin\n\n    /**\n     * the objects speed\n     * @type {number}\n     * @protected\n     */\n    this._speed = speed\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get power() {\n    return this._power\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get health() {\n    return this._health\n  }\n\n  /**\n   *\n   * @returns {Symbol}\n   */\n  public get state() {\n    return this._state\n  }\n\n  /**\n   *\n   * @param state\n   * @protected\n   */\n  protected _setState(state: Symbol) {\n    console.log(this.constructor.name, \"New state:\", state)\n    this._state = state\n  }\n\n  /**\n   *\n   * @protected\n   */\n  protected _idle(clip: string = \".idle\") {\n    // dont go to idle if we are dead\n    if (this._state !== ActorStates.died) {\n      this._setState(ActorStates.idle)\n\n      this._playClip(this._skin + clip, true)\n    }\n  }\n\n  /**\n   *\n   * @protected\n   */\n  protected _died() {\n    this._setState(ActorStates.died)\n\n    // remove all velocity\n    this._vy = 0\n    this._vx = 0\n    this._vr = 0\n\n    // play died clip\n    this._playClip(this._skin + \".died\", false, true)\n  }\n\n  /**\n   * @public\n   * @param actor\n   * @returns {boolean}\n   */\n  public hitBy(actor: ActorBase) {\n    let died = false\n    let objectTookDamage = false\n\n    if (this._canGetHitAgain) {\n      // lower the heal\n      this._health -= actor.power\n\n      objectTookDamage = true\n\n      // after we got hit we cannot get hit again\n      this._canGetHitAgain = false\n\n      // are we death?\n      if (this._health < 0) {\n        this._health = 0\n\n        // yep\n        died = true\n\n        this._died()\n      }\n      // not died\n      else {\n        // force the player a little bit back on hit\n        this._vx = actor._isFacingRight ? 5 : -5\n\n        // play the gothit clip\n        this._playClip(this._skin + \".gothit\", false).then(\n          () => {\n            // animation ended!\n\n            // remove the velocity\n            this._vx = 0\n\n            // yep we can get hit again\n            this._canGetHitAgain = true\n\n            // stand up and idle afterwards\n            this._idle()\n          }\n        )\n      }\n    }\n\n    return {\n      died,\n      objectTookDamage\n    }\n  }\n\n  public flip(direction?: boolean) {\n    this._setIsFacingRight(\n      direction !== undefined\n        ? direction\n        : !this._isFacingRight\n    )\n  }\n\n  /**\n   *\n   * @param target\n   */\n  public moveTowards(target: Point) {\n    const dist = MathHelper.distanceTo(\n      this.position,\n      target\n    )\n\n    let vx = 0\n    let vy = 0\n\n    if (dist > 1) {\n      let angleToTarget = MathHelper.angleBetweenRad(\n        this.position,\n        target\n      )\n\n      vy = Math.sin(angleToTarget) * this._speed\n      vx = Math.cos(angleToTarget) * this._speed\n\n      // flip player over\n      if (\n        vx > 0 &&\n        !this._isFacingRight &&\n        this._canFlipAgain()\n      ) {\n        //console.log(\"Enemy:\", \"flip left\");\n        this.flip()\n      }\n      // flip player over\n      else if (\n        vx < 0 &&\n        this._isFacingRight &&\n        this._canFlipAgain()\n      ) {\n        //console.log(\"Enemy:\", \"flip right\");\n        this.flip()\n      }\n    }\n\n    this._vy = vy\n    this._vx = vx\n  }\n\n  /**\n   *\n   * @returns {boolean}\n   * @private\n   */\n  private _canFlipAgain() {\n    let canFlip = true\n    if (Date.now() - this._lastFlip > 200) {\n      canFlip = true\n      this._lastFlip = Date.now()\n    }\n\n    return canFlip\n  }\n\n  private _logActorCoordinates() {\n    if (Config.logActorCoordinates) {\n      console.log(\n        \"x\",\n        this.x,\n        \"real x\",\n        this.realx,\n        \"y\",\n        this.y,\n        \"width\",\n        this.width,\n        \"height\",\n        this.height\n      )\n    }\n  }\n\n  protected moved() {\n    this._logActorCoordinates()\n    if (this._text) {\n      this._text.x = this.x - this._text.width / 2\n      this._text.y = this.y - 25\n    }\n  }\n\n  public speak(text: string) {\n    if (this.parent && !this._text) {\n      this._text = new TextBubble(\n        this._resources,\n        text,\n        3,\n        () => {\n          this.parent.removeChild(this._text!)\n          delete this._text\n        }\n      )\n      this._text.zIndex = 80\n      this._text.x = this.x - this._text.width / 2\n      this._text.y = this.y - 25\n      this.parent.addChild(this._text)\n    }\n  }\n\n  public move(\n    maxHeight: number,\n    maxWidth: number\n  ): boolean {\n    return false\n  }\n}\n","import { MathHelper } from \"../tools\"\nimport { AnimationBase } from \"./animation-base\"\nimport TWEEN from \"@tweenjs/tween.js\"\nimport {\n  IResourceDictionary,\n  Sprite,\n  Texture\n} from \"pixi.js\"\n\n/**\n *\n */\nexport class Shell extends AnimationBase {\n  constructor(\n    resources: IResourceDictionary,\n    texture: Texture,\n    vx: number,\n    vy: number,\n    vr: number\n  ) {\n    super(resources)\n\n    this.pivot.x = this.width / 2\n    this.pivot.y = this.height / 2\n\n    this._vr = vr\n    this._vx = vx\n    this._vy = vy\n    const sprite = new Sprite(texture)\n\n    // const t = TweenMax.to(sprite, 2.5, {ease: Back.easeInOut.config(4), y: -200})\n\n    sprite.rotation = MathHelper.getRandomInt(0, 100)\n\n    this.scale.x = 0.05\n    this.scale.y = 0.05\n\n    const start = {\n      x: 0,\n      y: 0\n    }\n\n    new TWEEN.Tween(start)\n      .to({ x: -MathHelper.getRandomInt(800, 1200) }, 500)\n      .repeat(1)\n      .onUpdate((coords) => {\n        sprite.x = coords.x\n      })\n      .start(0)\n\n    new TWEEN.Tween(start)\n      .to({ y: MathHelper.getRandomInt(1000, 1400) }, 300)\n      .easing(TWEEN.Easing.Bounce.Out)\n      .repeat(2)\n      .yoyo(true)\n      .onUpdate((coords) => {\n        sprite.y = coords.y\n      })\n      .start(0)\n\n    this.addChild(sprite)\n  }\n\n  tick(delta: number) {}\n}\n","import { AnimationBase } from \"./animation-base\"\nimport { AnimationHelper } from \"../tools\"\nimport { IResourceDictionary } from \"pixi.js\"\n\n/**\n *\n */\nexport class Muzzle extends AnimationBase {\n  constructor(\n    resources: IResourceDictionary,\n    speed: number = 0.01\n  ) {\n    super(resources)\n    const which = \"things.muzzle\"\n\n    this._clips = {\n      [which]: AnimationHelper.loadClip(\n        this._resources,\n        which,\n        speed,\n        1\n      )\n    }\n\n    this._playClip(which, false, false)\n  }\n}\n","import { ObjectBase } from \"../object-base\"\nimport { Shell } from \"../shell\"\nimport { Muzzle } from \"../muzzle\"\nimport { IResourceDictionary, Sprite } from \"pixi.js\"\n\nexport class WeaponBase extends ObjectBase {\n  protected _reloadTime: number\n  protected _isReloading: boolean = false\n\n  protected _power: number\n  protected _maxRounds: number\n  protected _rounds: number\n  protected _sprite?: Sprite\n  protected _roundsSprite?: Sprite\n  private _shellSprites: Shell[] = []\n\n  get rounds() {\n    return this._rounds\n  }\n\n  get sprite() {\n    return this._sprite\n  }\n\n  get roundsSprite() {\n    return this._roundsSprite\n  }\n\n  get isReloading() {\n    return this._isReloading\n  }\n\n  constructor(\n    resources: IResourceDictionary,\n    power: number,\n    rounds: number\n  ) {\n    super(resources)\n\n    this._power = power\n    this._rounds = rounds\n    this._maxRounds = rounds\n    this._reloadTime = 5\n\n    this.zIndex = 100\n\n    this.x = -5\n    this.y = 20\n  }\n\n  public fire(): boolean {\n    if (this._rounds > 0 && !this._isReloading) {\n      // muzzle flash\n      const muzzleFlash = new Muzzle(this._resources, 2)\n\n      muzzleFlash.x = 60\n      muzzleFlash.y = -25\n      this.addChild(muzzleFlash)\n\n      this._rounds--\n\n      const speed = 2\n      const shell = new Shell(\n        this._resources,\n        this._roundsSprite?.texture!,\n        speed,\n        speed,\n        0.1\n      )\n\n      const p = this.parent.parent\n      shell.position = this.parent.position\n\n      // add shell to the parent element because we want to let it fly around\n      p.addChild(shell)\n\n      this._shellSprites.push(shell)\n\n      setTimeout(() => {\n        p.removeChild(shell)\n        this._shellSprites = this._shellSprites.splice(\n          this._shellSprites.findIndex((s) => s === shell)\n        )\n      }, 3 * 1000)\n\n      // todo: add fire sound\n\n      return true\n    }\n\n    // todo: add empty clips sound\n\n    return false\n  }\n\n  public tick(delta: number) {\n    for (const shellSprite of this._shellSprites) {\n      shellSprite.tick(delta)\n    }\n  }\n\n  public reload(): boolean {\n    if (this.isReloading) {\n      return false\n    }\n\n    this._isReloading = true\n    setTimeout(() => {\n      this._rounds = this._maxRounds\n      this._isReloading = false\n    }, this._reloadTime * 1000)\n\n    console.log(\"reload\")\n    return true\n  }\n}\n","import { WeaponBase } from \"./weapon-base\"\nimport { IResourceDictionary, Sprite } from \"pixi.js\"\n\n/**\n *\n */\nexport class Shotgun extends WeaponBase {\n  /**\n   *\n   * @param resources\n   */\n  constructor(resources: IResourceDictionary) {\n    super(resources, 55, 6)\n\n    const which = \"weapons.shotgun\"\n\n    const res = resources![which]\n\n    this._roundsSprite = new Sprite(\n      res.textures![\"shell.png\"]!\n    )\n\n    this._sprite = new Sprite(res.textures![\"shotgun.png\"]!)\n\n    this._sprite.scale.x = 0.1\n    this._sprite.scale.y = 0.1\n\n    // shotgun should be in the back so add it first\n    this.addChild(this._sprite)\n  }\n}\n","import { WeaponBase } from \"./weapon-base\"\nimport { IResourceDictionary, Sprite } from \"pixi.js\"\n\n/**\n *\n */\nexport class Beretta extends WeaponBase {\n  fireSound\n  reloadSound\n\n  /**\n   *\n   * @param resources\n   */\n  constructor(resources: IResourceDictionary) {\n    super(resources, 55, 8)\n\n    const which = \"weapons.beretta\"\n\n    this.fireSound = resources[\"beretta.fire\"].sound\n    this.reloadSound = resources[\"beretta.reload\"].sound\n\n    this._reloadTime = this.reloadSound.duration\n\n    const res = resources![which]\n\n    // todo: replace with correct skin\n    this._sprite = new Sprite(res.textures![\"beretta.png\"]!)\n\n    this._sprite.scale.x = 0.1\n    this._sprite.scale.y = 0.1\n\n    // sprite should be in the back so add it first\n    this.addChild(this._sprite)\n\n    this._roundsSprite = new Sprite(\n      res.textures![\"shell.png\"]!\n    )\n  }\n\n  public fire(): boolean {\n    const f = super.fire()\n    if (f) {\n      this.fireSound.play()\n    }\n    return f\n  }\n\n  reload(): boolean {\n    const didReload = super.reload()\n    if (didReload) {\n      this.reloadSound.play()\n    }\n    return didReload\n  }\n}\n","import {\n  BLEND_MODES,\n  filters,\n  IResourceDictionary,\n  Sprite\n} from \"pixi.js\"\nimport { SimpleLightmapFilter } from \"@pixi/filter-simple-lightmap\"\nimport { ObjectBase } from \"./object-base\"\n\n/**\n *\n */\nexport class Flashlight extends ObjectBase {\n  constructor(resources: IResourceDictionary) {\n    super(resources)\n\n    const lightCone = new Sprite(\n      resources![\"flashlight\"].texture\n    )\n\n    this.scale.set(2)\n    lightCone.width = 100\n    lightCone.height = 50\n    lightCone.alpha = 0.2\n    lightCone.tint = 0xefebd8\n    lightCone.y = -20\n\n    lightCone.zIndex = 99999\n    const f = new SimpleLightmapFilter(\n      resources![\"flashlight\"].texture\n    )\n\n    f.alpha = 0.1\n    f.blendMode = BLEND_MODES.ADD\n    lightCone.filters = [new filters.NoiseFilter(0.2), f]\n\n    this.zIndex = 9999\n    this.addChild(lightCone)\n  }\n}\n","import {\n  Beretta,\n  Shotgun,\n  WeaponBase\n} from \"../objects/weapons\"\nimport { ActorBase } from \"./actor-base\"\nimport {\n  ActorStates,\n  AnimationHelper,\n  MathHelper\n} from \"../tools\"\nimport { IResourceDictionary, Point } from \"pixi.js\"\nimport { Flashlight } from \"../objects/flashlight\"\n\nconst weapons: {\n  shotgun?: Shotgun\n  beretta?: Beretta\n} = {}\n\n/**\n *\n */\nexport class Player extends ActorBase {\n  private _weapon: WeaponBase\n  private _name: string = \"Taro\"\n\n  flashlight?: Flashlight\n\n  get weapon(): WeaponBase {\n    return this._weapon\n  }\n\n  get playerName() {\n    return this._name\n  }\n\n  /**\n   *\n   * @param resources\n   * @param skin\n   */\n  constructor(\n    resources: IResourceDictionary,\n    skin: string\n  ) {\n    super(resources, skin, 3)\n\n    this._baseScale = 2\n\n    this._health = 77\n\n    // load the clips for this object\n    this._clips[\n      this._skin + \".idle\"\n    ] = AnimationHelper.loadClip(\n      this._resources,\n      this._skin + \".idle\",\n      0.1,\n      1\n    )\n    this._clips[\n      this._skin + \".idle_handgun\"\n    ] = AnimationHelper.loadClip(\n      this._resources,\n      this._skin + \".idle_handgun\",\n      0.1,\n      1\n    )\n    /*    this._clips[this._skin + \".walk\"] =\n          AnimationHelper.loadClip(\n            this._resources, this._skin + \".walk\", 0.2, 1\n          );\n        this._clips[this._skin + \".punch\"] =\n          AnimationHelper.loadClip(\n            this._resources, this._skin + \".punch\", 0.3, 1\n          );\n        this._clips[this._skin + \".kick\"] =\n          AnimationHelper.loadClip(\n            this._resources, this._skin + \".kick\", 0.2, 1\n          );\n        this._clips[this._skin + \".gothit\"] =\n          AnimationHelper.loadClip(\n            this._resources, this._skin + \".gothit\", 0.2, 1\n          );\n        this._clips[this._skin + \".died\"] =\n          AnimationHelper.loadClip(\n            this._resources, this._skin + \".died\", 0.2, 1\n          );*/\n\n    weapons.shotgun = new Shotgun(resources)\n    weapons.beretta = new Beretta(resources)\n    this.flashlight = new Flashlight(resources)\n\n    // todo get this from equipment\n    this._weapon = weapons.beretta\n    this.addChild(this._weapon)\n\n    // go to idle\n    this.relax()\n  }\n\n  private relax() {\n    //  this._idle(this._weapon && this._weapon instanceof Beretta ? \".idle_handgun\" : \".idle\")\n    this._idle()\n  }\n\n  public reload() {\n    // todo check equipment for shells\n    this._weapon.reload()\n  }\n\n  public switchWeapon() {\n    if (!this.weapon.isReloading) {\n      this.removeChild(this._weapon)\n\n      if (this._weapon instanceof Shotgun) {\n        this._weapon = weapons.beretta!\n      } else if (this._weapon instanceof Beretta) {\n        this._weapon = weapons.shotgun!\n      }\n\n      this.toggleFlashlight()\n\n      this.addChild(this._weapon)\n    }\n  }\n\n  private toggleFlashlight() {\n    if (this._map && this.flashlight) {\n      if (\n        this._map.foregroundContainer.children.find(\n          (c) => c === this.flashlight\n        )\n      ) {\n        this._map.foregroundContainer.removeChild(\n          this.flashlight\n        )\n      } else {\n        this.flashlight.position.set(this.x, this.y)\n        this._map.foregroundContainer.addChild(\n          this.flashlight\n        )\n\n        this._map.foregroundContainer.children.sort(\n          (a, b) => a.zIndex - b.zIndex\n        )\n      }\n    }\n  }\n\n  public updateCrosshairPosition(crosshairPosition: Point) {\n    const angle: number = this._isFacingRight\n      ? MathHelper.angleBetweenRad(\n          this.weaponLocation,\n          crosshairPosition\n        )\n      : -MathHelper.angleBetweenRad(\n          crosshairPosition,\n          this.weaponLocation\n        )\n    this._weapon.rotation = angle\n  }\n\n  get weaponLocation(): Point {\n    return this.toGlobal(this._weapon.position)\n  }\n\n  /**\n   *\n   * @returns {boolean}\n   * @private\n   */\n  private _canBeControlled() {\n    if (this._state === ActorStates.died) {\n      console.log(\"Cant be controlled, player is dead\")\n      return false\n    }\n\n    return (\n      this._state === ActorStates.idle ||\n      this._state === ActorStates.walking\n    )\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _died() {\n    super._died()\n\n    // todo: add dying animation\n    // the died animation is way lower so we need to\n    // adjust the hight a bit\n    this.y += this.height / 2\n\n    this.height = this.height / 2\n  }\n\n  /**\n   * @public\n   */\n  public fire(): boolean {\n    if (!this._canBeControlled()) {\n      return false\n    }\n\n    // try to fires\n    const fire = this._weapon.fire()\n    if (fire) {\n      // we fired, announce\n      this.speak(\"Png!\")\n\n      // set state, remove velo\n      this._setState(ActorStates.fire)\n      this._vx = 0\n      this._vy = 0\n\n      // play fire animation\n      this._playClip(this._skin + \".punch\", false).then(\n        () => {\n          // once done, go back to idle\n          this.relax()\n        }\n      )\n      return true\n    } else {\n      this.relax()\n      return false\n    }\n  }\n\n  /**\n   * @public\n   */\n  public moveRight() {\n    if (this._canBeControlled()) {\n      this._vx = this._speed\n      this._playClip(this._skin + \".walk\", true)\n      this._setState(ActorStates.walking)\n    }\n  }\n\n  /**\n   * @public\n   */\n  public moveLeft() {\n    if (this._canBeControlled()) {\n      this._vx = -this._speed\n      this._playClip(this._skin + \".walk\", true)\n      this._setState(ActorStates.walking)\n      this._adaptScaleBasedOnOrientation()\n    }\n  }\n\n  /**\n   * @public\n   */\n  public stopMoveHorizontally() {\n    this._vx = 0\n    if (this._vy === 0 && this._canBeControlled()) {\n      this.relax()\n    }\n  }\n\n  /**\n   * @public\n   */\n  public moveUp() {\n    if (this._canBeControlled()) {\n      this._vy = -this._speed\n      this._playClip(this._skin + \".walk\", true)\n      this._setState(ActorStates.walking)\n    }\n  }\n\n  /**\n   * @public\n   */\n  public moveDown() {\n    if (this._canBeControlled()) {\n      this._vy = this._speed\n      this._playClip(this._skin + \".walk\", true)\n      this._setState(ActorStates.walking)\n    }\n  }\n\n  /**\n   * @public\n   */\n  public stopMoveVertically() {\n    this._vy = 0\n    if (this._vx === 0 && this._canBeControlled()) {\n      this.relax()\n    }\n  }\n\n  public speak(text: string) {\n    super.speak(`${this._name}: ${text}`)\n  }\n\n  public move(\n    maxHeight: number,\n    maxWidth: number\n  ): boolean {\n    let playerMoved = false\n\n    if (\n      // do we have velocity?\n      this.vy !== 0 &&\n      this.y + this.vy > 0 &&\n      // dont move lower than the bottom\n      this.y + this.height + this.vy < maxHeight\n    ) {\n      this.y += this.vy\n      playerMoved = true\n    }\n\n    // move right\n    if (this.vx > 0) {\n      // dont walk further than the right border of the map\n      if (\n        this.realx + Math.abs(this.width) + 7 + this.vx <\n        maxWidth\n      ) {\n        this.x += this.vx\n        playerMoved = true\n      }\n    }\n    // move left\n    else if (this.vx < 0) {\n      // detect left col\n      if (this.realx + this.vx >= 0) {\n        this.x += this.vx\n        playerMoved = true\n      }\n    }\n\n    if (playerMoved) {\n      this.adaptScale(this.y, maxHeight)\n      this.flashlight?.position.set(this.x, this.y)\n      this.moved()\n    }\n\n    return playerMoved\n  }\n\n  public tick(delta: number) {\n    this.weapon.tick(delta)\n  }\n}\n","import { AnimationBase } from \"../objects\"\nimport {\n  Container,\n  IResourceDictionary,\n  ITextureDictionary\n} from \"pixi.js\"\n\n/**\n *\n */\nexport class MapBase extends AnimationBase {\n  private readonly _explorationOffset: number\n  protected _textures?: ITextureDictionary\n  protected _backgroundContainer: Container\n  protected _actorContainer: Container\n  protected _foregroundContainer: Container\n  protected _onDone\n\n  public withHud: boolean = true\n  public withCrosshair: boolean = true\n  public withPlayer: boolean = true\n  public withMouse: boolean = true\n  public withDarkness: boolean = false\n\n  constructor(\n    resources: IResourceDictionary,\n    protected _width: number,\n    mapToLoad?: string,\n    onDone?: () => void\n  ) {\n    super(resources)\n\n    this._onDone = onDone\n    this._explorationOffset = this._width / 3\n\n    if (mapToLoad) {\n      // load the clips for this object\n      this._textures = resources[mapToLoad].textures\n    }\n\n    /**\n     * setup background\n     * @type {Container}\n     * @private\n     */\n    this._backgroundContainer = new Container()\n    this.addChild(this._backgroundContainer)\n\n    /**\n     * setup actors\n     * @type {Container}\n     * @private\n     */\n    this._actorContainer = new Container()\n    this.addChild(this._actorContainer)\n\n    /**\n     * setup foreground\n     * @type {Container}\n     * @private\n     */\n    this._foregroundContainer = new Container()\n    this.addChild(this._foregroundContainer)\n  }\n\n  /**\n   *\n   * @returns {Container}\n   */\n  get actorContainer() {\n    return this._actorContainer\n  }\n\n  /**\n   *\n   * @returns {Container}\n   */\n  get backgroundContainer() {\n    return this._backgroundContainer\n  }\n\n  get foregroundContainer() {\n    return this._foregroundContainer\n  }\n\n  set onDone(onDone: () => void) {\n    this._onDone = onDone\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setup() {\n    // stub\n  }\n\n  /**\n   *\n   * @param playerX\n   * @param scrollAmount\n   */\n  public shallScroll(\n    playerX: number,\n    scrollAmount: number\n  ) {\n    if (\n      // move right\n      (scrollAmount > 0 &&\n        playerX + this._explorationOffset > this._width) ||\n      // move left\n      (scrollAmount < 0 &&\n        playerX - this._explorationOffset <\n          this._explorationOffset)\n    ) {\n      // move map based on positive or negative scroll amount\n      this.x -= scrollAmount\n\n      // left bound\n      if (this.x > 0) {\n        this.x = 0\n      }\n\n      // right bound\n      if (this.x < this._width - this.width) {\n        this.x = this._width - this.width\n      }\n    }\n  }\n\n  protected done() {\n    if (this._onDone) {\n      this._onDone()\n    }\n  }\n}\n","import { MapBase } from \"./map-base\"\nimport {\n  BLEND_MODES,\n  IResourceDictionary,\n  Sprite,\n  Texture\n} from \"pixi.js\"\n\n/**\n *\n */\nexport class MaensionOutside extends MapBase {\n  constructor(\n    resources: IResourceDictionary,\n    width: number\n  ) {\n    super(resources, width, \"maps.maension\")\n\n    this.withDarkness = true\n\n    let starryNight = new Sprite(this._textures![\"sky.png\"])\n    starryNight.scale.x = 2.56\n    starryNight.scale.y = 2.56\n\n    this._backgroundContainer.addChild(starryNight)\n\n    let maension = new Sprite(\n      this._textures![\"Maension_WIP.png\"]\n    )\n\n    maension.y = -40\n    maension.scale.x = 2\n    maension.scale.y = 2\n\n    this._backgroundContainer.addChild(maension)\n\n    const tree = this._textures![\"tree.png\"]\n    const tree1 = new Sprite(tree)\n    tree1.x = 100\n    tree1.y = 350\n    tree1.scale.x = 0.4\n    tree1.scale.y = 0.4\n\n    this._actorContainer.addChild(tree1)\n\n    const tree_dead = this._textures![\"tree_dead.png\"]\n    const tree2 = new Sprite(tree_dead)\n    tree2.x = 50\n    tree2.y = 180\n    tree2.scale.x = 0.4\n    tree2.scale.y = 0.4\n\n    this._backgroundContainer.addChild(tree2)\n\n    if (this.withDarkness) {\n      const darkness = new Sprite(Texture.WHITE)\n\n      darkness.width = width\n      darkness.height = this.height\n      darkness.tint = 0x000000\n      darkness.alpha = 0.8\n      darkness.blendMode = BLEND_MODES.MULTIPLY\n      darkness.zIndex = 1\n      this._foregroundContainer.addChild(darkness)\n    }\n\n    this._setup()\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setup() {\n    setInterval(() => {\n      //z1.play();\n    }, 30 * 1000)\n\n    setInterval(() => {\n      //z2.play();\n    }, 67 * 1000)\n  }\n}\n","import { MapBase } from \"./map-base\"\nimport { IResourceDictionary, Sprite } from \"pixi.js\"\n\n/**\n *\n */\nexport class HouseOutside extends MapBase {\n  constructor(\n    resources: IResourceDictionary,\n    width: number\n  ) {\n    super(resources, width, \"maps.house\")\n\n    this._setup()\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setup() {\n    let city = new Sprite(\n      // @ts-ignore\n      this._textures[\"house.png\"]\n    )\n\n    city.scale.x = 1.3\n    city.scale.y = 1.3\n\n    this._backgroundContainer.addChild(city)\n\n    setInterval(() => {\n      //z1.play();\n    }, 30 * 1000)\n\n    setInterval(() => {\n      //z2.play();\n    }, 67 * 1000)\n  }\n}\n","import { MapBase } from \"./map-base\"\nimport {\n  IResourceDictionary,\n  Sprite,\n  TilingSprite\n} from \"pixi.js\"\n\n/**\n *\n */\nexport class Street extends MapBase {\n  constructor(\n    resources: IResourceDictionary,\n    width: number\n  ) {\n    super(resources, width, \"maps.street\")\n\n    this._setup()\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setup() {\n    // background\n\n    // load city first because we need the width\n    // @ts-ignore\n    let city = new Sprite(this._textures[\"city01.png\"])\n    let cityWidth = city.width\n    city.scale.x = 2\n    city.scale.y = 2.1\n    city.y = -100\n\n    let concret = new TilingSprite(\n      // @ts-ignore\n      this._textures[\"concret.png\"]\n    )\n    concret.width = cityWidth\n    concret.height = 300\n    concret.scale.x = 2\n    concret.scale.y = 1.44\n    concret.y = 330\n\n    // concret should be in the back so add it first\n    this._backgroundContainer.addChild(concret)\n\n    this._backgroundContainer.addChild(city)\n\n    // foreground\n    // @ts-ignore\n    let police = new Sprite(this._textures[\"police.png\"])\n    police.scale.x = 2\n    police.scale.y = 2\n\n    police.y = this.height - police.height * 2\n    police.x = 300\n    this._foregroundContainer.addChild(police)\n  }\n}\n","import { Door } from \"../objects\"\nimport { MapBase } from \"./map-base\"\nimport { Config } from \"../config\"\nimport {\n  IResourceDictionary,\n  Sprite,\n  Texture\n} from \"pixi.js\"\n\n/**\n *\n */\nexport class Loading extends MapBase {\n  private readonly _door: Door\n\n  constructor(\n    resources: IResourceDictionary,\n    width: number,\n    done?: () => void\n  ) {\n    super(resources, width)\n\n    const bg = new Sprite(Texture.WHITE)\n\n    this._door = new Door(resources, done)\n    this._door.x = width / 2\n    this._door.y = 30\n\n    bg.width = width\n    bg.height = 800\n    bg.tint = Config.constants.black\n\n    this._backgroundContainer.addChild(bg)\n\n    this._setup()\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setup() {\n    this._foregroundContainer.addChild(this._door)\n  }\n\n  public tick(delta: number) {\n    this._door.y += delta / 100\n    const scale = this._door.scale.x + delta / 20000\n    this._door.scale.x = scale\n    this._door.scale.y = scale\n  }\n}\n","import {\n  Filter,\n  Container,\n  IResourceDictionary,\n  Sprite,\n  Texture,\n  BLEND_MODES\n} from \"pixi.js\"\nimport { MapBase } from \"./map-base\"\nimport { Config } from \"../config\"\nimport { Keyboard } from \"../tools\"\nimport { TextWithBackground } from \"../objects/text-with-background\"\nimport { GodrayFilter } from \"@pixi/filter-godray\"\n\n/**\n *\n */\nexport class Title extends MapBase {\n  enterText: Container\n  bgm\n\n  constructor(\n    resources: IResourceDictionary,\n    width: number,\n    height: number\n  ) {\n    super(resources, width, \"maps.maension\")\n\n    this.bgm = resources[\"bgm.title\"].sound\n    this.bgm.volume = 0.3\n    this.bgm.play()\n\n    this.withHud = false\n    this.withCrosshair = false\n    this.withPlayer = false\n    this.withMouse = false\n\n    const brand = new TextWithBackground(\n      resources,\n      \"Mnsion\",\n      \"54px\",\n      \"#EFB775\",\n      undefined,\n      \"#111\"\n    )\n    brand.x = width / 2 - brand.width / 2\n    brand.y = height / 3 - brand.height / 2\n\n    const isInteractive =\n      window.location.search.endsWith(\"interactive\") ||\n      !Config.lockTitleScreen\n\n    let enterText = \"Press Enter to play\"\n    if (!isInteractive) {\n      enterText = \"coming soon ...\"\n    }\n\n    this.enterText = new Container()\n    this.enterText.addChild(\n      new TextWithBackground(resources, enterText, \"24px\")\n    )\n\n    this.enterText.x = width / 2 - this.enterText.width / 2\n    this.enterText.y =\n      height / 2 - this.enterText.height / 2\n\n    let maension = new Sprite(\n      this._textures![\"Maension_WIP.png\"]\n    )\n\n    maension.alpha = 0.6\n    const scale = 2\n    maension.scale.x = scale\n    maension.scale.y = scale\n\n    maension.y = height - maension.height\n    maension.x = width / 2 - maension.width / 2\n\n    this._foregroundContainer.addChild(\n      maension,\n      this.enterText,\n      brand\n    )\n\n    {\n      const god = new Sprite(Texture.WHITE)\n\n      god.width = width\n      god.height = height\n      god.tint = Config.constants.black\n\n      this.godFilter = new GodrayFilter()\n      this.godFilter.angle = -35\n      this.godFilter.gain = 0.5\n      this.godFilter.lacunarity = 2.5\n      god.filters = [this.godFilter]\n\n      this._backgroundContainer.addChild(god)\n    }\n\n    {\n      const rain = new Sprite(Texture.WHITE)\n\n      rain.width = width\n      rain.height = height\n      rain.tint = Config.constants.black\n\n      const rainFrag = resources[\"shaders.frag-rain\"].data\n\n      this.rainShader = new Filter(undefined, rainFrag)\n      this.rainShader.uniforms.dimensions = [width, height]\n      this.rainShader.uniforms.time = 1\n      this.rainShader.uniforms.u_mouse = [width, height]\n      this.rainShader.uniforms.u_frame = 0\n      this.rainShader.blendMode = BLEND_MODES.ADD\n\n      rain.filters = [this.rainShader]\n\n      this._backgroundContainer.addChild(rain)\n    }\n\n    this._foregroundContainer.interactive = true\n\n    if (isInteractive) {\n      this.wireEvents()\n    }\n  }\n\n  private wireEvents() {\n    const enter = new Keyboard(\"Enter\", true)\n    enter.pressEvent = () => this.done()\n\n    this._foregroundContainer.on(\n      \"touchstart\",\n      this.done.bind(this)\n    )\n  }\n\n  protected done() {\n    this.bgm.stop()\n    super.done()\n  }\n\n  rainShader\n  godFilter\n  count = 0\n\n  public tick(delta: number) {\n    this.enterText.alpha += delta / 2000\n    if (this.enterText.alpha >= 1) {\n      this.enterText.alpha = 0.2\n    }\n\n    this.count += delta / 2000\n    this.godFilter.time = this.count\n    this.rainShader.uniforms.time = this.count\n  }\n}\n","import {\n  Text,\n  Container,\n  Sprite,\n  TextStyle,\n  IResourceDictionary\n} from \"pixi.js\"\nimport { Player } from \"../actors\"\nimport { AnimationBase } from \"../objects\"\n\nexport class HUD extends AnimationBase {\n  private _player: Player\n  private _health: Text\n\n  // round icons\n  private _rounds: Container\n  // weapon icon\n  private _weapon?: Sprite\n\n  // change to \"you are dead ...\"\n  private _gameOverSign?: Text\n\n  private _width: number\n  private _height: number\n\n  static bigText: TextStyle = {\n    fontFamily: \"Arial Black\",\n    fontSize: \"48px\",\n    fontWeight: \"bold\",\n    fill: \"#fff\",\n    dropShadow: true,\n    dropShadowColor: \"#000\",\n    align: \"center\"\n  } as TextStyle\n\n  constructor(\n    resources: IResourceDictionary,\n    player: Player,\n    width: number,\n    height: number\n  ) {\n    super(resources)\n\n    const which = \"things.hud\"\n\n    const res = resources[which]\n\n    this._width = width\n    this._height = height\n\n    console.log(\n      \"Setting up HUD\",\n      \"width:\",\n      this._width,\n      \"height:\",\n      this._height\n    )\n\n    this._player = player\n\n    const smallTextConfig = {\n      ...HUD.bigText,\n      fontSize: \"12px\"\n    }\n\n    const playerName = new Text(player.playerName, {\n      ...smallTextConfig,\n      fill: \"#ffff30\"\n    })\n    playerName.x = this._width / 3 - playerName.width / 2\n    playerName.y = this._height - 47\n    this.addChild(playerName)\n\n    this._health = new Text(\"\", smallTextConfig)\n\n    this._health.x = playerName.x\n    this._health.y = this._height - 23\n    this.addChild(this._health)\n\n    this._rounds = new Container()\n    this._rounds.x = this._width / 3 + 77\n    this._rounds.y = this._height - 33\n\n    this.addChild(this._rounds)\n\n    const healthBorder = new Sprite(\n      res.textures![\"side.png\"]\n    )\n\n    healthBorder.x =\n      this._width / 2 -\n      (healthBorder.width + healthBorder.width / 2) +\n      2\n    healthBorder.y = this._height - healthBorder.height - 2\n\n    this.addChild(healthBorder)\n\n    const roundsBorder = new Sprite(\n      res.textures![\"center.png\"]\n    )\n    roundsBorder.x =\n      this._width / 2 - roundsBorder.width / 2 + 1\n    roundsBorder.y = this._height - roundsBorder.height - 2\n\n    this.addChild(roundsBorder)\n\n    const weaponBorder = new Sprite(\n      res.textures![\"side.png\"]\n    )\n\n    weaponBorder.x =\n      this._width / 2 +\n      (roundsBorder.width + weaponBorder.width / 2) -\n      2\n    weaponBorder.y = this._height - weaponBorder.height - 2\n\n    weaponBorder.scale.x = -1\n\n    this.addChild(weaponBorder)\n\n    this.update()\n  }\n\n  private _renderWeapon() {\n    this.removeChild(this._weapon!)\n\n    this._weapon = new Sprite(\n      this._player.weapon.sprite!.texture\n    )\n    this._weapon.scale.x =\n      this._player.weapon.sprite!.scale.x * 2\n    this._weapon.scale.y =\n      this._player.weapon.sprite!.scale.y * 2\n\n    this._weapon.x =\n      this._width / 2 + (this._weapon.width + 27)\n    this._weapon.y = this._height - 40\n\n    this.addChild(this._weapon)\n  }\n\n  private _renderRounds() {\n    this._rounds.removeChildren()\n\n    for (let x = 0; x < this._player.weapon.rounds; x++) {\n      const roundSprite = new Sprite(\n        this._player.weapon.roundsSprite?.texture\n      )\n      roundSprite.scale.x = 0.1\n      roundSprite.scale.y = 0.1\n      roundSprite.x = 10 * x\n      roundSprite.y = 10\n\n      this._rounds.addChild(roundSprite)\n    }\n  }\n\n  public update() {\n    this._health.text = this._player.health + \" HP\"\n\n    this._renderRounds()\n    this._renderWeapon()\n  }\n\n  public renderGameOver() {\n    this._gameOverSign = new Text(\n      \"Game Over\\nPress Enter to retry!\",\n      {\n        ...HUD.bigText,\n        fill: \"#f00\"\n      }\n    )\n\n    this.addChild(this._gameOverSign)\n\n    // place game over sign in center of screen\n    this._gameOverSign.x =\n      this._width / 2 - this._gameOverSign.width / 2\n    this._gameOverSign.y =\n      this._height / 2 - this._gameOverSign.height / 2\n  }\n\n  public tick(delta: number) {\n    if (this._gameOverSign) {\n      this._gameOverSign.alpha += delta / 1000\n      if (this._gameOverSign.alpha > 1) {\n        this._gameOverSign.alpha = 0.2\n      }\n    }\n  }\n}\n","import { Config } from \"./config\"\nimport { Beacon, Blood, Crosshair, Decale } from \"./objects\"\nimport { ActorBase, EnemyBase, Player } from \"./actors\"\nimport {\n  HouseOutside,\n  Loading,\n  MaensionOutside,\n  MapBase,\n  Street,\n  Title\n} from \"./maps\"\nimport {\n  ActorStates,\n  Gamepads,\n  Keyboard,\n  MathHelper,\n  IDictionary\n} from \"./tools\"\nimport { HUD } from \"./ui\"\nimport {\n  Container,\n  DisplayObject,\n  Graphics,\n  InteractionEvent,\n  IResourceDictionary,\n  Point\n} from \"pixi.js\"\n\nlet maps: IDictionary<MapBase> = {}\n\n/**\n * @class\n */\nexport default class Game {\n  private _stage: Container\n\n  private _hud?: HUD\n  private _map?: MapBase\n  private _player?: Player\n  // special items that are nor visible\n  private _beacon?: Beacon\n  private _enemies: EnemyBase[] = []\n  private _mouseLocation?: Point\n\n  private _isRunning: boolean = true\n\n  private _startOffset?: number\n  private _elapsedSeconds = 0\n\n  private readonly _resources: IResourceDictionary\n\n  private readonly _width: number\n  private readonly _height: number\n\n  private _mouseLine?: Graphics\n  private _crosshair?: Crosshair\n\n  /**\n   *\n   * @param resources\n   * @param stage\n   * @param width\n   * @param height\n   */\n  constructor(\n    resources: IResourceDictionary,\n    stage: Container,\n    width: number,\n    height: number\n  ) {\n    this._stage = stage\n\n    this._resources = resources\n    this._width = width\n    this._height = height\n\n    maps.street = new Street(this._resources, this._width)\n\n    maps.house = new HouseOutside(\n      this._resources,\n      this._width\n    )\n\n    maps.maension = new MaensionOutside(\n      this._resources,\n      this._width\n    )\n\n    maps.loading = new Loading(this._resources, this._width)\n\n    maps.title = new Title(\n      this._resources,\n      this._width,\n      this._height\n    )\n\n    this._init()\n  }\n\n  private switchMap(newMap: MapBase): MapBase {\n    this._stage.removeChild(this._map!)\n    this._stage.removeChild(this._hud!)\n\n    this._map = newMap!\n    this._stage.addChild(this._map)\n\n    if (this._map.withPlayer) {\n      this._player!.x = 60\n      this._player!.y = 400\n\n      this._player!.adaptScale(\n        this._player!.y,\n        this._height\n      )\n      this._player!.map = this._map\n\n      // add player to stage\n      this._map.actorContainer.addChild(this._player!)\n    }\n\n    if (this._map.withCrosshair) {\n      this._crosshair = new Crosshair(this._resources)\n      this._crosshair.adaptScale(\n        this._player!.y,\n        this._height\n      )\n\n      this._stage.cursor = \"none\"\n    }\n\n    if (this._map.withHud) {\n      this._stage.addChild(this._hud!)\n      this._updateHud()\n    }\n\n    if (this._map.withMouse) {\n      this._attachMouse()\n      this._updateMouseLocation(\n        new Point(this._width / 2, this._height / 2)\n      )\n    }\n\n    return newMap!\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _init() {\n    // create player\n    this._player = new Player(this._resources, \"taro\")\n\n    this._hud = new HUD(\n      this._resources,\n      this._player,\n      this._width,\n      this._height\n    )\n\n    const map = this.switchMap(maps.title)\n\n    // todo change this\n    map.onDone = () => {\n      this.switchMap(maps.maension!)\n    }\n\n    // for testing\n    // todo remove\n    this._beacon = new Beacon(this._resources, 80, 5)\n\n    // attach the keyboard to player\n    const gamepad = this._attachGamepad()\n\n    // no gamepad, go to stinky keyboard\n    if (!gamepad) {\n      console.log(\"no gamepad, attaching stinky keyboard\")\n      this._attachKeyboard()\n    }\n\n    // init enemies\n    // todo let map handle this\n    this._enemies = []\n\n    // this game is running baby\n    this._isRunning = true\n\n    console.log(\"Game:\", \"Game init done!\")\n  }\n\n  private _attachMouse() {\n    this._mouseLine = new Graphics()\n    this._stage.addChild(this._mouseLine!)\n    if (this._crosshair) {\n      this._stage.addChild(this._crosshair)\n    }\n\n    this._stage.interactive = true\n    this._stage.on(\"mousemove\", (e: InteractionEvent) => {\n      this._updateMouseLocation(e.data.global)\n    })\n\n    this._stage.on(\"mousedown\", () => this._fire())\n\n    this._stage.on(\n      \"mouseout\",\n      () => (this._isRunning = false)\n    )\n\n    this._stage.on(\n      \"mouseover\",\n      () =>\n        (this._isRunning =\n          this._player!.state !== ActorStates.died)\n    )\n  }\n\n  private _updateCrosshair() {\n    if (\n      this._player &&\n      this._player.state !== ActorStates.died &&\n      this._crosshair &&\n      this._mouseLocation &&\n      this._isRunning\n    ) {\n      this._crosshair.x =\n        this._mouseLocation.x - this._crosshair.width / 2\n      this._crosshair.y =\n        this._mouseLocation.y - this._crosshair.height / 2\n\n      // flip player based on crosshair position\n      if (\n        this._crosshair!.x <\n        this._player!.toGlobal(this._stage).x\n      ) {\n        this._player.flip(false)\n      } else {\n        this._player.flip(true)\n      }\n\n      // update player based on crosshair\n      this._player.updateCrosshairPosition(\n        this._stage.toGlobal(this._crosshair?.position!)\n      )\n\n      // adapt crosshair scale based on player location\n      this._crosshair.adaptScale(\n        this._player!.y,\n        this._height\n      )\n    }\n  }\n\n  private _fire() {\n    if (this._isRunning) {\n      if (this._player?.fire()) {\n        // hit location\n        const impact = new Decale(\n          this._resources,\n          \"impact.png\"\n        )\n        impact.scale.x = 0.1\n        impact.scale.y = 0.1\n\n        const impactLocation = this._map!.toLocal(\n          this._crosshair!\n        )\n        impact.x =\n          impactLocation.x +\n          this._crosshair!.width / 2 -\n          impact.width / 2\n        impact.y =\n          impactLocation.y +\n          this._crosshair!.height / 2 -\n          impact.height / 2\n\n        this._map?.backgroundContainer.addChild(impact)\n\n        this._updateHud()\n      }\n    }\n  }\n\n  private _moveRight() {\n    if (this._isRunning && this._player) {\n      this._player.moveRight()\n    }\n  }\n\n  private _moveLeft() {\n    if (this._isRunning && this._player) {\n      this._player.moveLeft()\n    }\n  }\n\n  private _moveUp() {\n    if (this._isRunning && this._player) {\n      this._player.moveUp()\n    }\n  }\n\n  private _moveDown() {\n    if (this._isRunning && this._player) {\n      this._player.moveDown()\n    }\n  }\n\n  private _stopMoveVertically() {\n    if (this._isRunning) {\n      this._player?.stopMoveVertically()\n    }\n  }\n\n  private _stopMoveHorizontally() {\n    if (this._isRunning) {\n      this._player?.stopMoveHorizontally()\n    }\n  }\n\n  private _attachKeyboard() {\n    const left = new Keyboard(\"ArrowLeft\", true),\n      up = new Keyboard(\"ArrowUp\", true),\n      right = new Keyboard(\"ArrowRight\", true),\n      down = new Keyboard(\"ArrowDown\", true),\n      w = new Keyboard(\"w\", false),\n      r = new Keyboard(\"r\", false),\n      enter = new Keyboard(\"Enter\", false)\n\n    w.pressEvent = () => this._switchWeapon()\n    r.pressEvent = () => this._reload()\n\n    right.pressEvent = () => this._moveRight()\n    right.releaseEvent = () => {\n      if (!left.isDown) {\n        this._stopMoveHorizontally()\n      }\n    }\n\n    left.pressEvent = () => this._moveLeft()\n    left.releaseEvent = () => {\n      if (!right.isDown) {\n        this._stopMoveHorizontally()\n      }\n    }\n\n    up.pressEvent = () => this._moveUp()\n    up.releaseEvent = () => {\n      if (!down.isDown) {\n        this._stopMoveVertically()\n      }\n    }\n\n    down.pressEvent = () => this._moveDown()\n    down.releaseEvent = () => {\n      if (!up.isDown) {\n        this._stopMoveVertically()\n      }\n    }\n\n    enter.pressEvent = () => {\n      if (!this._isRunning) {\n        this._init()\n      }\n    }\n  }\n\n  private _attachGamepad(): boolean {\n    return !!Gamepads.init({\n      // first gamepad\n      0: {\n        // button 1 pressed\n        1: {\n          pressEvent: () => {\n            this._fire()\n          }\n        },\n        // button 15 pressed\n        15: {\n          pressEvent: () => this._moveRight(),\n          releaseEvent: () => this._stopMoveHorizontally()\n        },\n        // button 14 pressed\n        14: {\n          pressEvent: () => this._moveLeft(),\n          releaseEvent: () => this._stopMoveHorizontally()\n        },\n        // button 12 pressed\n        12: {\n          pressEvent: () => this._moveUp(),\n          releaseEvent: () => this._stopMoveVertically()\n        },\n        // button 13 pressed\n        13: {\n          pressEvent: () => this._moveDown(),\n          releaseEvent: () => this._stopMoveVertically()\n        },\n        // button 9 pressed\n        9: {\n          pressEvent: () => {\n            if (!this._isRunning) {\n              this._init()\n            }\n          }\n        }\n      }\n    })\n  }\n\n  /**\n   * this will end the game\n   * @private\n   */\n  private _end() {\n    // game is not longer running dude\n    this._isRunning = false\n\n    this._hud!.renderGameOver()\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _detectCollisions() {\n    if (this._player!.collides(this._beacon!)) {\n      this._player!.speak(\"It's locked!\")\n    }\n\n    if (\n      this._crosshair &&\n      this._crosshair!.collides(this._beacon!)\n    ) {\n      this._beacon = new Beacon(\n        this._resources,\n        this._height,\n        this._width\n      )\n\n      this._stage.removeChild(this._map!)\n      this._map = new Loading(\n        this._resources,\n        this._width,\n        () => {\n          this._map = new MaensionOutside(\n            this._resources,\n            this._width\n          )\n        }\n      )\n      this._stage.addChild(this._map!)\n    }\n\n    for (const enemy of this._enemies) {\n      if (\n        ActorStates.died !== enemy.state &&\n        ActorStates.died !== this._player!.state\n      ) {\n        // does the player collide the enemy?\n        if (this._player!.collides(enemy)) {\n          const playerHit = this._player!.hitBy(enemy)\n\n          if (playerHit.objectTookDamage) {\n            this._drawBlood(this._player!)\n            this._updateHud()\n          }\n\n          // we died and now lives left :(\n          if (playerHit.died) {\n            // end the game\n            this._end()\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   *\n   * @param actor: the bleeding actor\n   * @private\n   */\n  private _drawBlood(actor: ActorBase) {\n    for (let i = 0; i < 5; i++) {\n      const blood = new Blood(this._resources)\n\n      blood.x = actor.x + MathHelper.getRandomInt(-20, 20)\n      blood.y =\n        actor.y +\n        actor.height +\n        MathHelper.getRandomInt(-20, 20)\n      blood.rotation = MathHelper.getRandomInt(0, 10)\n\n      this._map?.backgroundContainer.addChild(blood)\n    }\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _updateHud() {\n    this._hud!.update()\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _updateKI() {\n    for (const enemy of this._enemies) {\n      if (ActorStates.died !== enemy.state) {\n        enemy.moveTowards(this._player!.position)\n      }\n    }\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _moveActors() {\n    const { _player } = this\n    let playerMoved = _player!.move(\n      this._height,\n      this._map!.width\n    )\n\n    if (playerMoved) {\n      // yep, so try to scroll the map\n      this._map?.shallScroll(_player!.realx, _player!.vx)\n      this._updateCrosshair()\n    }\n\n    // move the enemies\n    for (const enemy of this._enemies) {\n      enemy.move(this._height, this._map!.width)\n    }\n  }\n\n  private _outlineMouse() {\n    if (\n      this._mouseLine &&\n      this._mouseLocation &&\n      this._player &&\n      this._map\n    ) {\n      this._mouseLine.clear()\n      this._mouseLine.lineStyle(1, Config.constants.white)\n\n      // from\n      this._mouseLine.position = this._player.weaponLocation\n\n      // to\n      const { x, y } = this._mouseLine.toLocal(\n        this._mouseLocation\n      )\n      this._mouseLine.lineTo(x, y)\n\n      this._mouseLine.endFill()\n    }\n  }\n\n  private _switchWeapon() {\n    if (this._isRunning) {\n      this._player!.switchWeapon()\n      this._updateHud()\n    }\n  }\n\n  private _reload() {\n    if (this._isRunning) {\n      this._player!.reload()\n      this._updateHud()\n    }\n  }\n\n  private _updateMouseLocation(mouseLocation: Point) {\n    if (this._isRunning) {\n      this._mouseLocation = mouseLocation\n      this._updateCrosshair()\n    }\n  }\n\n  /**\n   *\n   * @param elapsed\n   * @param delta\n   * @public\n   */\n  public tick(elapsed: number, delta: number) {\n    Gamepads.updateStatus()\n\n    this._hud!.tick(delta)\n\n    if (this._isRunning) {\n      this._player!.tick(delta)\n      this._map!.tick(delta)\n\n      const elapsedSeconds = parseInt(\n        (elapsed / 1000).toString()\n      )\n\n      // game has not started\n      if (!this._startOffset) {\n        this._startOffset = elapsedSeconds\n      }\n\n      const correctedElapsedSeconds =\n        elapsedSeconds - this._startOffset\n\n      if (\n        correctedElapsedSeconds !== this._elapsedSeconds\n      ) {\n        this._elapsedSeconds = correctedElapsedSeconds\n        this._updateHud()\n      }\n\n      this._detectCollisions()\n      this._updateKI()\n      this._moveActors()\n\n      // sort by y\n      const sort = (a: DisplayObject, b: DisplayObject) => {\n        const ab = a.getBounds()\n        const bb = b.getBounds()\n\n        if (a.y + ab.height < b.y + bb.height - 5) {\n          return -1\n        }\n\n        if (a.y + ab.height > b.y + bb.height - 5) {\n          return 1\n        }\n\n        return 0\n      }\n\n      // ensure z index for actors\n      this._map?.actorContainer.children.sort(sort)\n\n      if (Config.outlineObjects) {\n        // outline player\n        this._player!.outline()\n        this._beacon!.outline()\n        this._crosshair!.outline()\n\n        // outline enemies\n        for (const enemy of this._enemies) {\n          enemy.outline()\n        }\n\n        // outline mouse line\n        this._outlineMouse()\n      }\n    }\n  }\n}\n","import {\n  Application,\n  Container,\n  Graphics,\n  ILoaderOptions,\n  IResourceDictionary,\n  Loader,\n  Text,\n  TextStyle\n} from \"pixi.js\"\nimport \"./tools/pixi\"\nimport Game from \"./game\"\nimport { Config } from \"./config\"\nimport TWEEN from \"@tweenjs/tween.js\"\n\nconst height = 600\nconst width = 800\n\nexport default class Maension {\n  private _lastFrame: number = 0\n  private _fpsCount: number = 0\n  private _fpsTimer: number = 0\n  private _game?: Game\n\n  private readonly _container: HTMLDivElement\n  private readonly _app: Application\n  private readonly _root: Container\n  private readonly _loadingBar: Container = new Container()\n  private readonly _fps?: Text\n\n  constructor(container: HTMLDivElement) {\n    this._container = container\n\n    this._app = new Application({\n      width,\n      height,\n      backgroundColor: Config.constants.black\n    })\n\n    this._container.appendChild(this._app.view)\n\n    console.log(\n      \"Viewport\",\n      this._container.clientWidth,\n      this._container.clientHeight\n    )\n\n    // create the root of the scene graph\n    // @ts-ignore\n    this._root = new Container()\n\n    // @ts-ignore\n    this._app.stage.addChild(this._root)\n\n    this.resize()\n\n    if (Config.showFPS) {\n      this._fps = new Text(\"FPS: \", {\n        fontWeight: \"16px\",\n        fill: \"#fff\"\n      } as TextStyle)\n      this._fps.x = 10\n      this._fps.y = 10\n      this._app.stage.addChild(this._fps)\n    }\n\n    this.drawLoadingBar()\n\n    window.addEventListener(\n      \"resize\",\n      this.resize.bind(this)\n    )\n\n    requestAnimationFrame(this._tick.bind(this))\n  }\n\n  private drawLoadingBar() {\n    const outline = new Graphics()\n    outline.lineStyle(5, Config.constants.white)\n\n    const lHeight = 50\n    const lWidth = 300\n    outline.drawRect(\n      width / 2 - lWidth / 2,\n      height / 2 - lHeight / 2,\n      lWidth,\n      lHeight\n    )\n\n    this._loadingBar.addChild(outline)\n    this._app.stage.addChild(this._loadingBar)\n  }\n\n  resize() {\n    const vpw = window.innerWidth - 50 // Width of the viewport\n    const vph = window.innerHeight // Height of the viewport\n    let nvw // New game width\n    let nvh // New game height\n\n    // The aspect ratio is the ratio of the screen's sizes in different dimensions.\n    // The height-to-width aspect ratio of the game is HEIGHT / WIDTH.\n\n    if (vph / vpw < height / width) {\n      // If height-to-width ratio of the viewport is less than the height-to-width ratio\n      // of the game, then the height will be equal to the height of the viewport, and\n      // the width will be scaled.\n      nvh = vph\n      nvw = (nvh * width) / height\n    } else {\n      // In the else case, the opposite is happening.\n      nvw = vpw\n      nvh = (nvw * height) / width\n    }\n\n    if (nvw > width) {\n      nvw = width\n    }\n\n    if (nvh > height) {\n      nvh = height\n    }\n\n    // Set the game screen size to the new values.\n    // This command only makes the screen bigger --- it does not scale the contents of the game.\n    // There will be a lot of extra room --- or missing room --- if we don't scale the stage.\n    this._app.renderer.resize(nvw, nvh)\n\n    // This command scales the stage to fit the new size of the game.\n    this._root.scale.set(nvw / width, nvh / height)\n  }\n\n  /**\n   *\n   */\n  public run() {\n    const options = {\n      crossOrigin: true\n    } as ILoaderOptions\n\n    const assetPath = \"assets\"\n\n    const loader = new Loader()\n\n    // load map\n    loader.add(\n      \"maps.house\",\n      assetPath + \"/maps/house.json\",\n      options\n    )\n    loader.add(\n      \"maps.street\",\n      assetPath + \"/maps/street.json\",\n      options\n    )\n    loader.add(\n      \"maps.maension\",\n      assetPath + \"/maps/maension.json\",\n      options\n    )\n\n    // load player\n    loader.add(\n      \"ryu.stance\",\n      assetPath + \"/ryu/stance.json\",\n      options\n    )\n    loader.add(\n      \"ryu.punch\",\n      assetPath + \"/ryu/punch.json\",\n      options\n    )\n    loader.add(\n      \"ryu.kick\",\n      assetPath + \"/ryu/kick.json\",\n      options\n    )\n    loader.add(\n      \"ryu.walk\",\n      assetPath + \"/ryu/walk.json\",\n      options\n    )\n    loader.add(\n      \"ryu.gothit\",\n      assetPath + \"/ryu/gothit.json\",\n      options\n    )\n    loader.add(\n      \"ryu.died\",\n      assetPath + \"/ryu/died.json\",\n      options\n    )\n\n    loader.add(\n      \"taro.idle\",\n      assetPath + \"/taro/idle.json\",\n      options\n    )\n    loader.add(\n      \"taro.idle_handgun\",\n      assetPath + \"/taro/idle_handgun.json\",\n      options\n    )\n\n    // enemies\n    loader.add(\n      \"bat.walk\",\n      assetPath + \"/enemys/bat/walk.json\",\n      options\n    )\n\n    // weapons\n    loader.add(\n      \"weapons.shotgun\",\n      assetPath + \"/weapons/shotgun.json\",\n      options\n    )\n    loader.add(\n      \"weapons.beretta\",\n      assetPath + \"/weapons/beretta.json\",\n      options\n    )\n\n    // sounds\n    loader.add(\n      \"bgm.title\",\n      assetPath + \"/sounds/title.m4a\",\n      options\n    )\n    loader.add(\n      \"beretta.fire\",\n      assetPath +\n        \"/sounds/beretta/mansion_sfx_gun_berreta_outside.wav\",\n      options\n    )\n    loader.add(\n      \"beretta.reload\",\n      assetPath +\n        \"/sounds/beretta/mansion_sfx_gun_berreta_reload.wav\",\n      options\n    )\n\n    loader.add(\n      \"shaders.frag-smoke\",\n      assetPath + \"/shaders/frag-smoke.glsl\",\n      options\n    )\n    loader.add(\n      \"shaders.frag-smoke2\",\n      assetPath + \"/shaders/frag-smoke2.glsl\",\n      options\n    )\n\n    loader.add(\n      \"shaders.vert-spot\",\n      assetPath + \"/shaders/vert-spot.glsl\",\n      options\n    )\n    loader.add(\n      \"shaders.frag-spot\",\n      assetPath + \"/shaders/frag-spot.glsl\",\n      options\n    )\n\n    loader.add(\n      \"shaders.vert-2d\",\n      assetPath + \"/shaders/vert-2d.glsl\",\n      options\n    )\n    loader.add(\n      \"shaders.frag-rain\",\n      assetPath + \"/shaders/frag-rain.glsl\",\n      options\n    )\n\n    loader.add(\n      \"shaders.vert-light\",\n      assetPath + \"/shaders/vert-light.glsl\",\n      options\n    )\n    loader.add(\n      \"shaders.frag-light\",\n      assetPath + \"/shaders/frag-light.glsl\",\n      options\n    )\n\n    // load things, like decals heads and so on\n    loader.add(\n      \"things.blood\",\n      assetPath + \"/things/blood.json\",\n      options\n    )\n    loader.add(\n      \"things.door\",\n      assetPath + \"/things/door.json\",\n      options\n    )\n    loader.add(\n      \"things.hud\",\n      assetPath + \"/things/hud.json\",\n      options\n    )\n    loader.add(\n      \"things.decals\",\n      assetPath + \"/things/decals.json\",\n      options\n    )\n    loader.add(\n      \"things.muzzle\",\n      assetPath + \"/things/muzzle.json\",\n      options\n    )\n\n    loader.add(\n      \"lightmap\",\n      assetPath + \"/things/lightmap.png\",\n      options\n    )\n    loader.add(\n      \"flashlight\",\n      assetPath + \"/things/flashlight.png\",\n      options\n    )\n\n    loader.onComplete.once(this._assetsLoaded.bind(this))\n\n    // resources loaded\n    loader.load()\n\n    loader.onProgress.add((event: any) => {\n      this.updateLoadingBar(event.progress)\n    })\n  }\n\n  private updateLoadingBar(pct: number) {\n    const fill = new Graphics()\n    fill.lineStyle(5, Config.constants.white)\n\n    fill.beginFill(Config.constants.white)\n\n    const lHeight = 50\n    const lWidth = 300\n    fill.drawRect(\n      width / 2 - lWidth / 2,\n      height / 2 - lHeight / 2,\n      (lWidth / 100) * pct,\n      lHeight\n    )\n\n    this._loadingBar.addChild(fill)\n  }\n\n  /**\n   *\n   * @param loader\n   * @param resources\n   * @private\n   */\n  private _assetsLoaded(\n    loader: Loader,\n    resources: IResourceDictionary\n  ) {\n    this._app.stage.removeChild(this._loadingBar)\n\n    // loading done, start game\n    this._game = new Game(\n      resources,\n      this._root,\n      width,\n      height\n    )\n\n    console.log(\"Mnsion:\", \"Init done, ready to scare!\")\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _tick(elapsed: number) {\n    // calculate frame delta\n    let delta = elapsed - this._lastFrame\n    this._lastFrame = elapsed\n\n    if (this._fps) {\n      this._fpsCount++\n      this._fpsTimer += delta\n\n      // reset after 1 second\n      if (this._fpsTimer > 1000) {\n        // update text\n        this._fps.text = \"FPS: \" + this._fpsCount\n\n        this._fpsCount = 0\n        this._fpsTimer = 0\n      }\n    }\n\n    // update game\n    if (this._game) {\n      this._game.tick(elapsed, delta)\n    }\n\n    // render the container\n    this._app.render()\n\n    requestAnimationFrame(this._tick.bind(this))\n\n    TWEEN.update(elapsed)\n  }\n}\n","import React, { useEffect, useRef, useState } from \"react\"\nimport \"./MaensionComponent.css\"\nimport Maension from \"../game/maension\"\n\nexport default function MaensionComponent() {\n  const stage = useRef(null)\n  const [maension, setMaension] = useState<Maension>()\n\n  useEffect(() => {\n    if (!maension && stage.current) {\n      const m = new Maension(stage.current!)\n      m.run()\n      setMaension(m)\n    }\n  }, [stage, maension])\n\n  return <div className=\"maension\" ref={stage} />\n}\n","import React from \"react\"\nimport \"./HowToPlay.css\"\n\nexport default function HowToPlay() {\n  return (\n    <div className=\"blocks\">\n      <div className=\"block\">\n        <h2>How to Play</h2>\n        <p>\n          Lorem ipsum dolor sit amet, consectetur adipiscing\n          elit. Sed mattis sem nunc, vitae consectetur purus\n          volutpat at. Integer at consequat arcu. Curabitur\n          aliquam ex sit amet consectetur bibendum.\n          Phasellus nec metus aliquam, vestibulum est et,\n          efficitur metus. Fusce consectetur vel lectus non\n          feugiat. Nam et ipsum leo. Mauris bibendum semper\n          augue, non dapibus dui vestibulum id. In eget\n          metus nec odio consectetur ultrices ut congue\n          nisi. Vivamus et augue vel risus posuere pulvinar.\n          Vestibulum placerat justo mi, sed aliquam massa\n          lobortis vitae.\n        </p>\n      </div>\n      <div\n        className=\"block\"\n        style={{ textAlign: \"center\" }}\n      >\n        <div className=\"controls\">\n          <div className=\"control\">\n            <div className=\"space center\">\n              <div className=\"button\">\n                <i className=\"fas fa-arrow-up\"></i>\n              </div>\n            </div>\n            <span className=\"label\">: Move Up</span>\n          </div>\n          <div className=\"control\">\n            <div className=\"space\">\n              <div className=\"button\">\n                <i className=\"fas fa-arrow-left\"></i>\n              </div>\n              <div className=\"button\">\n                <i className=\"fas fa-arrow-right\"></i>\n              </div>\n            </div>\n            <span className=\"label\">: Move Left/Right</span>\n          </div>\n          <div className=\"control\">\n            <div className=\"space center\">\n              <div className=\"button\">\n                <i className=\"fas fa-arrow-down\"></i>\n              </div>\n            </div>\n            <span className=\"label\">: Move Down</span>\n          </div>\n          <div className=\"control\">\n            <div className=\"space center\">\n              <div className=\"button\">\n                <i className=\"fas fa-mouse-pointer\"></i>\n              </div>\n              <div className=\"button\">\n                <i className=\"fas fa-mouse\"></i>\n              </div>\n            </div>\n            <span className=\"label\">: Aim/Fire</span>\n          </div>\n          <div className=\"control\">\n            <div className=\"space center\">\n              <div className=\"button\">R</div>\n            </div>\n            <span className=\"label\">: Reload</span>\n          </div>\n          <div className=\"control\">\n            <div className=\"space center\">\n              <div className=\"button\">W</div>\n            </div>\n            <span className=\"label\">: Switch Weapon</span>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n","import React from \"react\"\nimport \"./Page.css\"\nimport Header from \"./components/Header\"\nimport Footer from \"./components/Footer\"\nimport About from \"./components/About\"\nimport MaensionComponent from \"./components/MaensionComponent\"\nimport HowToPlay from \"./components/HowToPlay\"\n\nexport default function Page() {\n  return (\n    <div>\n      <Header />\n\n      <MaensionComponent />\n\n      <hr />\n\n      <div className=\"page\">\n        <HowToPlay />\n        <About />\n      </div>\n\n      <Footer />\n    </div>\n  )\n}\n","import React from \"react\"\nimport ReactDOM from \"react-dom\"\nimport * as serviceWorker from \"./serviceWorker\"\nimport \"./index.css\"\nimport \"@fortawesome/fontawesome-free/css/all.min.css\"\nimport Page from \"./Page\"\n\nReactDOM.render(\n  <React.StrictMode>\n    <Page />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n)\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.register()\n"],"sourceRoot":""}