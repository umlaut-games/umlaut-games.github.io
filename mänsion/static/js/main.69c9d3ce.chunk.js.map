{"version":3,"sources":["game/config.ts","game/objects/object-base.ts","game/objects/animation-base.ts","game/tools/animation-helper.ts","game/tools/gamepads.ts","game/tools/keyboard.ts","game/tools/math-helper.ts","game/tools/enums.ts","game/objects/door.ts","game/objects/crosshair.ts","game/objects/blood.ts","game/actors/actor-base.ts","game/objects/weapons/weapon-base.ts","game/objects/weapons/shotgun.ts","game/objects/weapons/beretta.ts","game/actors/player.ts","game/actors/enemies/bat.ts","game/actors/enemies/enemy-base.ts","game/actors/enemies/bat.infected.ts","game/maps/map-base.ts","game/maps/maension-outside.ts","game/maps/house-outside.ts","game/maps/street.ts","game/maps/loading.ts","game/ui/hud.ts","game/game.ts","game/maension.ts","Maension.tsx","serviceWorker.ts","index.tsx"],"names":["Config","ObjectBase","resources","_baseScale","_resources","_isFacingRight","_vx","_vy","_vr","actor","collides","x","this","realx","Math","abs","width","y","height","console","log","scaleOffset","scale","_adaptScaleBasedOnOrientation","PIXI","AnimationBase","_clips","_currentClip","isFacingRight","which","loop","dontRemove","removeChild","undefined","Promise","resolve","reject","clipToPlay","err","zIndex","addChild","gotoAndPlay","children","sort","a","b","onComplete","stop","AnimationHelper","speed","frames","textureId","textures","texture","push","clip","animationSpeed","anchor","outline","lineStyle","drawRect","pivot","endFill","Gamepads","events","_events","scanGamepads","_gamepads","event","addGamepad","gamepad","index","_state","removeGamepad","gamepadIndex","hasOwnProperty","axes","buttons","buttonIndex","button","state","pressed","isPressed","pressEvent","releaseEvent","gamepads","navigator","getGamepads","webkitGetGamepads","window","addEventListener","connectHandler","disconnectHandler","Keyboard","_key","_ignoreKeyup","_isDown","_isUp","_downHandler","bind","_upHandler","key","preventDefault","MathHelper","min","max","floor","random","v1","v2","atan2","sqrt","distanceToSq","dx","dy","ActorStates","idle","Symbol","for","walking","fire","died","Door","loadClip","filters","NoiseFilter","_playClip","Crosshair","fill","Blood","ActorBase","skin","_skin","_speed","_health","_power","_canGetHitAgain","objectTookDamage","power","_died","then","_idle","direction","_setIsFacingRight","constructor","name","WeaponBase","rounds","_maxRounds","_rounds","_sprite","_roundsSprite","muzzleFlash","Shotgun","res","Beretta","weapons","Player","_weapon","_name","shotgun","beretta","reload","crosshairPosition","angle","angleBetweenRad","weaponLocation","rotation","_canBeControlled","_logPlayerCoordinates","toGlobal","position","Bat","_lastFlip","set","PI","setTimeout","parent","canFlip","Date","now","target","vx","vy","distanceTo","angleToTarget","sin","cos","_canFlipAgain","flip","BatInfected","f","ColorMatrixFilter","lsd","MapBase","_width","mapToLoad","_explorationOffset","_textures","_backgroundContainer","_actorContainer","_foregroundContainer","playerX","scrollAmount","Sound","require","default","MaensionOutside","starryNight","maension","tree","tree1","tree_dead","tree2","_setup","z1","from","z2","setInterval","play","HouseOutside","city","Street","cityWidth","concret","police","Loading","_door","HUD","player","_player","_gameOverSign","_height","smallTextConfig","bigText","fontSize","playerName","weaponBorder","roundsBorder","sw","lineSize","healthBorder","w","update","weapon","sprite","removeChildren","roundSprite","roundsSprite","text","health","_renderRounds","_renderWeapon","delta","alpha","fontFamily","fontWeight","dropShadow","dropShadowColor","align","maps","Game","stage","_stage","_hud","_map","_enemies","_mouseLocation","_isRunning","_startOffset","_elapsedSeconds","_mouseLine","_crosshair","street","house","loading","_init","cursor","adaptScale","actorContainer","bat1","bat2","bat3","_attachGamepad","_attachKeyboard","_updateHud","_attachMouse","_updateMouseLocation","interactive","on","e","data","global","_fire","updateCrosshairPosition","impact","impactLocation","toLocal","backgroundContainer","moveRight","moveLeft","moveUp","moveDown","stopMoveVertically","stopMoveHorizontally","left","up","right","down","k","r","enter","_switchWeapon","_reload","_moveRight","isDown","_stopMoveHorizontally","_moveLeft","_moveUp","_stopMoveVertically","_moveDown","init","0","1","15","14","12","13","9","renderGameOver","enemy","playerHit","hitBy","_drawBlood","_end","i","blood","getRandomInt","moveTowards","playerMoved","shallScroll","_updateCrosshair","vr","clear","lineTo","switchWeapon","mouseLocation","elapsed","updateStatus","animate","elapsedSeconds","parseInt","toString","correctedElapsedSeconds","timeout","_detectCollisions","_updateKI","_moveActors","outlineContainer","_outlineMouse","Maension","container","_lastFrame","_fpsCount","_fpsTimer","_game","_renderer","_stageWrapper","_fps","backgroundColor","appendChild","view","innerWidth","innerHeight","_animate","_assetsLoaded","options","crossOrigin","loader","add","assetPath","once","load","requestAnimationFrame","render","MaensionComponent","useRef","useState","setMaension","useEffect","current","m","run","className","ref","Boolean","location","hostname","match","ReactDOM","StrictMode","document","getElementById","serviceWorker","ready","registration","unregister","catch","error","message"],"mappings":"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","file":"static/js/main.69c9d3ce.chunk.js","sourcesContent":["export const Config = {\n  /**\n   * shall the actors be outlined in renderer or not\n   */\n  outlineActors: false,\n\n  /**\n   * shall we show the fps or not?\n   */\n  showFPS: true,\n\n  /**\n   * shall we log the player coordinates to the console?\n   */\n  logPlayerCoordinates: false,\n\n  /**\n   * shall we log actor collisions?\n   */\n  logCollisions: false\n};","import * as PIXI from \"pixi.js\";\nimport { Config } from \"../config\"\n\n/**\n *\n */\nexport class ObjectBase extends PIXI.Container {\n\n  protected _baseScale: number = 1\n\n  /**\n   *\n   * @type {Object}\n   * @protected\n   */\n  protected _resources: PIXI.IResourceDictionary\n\n  /**\n   * Is the this one facing right?\n   * @type {boolean}\n   * @protected\n   */\n  protected _isFacingRight: boolean = true;\n\n  /**\n   * the object velocity x\n   * @type {number}\n   * @protected\n   */\n  protected _vx = 0;\n\n  /**\n   * the object velocity y\n   * @type {number}\n   * @protected\n   */\n  protected _vy = 0;\n\n  /**\n   * the objects rotation velocity\n   * @type {number}\n   * @private\n   */\n  protected _vr = 0;\n\n  /**\n   *\n   * @param resources\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary\n  ) {\n    super();\n\n    this._resources = resources;\n  }\n\n  get isFacingRight(): boolean {\n    return this._isFacingRight\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get vx() {\n    return this._vx;\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get vy() {\n    return this._vy;\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get vr() {\n    return this._vr;\n  }\n\n  /**\n   *\n   * @returns {Number}\n   */\n  get realx() {\n    return this.x - (Math.abs(this.width) / 2);\n  }\n\n  /**\n   *\n   * @param actor\n   * @public\n   */\n  public collides(\n    actor: ObjectBase\n  ) {\n    const collides = !(\n      actor.x > (this.realx + Math.abs(this.width)) ||\n      (actor.x + Math.abs(actor.width)) < this.realx ||\n      actor.y > (this.y + Math.abs(this.height)) ||\n      (actor.y + Math.abs(actor.height)) < this.y\n    );\n\n    if (collides && Config.logCollisions) {\n      console.log(\"p width\", this.width);\n      console.log(\"actor width\", actor.width);\n    }\n\n    return collides;\n  }\n\n  public adaptScale(\n    y: number,\n    height: number\n  ) {\n    const scaleOffset = height - y\n    let scale = this._baseScale - scaleOffset / 1000\n\n    this.scale.x = scale\n    this.scale.y = scale\n\n    this._adaptScaleBasedOnOrientation()\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _adaptScaleBasedOnOrientation() {\n    let scale = this.scale.x;\n    if (!this._isFacingRight && scale > 0) {\n      this.scale.x = scale * -1;\n    }\n\n    if (this._isFacingRight && scale < 0) {\n      this.scale.x = Math.abs(scale);\n    }\n  }\n}","import * as PIXI from \"pixi.js\";\nimport { IDictionary } from \"../tools/IDictionary\"\nimport { ObjectBase } from \"./object-base\"\n\n/**\n *\n */\nexport class AnimationBase extends ObjectBase {\n\n  /**\n   * array for animations\n   * @type {{}}\n   * @protected\n   */\n  protected _clips: IDictionary<PIXI.AnimatedSprite> = {};\n\n  /**\n   * current clip that is beeing played\n   * @type {null}\n   * @private\n   */\n  protected _currentClip?: PIXI.AnimatedSprite;\n\n  /**\n   *\n   * @param resources\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary\n  ) {\n    super(resources);\n\n    this._resources = resources;\n  }\n\n  /**\n   *\n   * @param isFacingRight\n   * @protected\n   */\n  protected _setIsFacingRight(\n    isFacingRight: boolean\n  ) {\n    this._isFacingRight = isFacingRight;\n    this._adaptScaleBasedOnOrientation()\n  }\n\n  protected _playClip(\n    which: string,\n    loop: boolean,\n    dontRemove?: boolean\n  ) {\n\n    if (this._currentClip) {\n      this.removeChild(this._currentClip);\n      this._currentClip = undefined;\n    }\n\n    return new Promise((resolve: Function, reject: Function) => {\n      // load punch clip\n      const clipToPlay = this._clips[which];\n\n      if (!clipToPlay) {\n\n        const err = \"AnimationBase: failed to load clip: \" + which;\n        console.log(err, this._clips);\n        reject(err);\n      }\n\n      clipToPlay.zIndex = 1\n\n      // play clip\n      this.addChild(clipToPlay);\n\n      // set the current playing clip\n      this._currentClip = clipToPlay;\n\n      this._adaptScaleBasedOnOrientation();\n\n      this._currentClip.loop = loop;\n      this._currentClip.gotoAndPlay(0);\n\n      this.children.sort((a, b) => a.zIndex - b.zIndex)\n\n      if (!loop) {\n\n        clipToPlay.onComplete = () => {\n\n          clipToPlay.stop();\n\n          if (!dontRemove) {\n            this.removeChild(clipToPlay);\n          }\n\n          resolve();\n        };\n\n      }\n    })\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { ActorBase } from \"../actors\"\n\n/**\n * @class\n */\nexport class AnimationHelper {\n\n  static loadClip(\n    resources: PIXI.IResourceDictionary,\n    which: string,\n    speed: number,\n    scale: number\n  ): PIXI.AnimatedSprite {\n    const frames: PIXI.Texture[] = [];\n    for (const textureId in resources[which].textures) {\n      let texture = resources[which]!.textures![textureId];\n      frames.push(texture);\n    }\n\n    const clip = new PIXI.AnimatedSprite(frames);\n\n    clip.animationSpeed = speed;\n    clip.scale.x = scale;\n    clip.scale.y = scale;\n    clip.anchor.x = 0.5;\n\n    return clip;\n  }\n\n  static outlineContainer(actor: ActorBase) {\n\n    // do we have a filling\n    if (actor.outline) {\n      // yep remove if from child\n      actor.removeChild(actor.outline);\n      // delete it\n      delete actor.outline;\n    }\n\n    // create new\n    const outline = new PIXI.Graphics();\n    outline.lineStyle(1, 0x000000);\n    outline.drawRect(0, 0, actor.width, actor.height);\n    outline.pivot.x = actor.width / 2;\n    outline.endFill();\n\n    actor.outline = outline;\n    actor.addChild(outline);\n  }\n}","import { IDictionary } from \"./IDictionary\"\n\ntype d<T> = IDictionary<IDictionary<T>>\n\ninterface Event {\n  pressEvent?: (() => void),\n  releaseEvent?: (() => void)\n}\n\ntype Events = d<Event>\n\ninterface State {\n  isPressed: boolean\n}\n\ntype States = d<State>\n\nexport class Gamepads {\n  static _gamepads: IDictionary<Gamepad> = {};\n  static _state: States = {};\n  static _events: Events = {};\n\n  static init(events: Events) {\n    Gamepads._events = events;\n\n    Gamepads.scanGamepads();\n\n    return Gamepads._gamepads[0] || null;\n  }\n\n  static connectHandler(event: GamepadEvent) {\n    console.log(\"gamepad connected\");\n\n    Gamepads.addGamepad(event.gamepad);\n  }\n\n  static addGamepad(gamepad: Gamepad) {\n    console.log(\"adding gamepad\", gamepad);\n\n    Gamepads._gamepads[gamepad.index] = gamepad;\n    Gamepads._state[gamepad.index] = {};\n  }\n\n  static disconnectHandler(event: GamepadEvent) {\n    console.log(\"gamepad disconnected\");\n\n    Gamepads.removeGamepad(event.gamepad);\n  }\n\n  static removeGamepad(gamepad: Gamepad) {\n    console.log(\"removing gamepad\");\n    delete Gamepads._gamepads[gamepad.index];\n    delete Gamepads._state[gamepad.index];\n  }\n\n  static updateStatus() {\n    Gamepads.scanGamepads();\n    for (const gamepadIndex in Gamepads._gamepads) {\n      if (Gamepads._gamepads.hasOwnProperty(gamepadIndex)) {\n        const gamepad: Gamepad = Gamepads._gamepads[gamepadIndex];\n\n        if (gamepad.axes) {\n          //console.log(gamepad.axes)\n        }\n\n        // sometimes controllers dont have buttons\n        if (gamepad.buttons) {\n          for (const buttonIndex in gamepad.buttons) {\n            if (gamepad.buttons.hasOwnProperty(buttonIndex)) {\n              const button: GamepadButton = gamepad.buttons[buttonIndex];\n\n              Gamepads._state[gamepadIndex][buttonIndex] =\n                Gamepads._state[gamepadIndex][buttonIndex] || {};\n              Gamepads._events[gamepadIndex][buttonIndex] =\n                Gamepads._events[gamepadIndex][buttonIndex] || {};\n\n              const state: State = Gamepads._state[gamepadIndex][buttonIndex]\n              const event: Event = Gamepads._events[gamepadIndex][buttonIndex]\n\n              if (button.pressed && !state.isPressed) {\n                console.log(\"button pressed\", gamepadIndex, buttonIndex);\n\n                state.isPressed = true;\n\n                if (event.pressEvent) {\n                  event.pressEvent()\n                }\n              }\n\n              if (!button.pressed && state.isPressed) {\n                console.log(\"button released\", gamepadIndex, buttonIndex);\n\n                state.isPressed = false;\n\n                if (event.releaseEvent) {\n                  event.releaseEvent()\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  static scanGamepads() {\n    const gamepads: Gamepad[] =\n      navigator.getGamepads ? navigator.getGamepads()\n        // @ts-ignore\n        : (navigator.webkitGetGamepads ? navigator.webkitGetGamepads() : []);\n\n    for (const gamepad of gamepads) {\n      // sometimes gamepad is undefined?!\n      if (gamepad) {\n        const gamepadIndex = gamepad.index;\n\n        // do we have this already in records?\n        if (gamepadIndex in Gamepads._gamepads) {\n          Gamepads._gamepads[gamepadIndex] = gamepad;\n        } else {\n          console.log(\"found new gamepad during scan, adding\", gamepadIndex);\n\n          Gamepads.addGamepad(gamepad);\n        }\n      }\n    }\n  }\n}\n\n// register events\n// @ts-ignore\nwindow.addEventListener(\n  \"gamepadconnected\",\n  Gamepads.connectHandler\n);\n// @ts-ignore\nwindow.addEventListener(\n  \"gamepaddisconnected\",\n  Gamepads.disconnectHandler\n);","/**\n * @class\n */\nexport class Keyboard {\n\n  /**\n   *\n   * @type {boolean}\n   * @private\n   */\n  private _isDown = false;\n  /**\n   *\n   * @type {boolean}\n   * @private\n   */\n  private _isUp = true;\n\n  // events\n  /**\n   *\n   * @type {KeyboardEvent}\n   */\n  public pressEvent: (() => void) | null = null;\n  /**\n   *\n   * @type {KeyboardEvent}\n   */\n  public releaseEvent: (() => void) | null = null;\n\n  constructor(\n    private readonly _key: string,\n    private readonly _ignoreKeyup: boolean\n  ) {\n    //Attach event listeners\n    window.addEventListener(\n      \"keydown\",\n      this._downHandler.bind(this),\n      false\n    );\n    window.addEventListener(\n      \"keyup\",\n      this._upHandler.bind(this),\n      false\n    );\n  }\n\n  get isDown() {\n    return this._isDown;\n  }\n\n  /**\n   *\n   * @param event\n   * @private\n   */\n  private _downHandler(\n    event: KeyboardEvent\n  ) {\n    if (event.key === this._key) {\n      event.preventDefault();\n\n      // if the key is up and we have a press handler\n      if (this._isUp && this.pressEvent) {\n        this.pressEvent();\n      }\n\n      this._isDown = true;\n      this._isUp = false;\n    }\n  }\n\n  /**\n   *\n   * @param event\n   * @private\n   */\n  private _upHandler(event: KeyboardEvent) {\n    if (event.key === this._key) {\n      event.preventDefault();\n\n      // if the key is down and we have a press handler\n      if (this._isDown && this.releaseEvent) {\n        this.releaseEvent();\n      }\n\n      this._isDown = false;\n      this._isUp = true;\n    }\n  }\n}","import * as PIXI from \"pixi.js\";\n\nexport class MathHelper {\n\n  /**\n   *\n   * @param min\n   * @param max\n   * @returns {number}\n   * @public\n   */\n  static getRandomInt(min: number, max: number) {\n    return Math.floor(Math.random() * (max - min)) + min;\n  }\n\n  /**\n   *\n   * @param v2\n   * @param v1\n   * @returns {number}\n   */\n  static angleBetweenRad(\n    v1: PIXI.Point,\n    v2: PIXI.Point\n  ) {\n    return Math.atan2(v2.y - v1.y, v2.x - v1.x);\n  }\n\n  /**\n   *\n   * @param v1\n   * @param v2\n   * @returns {number}\n   */\n  static distanceTo(v1: PIXI.Point, v2: PIXI.Point) {\n    return Math.sqrt(MathHelper.distanceToSq(v1, v2));\n  }\n\n  /**\n   *\n   * @param v2\n   * @param v1\n   * @returns {number}\n   */\n  static distanceToSq(v1: PIXI.Point, v2: PIXI.Point) {\n    let dx = v1.x - v2.x,\n      dy = v1.y - v2.y;\n\n    return dx * dx + dy * dy;\n  }\n}","export const ActorStates = {\n  idle: Symbol.for(\"Idle\"),\n  walking: Symbol.for(\"Walking\"),\n  fire: Symbol.for(\"Fire\"),\n  died: Symbol.for(\"Died\")\n};\n\nexport const HitLocations = {\n  Head: Symbol.for(\"Head\"),\n  Feet: Symbol.for(\"Feet\"),\n  Front: Symbol.for(\"Front\"),\n  Back: Symbol.for(\"Back\")\n};","import * as PIXI from \"pixi.js\"\nimport { AnimationBase } from \"./animation-base\"\nimport { AnimationHelper } from \"../tools\"\n\n/**\n *\n */\nexport class Door extends AnimationBase {\n\n  /**\n   *\n   * @param resources\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary\n  ) {\n    super(resources);\n\n    const which = \"things.door\"\n\n    this._clips = {\n      [which]: AnimationHelper.loadClip(\n        this._resources,\n        which,\n        0.01,\n        10\n      )\n    };\n\n\n    this._clips[which].filters = [new PIXI.filters.NoiseFilter(0.2)]\n\n    this._playClip(\n      which,\n      false,\n      false\n    );\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { ObjectBase } from \"./object-base\"\n\nexport class Crosshair extends ObjectBase {\n\n  constructor(\n    resources: PIXI.IResourceDictionary\n  ) {\n    super(resources);\n\n    this.addChild(\n      new PIXI.Text(\"x\", {\n        fill: \"#fff\"\n      })\n    )\n  }\n}\n","import { AnimationBase } from \"./animation-base\"\nimport { AnimationHelper } from \"../tools\"\n\n/**\n *\n */\nexport class Blood extends AnimationBase {\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    speed: number = 0.01\n  ) {\n    super(resources);\n    const which = \"things.blood\"\n\n    this._clips = {\n      [which]: AnimationHelper.loadClip(\n        this._resources,\n        which,\n        speed,\n        1\n      )\n    };\n\n    this._playClip(which, false, false);\n  }\n}","import PIXI from \"pixi.js\"\nimport { ActorStates } from \"../tools\";\nimport { AnimationBase } from \"../objects\"\n\n/**\n * @class\n */\nexport class ActorBase extends AnimationBase {\n\n  public outline?: PIXI.Graphics\n\n  /**\n   *\n   * @type {null}\n   * @protected\n   */\n  protected _skin?: string;\n\n  /**\n   *\n   * @type {number}\n   * @protected\n   */\n  protected _speed = 1;\n\n  /**\n   * the objects health\n   * @type {number}\n   * @protected\n   */\n  protected _health = 100;\n\n  /**\n   * the objects striking power\n   * @type {number}\n   * @protected\n   */\n  protected _power = 12;\n\n  /**\n   * @type {Symbol}\n   * @protected\n   */\n  protected _state: Symbol = ActorStates.idle;\n\n  /**\n   * can we get git again helper\n   * @type {boolean}\n   * @protected\n   */\n  protected _canGetHitAgain = true;\n\n  /**\n   * @constructor\n   */\n  constructor(\n    speed: number,\n    resources: PIXI.IResourceDictionary,\n    skin: string\n  ) {\n    super(resources);\n\n    /**\n     * set the actor skin\n     * @type {String}\n     * @protected\n     */\n    this._skin = skin;\n\n    /**\n     * the objects speed\n     * @type {number}\n     * @protected\n     */\n    this._speed = speed;\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get power() {\n    return this._power;\n  }\n\n  /**\n   *\n   * @returns {Symbol}\n   */\n  get state() {\n    return this._state;\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get health() {\n    return this._health;\n  }\n\n\n  /**\n   *\n   * @param state\n   * @protected\n   */\n  set state(state: Symbol) {\n    console.log(this.constructor.name, \"New state:\", state);\n    this._state = state;\n  }\n\n  /**\n   *\n   * @protected\n   */\n  protected _idle() {\n    // dont go to idle if we are dead\n    if (this._state !== ActorStates.died) {\n\n      this.state = ActorStates.idle;\n\n      this._playClip(\n        this._skin + \".stance\",\n        true\n      );\n    }\n  }\n\n  /**\n   *\n   * @protected\n   */\n  protected _died() {\n    this.state = ActorStates.died;\n\n    // remove all velocity\n    this._vy = 0;\n    this._vx = 0;\n    this._vr = 0;\n\n    // play died clip\n    this._playClip(\n      this._skin + \".died\",\n      false,\n      true\n    )\n  }\n\n  /**\n   * @public\n   * @param actor\n   * @returns {boolean}\n   */\n  public hitBy(\n    actor: ActorBase\n  ) {\n\n    let died = false;\n    let objectTookDamage = false;\n\n    if (this._canGetHitAgain) {\n\n      // lower the heal\n      this._health -= actor.power;\n\n      objectTookDamage = true;\n\n      // after we got hit we cannot get hit again\n      this._canGetHitAgain = false;\n\n      // are we death?\n      if (this._health < 0) {\n\n        this._health = 0;\n\n        // yep\n        died = true;\n\n        this._died();\n      }\n      // not died\n      else {\n\n        // force the player a little bit back on hit\n        this._vx = actor._isFacingRight ? 5 : -5;\n\n        // play the gothit clip\n        this._playClip(\n          this._skin + \".gothit\",\n          false\n        )\n          .then(() => {\n\n            // animation ended!\n\n            // remove the velocity\n            this._vx = 0;\n\n            // yep we can get hit again\n            this._canGetHitAgain = true;\n\n            // stand up and idle afterwards\n            this._idle();\n          });\n      }\n    }\n\n    return {\n      died,\n      objectTookDamage\n    };\n  }\n\n  public flip(\n    direction?: boolean\n  ) {\n    this._setIsFacingRight(\n      direction !== undefined ? direction : !this._isFacingRight\n    )\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { ObjectBase } from \"../object-base\"\nimport { Blood } from \"../blood\"\n\nexport class WeaponBase extends ObjectBase {\n  protected _power: number\n  protected _maxRounds: number\n  protected _rounds: number\n  protected _sprite?: PIXI.Sprite\n  protected _roundsSprite?: PIXI.Sprite\n\n  get rounds() {\n    return this._rounds\n  }\n\n  get sprite() {\n    return this._sprite\n  }\n\n  get roundsSprite() {\n    return this._roundsSprite\n  }\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    power: number,\n    rounds: number\n  ) {\n    super(resources);\n\n    this._power = power\n    this._rounds = rounds\n    this._maxRounds = rounds\n\n    this.zIndex = 100\n  }\n\n  public fire(): boolean {\n\n    if (this._rounds > 0) {\n      // muzzle flash\n      const muzzleFlash = new Blood(this._resources, 2)\n\n      muzzleFlash.x = 80\n      this.addChild(muzzleFlash);\n\n      this._rounds--;\n\n      return true\n    }\n\n    return false\n  }\n\n  public reload(): boolean {\n    this._rounds = this._maxRounds\n\n    console.log(\"reload\")\n    return true\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { WeaponBase } from \"./weapon-base\"\n\n/**\n *\n */\nexport class Shotgun extends WeaponBase {\n\n  /**\n   *\n   * @param resources\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary\n  ) {\n    super(resources, 55, 6);\n\n    const which = \"weapons.shotgun\"\n\n    const res = resources![which]\n\n    this._sprite = new PIXI.Sprite(\n      res.textures![\"shotgun.png\"]!\n    );\n\n    this._roundsSprite = new PIXI.Sprite(\n      res.textures![\"shell.png\"]!\n    );\n\n    this._sprite.scale.x = 0.2\n    this._sprite.scale.y = 0.2\n\n    this.x = -10\n    this.y = 40\n\n    // shotgun should be in the back so add it first\n    this.addChild(this._sprite);\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { WeaponBase } from \"./weapon-base\"\n\n/**\n *\n */\nexport class Beretta extends WeaponBase {\n\n  /**\n   *\n   * @param resources\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary\n  ) {\n    super(resources, 55, 8);\n\n    const which = \"weapons.beretta\"\n\n    const res = resources![which]\n\n    // todo: replace with correct skin\n    this._sprite = new PIXI.Sprite(\n      res.textures![\"beretta.png\"]!\n    );\n\n    this._roundsSprite = new PIXI.Sprite(\n      res.textures![\"shell.png\"]!\n    );\n\n    this._sprite.scale.x = 0.2\n    this._sprite.scale.y = 0.2\n\n    this.x = -10\n    this.y = 40\n\n    // sprite should be in the back so add it first\n    this.addChild(this._sprite);\n  }\n}","import * as PIXI from \"pixi.js\"\nimport {\n  Beretta,\n  Shotgun,\n  WeaponBase\n} from \"../objects/weapons\"\nimport { ActorBase } from \"./actor-base\"\nimport {\n  ActorStates,\n  AnimationHelper,\n  MathHelper\n} from \"../tools\"\nimport { Config } from \"../config\"\n\n\nconst weapons: {\n  shotgun?: Shotgun,\n  beretta?: Beretta\n} = {}\n\n/**\n *\n */\nexport class Player extends ActorBase {\n\n  private _weapon: WeaponBase\n  private _name: string = \"Gordon\"\n\n  get weapon(): WeaponBase {\n    return this._weapon\n  }\n\n  get name() {\n    return this._name\n  }\n\n  /**\n   *\n   * @param resources\n   * @param skin\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    skin: string\n  ) {\n    super(\n      3,\n      resources,\n      skin\n    );\n\n    this._baseScale = 0.7\n\n    this._health = 77;\n\n    // load the clips for this object\n    this._clips[this._skin + \".stance\"] = AnimationHelper.loadClip(this._resources, this._skin + \".stance\", 0.1, 2);\n    this._clips[this._skin + \".walk\"] = AnimationHelper.loadClip(this._resources, this._skin + \".walk\", 0.2, 2);\n    this._clips[this._skin + \".punch\"] = AnimationHelper.loadClip(this._resources, this._skin + \".punch\", 0.3, 2);\n    this._clips[this._skin + \".kick\"] = AnimationHelper.loadClip(this._resources, this._skin + \".kick\", 0.2, 2);\n    this._clips[this._skin + \".gothit\"] = AnimationHelper.loadClip(this._resources, this._skin + \".gothit\", 0.2, 2);\n    this._clips[this._skin + \".died\"] = AnimationHelper.loadClip(this._resources, this._skin + \".died\", 0.2, 2);\n\n    weapons.shotgun = new Shotgun(resources)\n    weapons.beretta = new Beretta(resources)\n\n    // todo get this from equipment\n    this._weapon = weapons.beretta\n    this.addChild(this._weapon)\n\n    // go to idle\n    this._idle();\n  }\n\n  public reload() {\n    // todo check equipment for shells\n    this._weapon.reload()\n  }\n\n  public switchWeapon() {\n    this.removeChild(this._weapon)\n\n    if (this._weapon instanceof Shotgun) {\n      this._weapon = weapons.beretta!\n    } else {\n      this._weapon = weapons.shotgun!\n    }\n\n    this.addChild(this._weapon)\n  }\n\n  public updateCrosshairPosition(\n    crosshairPosition: PIXI.Point\n  ) {\n    const angle: number = this._isFacingRight ?\n      MathHelper.angleBetweenRad(this.weaponLocation, crosshairPosition) :\n      -1 * MathHelper.angleBetweenRad(crosshairPosition, this.weaponLocation)\n    this._weapon.rotation = angle\n  }\n\n  get weaponLocation(): PIXI.Point {\n    return this.toGlobal(\n      this._weapon.position\n    )\n  }\n\n  /**\n   *\n   * @returns {boolean}\n   * @private\n   */\n  private _canBeControlled() {\n    if (this._state === ActorStates.died) {\n      console.log(\"Cant be controlled, player is dead\");\n      return false\n    }\n\n    return (\n      this._state === ActorStates.idle ||\n      this._state === ActorStates.walking\n    );\n  }\n\n  private _logPlayerCoordinates() {\n    if (Config.logPlayerCoordinates) {\n      console.log(\n        \"x\", this.x,\n        \"real x\", this.realx,\n        \"y\", this.y,\n        \"width\", this.width,\n        \"height\", this.height\n      )\n    }\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _died() {\n    super._died();\n\n    // todo: add dying animation\n    // the died animation is way lower so we need to\n    // adjust the hight a bit\n    this.y += this.height / 2;\n  }\n\n  /**\n   * @public\n   */\n  public fire(): boolean {\n    if (this._canBeControlled()) {\n      console.log(\"Päng!\");\n      this.state = ActorStates.fire;\n\n      this._vx = 0;\n      this._vy = 0;\n\n      const fire = this._weapon.fire()\n      if (fire) {\n        this._playClip(\n          this._skin + \".punch\",\n          false\n        )\n          .then(() => {\n            this._idle();\n          });\n        return true\n      } else {\n        this._idle()\n      }\n    }\n\n    return false\n  }\n\n  /**\n   * @public\n   */\n  public moveRight() {\n    if (this._canBeControlled()) {\n      this._vx = this._speed;\n      this._playClip(\n        this._skin + \".walk\",\n        true\n      );\n      this.state = ActorStates.walking;\n\n      this._adaptScaleBasedOnOrientation();\n\n      this._logPlayerCoordinates();\n    }\n  }\n\n  /**\n   * @public\n   */\n  public moveLeft() {\n    if (this._canBeControlled()) {\n      this._vx = -this._speed;\n      this._playClip(\n        this._skin + \".walk\",\n        true\n      );\n      this.state = ActorStates.walking;\n      this._adaptScaleBasedOnOrientation();\n\n      this._logPlayerCoordinates();\n    }\n  }\n\n  /**\n   * @public\n   */\n  public stopMoveHorizontally() {\n    this._vx = 0;\n    if (this._vy === 0 && this._canBeControlled()) {\n      this._idle();\n    }\n  }\n\n  /**\n   * @public\n   */\n  public moveUp() {\n    if (this._canBeControlled()) {\n      this._vy = -this._speed;\n      this._playClip(\n        this._skin + \".walk\",\n        true\n      );\n      this.state = ActorStates.walking;\n\n      this._logPlayerCoordinates();\n    }\n  }\n\n  /**\n   * @public\n   */\n  public moveDown() {\n    if (this._canBeControlled()) {\n      this._vy = this._speed;\n      this._playClip(\n        this._skin + \".walk\",\n        true\n      );\n      this.state = ActorStates.walking;\n\n      this._logPlayerCoordinates();\n    }\n  }\n\n  /**\n   * @public\n   */\n  public stopMoveVertically() {\n    this._vy = 0;\n    if (this._vx === 0 && this._canBeControlled()) {\n      this._idle();\n    }\n  }\n}","import * as PIXI from \"pixi.js\";\nimport { EnemyBase } from \"./enemy-base\"\n\n/**\n *\n */\nexport class Bat extends EnemyBase {\n\n  /**\n   *\n   * @param resources\n   * @param skin\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    skin: string\n  ) {\n    super(resources, skin, 1);\n  }\n}","import * as PIXI from \"pixi.js\";\nimport { ActorStates } from \"../../tools/enums\";\nimport { ActorBase } from \"../actor-base\"\nimport { AnimationHelper, MathHelper } from \"../../tools\"\n\n/**\n *\n */\nexport class EnemyBase extends ActorBase {\n\n  // time delta of last sprite flip\n  private _lastFlip = 0;\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    skin: string,\n    speed: number = 2\n  ) {\n\n    super(speed, resources, skin);\n\n    this._isFacingRight = false;\n\n    // load the clips for this object\n    this._clips[this._skin + \".walk\"] =\n      AnimationHelper.loadClip(this._resources, this._skin + \".walk\", 0.2, 2.2);\n    this._clips[this._skin + \".gothit\"] = this._clips[this._skin + \".walk\"];\n    this._clips[this._skin + \".died\"] = this._clips[this._skin + \".walk\"];\n\n    // go to idle\n    this._idle();\n\n//\t\tthis._vr = 0.1;\n//\t\tthis.pivot.set(Math.abs(this.width) / 2, this.height);\n\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _idle() {\n    this.state = ActorStates.idle;\n    this._playClip(\n      this._skin + \".walk\",\n      true\n    );\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _died() {\n    super._died();\n\n    // set proper death location\n    this.y += this.height / 2;\n    this.pivot.set(Math.abs(this.width) / 2, this.height);\n    this.rotation = 90 * Math.PI / 180;\n\n    //console.log(\"pivot\", this.pivot);\n\n    setTimeout(() => {\n      this.parent.removeChild(this);\n    }, 10 * 1000);\n  }\n\n  /**\n   *\n   * @returns {boolean}\n   * @private\n   */\n  private _canFlipAgain() {\n    let canFlip = true;\n    if (Date.now() - this._lastFlip > 200) {\n      canFlip = true;\n      this._lastFlip = Date.now();\n    }\n\n    return canFlip;\n  }\n\n  /**\n   *\n   * @param target\n   */\n  public moveTowards(target: PIXI.Point) {\n\n    /*\n     this.pivot.set(this.width / 2, this.height);\n     this.rotation += 0.1;\n\n     return;*/\n\n    const dist = MathHelper.distanceTo(this.position, target);\n\n    let vx = 0;\n    let vy = 0;\n\n    if (dist > 1) {\n      let angleToTarget = MathHelper.angleBetweenRad(this.position, target);\n\n      vy = Math.sin(angleToTarget) * this._speed;\n      vx = Math.cos(angleToTarget) * this._speed;\n\n      // flip player over\n      if (vx > 0 && !this._isFacingRight && this._canFlipAgain()) {\n\n        //console.log(\"Enemy:\", \"flip left\");\n        this.flip();\n      }\n      // flip player over\n      else if (vx < 0 && this._isFacingRight && this._canFlipAgain()) {\n\n        //console.log(\"Enemy:\", \"flip right\");\n        this.flip();\n      }\n    }\n\n    this._vy = vy;\n    this._vx = vx;\n  }\n}","import * as PIXI from \"pixi.js\";\nimport { Bat } from \"./bat\"\n\n/**\n *\n */\nexport class BatInfected extends Bat {\n\n\n  /**\n   *\n   * @param resources\n   * @param skin\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    skin: string\n  ) {\n    super(resources, skin);\n\n    this._baseScale = 2.5\n\n    // todo make this a red'isch filter\n    const f = new PIXI.filters.ColorMatrixFilter()\n    f.lsd(false)\n    this.filters = [f]\n\n    this.scale.x = this._baseScale\n    this.scale.y = this._baseScale\n  }\n}","import * as PIXI from \"pixi.js\"\n\n/**\n *\n */\nexport class MapBase extends PIXI.Container {\n\n  private readonly _explorationOffset: number\n  protected _textures?: PIXI.ITextureDictionary\n  protected _backgroundContainer: PIXI.Container\n  protected _actorContainer: PIXI.Container\n  protected _foregroundContainer: PIXI.Container\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    protected _width: number,\n    mapToLoad?: string\n  ) {\n    super();\n\n    this._explorationOffset = this._width / 3;\n\n    if (mapToLoad) {\n      // load the clips for this object\n      this._textures = resources[mapToLoad].textures;\n    }\n\n    /**\n     * setup background\n     * @type {PIXI.Container}\n     * @private\n     */\n    this._backgroundContainer = new PIXI.Container();\n    this.addChild(this._backgroundContainer);\n\n    /**\n     * setup actors\n     * @type {PIXI.Container}\n     * @private\n     */\n    this._actorContainer = new PIXI.Container();\n    this.addChild(this._actorContainer);\n\n    /**\n     * setup foreground\n     * @type {PIXI.Container}\n     * @private\n     */\n    this._foregroundContainer = new PIXI.Container();\n    this.addChild(this._foregroundContainer);\n  }\n\n  /**\n   *\n   * @returns {PIXI.Container}\n   */\n  get actorContainer() {\n    return this._actorContainer;\n  }\n\n  /**\n   *\n   * @returns {PIXI.Container}\n   */\n  get backgroundContainer() {\n    return this._backgroundContainer;\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setup() {\n    // stub\n  }\n\n  /**\n   *\n   * @param playerX\n   * @param scrollAmount\n   */\n  public shallScroll(\n    playerX: number,\n    scrollAmount: number\n  ) {\n    if (\n      // move right\n      (scrollAmount > 0 && playerX + this._explorationOffset > this._width) ||\n      // move left\n      (scrollAmount < 0 && playerX - this._explorationOffset < this._explorationOffset)\n    ) {\n      // move map based on positive or negative scroll amount\n      this.x -= scrollAmount\n\n      // left bound\n      if (this.x > 0) {\n        this.x = 0\n      }\n\n      // right bound\n      if (this.x < this._width - this.width) {\n        this.x = this._width - this.width\n      }\n    }\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { MapBase } from \"./map-base\"\n\nconst {Sound} = require(\"pixi-sound\").default\n\n/**\n *\n */\nexport class MaensionOutside extends MapBase {\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    width: number\n  ) {\n    super(resources, width, \"maps.maension\")\n\n    let starryNight = new PIXI.Sprite(\n      this._textures![\"tumblr_inline_n258q4r8c01qhwjx8.png\"]\n    );\n    starryNight.scale.x = 2.56;\n    starryNight.scale.y = 2.56;\n\n    this._backgroundContainer.addChild(starryNight);\n\n    let maension = new PIXI.Sprite(\n      this._textures![\"Maension_WIP.png\"]\n    );\n\n    maension.y = -40\n    maension.scale.x = 2;\n    maension.scale.y = 2;\n\n    this._backgroundContainer.addChild(maension);\n\n    const tree = this._textures![\"tree.png\"]\n    const tree1 = new PIXI.Sprite(tree);\n    tree1.x = 100\n    tree1.y = 350\n    tree1.scale.x = 0.4\n    tree1.scale.y = 0.4\n\n    this._foregroundContainer.addChild(tree1)\n\n    const tree_dead = this._textures![\"tree_dead.png\"]\n    const tree2 = new PIXI.Sprite(tree_dead);\n    tree2.x = 50\n    tree2.y = 180\n    tree2.scale.x = 0.4\n    tree2.scale.y = 0.4\n\n    this._backgroundContainer.addChild(tree2)\n\n    this._setup()\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setup() {\n    const z1 = Sound.from('assets/sounds/zombie1.mp3');\n    const z2 = Sound.from('assets/sounds/zombie1.mp3');\n\n    setInterval(() => {\n      z1.play();\n    }, 15 * 1000)\n\n    setInterval(() => {\n      z2.play();\n    }, 8 * 1000)\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { MapBase } from \"./map-base\"\n\nconst {Sound} = require(\"pixi-sound\").default\n\n/**\n *\n */\nexport class HouseOutside extends MapBase {\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    width: number\n  ) {\n    super(resources, width, \"maps.house\")\n\n    this._setup()\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setup() {\n    let city = new PIXI.Sprite(\n      // @ts-ignore\n      this._textures[\"house.png\"]\n    );\n\n    city.scale.x = 1.3;\n    city.scale.y = 1.3;\n\n    this._backgroundContainer.addChild(city);\n\n    const z1 = Sound.from('assets/sounds/zombie1.mp3');\n    const z2 = Sound.from('assets/sounds/zombie1.mp3');\n\n    setInterval(() => {\n      z1.play();\n    }, 15 * 1000)\n\n    setInterval(() => {\n      z2.play();\n    }, 8 * 1000)\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { MapBase } from \"./map-base\"\n\n/**\n *\n */\nexport class Street extends MapBase {\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    width: number,\n  ) {\n    super(resources, width, \"maps.street\")\n\n    this._setup()\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setup() {\n\n    // background\n\n    // load city first because we need the width\n    // @ts-ignore\n    let city = new PIXI.Sprite(this._textures[\"city01.png\"]);\n    let cityWidth = city.width;\n    city.scale.x = 2;\n    city.scale.y = 2.1;\n    city.y = -100;\n\n    let concret = new PIXI.TilingSprite(\n      // @ts-ignore\n      this._textures[\"concret.png\"]\n    );\n    concret.width = cityWidth;\n    concret.height = 300;\n    concret.scale.x = 2;\n    concret.scale.y = 1.44;\n    concret.y = 330;\n\n    // concret should be in the back so add it first\n    this._backgroundContainer.addChild(concret);\n\n    this._backgroundContainer.addChild(city);\n\n    // foreground\n    // @ts-ignore\n    let police = new PIXI.Sprite(this._textures[\"police.png\"]);\n    police.scale.x = 2;\n    police.scale.y = 2;\n\n    police.y = this.height - police.height * 2;\n    police.x = 300;\n    this._foregroundContainer.addChild(police);\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { Door } from \"../objects\"\nimport { MapBase } from \"./map-base\"\n\n/**\n *\n */\nexport class Loading extends MapBase {\n\n  private readonly _door: Door\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    width: number\n  ) {\n    super(resources, width);\n\n    this._door = new Door(resources)\n    this._door.position.x = (width / 2) - (this._door.width / 2)\n\n    this._setup()\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setup() {\n    this._foregroundContainer.addChild(this._door);\n  }\n}","import * as PIXI from \"pixi.js\";\nimport { Player } from \"../actors\"\n\nconst lineSize = 4;\n\nexport class HUD extends PIXI.Container {\n\n  private _player: Player\n  private _health: PIXI.Text\n\n  // round icons\n  private _rounds: PIXI.Container\n  // weapon icon\n  private _weapon?: PIXI.Sprite\n\n  // change to \"you are dead ...\"\n  private _gameOverSign?: PIXI.Text\n\n  private _width: number\n  private _height: number\n\n  static bigText: PIXI.TextStyle = {\n    fontFamily: \"Arial Black\",\n    fontSize: \"48px\",\n    fontWeight: \"bold\",\n    fill: \"#fff\",\n    dropShadow: true,\n    dropShadowColor: \"#000\",\n    align: \"center\"\n  } as PIXI.TextStyle\n\n  constructor(\n    player: Player,\n    width: number,\n    height: number\n  ) {\n    super();\n\n    this._width = width;\n    this._height = height;\n\n    console.log(\n      \"Setting up HUD\",\n      \"width:\", this._width,\n      \"height:\", this._height\n    );\n\n    this._player = player;\n\n    const smallTextConfig = {\n      ...HUD.bigText,\n      fontSize: \"12px\"\n    }\n\n    const playerName = new PIXI.Text(\n      player.name,\n      {\n        ...smallTextConfig,\n        fill: \"#ffff30\",\n      }\n    );\n    playerName.x = 20;\n    playerName.y = this._height - 50;\n    this.addChild(playerName);\n\n    this._health = new PIXI.Text(\n      \"\",\n      smallTextConfig\n    );\n\n    this._health.x = 20;\n    this._health.y = this._height - 20;\n    this.addChild(this._health);\n\n    this._rounds = new PIXI.Container()\n    this._rounds.x = (this._width / 4) + 40\n    this._rounds.y = this._height - 40\n\n    this.addChild(this._rounds)\n\n    const weaponBorder = new PIXI.Graphics();\n    weaponBorder.lineStyle(lineSize, 0x777777);\n    weaponBorder.drawRect(\n      1,\n      10 - lineSize,\n      this._width / 4 - lineSize,\n      60\n    );\n\n    weaponBorder.y = this._height - weaponBorder.height\n\n    this.addChild(weaponBorder);\n\n    const roundsBorder = new PIXI.Graphics();\n    const sw = this._width / 2 - lineSize\n    roundsBorder.lineStyle(lineSize, 0x777777);\n    roundsBorder.drawRect(\n      weaponBorder.width + lineSize / 2,\n      40 - lineSize,\n      sw,\n      30\n    );\n\n    roundsBorder.y = this._height - 70\n\n    this.addChild(roundsBorder);\n\n    const healthBorder = new PIXI.Graphics();\n    const w = this._width / 4 - lineSize\n    healthBorder.lineStyle(lineSize, 0x777777);\n    healthBorder.drawRect(\n      this._width - w,\n      10 - lineSize,\n      w,\n      60\n    );\n\n    healthBorder.y = this._height - (healthBorder.height + lineSize)\n\n    this.addChild(healthBorder);\n\n    this.update();\n  }\n\n  private _renderWeapon() {\n    this.removeChild(this._weapon!)\n\n    this._weapon = new PIXI.Sprite(this._player.weapon.sprite!.texture)\n    this._weapon.scale.x = this._player.weapon.sprite!.scale.x\n    this._weapon.scale.y = this._player.weapon.sprite!.scale.y\n\n    this._weapon.x = this._width - (this._weapon.width + 40)\n    this._weapon.y = this._height - 40\n\n    this.addChild(this._weapon)\n  }\n\n  private _renderRounds() {\n\n    this._rounds.removeChildren()\n\n    for (let x = 0; x < this._player.weapon.rounds; x++) {\n\n      const roundSprite = new PIXI.Sprite(this._player.weapon.roundsSprite?.texture)\n      roundSprite.scale.x = 0.1\n      roundSprite.scale.y = 0.1\n      roundSprite.x = 20 * x\n      roundSprite.y = 10\n\n      this._rounds.addChild(roundSprite)\n    }\n\n  }\n\n  public update() {\n    this._health.text = this._player.health + \" HP\";\n\n    this._renderRounds()\n    this._renderWeapon()\n  }\n\n  public renderGameOver() {\n    this._gameOverSign = new PIXI.Text(\n      \"Game Over\\nPress Enter to retry!\",\n      {\n        ...HUD.bigText,\n        fill: \"#f00\"\n      }\n    );\n\n    this.addChild(this._gameOverSign);\n\n    // place game over sign in center of screen\n    this._gameOverSign.x = (this._width / 2) - (this._gameOverSign.width / 2)\n    this._gameOverSign.y = (this._height / 2) - (this._gameOverSign.height / 2)\n\n    console.log(this._gameOverSign.position)\n  }\n\n  public animate(delta: number) {\n    if (this._gameOverSign) {\n      this._gameOverSign.alpha += delta / 1000;\n      if (this._gameOverSign.alpha > 1) {\n        this._gameOverSign.alpha = 0.2;\n      }\n    }\n  }\n}","import * as PIXI from \"pixi.js\";\nimport { Config } from \"./config\";\nimport {\n  Blood,\n  Crosshair\n} from \"./objects\"\nimport {\n  ActorBase,\n  Bat,\n  BatInfected,\n  EnemyBase,\n  Player\n} from \"./actors\"\nimport {\n  HouseOutside,\n  Loading,\n  MaensionOutside,\n  MapBase,\n  Street\n} from \"./maps\"\nimport {\n  ActorStates,\n  AnimationHelper,\n  Gamepads,\n  Keyboard,\n  MathHelper\n} from \"./tools\"\nimport {\n  HUD\n} from \"./ui\"\nimport { IDictionary } from \"./tools/IDictionary\"\n\nlet maps: IDictionary<MapBase> = {}\n\n/**\n * @class\n */\nexport default class Game {\n  private _stage: PIXI.Container\n\n  private _hud?: HUD\n  private _map?: MapBase\n  private _player?: Player\n  private _enemies: EnemyBase[] = [];\n  private _mouseLocation?: PIXI.Point\n\n  private _isRunning: boolean = true;\n\n  private _startOffset?: number\n  private _elapsedSeconds = 0;\n  private readonly _resources: PIXI.IResourceDictionary\n\n  private readonly _width: number\n  private readonly _height: number\n\n  private _mouseLine?: PIXI.Graphics\n  private _crosshair?: Crosshair\n\n  private static timeout: number = 300;\n\n  /**\n   *\n   * @param resources\n   * @param stage\n   * @param width\n   * @param height\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    stage: PIXI.Container,\n    width: number, height: number\n  ) {\n    this._stage = stage;\n\n    this._resources = resources;\n    this._width = width;\n    this._height = height;\n\n    maps.street = new Street(\n      this._resources,\n      this._width,\n    );\n\n    maps.house = new HouseOutside(\n      this._resources,\n      this._width,\n    );\n\n    maps.maension = new MaensionOutside(\n      this._resources,\n      this._width\n    );\n\n    maps.loading = new Loading(\n      this._resources,\n      this._width\n    );\n\n    this._init();\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _init() {\n    this._mouseLine = new PIXI.Graphics();\n    this._crosshair = new Crosshair(this._resources)\n\n    this._map = maps.maension!\n    this._stage.addChild(this._map);\n    this._stage.cursor = \"none\"\n\n    // create player\n    this._player = new Player(this._resources, \"ryu\");\n\n    this._player.x = 60\n    this._player.y = 400\n\n    this._player!.adaptScale(this._player!.y, this._height)\n    this._crosshair!.adaptScale(this._player!.y, this._height)\n\n    // add player to stage\n    this._map.actorContainer.addChild(this._player);\n\n    const bat1 = new Bat(this._resources, \"bat\")\n    bat1.flip()\n\n    const bat2 = new Bat(this._resources, \"bat\")\n    const bat3 = new BatInfected(this._resources, \"bat\")\n\n    bat1.position.x = 900\n    bat1.position.y = 200\n\n    bat2.position.x = 920\n    bat2.position.y = 220\n\n    bat3.position.x = 880\n    bat3.position.y = 240\n\n    this._map.actorContainer.addChild(bat1);\n    this._map.actorContainer.addChild(bat2);\n    this._map.actorContainer.addChild(bat3);\n\n    // attach the keyboard to player\n    const gamepad = this._attachGamepad();\n\n    // no gamepad, go to stinky keyboard\n    if (!gamepad) {\n\n      console.log(\"no gamepad, attaching stinky keyboard\");\n      this._attachKeyboard()\n    }\n\n    // init enemies\n    this._enemies = [\n      bat3\n    ];\n\n    this._hud = new HUD(\n      this._player,\n      this._width,\n      this._height\n    );\n\n    this._stage.addChild(this._hud);\n\n    this._updateHud();\n\n    this._attachMouse()\n\n    this._updateMouseLocation(new PIXI.Point(this._width / 2, this._height / 2))\n\n    this._startOffset = undefined;\n\n    // this game is running baby\n    this._isRunning = true;\n\n    console.log(\n      \"Game:\",\n      \"Game init done!\"\n    );\n  }\n\n  private _attachMouse() {\n    this._stage.addChild(this._mouseLine!)\n    this._stage.addChild(this._crosshair!)\n\n    this._stage.interactive = true\n    this._stage.on(\n      \"mousemove\",\n      (e: PIXI.InteractionEvent) => {\n        this._updateMouseLocation(e.data.global)\n      })\n\n    this._stage.on(\n      \"mousedown\",\n      () =>\n        this._fire()\n    )\n\n    this._stage.on(\n      \"mouseout\",\n      () => this._isRunning = false\n    )\n\n    this._stage.on(\n      \"mouseover\",\n      () => this._isRunning = this._player!.state !== ActorStates.died\n    )\n  }\n\n  private _updateCrosshair() {\n    if (\n      this._mouseLocation &&\n      this._isRunning &&\n      this._player?.state !== ActorStates.died\n    ) {\n      this._crosshair!.x = this._mouseLocation!.x - this._crosshair!.width / 2\n      this._crosshair!.y = this._mouseLocation!.y - this._crosshair!.height / 2\n\n      // flip player based on crosshair position\n      if (this._crosshair!.x < this._player!.toGlobal(this._stage).x) {\n        this._player!.flip(false)\n      } else {\n        this._player!.flip(true)\n      }\n\n      // update player based on crosshair\n      this._player!.updateCrosshairPosition(\n        this._stage.toGlobal(this._crosshair?.position!)\n      )\n\n      // adapt crosshair scale based on player location\n      this._crosshair!.adaptScale(this._player!.y, this._height)\n    }\n  }\n\n  private _fire() {\n    if (this._isRunning) {\n      if (this._player?.fire()) {\n        // hit location\n        const impact = new Blood(this._resources, 2)\n        const impactLocation = this._map!.toLocal(this._crosshair!)\n        impact.x = impactLocation.x\n        impact.y = impactLocation.y\n\n        this._map?.backgroundContainer.addChild(impact);\n\n        this._updateHud()\n      }\n    }\n  }\n\n  private _moveRight() {\n    if (this._isRunning && this._player) {\n      this._player.moveRight();\n    }\n  }\n\n  private _moveLeft() {\n    if (this._isRunning && this._player) {\n      this._player.moveLeft();\n    }\n  }\n\n  private _moveUp() {\n    if (this._isRunning && this._player) {\n      this._player.moveUp();\n    }\n  }\n\n  private _moveDown() {\n    if (this._isRunning && this._player) {\n      this._player.moveDown();\n    }\n  }\n\n  private _stopMoveVertically() {\n    if (this._isRunning) {\n      this._player?.stopMoveVertically();\n    }\n  }\n\n  private _stopMoveHorizontally() {\n    if (this._isRunning) {\n      this._player?.stopMoveHorizontally();\n    }\n  }\n\n  private _attachKeyboard() {\n    const\n      left = new Keyboard(\"ArrowLeft\", true),\n      up = new Keyboard(\"ArrowUp\", true),\n      right = new Keyboard(\"ArrowRight\", true),\n      down = new Keyboard(\"ArrowDown\", true),\n\n      k = new Keyboard(\"k\", false),\n      w = new Keyboard(\"w\", false),\n      r = new Keyboard(\"r\", false),\n\n      enter = new Keyboard(\"Enter\", false);\n\n    k.pressEvent = () => this._fire()\n    w.pressEvent = () => this._switchWeapon()\n    r.pressEvent = () => this._reload()\n\n    right.pressEvent = () => this._moveRight()\n    right.releaseEvent = () => {\n      if (!left.isDown) {\n        this._stopMoveHorizontally()\n      }\n    };\n\n    left.pressEvent = () => this._moveLeft()\n    left.releaseEvent = () => {\n      if (!right.isDown) {\n        this._stopMoveHorizontally()\n      }\n    };\n\n    up.pressEvent = () => this._moveUp()\n    up.releaseEvent = () => {\n      if (!down.isDown) {\n        this._stopMoveVertically()\n      }\n    };\n\n    down.pressEvent = () => this._moveDown()\n    down.releaseEvent = () => {\n      if (!up.isDown) {\n        this._stopMoveVertically()\n      }\n    };\n\n    enter.pressEvent = () => {\n      if (!this._isRunning) {\n        this._init();\n      }\n    }\n  }\n\n  private _attachGamepad(): boolean {\n    return !!Gamepads.init({\n      // first gamepad\n      0: {\n        // button 1 pressed\n        1: {\n          pressEvent: () => {\n            this._fire()\n          }\n        },\n        // button 15 pressed\n        15: {\n          pressEvent: () => this._moveRight(),\n          releaseEvent: () => this._stopMoveHorizontally()\n        },\n        // button 14 pressed\n        14: {\n          pressEvent: () => this._moveLeft(),\n          releaseEvent: () => this._stopMoveHorizontally()\n        },\n        // button 12 pressed\n        12: {\n          pressEvent: () => this._moveUp(),\n          releaseEvent: () => this._stopMoveVertically()\n        },\n        // button 13 pressed\n        13: {\n          pressEvent: () => this._moveDown(),\n          releaseEvent: () => this._stopMoveVertically()\n        },\n        // button 9 pressed\n        9: {\n          pressEvent: () => {\n            if (!this._isRunning) {\n              this._init();\n            }\n          }\n        }\n      }\n    })\n  }\n\n  /**\n   * this will end the game\n   * @private\n   */\n  private _end() {\n    // game is not longer running dude\n    this._isRunning = false;\n\n    this._hud!.renderGameOver();\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _detectCollisions() {\n    for (const enemy of this._enemies) {\n      if (ActorStates.died !== enemy.state &&\n        ActorStates.died !== this._player!.state) {\n        // does the player collide the enemy?\n        if (this._player!.collides(enemy)) {\n          const playerHit = this._player!.hitBy(enemy);\n\n          if (playerHit.objectTookDamage) {\n            this._drawBlood(this._player!);\n            this._updateHud();\n          }\n\n          // we died and now lives left :(\n          if (playerHit.died) {\n            // end the game\n            this._end();\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   *\n   * @param actor: the bleeding actor\n   * @private\n   */\n  private _drawBlood(\n    actor: ActorBase\n  ) {\n    for (let i = 0; i < 5; i++) {\n      const blood = new Blood(this._resources);\n\n      blood.x = actor.x + MathHelper.getRandomInt(-20, 20);\n      blood.y = actor.y + actor.height + MathHelper.getRandomInt(-20, 20);\n      blood.rotation = MathHelper.getRandomInt(0, 10);\n\n      this._map?.backgroundContainer.addChild(blood);\n    }\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _updateHud() {\n    this._hud!.update();\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _updateKI() {\n    for (const enemy of this._enemies) {\n      if (ActorStates.died !== enemy.state) {\n        enemy.moveTowards(this._player!.position);\n      }\n    }\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _moveActors() {\n\n    const {_player} = this\n    let playerMoved = false\n\n    if (\n      // do we have velocity?\n      _player!.vy !== 0 &&\n      _player!.y + _player!.vy > 0 &&\n      // dont move lower than the bottom\n      _player!.y + _player!.height + _player!.vy < this._height\n    ) {\n      _player!.y += _player!.vy;\n      playerMoved = true\n    }\n\n    // move right\n    if (_player!.vx > 0) {\n      // dont walk further than the right border of the map\n      if (\n        _player!.realx +\n        Math.abs(_player!.width) + 7 +\n        _player!.vx < this._map!.width\n      ) {\n        _player!.x += _player!.vx;\n        playerMoved = true\n      }\n    }\n    // move left\n    else if (_player!.vx < 0) {\n      // detect left col\n      if (\n        _player!.realx + _player!.vx >= 0\n      ) {\n        _player!.x += _player!.vx;\n        playerMoved = true\n      }\n    }\n\n    if (playerMoved) {\n      // yep, so try to scroll the map\n      this._map?.shallScroll(\n        _player!.realx,\n        _player!.vx\n      );\n      this._updateCrosshair()\n\n      this._player!.adaptScale(this._player!.y, this._height)\n    }\n\n    // move the enemies\n    for (const enemy of this._enemies) {\n\n      if (\n        enemy.vx !== 0 ||\n        enemy.vy !== 0 ||\n        enemy.vr !== 0\n      ) {\n        enemy.x += enemy.vx;\n        enemy.y += enemy.vy;\n        enemy.rotation += enemy.vr;\n\n        enemy.adaptScale(enemy.y, this._height)\n      }\n    }\n\n  }\n\n  private _outlineMouse() {\n    if (\n      this._mouseLine && this._mouseLocation &&\n      this._player && this._map\n    ) {\n      this._mouseLine.clear()\n      this._mouseLine.lineStyle(1, 0xffffff);\n\n      // from\n      this._mouseLine.position =\n        this._player.weaponLocation\n\n      // to\n      const {x, y} = this._mouseLine.toLocal(this._mouseLocation)\n      this._mouseLine.lineTo(\n        x, y\n      );\n\n      this._mouseLine.endFill();\n    }\n  }\n\n  private _switchWeapon() {\n    if (this._isRunning) {\n      this._player!.switchWeapon()\n      this._updateHud()\n    }\n  }\n\n  private _reload() {\n    if (this._isRunning) {\n      this._player!.reload()\n      this._updateHud()\n    }\n  }\n\n  private _updateMouseLocation(\n    mouseLocation: PIXI.Point\n  ) {\n    if (this._isRunning) {\n      this._mouseLocation = mouseLocation\n      this._updateCrosshair()\n    }\n  }\n\n  /**\n   *\n   * @param elapsed\n   * @param delta\n   * @public\n   */\n  public update(\n    elapsed: number,\n    delta: number\n  ) {\n    Gamepads.updateStatus();\n\n    this._hud!.animate(delta);\n\n    if (this._isRunning) {\n      const elapsedSeconds = parseInt((elapsed / 1000).toString());\n\n      // game has not started\n      if (!this._startOffset) {\n        this._startOffset = elapsedSeconds;\n      }\n\n      const correctedElapsedSeconds = (elapsedSeconds - this._startOffset);\n\n      if (correctedElapsedSeconds !== this._elapsedSeconds) {\n        this._elapsedSeconds = correctedElapsedSeconds;\n        this._updateHud();\n      }\n\n      if (Game.timeout - correctedElapsedSeconds <= 0) {\n        // times up!\n        console.log(\"Time is up, dude!\");\n        this._end();\n      }\n\n      this._detectCollisions();\n      this._updateKI();\n      this._moveActors();\n\n      const sort = (a: PIXI.DisplayObject, b: PIXI.DisplayObject) => {\n        if (a.position.y < b.position.y) {\n          return 1;\n        }\n\n        if (a.position.y > b.position.y) {\n          return -1;\n        }\n\n        return 0;\n      }\n\n      // ensure z index for actors\n      this._map?.actorContainer.children\n        .sort(sort);\n\n      if (Config.outlineActors) {\n        // outline player\n        AnimationHelper.outlineContainer(this._player!);\n\n        // outline enemies\n        for (const enemy of this._enemies) {\n          AnimationHelper.outlineContainer(enemy);\n        }\n\n        // outline mouse line\n        this._outlineMouse()\n      }\n    }\n  }\n}","import * as PIXI from \"pixi.js\";\nimport Game from \"./game\";\nimport { Config } from \"./config\"\n\nexport default class Maension {\n\n  private _lastFrame: number = 0\n  private _fpsCount: number = 0\n  private _fpsTimer: number = 0\n  private _game?: Game\n  private readonly _renderer: PIXI.Renderer\n  private readonly _stage: PIXI.Container\n  private readonly _stageWrapper: PIXI.Container\n  private readonly _fps?: PIXI.Text\n\n  constructor(container: HTMLDivElement) {\n\n    this._renderer = PIXI.autoDetectRenderer({\n      width: 800,\n      height: 600,\n      backgroundColor: 0x1099bb\n    });\n\n    container.appendChild(this._renderer.view);\n\n    console.log(\"Viewport\", window.innerWidth, window.innerHeight);\n\n    // create the root of the scene graph\n    this._stage = new PIXI.Container();\n\n    this._stageWrapper = new PIXI.Container();\n    this._stageWrapper.addChild(this._stage)\n\n    if (Config.showFPS) {\n      this._fps = new PIXI.Text(\"FPS: \", {\n        fontWeight: \"16px\",\n        fill: \"#fff\"\n      } as PIXI.TextStyle);\n      this._fps.x = 10\n      this._fps.y = 10\n      this._stageWrapper.addChild(this._fps)\n    }\n\n    this._animate.bind(this);\n    this._assetsLoaded.bind(this);\n  }\n\n  /**\n   *\n   */\n  public run() {\n    const options = {\n      crossOrigin: true\n    };\n\n    const assetPath = \"assets\";\n\n    const loader = new PIXI.Loader()\n\n    // load map\n    loader.add(\"maps.house\", assetPath + \"/maps/house.json\", options)\n    loader.add(\"maps.street\", assetPath + \"/maps/street.json\", options)\n    loader.add(\"maps.maension\", assetPath + \"/maps/maension.json\", options)\n\n    // load player\n    loader.add(\"ryu.stance\", assetPath + \"/ryu/stance.json\", options)\n    loader.add(\"ryu.punch\", assetPath + \"/ryu/punch.json\", options)\n    loader.add(\"ryu.kick\", assetPath + \"/ryu/kick.json\", options)\n    loader.add(\"ryu.walk\", assetPath + \"/ryu/walk.json\", options)\n    loader.add(\"ryu.gothit\", assetPath + \"/ryu/gothit.json\", options)\n    loader.add(\"ryu.died\", assetPath + \"/ryu/died.json\", options)\n\n    // enemies\n    loader.add(\"bat.walk\", assetPath + \"/enemys/bat/walk.json\", options)\n\n    // weapons\n    loader.add(\"weapons.shotgun\", assetPath + \"/weapons/shotgun.json\", options)\n    loader.add(\"weapons.beretta\", assetPath + \"/weapons/beretta.json\", options)\n\n    // load things, like decals heads and so on\n    loader.add(\"things.blood\", assetPath + \"/things/blood.json\", options)\n    loader.add(\"things.door\", assetPath + \"/things/door.json\", options)\n\n    loader.onComplete.once(this._assetsLoaded.bind(this))\n\n    // resources loaded\n    loader.load();\n  }\n\n  /**\n   *\n   * @param loader\n   * @param resources\n   * @private\n   */\n  private _assetsLoaded(\n    loader: PIXI.Loader,\n    resources: PIXI.IResourceDictionary\n  ) {\n\n    // loading done, start game\n    this._game = new Game(\n      resources,\n      this._stage,\n      this._renderer.width,\n      this._renderer.height\n    );\n\n    console.log(\"Mänsion:\", \"Init done, ready to scare!\");\n\n    requestAnimationFrame(this._animate.bind(this));\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _animate(elapsed: number) {\n    // calculate frame delta\n    let delta = elapsed - this._lastFrame;\n    this._lastFrame = elapsed;\n\n    if (this._fps) {\n      this._fpsCount++\n      this._fpsTimer += delta;\n\n      // reset after 1 second\n      if (this._fpsTimer > 1000) {\n        // update text\n        this._fps.text = \"FPS: \" + this._fpsCount;\n\n        this._fpsCount = 0;\n        this._fpsTimer = 0;\n      }\n    }\n\n    // update game\n    if (this._game) {\n      this._game.update(elapsed, delta);\n    }\n\n    // render the container\n    this._renderer.render(this._stageWrapper);\n\n    requestAnimationFrame(this._animate.bind(this));\n  }\n}\n","import React, { useEffect, useRef, useState } from 'react';\nimport './Maension.css';\nimport Maension from \"./game/maension\"\n\nexport default function MaensionComponent() {\n\n  const stage = useRef(null)\n  const [maension, setMaension] = useState<Maension>()\n\n  useEffect(() => {\n    if (!maension && stage.current) {\n      const m = new Maension(stage.current!)\n      m.run()\n      setMaension(m)\n    }\n  }, [stage, maension])\n\n  return (\n    <div className=\"maension\">\n      <h1>Mänsion</h1>\n\n      <div ref={stage}/>\n\n      <div>\n        <div>\n          Donate\n        </div>\n        <div>\n          Patreon\n        </div>\n      </div>\n\n    </div>\n  );\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport Maension from './Maension';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <Maension/>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}