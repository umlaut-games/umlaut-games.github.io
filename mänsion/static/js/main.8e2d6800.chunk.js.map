{"version":3,"sources":["serviceWorker.ts","components/Header.tsx","components/Footer.tsx","components/About.tsx","game/config.ts","game/objects/object-base.ts","game/objects/animation-base.ts","game/objects/decale.ts","game/tools/animation-helper.ts","game/tools/gamepads.ts","game/tools/keyboard.ts","game/tools/math-helper.ts","game/tools/enums.ts","game/objects/door.ts","game/objects/crosshair.ts","game/objects/blood.ts","game/objects/beacon.ts","game/objects/text-bubble.ts","game/actors/actor-base.ts","game/objects/shell.ts","game/objects/muzzle.ts","game/objects/weapons/weapon-base.ts","game/objects/weapons/shotgun.ts","game/objects/weapons/beretta.ts","game/actors/player.ts","game/actors/enemies/bat.ts","game/actors/enemies/enemy-base.ts","game/actors/enemies/bat.infected.ts","game/maps/map-base.ts","game/maps/maension-outside.ts","game/maps/house-outside.ts","game/maps/street.ts","game/maps/loading.ts","game/ui/hud.ts","game/game.ts","game/maension.ts","components/MaensionComponent.tsx","components/HowToPlay.tsx","Page.tsx","index.tsx"],"names":["Boolean","window","location","hostname","match","Header","Footer","className","href","target","rel","About","Config","process","ObjectBase","resources","_outlineContainer","_baseScale","_resources","_isFacingRight","_vx","_vy","_vr","delta","this","vx","vy","vr","x","y","rotation","actor","actorBounds","getBounds","thisBounds","collides","width","height","console","log","scaleOffset","scale","_adaptScaleBasedOnOrientation","Math","abs","parent","removeChild","PIXI","b","lb","toLocal","coordinates","toFixed","fontSize","fill","addChild","outline","lineStyle","drawRect","endFill","AnimationBase","_clips","_currentClip","isFacingRight","which","loop","dontRemove","undefined","Promise","resolve","reject","clipToPlay","err","zIndex","gotoAndPlay","children","sort","a","onComplete","stop","Decale","res","decale","textures","AnimationHelper","speed","frames","textureId","texture","push","clip","animationSpeed","anchor","Gamepads","events","_events","scanGamepads","_gamepads","event","addGamepad","gamepad","index","_state","removeGamepad","gamepadIndex","hasOwnProperty","axes","buttons","buttonIndex","button","state","pressed","isPressed","pressEvent","releaseEvent","gamepads","navigator","getGamepads","webkitGetGamepads","addEventListener","connectHandler","disconnectHandler","Keyboard","_key","_ignoreKeyup","_isDown","_isUp","_downHandler","bind","_upHandler","key","preventDefault","MathHelper","min","max","floor","random","v1","v2","atan2","sqrt","distanceToSq","dx","dy","ActorStates","idle","Symbol","for","walking","fire","died","Door","done","loadClip","filters","BlurFilter","_playClip","then","Crosshair","Blood","Beacon","bg","WHITE","EMPTY","tint","SCALE_MODE","NEAREST","TextBubble","text","duration","t","fontFamily","setTimeout","ActorBase","skin","_text","_lastFlip","_skin","_speed","_health","_power","_canGetHitAgain","constructor","name","_setState","objectTookDamage","power","_died","_idle","direction","_setIsFacingRight","distanceTo","position","angleToTarget","angleBetweenRad","sin","cos","_canFlipAgain","flip","canFlip","Date","now","realx","_logActorCoordinates","maxHeight","maxWidth","Shell","pivot","sprite","getRandomInt","start","TWEEN","Tween","to","repeat","onUpdate","coords","easing","Easing","Bounce","Out","yoyo","Muzzle","WeaponBase","rounds","_reloadTime","_isReloading","_maxRounds","_rounds","_sprite","_roundsSprite","_shellSprites","muzzleFlash","shell","toGlobal","p","splice","findIndex","s","tick","Shotgun","Sound","require","default","Beretta","fireSound","from","f","play","weapons","Player","_weapon","_name","shotgun","beretta","reload","weapon","isReloading","crosshairPosition","angle","weaponLocation","_canBeControlled","speak","playerMoved","adaptScale","moved","Bat","set","PI","enemyMoved","BatInfected","ColorMatrixFilter","lsd","MapBase","_width","mapToLoad","_explorationOffset","_textures","_backgroundContainer","_actorContainer","_foregroundContainer","playerX","scrollAmount","MaensionOutside","starryNight","maension","tree","tree1","tree_dead","tree2","_setup","z1","z2","setInterval","HouseOutside","city","Street","cityWidth","concret","police","Loading","_door","HUD","player","_player","_gameOverSign","_height","smallTextConfig","bigText","playerName","healthBorder","roundsBorder","weaponBorder","update","removeChildren","roundSprite","roundsSprite","health","_renderRounds","_renderWeapon","alpha","fontWeight","dropShadow","dropShadowColor","align","maps","Game","stage","_stage","_hud","_map","_beacon","_enemies","_mouseLocation","_isRunning","_startOffset","_elapsedSeconds","_mouseLine","_crosshair","street","house","loading","_init","cursor","actorContainer","bat2","bat3","_attachGamepad","_attachKeyboard","_updateHud","_attachMouse","_updateMouseLocation","interactive","on","e","data","global","_fire","updateCrosshairPosition","impact","impactLocation","backgroundContainer","moveRight","moveLeft","moveUp","moveDown","stopMoveVertically","stopMoveHorizontally","left","up","right","down","k","w","r","enter","_switchWeapon","_reload","_moveRight","isDown","_stopMoveHorizontally","_moveLeft","_moveUp","_stopMoveVertically","_moveDown","init","0","1","15","14","12","13","9","renderGameOver","enemy","playerHit","hitBy","_drawBlood","_end","i","blood","moveTowards","move","shallScroll","_updateCrosshair","clear","lineTo","switchWeapon","mouseLocation","elapsed","updateStatus","elapsedSeconds","parseInt","toString","correctedElapsedSeconds","_detectCollisions","_updateKI","_moveActors","ab","bb","_outlineMouse","Maension","container","_lastFrame","_fpsCount","_fpsTimer","_game","_renderer","_stageWrapper","_fps","backgroundColor","appendChild","view","innerWidth","innerHeight","_animate","_assetsLoaded","options","crossOrigin","loader","add","assetPath","once","load","requestAnimationFrame","render","MaensionComponent","useRef","useState","setMaension","useEffect","current","m","run","ref","HowToPlay","Page","ReactDOM","StrictMode","document","getElementById","serviceWorker","ready","registration","unregister","catch","error","message"],"mappings":"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","file":"static/js/main.8e2d6800.chunk.js","sourcesContent":["// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport \"./Header.css\"\n\nexport default function Header() {\n  return (\n    <header>\n      <h1>Mänsion</h1>\n      <hr/>\n    </header>\n  );\n}\n","import React from 'react';\nimport './Footer.css';\n\nexport default function Footer() {\n  return (\n    <footer>\n\n      <div>\n        <div className=\"entry\">\n          <a href=\"https://twitter.com/umlautgames\" target=\"_blank\"\n             rel=\"noopener noreferrer\">Twitter</a> |\n        </div>\n        <div className=\"entry\">Kickstarter |</div>\n        <div className=\"entry\">Patreon |</div>\n        <div className=\"entry\">\n          <a href=\"https://umlaut-games.itch.io/\" target=\"_blank\"\n             rel=\"noopener noreferrer\">itch.io</a>\n        </div>\n      </div>\n\n      <div className=\"copyright\">\n        © 2020 <a href=\"https://umlaut.games\" target=\"_blank\" rel=\"noopener noreferrer\">Umlaut Games</a>\n        <span> — All Rights Reserved</span>\n      </div>\n\n    </footer>\n  );\n}\n","import React from 'react';\nimport \"./About.css\"\n\nexport default function About() {\n  return (\n    <div className=\"blocks\">\n      <div className=\"block\">\n        <h2>Kickstarter</h2>\n        <p>\n          Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed mattis sem nunc, vitae consectetur purus volutpat\n          at. Integer at consequat arcu. Curabitur aliquam ex sit amet consectetur bibendum. Phasellus nec metus\n          aliquam, vestibulum est et, efficitur metus. Fusce consectetur vel lectus non feugiat. Nam et ipsum leo.\n          Mauris bibendum semper augue, non dapibus dui vestibulum id. In eget metus nec odio consectetur ultrices ut\n          congue nisi. Vivamus et augue vel risus posuere pulvinar. Vestibulum placerat justo mi, sed aliquam massa\n          lobortis vitae.\n        </p>\n      </div>\n      <div className=\"block\">\n        <h2>Patreon</h2>\n        <p>\n          Ut vestibulum bibendum enim ut sodales. Nam efficitur, sapien consectetur porttitor dapibus, dolor felis\n          lacinia velit, ut commodo odio leo eu nunc. Curabitur vel libero aliquam, malesuada mauris vel, ornare elit.\n          Sed consectetur mauris eu ante maximus pulvinar. Aliquam arcu metus, pellentesque non nibh id, scelerisque\n          placerat mauris. Cras vel elit metus. Donec pulvinar purus ac ipsum tristique tincidunt. Quisque non placerat\n          sapien. In ut iaculis libero, id dictum sem. Mauris pulvinar vel lorem nec cursus.\n        </p>\n      </div>\n    </div>\n  );\n}\n","export const Config = {\n  /**\n   * shall the objects be outlined in renderer or not\n   */\n  outlineObjects: process.env.NODE_ENV !== \"production\" && false,\n\n  /**\n   * show actor coordinates inside the outlines\n   */\n  showObjectCoordinates: process.env.NODE_ENV !== \"production\" && false,\n\n  /**\n   * shall we show the fps or not?\n   */\n  showFPS: process.env.NODE_ENV !== \"production\" && true,\n\n  /**\n   * shall we log the actor coordinates to the console?\n   */\n  logActorCoordinates: process.env.NODE_ENV !== \"production\" && false,\n\n  /**\n   * shall we log actor collisions?\n   */\n  logCollisions: process.env.NODE_ENV !== \"production\" && false,\n\n  /**\n   * highlight beacons\n   */\n  highlightBeacons: process.env.NODE_ENV !== \"production\" && false\n}\n","import * as PIXI from \"pixi.js\";\nimport {Config} from \"../config\"\n\n/**\n *\n */\nexport class ObjectBase extends PIXI.Container {\n\n  protected _outlineContainer?: PIXI.Container\n\n  protected _baseScale: number = 1\n\n  /**\n   *\n   * @type {Object}\n   * @protected\n   */\n  protected _resources: PIXI.IResourceDictionary\n\n  /**\n   * Is the this one facing right?\n   * @type {boolean}\n   * @protected\n   */\n  protected _isFacingRight: boolean = true;\n\n  /**\n   * the object velocity x\n   * @type {number}\n   * @protected\n   */\n  protected _vx = 0;\n\n  /**\n   * the object velocity y\n   * @type {number}\n   * @protected\n   */\n  protected _vy = 0;\n\n  /**\n   * the objects rotation velocity\n   * @type {number}\n   * @private\n   */\n  protected _vr = 0;\n\n  /**\n   *\n   * @param resources\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary\n  ) {\n    super();\n\n    this._resources = resources;\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get vx() {\n    return this._vx;\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get vy() {\n    return this._vy;\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get vr() {\n    return this._vr;\n  }\n\n  /**\n   *\n   * @returns {Number}\n   */\n  get realx() {\n    return this.x - (Math.abs(this.width) / 2);\n  }\n\n  public tick(delta: number) {\n    if (\n      this.vx !== 0 ||\n      this.vy !== 0 ||\n      this.vr !== 0\n    ) {\n      this.x += this.vx;\n      this.y += this.vy;\n      this.rotation += this.vr;\n    }\n  }\n\n  /**\n   *\n   * @param actor\n   * @public\n   */\n  public collides(\n    actor: ObjectBase\n  ) {\n    const actorBounds = actor.getBounds()\n    const thisBounds = this.getBounds()\n\n    const collides = (\n      actorBounds.x + actorBounds.width > thisBounds.x &&\n      actorBounds.x < thisBounds.x + thisBounds.width &&\n      actorBounds.y + actorBounds.height > thisBounds.y &&\n      actorBounds.y < thisBounds.y + thisBounds.height\n    );\n\n    if (collides && Config.logCollisions) {\n      console.log(\"this\", thisBounds);\n      console.log(\"actor\", actorBounds);\n    }\n\n    return collides;\n  }\n\n  public adaptScale(\n    y: number,\n    height: number\n  ) {\n    const scaleOffset = height - y\n    let scale = this._baseScale - scaleOffset / 1000\n\n    this.scale.x = scale\n    this.scale.y = scale\n\n    this._adaptScaleBasedOnOrientation()\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _adaptScaleBasedOnOrientation() {\n    let scale = this.scale.x;\n    if (!this._isFacingRight && scale > 0) {\n      this.scale.x = -scale;\n    }\n\n    if (this._isFacingRight && scale < 0) {\n      this.scale.x = Math.abs(scale);\n    }\n  }\n\n  public outline() {\n    // do we have a outline?\n    if (this._outlineContainer) {\n      // yep remove if from child\n      this.parent.removeChild(this._outlineContainer);\n      // delete it\n      delete this._outlineContainer\n    }\n\n    this._adaptScaleBasedOnOrientation()\n\n    this._outlineContainer = new PIXI.Container()\n    const b = this.getBounds()\n    const lb = this.parent.toLocal(b)\n\n    if (Config.showObjectCoordinates) {\n      const coordinates = new PIXI.Text(\n        `x: ${b.x.toFixed(0)} y: ${b.y.toFixed(0)}\\nw: ${b.width.toFixed(0)} h: ${b.height.toFixed(0)}`, {\n          fontSize: \"10px\",\n          fill: \"#fff\"\n        } as PIXI.TextStyle\n      )\n\n      coordinates.x = lb.x\n      coordinates.y = lb.y\n\n      this._outlineContainer.addChild(coordinates)\n    }\n\n    // create new\n    const outline = new PIXI.Graphics();\n    outline.lineStyle(\n      1,\n      0x000\n    );\n\n    outline.drawRect(\n      lb.x, lb.y,\n      b.width,\n      b.height\n    );\n\n    outline.endFill();\n\n    // attach to object\n    this._outlineContainer.addChild(outline);\n\n    this.parent.addChild(this._outlineContainer)\n  }\n}","import * as PIXI from \"pixi.js\";\nimport { IDictionary } from \"../tools/IDictionary\"\nimport { ObjectBase } from \"./object-base\"\n\n/**\n *\n */\nexport class AnimationBase extends ObjectBase {\n\n  /**\n   * array for animations\n   * @type {{}}\n   * @protected\n   */\n  protected _clips: IDictionary<PIXI.AnimatedSprite> = {};\n\n  /**\n   * current clip that is beeing played\n   * @type {null}\n   * @private\n   */\n  protected _currentClip?: PIXI.AnimatedSprite;\n\n  /**\n   *\n   * @param resources\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary\n  ) {\n    super(resources);\n\n    this._resources = resources;\n  }\n\n  /**\n   *\n   * @param isFacingRight\n   * @protected\n   */\n  protected _setIsFacingRight(\n    isFacingRight: boolean\n  ) {\n    this._isFacingRight = isFacingRight;\n    this._adaptScaleBasedOnOrientation()\n  }\n\n  protected _playClip(\n    which: string,\n    loop: boolean,\n    dontRemove?: boolean\n  ) {\n\n    if (this._currentClip) {\n      this.removeChild(this._currentClip);\n      this._currentClip = undefined;\n    }\n\n    return new Promise((resolve: Function, reject: Function) => {\n      // load punch clip\n      const clipToPlay = this._clips[which];\n\n      if (!clipToPlay) {\n\n        const err = \"AnimationBase: failed to load clip: \" + which;\n        console.log(err, this._clips);\n        reject(err);\n      }\n\n      clipToPlay.zIndex = 1\n\n      // play clip\n      this.addChild(clipToPlay);\n\n      // set the current playing clip\n      this._currentClip = clipToPlay;\n\n      this._adaptScaleBasedOnOrientation();\n\n      this._currentClip.loop = loop;\n      this._currentClip.gotoAndPlay(0);\n\n      this.children.sort(\n        (a, b) =>\n          a.zIndex - b.zIndex\n      )\n\n      if (!loop) {\n        clipToPlay.onComplete = () => {\n          clipToPlay.stop();\n\n          if (!dontRemove) {\n            this.removeChild(clipToPlay);\n          }\n\n          resolve();\n        };\n\n      }\n    })\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { AnimationBase } from \"./animation-base\"\n\n/**\n *\n */\nexport class Decale extends AnimationBase {\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    which: string\n  ) {\n    super(resources);\n\n    const res = this._resources[\"things.decals\"]\n\n    const decale = new PIXI.Sprite(res.textures![which])\n\n    this.addChild(decale)\n  }\n}","import * as PIXI from \"pixi.js\"\n\n/**\n * @class\n */\nexport class AnimationHelper {\n\n  static loadClip(\n    resources: PIXI.IResourceDictionary,\n    which: string,\n    speed: number,\n    scale: number\n  ): PIXI.AnimatedSprite {\n    const frames: PIXI.Texture[] = [];\n    for (const textureId in resources[which].textures) {\n      let texture = resources[which]!.textures![textureId];\n      frames.push(texture);\n    }\n\n    const clip = new PIXI.AnimatedSprite(frames);\n\n    clip.animationSpeed = speed;\n    clip.scale.x = scale;\n    clip.scale.y = scale;\n    clip.anchor.x = 0.5;\n\n    return clip;\n  }\n}","import { IDictionary } from \"./IDictionary\"\n\ntype d<T> = IDictionary<IDictionary<T>>\n\ninterface Event {\n  pressEvent?: (() => void),\n  releaseEvent?: (() => void)\n}\n\ntype Events = d<Event>\n\ninterface State {\n  isPressed: boolean\n}\n\ntype States = d<State>\n\nexport class Gamepads {\n  static _gamepads: IDictionary<Gamepad> = {};\n  static _state: States = {};\n  static _events: Events = {};\n\n  static init(events: Events) {\n    Gamepads._events = events;\n\n    Gamepads.scanGamepads();\n\n    return Gamepads._gamepads[0] || null;\n  }\n\n  static connectHandler(event: GamepadEvent) {\n    console.log(\"gamepad connected\");\n\n    Gamepads.addGamepad(event.gamepad);\n  }\n\n  static addGamepad(gamepad: Gamepad) {\n    console.log(\"adding gamepad\", gamepad);\n\n    Gamepads._gamepads[gamepad.index] = gamepad;\n    Gamepads._state[gamepad.index] = {};\n  }\n\n  static disconnectHandler(event: GamepadEvent) {\n    console.log(\"gamepad disconnected\");\n\n    Gamepads.removeGamepad(event.gamepad);\n  }\n\n  static removeGamepad(gamepad: Gamepad) {\n    console.log(\"removing gamepad\");\n    delete Gamepads._gamepads[gamepad.index];\n    delete Gamepads._state[gamepad.index];\n  }\n\n  static updateStatus() {\n    Gamepads.scanGamepads();\n    for (const gamepadIndex in Gamepads._gamepads) {\n      if (Gamepads._gamepads.hasOwnProperty(gamepadIndex)) {\n        const gamepad: Gamepad = Gamepads._gamepads[gamepadIndex];\n\n        if (gamepad.axes) {\n          //console.log(gamepad.axes)\n        }\n\n        // sometimes controllers dont have buttons\n        if (gamepad.buttons) {\n          for (const buttonIndex in gamepad.buttons) {\n            if (gamepad.buttons.hasOwnProperty(buttonIndex)) {\n              const button: GamepadButton = gamepad.buttons[buttonIndex];\n\n              Gamepads._state[gamepadIndex][buttonIndex] =\n                Gamepads._state[gamepadIndex][buttonIndex] || {};\n              Gamepads._events[gamepadIndex][buttonIndex] =\n                Gamepads._events[gamepadIndex][buttonIndex] || {};\n\n              const state: State = Gamepads._state[gamepadIndex][buttonIndex]\n              const event: Event = Gamepads._events[gamepadIndex][buttonIndex]\n\n              if (button.pressed && !state.isPressed) {\n                console.log(\"button pressed\", gamepadIndex, buttonIndex);\n\n                state.isPressed = true;\n\n                if (event.pressEvent) {\n                  event.pressEvent()\n                }\n              }\n\n              if (!button.pressed && state.isPressed) {\n                console.log(\"button released\", gamepadIndex, buttonIndex);\n\n                state.isPressed = false;\n\n                if (event.releaseEvent) {\n                  event.releaseEvent()\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  static scanGamepads() {\n    const gamepads: Gamepad[] =\n      navigator.getGamepads ? navigator.getGamepads()\n        // @ts-ignore\n        : (navigator.webkitGetGamepads ? navigator.webkitGetGamepads() : []);\n\n    for (const gamepad of gamepads) {\n      // sometimes gamepad is undefined?!\n      if (gamepad) {\n        const gamepadIndex = gamepad.index;\n\n        // do we have this already in records?\n        if (gamepadIndex in Gamepads._gamepads) {\n          Gamepads._gamepads[gamepadIndex] = gamepad;\n        } else {\n          console.log(\"found new gamepad during scan, adding\", gamepadIndex);\n\n          Gamepads.addGamepad(gamepad);\n        }\n      }\n    }\n  }\n}\n\n// register events\n// @ts-ignore\nwindow.addEventListener(\n  \"gamepadconnected\",\n  Gamepads.connectHandler\n);\n// @ts-ignore\nwindow.addEventListener(\n  \"gamepaddisconnected\",\n  Gamepads.disconnectHandler\n);","/**\n * @class\n */\nexport class Keyboard {\n\n  /**\n   *\n   * @type {boolean}\n   * @private\n   */\n  private _isDown = false;\n  /**\n   *\n   * @type {boolean}\n   * @private\n   */\n  private _isUp = true;\n\n  // events\n  /**\n   *\n   * @type {KeyboardEvent}\n   */\n  public pressEvent: (() => void) | null = null;\n  /**\n   *\n   * @type {KeyboardEvent}\n   */\n  public releaseEvent: (() => void) | null = null;\n\n  constructor(\n    private readonly _key: string,\n    private readonly _ignoreKeyup: boolean\n  ) {\n    //Attach event listeners\n    window.addEventListener(\n      \"keydown\",\n      this._downHandler.bind(this),\n      false\n    );\n    window.addEventListener(\n      \"keyup\",\n      this._upHandler.bind(this),\n      false\n    );\n  }\n\n  get isDown() {\n    return this._isDown;\n  }\n\n  /**\n   *\n   * @param event\n   * @private\n   */\n  private _downHandler(\n    event: KeyboardEvent\n  ) {\n    if (event.key === this._key) {\n      event.preventDefault();\n\n      // if the key is up and we have a press handler\n      if (this._isUp && this.pressEvent) {\n        this.pressEvent();\n      }\n\n      this._isDown = true;\n      this._isUp = false;\n    }\n  }\n\n  /**\n   *\n   * @param event\n   * @private\n   */\n  private _upHandler(event: KeyboardEvent) {\n    if (event.key === this._key) {\n      event.preventDefault();\n\n      // if the key is down and we have a press handler\n      if (this._isDown && this.releaseEvent) {\n        this.releaseEvent();\n      }\n\n      this._isDown = false;\n      this._isUp = true;\n    }\n  }\n}","import * as PIXI from \"pixi.js\";\n\nexport class MathHelper {\n\n  /**\n   *\n   * @param min\n   * @param max\n   * @returns {number}\n   * @public\n   */\n  static getRandomInt(min: number, max: number) {\n    return Math.floor(Math.random() * (max - min)) + min;\n  }\n\n  /**\n   *\n   * @param v2\n   * @param v1\n   * @returns {number}\n   */\n  static angleBetweenRad(\n    v1: PIXI.Point,\n    v2: PIXI.Point\n  ) {\n    return Math.atan2(v2.y - v1.y, v2.x - v1.x);\n  }\n\n  /**\n   *\n   * @param v1\n   * @param v2\n   * @returns {number}\n   */\n  static distanceTo(v1: PIXI.Point, v2: PIXI.Point) {\n    return Math.sqrt(MathHelper.distanceToSq(v1, v2));\n  }\n\n  /**\n   *\n   * @param v2\n   * @param v1\n   * @returns {number}\n   */\n  static distanceToSq(v1: PIXI.Point, v2: PIXI.Point) {\n    let dx = v1.x - v2.x,\n      dy = v1.y - v2.y;\n\n    return dx * dx + dy * dy;\n  }\n}","export const ActorStates = {\n  idle: Symbol.for(\"Idle\"),\n  walking: Symbol.for(\"Walking\"),\n  fire: Symbol.for(\"Fire\"),\n  died: Symbol.for(\"Died\")\n};\n\nexport const HitLocations = {\n  Head: Symbol.for(\"Head\"),\n  Feet: Symbol.for(\"Feet\"),\n  Front: Symbol.for(\"Front\"),\n  Back: Symbol.for(\"Back\")\n};","import * as PIXI from \"pixi.js\"\nimport { AnimationBase } from \"./animation-base\"\nimport { AnimationHelper } from \"../tools\"\n\n/**\n *\n */\nexport class Door extends AnimationBase {\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    done?: (() => void)\n  ) {\n    super(resources);\n\n    const which = \"things.door\"\n\n    this._clips = {\n      [which]: AnimationHelper.loadClip(\n        this._resources,\n        which,\n        0.01,\n        8\n      )\n    };\n\n    this._clips[which].filters = [new PIXI.filters.BlurFilter(0.2)]\n\n    this._playClip(\n      which,\n      false,\n      false\n    )\n      .then(() => {\n        if (done) {\n          done()\n        }\n      })\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { ObjectBase } from \"./object-base\"\n\nexport class Crosshair extends ObjectBase {\n\n  constructor(\n    resources: PIXI.IResourceDictionary\n  ) {\n    super(resources);\n\n    this.addChild(\n      new PIXI.Text(\"x\", {\n          fill: \"#fff\"\n        } as PIXI.TextStyle\n      )\n    )\n  }\n}\n","import { AnimationBase } from \"./animation-base\"\nimport { AnimationHelper } from \"../tools\"\n\n/**\n *\n */\nexport class Blood extends AnimationBase {\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    speed: number = 0.01\n  ) {\n    super(resources);\n    const which = \"things.blood\"\n\n    this._clips = {\n      [which]: AnimationHelper.loadClip(\n        this._resources,\n        which,\n        speed,\n        1\n      )\n    };\n\n    this._playClip(which, false, false);\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { Config } from \"../config\"\nimport { ObjectBase } from \"./object-base\"\n\nexport class Beacon extends ObjectBase {\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    width: number,\n    height: number\n  ) {\n    super(resources);\n\n    this._isFacingRight = true\n\n    this.height = height;\n    this.width = width;\n\n    const bg = new PIXI.Sprite(\n      Config.highlightBeacons ? PIXI.Texture.WHITE : PIXI.Texture.EMPTY\n    );\n\n    bg.width = width\n    bg.height = height\n\n    if (Config.highlightBeacons) {\n      bg.tint = 0xff0000\n    }\n\n    this.addChild(bg)\n  }\n\n}\n","import * as PIXI from \"pixi.js\"\nimport { AnimationBase } from \"./animation-base\"\n\nPIXI.settings.SCALE_MODE = PIXI.SCALE_MODES.NEAREST;\n\n/**\n *\n */\nexport class TextBubble extends AnimationBase {\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    text: string,\n    duration: number,\n    done: (() => void)\n  ) {\n    super(resources);\n\n    const t = new PIXI.Text(\n      text, {\n        fontSize: \"8px\",\n        fill: \"#fff\",\n        fontFamily: \"Press Start 2P\"\n      } as PIXI.TextStyle)\n    const bg = new PIXI.Sprite(\n      PIXI.Texture.WHITE\n    );\n\n    bg.width = t.width\n    bg.height = t.height\n    bg.tint = 0x000000\n\n    this.addChild(bg)\n    this.addChild(t)\n\n    setTimeout(() => {\n      done()\n    }, duration * 1000)\n  }\n}","import PIXI from \"pixi.js\"\nimport { ActorStates, MathHelper } from \"../tools\";\nimport { AnimationBase } from \"../objects\"\nimport { TextBubble } from \"../objects/text-bubble\"\nimport { Config } from \"../config\"\n\n/**\n * @class\n */\nexport class ActorBase extends AnimationBase {\n\n  protected _text?: TextBubble\n\n  // time delta of last sprite flip\n  private _lastFlip = 0;\n\n  /**\n   *\n   * @type {null}\n   * @protected\n   */\n  protected _skin?: string;\n\n  /**\n   *\n   * @type {number}\n   * @protected\n   */\n  protected _speed = 1;\n\n  /**\n   * the objects health\n   * @type {number}\n   * @protected\n   */\n  protected _health = 100;\n\n  /**\n   * the objects striking power\n   * @type {number}\n   * @protected\n   */\n  protected _power = 12;\n\n  /**\n   * @type {Symbol}\n   * @protected\n   */\n  protected _state: Symbol = ActorStates.idle;\n\n  /**\n   * can we get git again helper\n   * @type {boolean}\n   * @protected\n   */\n  protected _canGetHitAgain = true;\n\n  /**\n   * @constructor\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    skin: string,\n    speed: number\n  ) {\n    super(resources);\n\n    /**\n     * set the actor skin\n     * @type {String}\n     * @protected\n     */\n    this._skin = skin;\n\n    /**\n     * the objects speed\n     * @type {number}\n     * @protected\n     */\n    this._speed = speed;\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get power() {\n    return this._power;\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get health() {\n    return this._health;\n  }\n\n  /**\n   *\n   * @returns {Symbol}\n   */\n  public get state() {\n    return this._state;\n  }\n\n  /**\n   *\n   * @param state\n   * @protected\n   */\n  protected _setState(state: Symbol) {\n    console.log(this.constructor.name, \"New state:\", state);\n    this._state = state;\n  }\n\n  /**\n   *\n   * @protected\n   */\n  protected _idle() {\n    // dont go to idle if we are dead\n    if (this._state !== ActorStates.died) {\n      this._setState(ActorStates.idle)\n\n      this._playClip(\n        this._skin + \".stance\",\n        true\n      );\n    }\n  }\n\n  /**\n   *\n   * @protected\n   */\n  protected _died() {\n    this._setState(ActorStates.died);\n\n    // remove all velocity\n    this._vy = 0;\n    this._vx = 0;\n    this._vr = 0;\n\n    // play died clip\n    this._playClip(\n      this._skin + \".died\",\n      false,\n      true\n    )\n  }\n\n  /**\n   * @public\n   * @param actor\n   * @returns {boolean}\n   */\n  public hitBy(\n    actor: ActorBase\n  ) {\n\n    let died = false;\n    let objectTookDamage = false;\n\n    if (this._canGetHitAgain) {\n\n      // lower the heal\n      this._health -= actor.power;\n\n      objectTookDamage = true;\n\n      // after we got hit we cannot get hit again\n      this._canGetHitAgain = false;\n\n      // are we death?\n      if (this._health < 0) {\n\n        this._health = 0;\n\n        // yep\n        died = true;\n\n        this._died();\n      }\n      // not died\n      else {\n\n        // force the player a little bit back on hit\n        this._vx = actor._isFacingRight ? 5 : -5;\n\n        // play the gothit clip\n        this._playClip(\n          this._skin + \".gothit\",\n          false\n        )\n          .then(() => {\n\n            // animation ended!\n\n            // remove the velocity\n            this._vx = 0;\n\n            // yep we can get hit again\n            this._canGetHitAgain = true;\n\n            // stand up and idle afterwards\n            this._idle();\n          });\n      }\n    }\n\n    return {\n      died,\n      objectTookDamage\n    };\n  }\n\n  public flip(\n    direction?: boolean\n  ) {\n    this._setIsFacingRight(\n      direction !== undefined ? direction : !this._isFacingRight\n    )\n  }\n\n  /**\n   *\n   * @param target\n   */\n  public moveTowards(target: PIXI.Point) {\n    const dist = MathHelper.distanceTo(this.position, target);\n\n    let vx = 0;\n    let vy = 0;\n\n    if (dist > 1) {\n      let angleToTarget = MathHelper.angleBetweenRad(this.position, target);\n\n      vy = Math.sin(angleToTarget) * this._speed;\n      vx = Math.cos(angleToTarget) * this._speed;\n\n      // flip player over\n      if (vx > 0 && !this._isFacingRight && this._canFlipAgain()) {\n\n        //console.log(\"Enemy:\", \"flip left\");\n        this.flip();\n      }\n      // flip player over\n      else if (vx < 0 && this._isFacingRight && this._canFlipAgain()) {\n\n        //console.log(\"Enemy:\", \"flip right\");\n        this.flip();\n      }\n    }\n\n    this._vy = vy;\n    this._vx = vx;\n  }\n\n  /**\n   *\n   * @returns {boolean}\n   * @private\n   */\n  private _canFlipAgain() {\n    let canFlip = true;\n    if (Date.now() - this._lastFlip > 200) {\n      canFlip = true;\n      this._lastFlip = Date.now();\n    }\n\n    return canFlip;\n  }\n\n  private _logActorCoordinates() {\n    if (Config.logActorCoordinates) {\n      console.log(\n        \"x\", this.x,\n        \"real x\", this.realx,\n        \"y\", this.y,\n        \"width\", this.width,\n        \"height\", this.height\n      )\n    }\n  }\n\n  protected moved() {\n    this._logActorCoordinates()\n    if (this._text) {\n      this._text.x = this.x - this._text.width / 2\n      this._text.y = this.y - 25\n    }\n  }\n\n  public speak(\n    text: string\n  ) {\n    if (!this._text) {\n      this._text = new TextBubble(\n        this._resources,\n        text, 3,\n        () => {\n          this.parent.removeChild(this._text!)\n          delete this._text\n        }\n      )\n      this._text.zIndex = 80\n      this._text.x = this.x - this._text.width / 2\n      this._text.y = this.y - 25\n      this.parent.addChild(this._text)\n    }\n  }\n\n  public move(\n    maxHeight: number,\n    maxWidth: number\n  ): boolean {\n    return false\n  }\n}\n","import * as PIXI from \"pixi.js\"\nimport {MathHelper} from \"../tools\";\nimport {AnimationBase} from \"./animation-base\"\nimport TWEEN from '@tweenjs/tween.js'\n\n\n/**\n *\n */\nexport class Shell extends AnimationBase {\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    texture: PIXI.Texture,\n    vx: number, vy: number, vr: number\n  ) {\n    super(resources);\n\n    this.pivot.x = this.width / 2\n    this.pivot.y = this.height / 2\n\n    this._vr = vr\n    this._vx = vx\n    this._vy = vy\n    const sprite = new PIXI.Sprite(texture)\n\n    // const t = TweenMax.to(sprite, 2.5, {ease: Back.easeInOut.config(4), y: -200})\n\n    sprite.rotation = MathHelper.getRandomInt(0, 100)\n\n    this.scale.x = 0.05\n    this.scale.y = 0.05\n\n    const start = {\n      x: 0,\n      y: 0\n    }\n\n    new TWEEN.Tween(start)\n      .to({x: -(MathHelper.getRandomInt(800, 1200))}, 500)\n      .repeat(1)\n      .onUpdate((coords) => {\n        sprite.x = coords.x;\n      })\n      .start(0)\n\n    new TWEEN.Tween(start)\n      .to({y: MathHelper.getRandomInt(1000, 1400)}, 300)\n      .easing(TWEEN.Easing.Bounce.Out)\n      .repeat(2)\n      .yoyo(true)\n      .onUpdate((coords) => {\n        sprite.y = coords.y;\n      })\n      .start(0)\n\n    this.addChild(sprite)\n  }\n\n  tick(delta: number) {\n\n  }\n}","import { AnimationBase } from \"./animation-base\"\nimport { AnimationHelper } from \"../tools\"\n\n/**\n *\n */\nexport class Muzzle extends AnimationBase {\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    speed: number = 0.01\n  ) {\n    super(resources);\n    const which = \"things.muzzle\"\n\n    this._clips = {\n      [which]: AnimationHelper.loadClip(\n        this._resources,\n        which,\n        speed,\n        1\n      )\n    };\n\n    this._playClip(which, false, false);\n  }\n}","import * as PIXI from \"pixi.js\"\nimport {ObjectBase} from \"../object-base\"\nimport {Shell} from \"../shell\";\nimport { Muzzle } from \"../muzzle\"\n\nexport class WeaponBase extends ObjectBase {\n\n  protected _reloadTime: number\n  protected _isReloading: boolean = false\n\n  protected _power: number\n  protected _maxRounds: number\n  protected _rounds: number\n  protected _sprite?: PIXI.Sprite\n  protected _roundsSprite?: PIXI.Sprite\n  private _shellSprites: Shell[] = []\n\n  get rounds() {\n    return this._rounds\n  }\n\n  get sprite() {\n    return this._sprite\n  }\n\n  get roundsSprite() {\n    return this._roundsSprite\n  }\n\n  get isReloading() {\n    return this._isReloading\n  }\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    power: number,\n    rounds: number\n  ) {\n    super(resources);\n\n    this._power = power\n    this._rounds = rounds\n    this._maxRounds = rounds\n    this._reloadTime = 5\n\n    this.zIndex = 100\n\n    this.x = -5\n    this.y = 20\n  }\n\n  public fire(): boolean {\n\n    if (\n      this._rounds > 0 &&\n      !this._isReloading\n    ) {\n      // muzzle flash\n      const muzzleFlash = new Muzzle(this._resources, 2)\n\n      muzzleFlash.x = 60;\n      muzzleFlash.y = -25;\n      this.addChild(muzzleFlash);\n\n      this._rounds--;\n\n      const speed = 2\n      const shell = new Shell(\n        this._resources,\n        this._roundsSprite?.texture!,\n        speed, speed, 0.1\n      )\n\n      shell.position = this.parent.parent.toGlobal(this.parent.position)\n\n      const p = this.parent.parent\n\n      p.addChild(shell);\n      this._shellSprites.push(shell)\n\n      setTimeout(() => {\n        p.removeChild(shell)\n        this._shellSprites = this._shellSprites.splice(\n          this._shellSprites.findIndex((s) => s === shell)\n        )\n      }, 3 * 1000)\n\n      // todo: add fire sound\n\n      return true\n    }\n\n    // todo: add empty clips sound\n\n    return false\n  }\n\n  public tick(delta: number) {\n    for (const shellSprite of this._shellSprites) {\n      shellSprite.tick(delta)\n    }\n  }\n\n  public reload(): boolean {\n\n    this._isReloading = true\n    setTimeout(() => {\n      this._rounds = this._maxRounds\n      this._isReloading = false\n    }, this._reloadTime * 1000)\n\n    console.log(\"reload\")\n    return true\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { WeaponBase } from \"./weapon-base\"\n\n/**\n *\n */\nexport class Shotgun extends WeaponBase {\n\n  /**\n   *\n   * @param resources\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary\n  ) {\n    super(resources, 55, 6);\n\n    const which = \"weapons.shotgun\"\n\n    const res = resources![which]\n\n    this._roundsSprite = new PIXI.Sprite(\n      res.textures![\"shell.png\"]!\n    );\n\n    this._sprite = new PIXI.Sprite(\n      res.textures![\"shotgun.png\"]!\n    );\n\n    this._sprite.scale.x = 0.1\n    this._sprite.scale.y = 0.1\n\n    // shotgun should be in the back so add it first\n    this.addChild(this._sprite);\n  }\n}","import * as PIXI from \"pixi.js\"\nimport {WeaponBase} from \"./weapon-base\"\n\nconst {Sound} = require(\"pixi-sound\").default\n\n/**\n *\n */\nexport class Beretta extends WeaponBase {\n\n  fireSound = Sound.from('assets/sounds/beretta/beretta_fire.mp3');\n\n  /**\n   *\n   * @param resources\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary\n  ) {\n    super(resources, 55, 8);\n\n    const which = \"weapons.beretta\"\n\n    const res = resources![which]\n\n    // todo: replace with correct skin\n    this._sprite = new PIXI.Sprite(\n      res.textures![\"beretta.png\"]!\n    );\n\n    this._sprite.scale.x = 0.1\n    this._sprite.scale.y = 0.1\n\n    // sprite should be in the back so add it first\n    this.addChild(this._sprite);\n\n    this._roundsSprite = new PIXI.Sprite(\n      res.textures![\"shell.png\"]!\n    );\n  }\n\n  public fire(): boolean {\n    const f = super.fire()\n    if (f) {\n      this.fireSound.play();\n    }\n    return f\n  }\n}","import * as PIXI from \"pixi.js\"\nimport {\n  Beretta,\n  Shotgun,\n  WeaponBase\n} from \"../objects/weapons\"\nimport {ActorBase} from \"./actor-base\"\nimport {\n  ActorStates,\n  AnimationHelper,\n  MathHelper\n} from \"../tools\"\n\nconst weapons: {\n  shotgun?: Shotgun,\n  beretta?: Beretta\n} = {}\n\n/**\n *\n */\nexport class Player extends ActorBase {\n\n  private _weapon: WeaponBase\n  private _name: string = \"Taro\"\n\n  get weapon(): WeaponBase {\n    return this._weapon\n  }\n\n  get playerName() {\n    return this._name\n  }\n\n  /**\n   *\n   * @param resources\n   * @param skin\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    skin: string\n  ) {\n    super(\n      resources, skin, 3\n    );\n\n    this._baseScale = 1.1\n\n    this._health = 77;\n\n    // load the clips for this object\n    this._clips[this._skin + \".stance\"] =\n      AnimationHelper.loadClip(\n        this._resources, this._skin + \".stance\", 0.1, 1\n      );\n    this._clips[this._skin + \".walk\"] =\n      AnimationHelper.loadClip(\n        this._resources, this._skin + \".walk\", 0.2, 1\n      );\n    this._clips[this._skin + \".punch\"] =\n      AnimationHelper.loadClip(\n        this._resources, this._skin + \".punch\", 0.3, 1\n      );\n    this._clips[this._skin + \".kick\"] =\n      AnimationHelper.loadClip(\n        this._resources, this._skin + \".kick\", 0.2, 1\n      );\n    this._clips[this._skin + \".gothit\"] =\n      AnimationHelper.loadClip(\n        this._resources, this._skin + \".gothit\", 0.2, 1\n      );\n    this._clips[this._skin + \".died\"] =\n      AnimationHelper.loadClip(\n        this._resources, this._skin + \".died\", 0.2, 1\n      );\n\n    weapons.shotgun = new Shotgun(resources)\n    weapons.beretta = new Beretta(resources)\n\n    // todo get this from equipment\n    this._weapon = weapons.beretta\n    this.addChild(this._weapon)\n\n    // go to idle\n    this._idle();\n  }\n\n  public reload() {\n    // todo check equipment for shells\n    this._weapon.reload()\n  }\n\n  public switchWeapon() {\n    if (!this.weapon.isReloading) {\n      this.removeChild(this._weapon)\n\n      if (this._weapon instanceof Shotgun) {\n        this._weapon = weapons.beretta!\n      } else {\n        this._weapon = weapons.shotgun!\n      }\n\n      this.addChild(this._weapon)\n    }\n  }\n\n  public updateCrosshairPosition(\n    crosshairPosition: PIXI.Point\n  ) {\n    const angle: number = this._isFacingRight ?\n      MathHelper.angleBetweenRad(this.weaponLocation, crosshairPosition) :\n      -MathHelper.angleBetweenRad(crosshairPosition, this.weaponLocation)\n    this._weapon.rotation = angle\n  }\n\n  get weaponLocation(): PIXI.Point {\n    return this.toGlobal(\n      this._weapon.position\n    )\n  }\n\n  /**\n   *\n   * @returns {boolean}\n   * @private\n   */\n  private _canBeControlled() {\n    if (this._state === ActorStates.died) {\n      console.log(\"Cant be controlled, player is dead\");\n      return false\n    }\n\n    return (\n      this._state === ActorStates.idle ||\n      this._state === ActorStates.walking\n    );\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _died() {\n    super._died();\n\n    // todo: add dying animation\n    // the died animation is way lower so we need to\n    // adjust the hight a bit\n    this.y += this.height / 2;\n\n    this.height = this.height / 2\n  }\n\n  /**\n   * @public\n   */\n  public fire(): boolean {\n    if (!this._canBeControlled()) {\n      return false\n    }\n\n    // try to fires\n    const fire = this._weapon.fire()\n    if (fire) {\n\n      // we fired, announce\n      this.speak(\"Päng!\")\n\n      // set state, remove velo\n      this._setState(ActorStates.fire)\n      this._vx = 0;\n      this._vy = 0;\n\n      // play fire animation\n      this._playClip(\n        this._skin + \".punch\",\n        false\n      )\n        .then(() => {\n          // once done, go back to idle\n          this._idle();\n        });\n      return true\n    } else {\n      this._idle()\n      return false\n    }\n  }\n\n  /**\n   * @public\n   */\n  public moveRight() {\n    if (this._canBeControlled()) {\n      this._vx = this._speed;\n      this._playClip(\n        this._skin + \".walk\",\n        true\n      );\n      this._setState(ActorStates.walking)\n    }\n  }\n\n  /**\n   * @public\n   */\n  public moveLeft() {\n    if (this._canBeControlled()) {\n      this._vx = -this._speed;\n      this._playClip(\n        this._skin + \".walk\",\n        true\n      );\n      this._setState(ActorStates.walking)\n      this._adaptScaleBasedOnOrientation()\n    }\n  }\n\n  /**\n   * @public\n   */\n  public stopMoveHorizontally() {\n    this._vx = 0;\n    if (this._vy === 0 && this._canBeControlled()) {\n      this._idle();\n    }\n  }\n\n  /**\n   * @public\n   */\n  public moveUp() {\n    if (this._canBeControlled()) {\n      this._vy = -this._speed;\n      this._playClip(\n        this._skin + \".walk\",\n        true\n      );\n      this._setState(ActorStates.walking)\n    }\n  }\n\n  /**\n   * @public\n   */\n  public moveDown() {\n    if (this._canBeControlled()) {\n      this._vy = this._speed;\n      this._playClip(\n        this._skin + \".walk\",\n        true\n      );\n      this._setState(ActorStates.walking);\n    }\n  }\n\n  /**\n   * @public\n   */\n  public stopMoveVertically() {\n    this._vy = 0;\n    if (this._vx === 0 && this._canBeControlled()) {\n      this._idle();\n    }\n  }\n\n  public speak(\n    text: string\n  ) {\n    super.speak(`${this._name}: ${text}`)\n  }\n\n  public move(\n    maxHeight: number,\n    maxWidth: number\n  ): boolean {\n    let playerMoved = false\n\n    if (\n      // do we have velocity?\n      this.vy !== 0 &&\n      this.y + this.vy > 0 &&\n      // dont move lower than the bottom\n      this.y + this.height + this.vy < maxHeight\n    ) {\n      this.y += this.vy;\n      playerMoved = true\n    }\n\n    // move right\n    if (this.vx > 0) {\n      // dont walk further than the right border of the map\n      if (\n        this.realx +\n        Math.abs(this.width) + 7 +\n        this.vx < maxWidth\n      ) {\n        this.x += this.vx;\n        playerMoved = true\n      }\n    }\n    // move left\n    else if (this.vx < 0) {\n      // detect left col\n      if (\n        this.realx + this.vx >= 0\n      ) {\n        this.x += this.vx;\n        playerMoved = true\n      }\n    }\n\n    if (playerMoved) {\n      this.adaptScale(this.y, maxHeight)\n      this.moved()\n    }\n\n    return playerMoved\n  }\n\n  public tick(delta: number) {\n    this.weapon.tick(delta)\n  }\n}\n","import * as PIXI from \"pixi.js\";\nimport { EnemyBase } from \"./enemy-base\"\n\n/**\n *\n */\nexport class Bat extends EnemyBase {\n\n  /**\n   *\n   * @param resources\n   * @param skin\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    skin: string\n  ) {\n    super(resources, skin, 1);\n  }\n}","import * as PIXI from \"pixi.js\";\nimport { ActorBase } from \"../actor-base\"\nimport {\n  ActorStates,\n  AnimationHelper\n} from \"../../tools\"\n\n/**\n *\n */\nexport class EnemyBase extends ActorBase {\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    skin: string,\n    speed: number = 2\n  ) {\n    super(resources, skin, speed);\n\n    this._isFacingRight = false;\n\n    // load the clips for this object\n    this._clips[this._skin + \".walk\"] =\n      AnimationHelper.loadClip(\n        this._resources, this._skin + \".walk\", 0.2, 1\n      );\n    this._clips[this._skin + \".gothit\"] = this._clips[this._skin + \".walk\"];\n    this._clips[this._skin + \".died\"] = this._clips[this._skin + \".walk\"];\n\n    // go to idle\n    this._idle();\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _idle() {\n    this._setState(ActorStates.idle)\n    this._playClip(\n      this._skin + \".walk\",\n      true\n    );\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _died() {\n    super._died();\n\n    // set proper death location\n    this.y += this.height / 2;\n    this.pivot.set(Math.abs(this.width) / 2, this.height);\n    this.rotation = 90 * Math.PI / 180;\n\n    setTimeout(() => {\n      this.parent.removeChild(this);\n    }, 10 * 1000);\n  }\n\n  move(\n    maxHeight: number,\n    maxWidth: number\n  ): boolean {\n    let enemyMoved = false\n\n    if (\n      this.vx !== 0 ||\n      this.vy !== 0 ||\n      this.vr !== 0\n    ) {\n      this.x += this.vx;\n      this.y += this.vy;\n      this.rotation += this.vr;\n\n      enemyMoved = true\n\n      this.adaptScale(this.y, maxHeight)\n    }\n\n    return enemyMoved\n  }\n}\n","import * as PIXI from \"pixi.js\";\nimport { Bat } from \"./bat\"\n\n/**\n *\n */\nexport class BatInfected extends Bat {\n\n\n  /**\n   *\n   * @param resources\n   * @param skin\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    skin: string\n  ) {\n    super(resources, skin);\n\n    this._baseScale = 2.5\n\n    // todo make this a red'isch filter\n    const f = new PIXI.filters.ColorMatrixFilter()\n    f.lsd(false)\n    this.filters = [f]\n\n    this.scale.x = this._baseScale\n    this.scale.y = this._baseScale\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { AnimationBase } from \"../objects\"\n\n/**\n *\n */\nexport class MapBase extends AnimationBase {\n\n  private readonly _explorationOffset: number\n  protected _textures?: PIXI.ITextureDictionary\n  protected _backgroundContainer: PIXI.Container\n  protected _actorContainer: PIXI.Container\n  protected _foregroundContainer: PIXI.Container\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    protected _width: number,\n    mapToLoad?: string\n  ) {\n    super(resources);\n\n    this._explorationOffset = this._width / 3;\n\n    if (mapToLoad) {\n      // load the clips for this object\n      this._textures = resources[mapToLoad].textures;\n    }\n\n    /**\n     * setup background\n     * @type {PIXI.Container}\n     * @private\n     */\n    this._backgroundContainer = new PIXI.Container();\n    this.addChild(this._backgroundContainer);\n\n    /**\n     * setup actors\n     * @type {PIXI.Container}\n     * @private\n     */\n    this._actorContainer = new PIXI.Container();\n    this.addChild(this._actorContainer);\n\n    /**\n     * setup foreground\n     * @type {PIXI.Container}\n     * @private\n     */\n    this._foregroundContainer = new PIXI.Container();\n    this.addChild(this._foregroundContainer);\n  }\n\n  /**\n   *\n   * @returns {PIXI.Container}\n   */\n  get actorContainer() {\n    return this._actorContainer;\n  }\n\n  /**\n   *\n   * @returns {PIXI.Container}\n   */\n  get backgroundContainer() {\n    return this._backgroundContainer;\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setup() {\n    // stub\n  }\n\n  /**\n   *\n   * @param playerX\n   * @param scrollAmount\n   */\n  public shallScroll(\n    playerX: number,\n    scrollAmount: number\n  ) {\n    if (\n      // move right\n      (scrollAmount > 0 && playerX + this._explorationOffset > this._width) ||\n      // move left\n      (scrollAmount < 0 && playerX - this._explorationOffset < this._explorationOffset)\n    ) {\n      // move map based on positive or negative scroll amount\n      this.x -= scrollAmount\n\n      // left bound\n      if (this.x > 0) {\n        this.x = 0\n      }\n\n      // right bound\n      if (this.x < this._width - this.width) {\n        this.x = this._width - this.width\n      }\n    }\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { MapBase } from \"./map-base\"\n\nconst {Sound} = require(\"pixi-sound\").default\n\n/**\n *\n */\nexport class MaensionOutside extends MapBase {\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    width: number\n  ) {\n    super(resources, width, \"maps.maension\")\n\n    let starryNight = new PIXI.Sprite(\n      this._textures![\"tumblr_inline_n258q4r8c01qhwjx8.png\"]\n    );\n    starryNight.scale.x = 2.56;\n    starryNight.scale.y = 2.56;\n\n    this._backgroundContainer.addChild(starryNight);\n\n    let maension = new PIXI.Sprite(\n      this._textures![\"Maension_WIP.png\"]\n    );\n\n    maension.y = -40\n    maension.scale.x = 2;\n    maension.scale.y = 2;\n\n    this._backgroundContainer.addChild(maension);\n\n    const tree = this._textures![\"tree.png\"]\n    const tree1 = new PIXI.Sprite(tree);\n    tree1.x = 100\n    tree1.y = 350\n    tree1.scale.x = 0.4\n    tree1.scale.y = 0.4\n\n    this._actorContainer.addChild(tree1)\n\n    const tree_dead = this._textures![\"tree_dead.png\"]\n    const tree2 = new PIXI.Sprite(tree_dead);\n    tree2.x = 50\n    tree2.y = 180\n    tree2.scale.x = 0.4\n    tree2.scale.y = 0.4\n\n    this._backgroundContainer.addChild(tree2)\n\n    this._setup()\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setup() {\n    const z1 = Sound.from('assets/sounds/zombie1.mp3');\n    const z2 = Sound.from('assets/sounds/zombie1.mp3');\n\n    setInterval(() => {\n      z1.play();\n    }, 30 * 1000)\n\n    setInterval(() => {\n      z2.play();\n    }, 67 * 1000)\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { MapBase } from \"./map-base\"\n\nconst {Sound} = require(\"pixi-sound\").default\n\n/**\n *\n */\nexport class HouseOutside extends MapBase {\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    width: number\n  ) {\n    super(resources, width, \"maps.house\")\n\n    this._setup()\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setup() {\n    let city = new PIXI.Sprite(\n      // @ts-ignore\n      this._textures[\"house.png\"]\n    );\n\n    city.scale.x = 1.3;\n    city.scale.y = 1.3;\n\n    this._backgroundContainer.addChild(city);\n\n    const z1 = Sound.from('assets/sounds/zombie1.mp3');\n    const z2 = Sound.from('assets/sounds/zombie1.mp3');\n\n    setInterval(() => {\n      z1.play();\n    }, 30 * 1000)\n\n    setInterval(() => {\n      z2.play();\n    }, 67 * 1000)\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { MapBase } from \"./map-base\"\n\n/**\n *\n */\nexport class Street extends MapBase {\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    width: number,\n  ) {\n    super(resources, width, \"maps.street\")\n\n    this._setup()\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setup() {\n\n    // background\n\n    // load city first because we need the width\n    // @ts-ignore\n    let city = new PIXI.Sprite(this._textures[\"city01.png\"]);\n    let cityWidth = city.width;\n    city.scale.x = 2;\n    city.scale.y = 2.1;\n    city.y = -100;\n\n    let concret = new PIXI.TilingSprite(\n      // @ts-ignore\n      this._textures[\"concret.png\"]\n    );\n    concret.width = cityWidth;\n    concret.height = 300;\n    concret.scale.x = 2;\n    concret.scale.y = 1.44;\n    concret.y = 330;\n\n    // concret should be in the back so add it first\n    this._backgroundContainer.addChild(concret);\n\n    this._backgroundContainer.addChild(city);\n\n    // foreground\n    // @ts-ignore\n    let police = new PIXI.Sprite(this._textures[\"police.png\"]);\n    police.scale.x = 2;\n    police.scale.y = 2;\n\n    police.y = this.height - police.height * 2;\n    police.x = 300;\n    this._foregroundContainer.addChild(police);\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { Door } from \"../objects\"\nimport { MapBase } from \"./map-base\"\n\n/**\n *\n */\nexport class Loading extends MapBase {\n\n  private readonly _door: Door\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    width: number,\n    done?: (() => void)\n  ) {\n    super(resources, width);\n\n    const bg = new PIXI.Sprite(PIXI.Texture.WHITE);\n\n    this._door = new Door(\n      resources,\n      done\n    )\n    this._door.x = width / 2\n    this._door.y = 30\n\n    bg.width = width\n    bg.height = 800\n    bg.tint = 0x000000\n\n    this._backgroundContainer.addChild(bg)\n\n    this._setup()\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setup() {\n    this._foregroundContainer.addChild(this._door);\n  }\n\n  public animate(delta: number) {\n    this._door.y += delta / 100\n    const scale = this._door.scale.x + delta / 20000\n    this._door.scale.x = scale\n    this._door.scale.y = scale\n  }\n}","import * as PIXI from \"pixi.js\";\nimport { Player } from \"../actors\"\nimport { AnimationBase } from \"../objects\"\n\nexport class HUD extends AnimationBase {\n\n  private _player: Player\n  private _health: PIXI.Text\n\n  // round icons\n  private _rounds: PIXI.Container\n  // weapon icon\n  private _weapon?: PIXI.Sprite\n\n  // change to \"you are dead ...\"\n  private _gameOverSign?: PIXI.Text\n\n  private _width: number\n  private _height: number\n\n  static bigText: PIXI.TextStyle = {\n    fontFamily: \"Arial Black\",\n    fontSize: \"48px\",\n    fontWeight: \"bold\",\n    fill: \"#fff\",\n    dropShadow: true,\n    dropShadowColor: \"#000\",\n    align: \"center\"\n  } as PIXI.TextStyle\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    player: Player,\n    width: number,\n    height: number\n  ) {\n    super(resources);\n\n    const which = \"things.hud\"\n\n    const res = resources[which]\n\n    this._width = width;\n    this._height = height;\n\n    console.log(\n      \"Setting up HUD\",\n      \"width:\", this._width,\n      \"height:\", this._height\n    );\n\n    this._player = player;\n\n    const smallTextConfig = {\n      ...HUD.bigText,\n      fontSize: \"12px\"\n    }\n\n    const playerName = new PIXI.Text(\n      player.playerName,\n      {\n        ...smallTextConfig,\n        fill: \"#ffff30\",\n      }\n    );\n    playerName.x = this._width / 3 - playerName.width / 2;\n    playerName.y = this._height - 47;\n    this.addChild(playerName);\n\n    this._health = new PIXI.Text(\n      \"\",\n      smallTextConfig\n    );\n\n    this._health.x = playerName.x;\n    this._health.y = this._height - 23;\n    this.addChild(this._health);\n\n    this._rounds = new PIXI.Container()\n    this._rounds.x = (this._width / 3) + 77\n    this._rounds.y = this._height - 33\n\n    this.addChild(this._rounds)\n\n    const healthBorder = new PIXI.Sprite(\n      res.textures![\"side.png\"]\n    );\n\n    healthBorder.x = this._width / 2 - (healthBorder.width + healthBorder.width / 2) + 2\n    healthBorder.y = this._height - healthBorder.height - 2\n\n    this.addChild(healthBorder);\n\n    const roundsBorder = new PIXI.Sprite(\n      res.textures![\"center.png\"]\n    );\n    roundsBorder.x = this._width / 2 - (roundsBorder.width / 2) + 1\n    roundsBorder.y = this._height - roundsBorder.height - 2\n\n    this.addChild(roundsBorder);\n\n    const weaponBorder = new PIXI.Sprite(\n      res.textures![\"side.png\"]\n    );\n\n    weaponBorder.x = this._width / 2 + (roundsBorder.width + weaponBorder.width / 2) - 2\n    weaponBorder.y = this._height - weaponBorder.height - 2\n\n    weaponBorder.scale.x = -1\n\n    this.addChild(weaponBorder);\n\n    this.update();\n  }\n\n  private _renderWeapon() {\n    this.removeChild(this._weapon!)\n\n    this._weapon = new PIXI.Sprite(this._player.weapon.sprite!.texture)\n    this._weapon.scale.x = this._player.weapon.sprite!.scale.x * 2\n    this._weapon.scale.y = this._player.weapon.sprite!.scale.y * 2\n\n    this._weapon.x = this._width / 2 + (this._weapon.width + 27)\n    this._weapon.y = this._height - 40\n\n    this.addChild(this._weapon)\n  }\n\n  private _renderRounds() {\n\n    this._rounds.removeChildren()\n\n    for (let x = 0; x < this._player.weapon.rounds; x++) {\n\n      const roundSprite = new PIXI.Sprite(this._player.weapon.roundsSprite?.texture)\n      roundSprite.scale.x = 0.1\n      roundSprite.scale.y = 0.1\n      roundSprite.x = 10 * x\n      roundSprite.y = 10\n\n      this._rounds.addChild(roundSprite)\n    }\n\n  }\n\n  public update() {\n    this._health.text = this._player.health + \" HP\";\n\n    this._renderRounds()\n    this._renderWeapon()\n  }\n\n  public renderGameOver() {\n    this._gameOverSign = new PIXI.Text(\n      \"Game Over\\nPress Enter to retry!\",\n      {\n        ...HUD.bigText,\n        fill: \"#f00\"\n      }\n    );\n\n    this.addChild(this._gameOverSign);\n\n    // place game over sign in center of screen\n    this._gameOverSign.x = (this._width / 2) - (this._gameOverSign.width / 2)\n    this._gameOverSign.y = (this._height / 2) - (this._gameOverSign.height / 2)\n  }\n\n  public animate(delta: number) {\n    if (this._gameOverSign) {\n      this._gameOverSign.alpha += delta / 1000;\n      if (this._gameOverSign.alpha > 1) {\n        this._gameOverSign.alpha = 0.2;\n      }\n    }\n  }\n}\n","import * as PIXI from \"pixi.js\";\nimport { Config } from \"./config\";\nimport {\n  Beacon,\n  Blood,\n  Crosshair, Decale\n} from \"./objects\"\nimport {\n  ActorBase,\n  Bat,\n  BatInfected,\n  EnemyBase,\n  Player\n} from \"./actors\"\nimport {\n  HouseOutside,\n  Loading,\n  MaensionOutside,\n  MapBase,\n  Street\n} from \"./maps\"\nimport {\n  ActorStates,\n  Gamepads,\n  Keyboard,\n  MathHelper\n} from \"./tools\"\nimport {\n  HUD\n} from \"./ui\"\nimport { IDictionary } from \"./tools/IDictionary\"\n\nlet maps: IDictionary<MapBase> = {}\n\n/**\n * @class\n */\nexport default class Game {\n  private _stage: PIXI.Container\n\n  private _hud?: HUD\n  private _map?: MapBase\n  private _player?: Player\n  // special items that are nor visible\n  private _beacon?: Beacon\n  private _enemies: EnemyBase[] = [];\n  private _mouseLocation?: PIXI.Point\n\n  private _isRunning: boolean = true;\n\n  private _startOffset?: number\n  private _elapsedSeconds = 0;\n\n  private readonly _resources: PIXI.IResourceDictionary\n\n  private readonly _width: number\n  private readonly _height: number\n\n  private _mouseLine?: PIXI.Graphics\n  private _crosshair?: Crosshair\n\n  /**\n   *\n   * @param resources\n   * @param stage\n   * @param width\n   * @param height\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    stage: PIXI.Container,\n    width: number, height: number\n  ) {\n    this._stage = stage;\n\n    this._resources = resources;\n    this._width = width;\n    this._height = height;\n\n    maps.street = new Street(\n      this._resources,\n      this._width,\n    );\n\n    maps.house = new HouseOutside(\n      this._resources,\n      this._width,\n    );\n\n    maps.maension = new MaensionOutside(\n      this._resources,\n      this._width\n    );\n\n    maps.loading = new Loading(\n      this._resources,\n      this._width\n    );\n\n    this._init();\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _init() {\n    this._mouseLine = new PIXI.Graphics();\n    this._crosshair = new Crosshair(this._resources)\n\n    this._map = maps.maension!\n    this._stage.addChild(this._map);\n    this._stage.cursor = \"none\"\n\n    // create player\n    this._player = new Player(this._resources, \"ryu\");\n\n    this._player.x = 60\n    this._player.y = 400\n\n    this._player!.adaptScale(this._player!.y, this._height)\n    this._crosshair!.adaptScale(this._player!.y, this._height)\n\n    // add player to stage\n    this._map.actorContainer.addChild(this._player);\n\n    this._beacon = new Beacon(\n      this._resources, 80, 5\n    )\n\n    const bat2 = new Bat(this._resources, \"bat\")\n    const bat3 = new BatInfected(this._resources, \"bat\")\n\n    this._beacon.position.x = 580\n    this._beacon.position.y = 250\n\n    bat2.position.x = 920\n    bat2.position.y = 220\n\n    bat3.position.x = 880\n    bat3.position.y = 240\n\n    this._map.actorContainer.addChild(this._beacon);\n    this._map.actorContainer.addChild(bat2);\n    this._map.actorContainer.addChild(bat3);\n\n    // attach the keyboard to player\n    const gamepad = this._attachGamepad();\n\n    // no gamepad, go to stinky keyboard\n    if (!gamepad) {\n\n      console.log(\"no gamepad, attaching stinky keyboard\");\n      this._attachKeyboard()\n    }\n\n    // init enemies\n    this._enemies = [\n      // bat3\n    ];\n\n    this._hud = new HUD(\n      this._resources,\n      this._player,\n      this._width,\n      this._height\n    );\n\n    this._stage.addChild(this._hud);\n\n    this._updateHud();\n\n    this._attachMouse()\n\n    this._updateMouseLocation(new PIXI.Point(this._width / 2, this._height / 2))\n\n    this._startOffset = undefined;\n\n    // this game is running baby\n    this._isRunning = true;\n\n    console.log(\n      \"Game:\",\n      \"Game init done!\"\n    );\n  }\n\n  private _attachMouse() {\n    this._stage.addChild(this._mouseLine!)\n    this._stage.addChild(this._crosshair!)\n\n    this._stage.interactive = true\n    this._stage.on(\n      \"mousemove\",\n      (e: PIXI.InteractionEvent) => {\n        this._updateMouseLocation(e.data.global)\n      })\n\n    this._stage.on(\n      \"mousedown\",\n      () =>\n        this._fire()\n    )\n\n    this._stage.on(\n      \"mouseout\",\n      () => this._isRunning = false\n    )\n\n    this._stage.on(\n      \"mouseover\",\n      () => this._isRunning = this._player!.state !== ActorStates.died\n    )\n  }\n\n  private _updateCrosshair() {\n    if (\n      this._mouseLocation &&\n      this._isRunning &&\n      this._player?.state !== ActorStates.died\n    ) {\n      this._crosshair!.x = this._mouseLocation!.x - this._crosshair!.width / 2\n      this._crosshair!.y = this._mouseLocation!.y - this._crosshair!.height / 2\n\n      // flip player based on crosshair position\n      if (this._crosshair!.x < this._player!.toGlobal(this._stage).x) {\n        this._player!.flip(false)\n      } else {\n        this._player!.flip(true)\n      }\n\n      // update player based on crosshair\n      this._player!.updateCrosshairPosition(\n        this._stage.toGlobal(this._crosshair?.position!)\n      )\n\n      // adapt crosshair scale based on player location\n      this._crosshair!.adaptScale(this._player!.y, this._height)\n    }\n  }\n\n  private _fire() {\n    if (this._isRunning) {\n      if (this._player?.fire()) {\n        // hit location\n        const impact = new Decale(this._resources, \"impact.png\")\n        impact.scale.x = 0.1\n        impact.scale.y = 0.1\n\n        const impactLocation = this._map!.toLocal(this._crosshair!)\n        impact.x = impactLocation.x + this._crosshair!.width / 2 - impact.width / 2\n        impact.y = impactLocation.y + this._crosshair!.height / 2 - impact.height / 2\n\n        this._map?.backgroundContainer.addChild(impact);\n\n        this._updateHud()\n      }\n    }\n  }\n\n  private _moveRight() {\n    if (this._isRunning && this._player) {\n      this._player.moveRight();\n    }\n  }\n\n  private _moveLeft() {\n    if (this._isRunning && this._player) {\n      this._player.moveLeft();\n    }\n  }\n\n  private _moveUp() {\n    if (this._isRunning && this._player) {\n      this._player.moveUp();\n    }\n  }\n\n  private _moveDown() {\n    if (this._isRunning && this._player) {\n      this._player.moveDown();\n    }\n  }\n\n  private _stopMoveVertically() {\n    if (this._isRunning) {\n      this._player?.stopMoveVertically();\n    }\n  }\n\n  private _stopMoveHorizontally() {\n    if (this._isRunning) {\n      this._player?.stopMoveHorizontally();\n    }\n  }\n\n  private _attachKeyboard() {\n    const\n      left = new Keyboard(\"ArrowLeft\", true),\n      up = new Keyboard(\"ArrowUp\", true),\n      right = new Keyboard(\"ArrowRight\", true),\n      down = new Keyboard(\"ArrowDown\", true),\n\n      k = new Keyboard(\"k\", false),\n      w = new Keyboard(\"w\", false),\n      r = new Keyboard(\"r\", false),\n\n      enter = new Keyboard(\"Enter\", false);\n\n    k.pressEvent = () => this._fire()\n    w.pressEvent = () => this._switchWeapon()\n    r.pressEvent = () => this._reload()\n\n    right.pressEvent = () => this._moveRight()\n    right.releaseEvent = () => {\n      if (!left.isDown) {\n        this._stopMoveHorizontally()\n      }\n    };\n\n    left.pressEvent = () => this._moveLeft()\n    left.releaseEvent = () => {\n      if (!right.isDown) {\n        this._stopMoveHorizontally()\n      }\n    };\n\n    up.pressEvent = () => this._moveUp()\n    up.releaseEvent = () => {\n      if (!down.isDown) {\n        this._stopMoveVertically()\n      }\n    };\n\n    down.pressEvent = () => this._moveDown()\n    down.releaseEvent = () => {\n      if (!up.isDown) {\n        this._stopMoveVertically()\n      }\n    };\n\n    enter.pressEvent = () => {\n      if (!this._isRunning) {\n        this._init();\n      }\n    }\n  }\n\n  private _attachGamepad(): boolean {\n    return !!Gamepads.init({\n      // first gamepad\n      0: {\n        // button 1 pressed\n        1: {\n          pressEvent: () => {\n            this._fire()\n          }\n        },\n        // button 15 pressed\n        15: {\n          pressEvent: () => this._moveRight(),\n          releaseEvent: () => this._stopMoveHorizontally()\n        },\n        // button 14 pressed\n        14: {\n          pressEvent: () => this._moveLeft(),\n          releaseEvent: () => this._stopMoveHorizontally()\n        },\n        // button 12 pressed\n        12: {\n          pressEvent: () => this._moveUp(),\n          releaseEvent: () => this._stopMoveVertically()\n        },\n        // button 13 pressed\n        13: {\n          pressEvent: () => this._moveDown(),\n          releaseEvent: () => this._stopMoveVertically()\n        },\n        // button 9 pressed\n        9: {\n          pressEvent: () => {\n            if (!this._isRunning) {\n              this._init();\n            }\n          }\n        }\n      }\n    })\n  }\n\n  /**\n   * this will end the game\n   * @private\n   */\n  private _end() {\n    // game is not longer running dude\n    this._isRunning = false;\n\n    this._hud!.renderGameOver();\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _detectCollisions() {\n\n    if (this._player!.collides(this._beacon!)) {\n\n      this._player!.speak(\"It's locked!\")\n    }\n\n    if (this._crosshair!.collides(this._beacon!)) {\n\n      this._beacon = new Beacon(\n        this._resources,\n        this._height,\n        this._width\n      )\n\n      this._stage.removeChild(this._map!)\n      this._map = new Loading(\n        this._resources,\n        this._width,\n        () => {\n          this._map = new MaensionOutside(\n            this._resources,\n            this._width\n          )\n        }\n      )\n      this._stage.addChild(this._map!)\n    }\n\n    for (const enemy of this._enemies) {\n      if (ActorStates.died !== enemy.state &&\n        ActorStates.died !== this._player!.state) {\n        // does the player collide the enemy?\n        if (this._player!.collides(enemy)) {\n          const playerHit = this._player!.hitBy(enemy);\n\n          if (playerHit.objectTookDamage) {\n            this._drawBlood(this._player!);\n            this._updateHud();\n          }\n\n          // we died and now lives left :(\n          if (playerHit.died) {\n            // end the game\n            this._end();\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   *\n   * @param actor: the bleeding actor\n   * @private\n   */\n  private _drawBlood(\n    actor: ActorBase\n  ) {\n    for (let i = 0; i < 5; i++) {\n      const blood = new Blood(this._resources);\n\n      blood.x = actor.x + MathHelper.getRandomInt(-20, 20);\n      blood.y = actor.y + actor.height + MathHelper.getRandomInt(-20, 20);\n      blood.rotation = MathHelper.getRandomInt(0, 10);\n\n      this._map?.backgroundContainer.addChild(blood);\n    }\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _updateHud() {\n    this._hud!.update();\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _updateKI() {\n    for (const enemy of this._enemies) {\n      if (ActorStates.died !== enemy.state) {\n        enemy.moveTowards(this._player!.position)\n      }\n    }\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _moveActors() {\n    const {_player} = this\n    let playerMoved = _player!.move(\n      this._height,\n      this._map!.width\n    )\n\n    if (playerMoved) {\n      // yep, so try to scroll the map\n      this._map?.shallScroll(\n        _player!.realx,\n        _player!.vx\n      );\n      this._updateCrosshair()\n    }\n\n    // move the enemies\n    for (const enemy of this._enemies) {\n      enemy.move(\n        this._height,\n        this._map!.width\n      )\n    }\n\n  }\n\n  private _outlineMouse() {\n    if (\n      this._mouseLine && this._mouseLocation &&\n      this._player && this._map\n    ) {\n      this._mouseLine.clear()\n      this._mouseLine.lineStyle(1, 0xffffff);\n\n      // from\n      this._mouseLine.position =\n        this._player.weaponLocation\n\n      // to\n      const {x, y} = this._mouseLine.toLocal(this._mouseLocation)\n      this._mouseLine.lineTo(\n        x, y\n      );\n\n      this._mouseLine.endFill();\n    }\n  }\n\n  private _switchWeapon() {\n    if (this._isRunning) {\n      this._player!.switchWeapon()\n      this._updateHud()\n    }\n  }\n\n  private _reload() {\n    if (this._isRunning) {\n      this._player!.reload()\n      this._updateHud()\n    }\n  }\n\n  private _updateMouseLocation(\n    mouseLocation: PIXI.Point\n  ) {\n    if (this._isRunning) {\n      this._mouseLocation = mouseLocation\n      this._updateCrosshair()\n    }\n  }\n\n  /**\n   *\n   * @param elapsed\n   * @param delta\n   * @public\n   */\n  public tick(\n    elapsed: number,\n    delta: number\n  ) {\n    Gamepads.updateStatus();\n\n    this._hud!.tick(delta)\n\n    if (this._isRunning) {\n      this._player!.tick(delta)\n      this._map!.tick(delta)\n\n      const elapsedSeconds = parseInt((elapsed / 1000).toString());\n\n      // game has not started\n      if (!this._startOffset) {\n        this._startOffset = elapsedSeconds;\n      }\n\n      const correctedElapsedSeconds = (elapsedSeconds - this._startOffset);\n\n      if (correctedElapsedSeconds !== this._elapsedSeconds) {\n        this._elapsedSeconds = correctedElapsedSeconds;\n        this._updateHud();\n      }\n\n      this._detectCollisions();\n      this._updateKI();\n      this._moveActors();\n\n      // sort by y\n      const sort = (\n        a: PIXI.DisplayObject,\n        b: PIXI.DisplayObject\n      ) => {\n        const ab = a.getBounds()\n        const bb = b.getBounds()\n\n        if (a.y + ab.height < b.y + bb.height - 5) {\n          return -1;\n        }\n\n        if (a.y + ab.height > b.y + bb.height - 5) {\n          return 1;\n        }\n\n        return 0;\n      }\n\n      // ensure z index for actors\n      this._map?.actorContainer.children\n        .sort(sort);\n\n      if (Config.outlineObjects) {\n        // outline player\n        this._player!.outline()\n        this._beacon!.outline()\n        this._crosshair!.outline()\n\n        // outline enemies\n        for (const enemy of this._enemies) {\n          enemy.outline()\n        }\n\n        // outline mouse line\n        this._outlineMouse()\n      }\n    }\n  }\n}","import * as PIXI from \"pixi.js\";\nimport Game from \"./game\";\nimport {Config} from \"./config\"\nimport TWEEN from \"@tweenjs/tween.js\";\n\nexport default class Maension {\n\n  private _lastFrame: number = 0\n  private _fpsCount: number = 0\n  private _fpsTimer: number = 0\n  private _game?: Game\n  private readonly _renderer: PIXI.Renderer\n  private readonly _stage: PIXI.Container\n  private readonly _stageWrapper: PIXI.Container\n  private readonly _fps?: PIXI.Text\n\n  constructor(container: HTMLDivElement) {\n\n    this._renderer = PIXI.autoDetectRenderer({\n      width: 800,\n      height: 600,\n      backgroundColor: 0x1099bb\n    });\n\n    container.appendChild(this._renderer.view);\n\n    console.log(\"Viewport\", window.innerWidth, window.innerHeight);\n\n    // create the root of the scene graph\n    this._stage = new PIXI.Container();\n\n    this._stageWrapper = new PIXI.Container();\n    this._stageWrapper.addChild(this._stage)\n\n    if (Config.showFPS) {\n      this._fps = new PIXI.Text(\"FPS: \", {\n        fontWeight: \"16px\",\n        fill: \"#fff\"\n      } as PIXI.TextStyle);\n      this._fps.x = 10\n      this._fps.y = 10\n      this._stageWrapper.addChild(this._fps)\n    }\n\n    this._animate.bind(this);\n    this._assetsLoaded.bind(this);\n  }\n\n  /**\n   *\n   */\n  public run() {\n    const options = {\n      crossOrigin: true\n    } as PIXI.ILoaderOptions\n\n    const assetPath = \"assets\";\n\n    const loader = new PIXI.Loader()\n\n    // load map\n    loader.add(\"maps.house\", assetPath + \"/maps/house.json\", options)\n    loader.add(\"maps.street\", assetPath + \"/maps/street.json\", options)\n    loader.add(\"maps.maension\", assetPath + \"/maps/maension.json\", options)\n\n    // load player\n    loader.add(\"ryu.stance\", assetPath + \"/ryu/stance.json\", options)\n    loader.add(\"ryu.punch\", assetPath + \"/ryu/punch.json\", options)\n    loader.add(\"ryu.kick\", assetPath + \"/ryu/kick.json\", options)\n    loader.add(\"ryu.walk\", assetPath + \"/ryu/walk.json\", options)\n    loader.add(\"ryu.gothit\", assetPath + \"/ryu/gothit.json\", options)\n    loader.add(\"ryu.died\", assetPath + \"/ryu/died.json\", options)\n\n    // enemies\n    loader.add(\"bat.walk\", assetPath + \"/enemys/bat/walk.json\", options)\n\n    // weapons\n    loader.add(\"weapons.shotgun\", assetPath + \"/weapons/shotgun.json\", options)\n    loader.add(\"weapons.beretta\", assetPath + \"/weapons/beretta.json\", options)\n\n    // load things, like decals heads and so on\n    loader.add(\"things.blood\", assetPath + \"/things/blood.json\", options)\n    loader.add(\"things.door\", assetPath + \"/things/door.json\", options)\n    loader.add(\"things.hud\", assetPath + \"/things/hud.json\", options)\n    loader.add(\"things.decals\", assetPath + \"/things/decals.json\", options)\n    loader.add(\"things.muzzle\", assetPath + \"/things/muzzle.json\", options)\n\n    loader.onComplete.once(this._assetsLoaded.bind(this))\n\n    // resources loaded\n    loader.load();\n  }\n\n  /**\n   *\n   * @param loader\n   * @param resources\n   * @private\n   */\n  private _assetsLoaded(\n    loader: PIXI.Loader,\n    resources: PIXI.IResourceDictionary\n  ) {\n\n    // loading done, start game\n    this._game = new Game(\n      resources,\n      this._stage,\n      this._renderer.width,\n      this._renderer.height\n    );\n\n    console.log(\"Mänsion:\", \"Init done, ready to scare!\");\n\n    requestAnimationFrame(this._animate.bind(this));\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _animate(elapsed: number) {\n    // calculate frame delta\n    let delta = elapsed - this._lastFrame;\n    this._lastFrame = elapsed;\n\n    if (this._fps) {\n      this._fpsCount++\n      this._fpsTimer += delta;\n\n      // reset after 1 second\n      if (this._fpsTimer > 1000) {\n        // update text\n        this._fps.text = \"FPS: \" + this._fpsCount;\n\n        this._fpsCount = 0;\n        this._fpsTimer = 0;\n      }\n    }\n\n    // update game\n    if (this._game) {\n      this._game.tick(elapsed, delta);\n    }\n\n    // render the container\n    this._renderer.render(this._stageWrapper);\n\n    requestAnimationFrame(this._animate.bind(this));\n\n    TWEEN.update(elapsed)\n  }\n}\n","import React, { useEffect, useRef, useState } from 'react';\nimport './MaensionComponent.css';\nimport Maension from \"../game/maension\"\n\nexport default function MaensionComponent() {\n\n  const stage = useRef(null)\n  const [maension, setMaension] = useState<Maension>()\n\n  useEffect(() => {\n    if (!maension && stage.current) {\n      const m = new Maension(stage.current!)\n      m.run()\n      setMaension(m)\n    }\n  }, [stage, maension])\n\n  return (\n    <div className=\"maension\" ref={stage}/>\n  );\n}\n","import React from 'react';\nimport \"./About.css\"\n\nexport default function HowToPlay() {\n  return (\n    <div className=\"blocks\">\n      <div className=\"block\">\n        <h2>How to Play</h2>\n        <p>\n          Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed mattis sem nunc, vitae consectetur purus volutpat\n          at. Integer at consequat arcu. Curabitur aliquam ex sit amet consectetur bibendum. Phasellus nec metus\n          aliquam, vestibulum est et, efficitur metus. Fusce consectetur vel lectus non feugiat. Nam et ipsum leo.\n          Mauris bibendum semper augue, non dapibus dui vestibulum id. In eget metus nec odio consectetur ultrices ut\n          congue nisi. Vivamus et augue vel risus posuere pulvinar. Vestibulum placerat justo mi, sed aliquam massa\n          lobortis vitae.\n        </p>\n        <div className=\"cta\">\n          <button>Preorder Now!</button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import React from 'react';\nimport \"./Page.css\"\nimport Header from \"./components/Header\"\nimport Footer from \"./components/Footer\"\nimport About from \"./components/About\"\nimport MaensionComponent from \"./components/MaensionComponent\"\nimport HowToPlay from \"./components/HowToPlay\"\n\nexport default function Page() {\n\n  return (\n    <div>\n      <Header/>\n\n      <MaensionComponent/>\n\n      <hr/>\n\n      <div className=\"page\">\n        <HowToPlay/>\n        <About/>\n      </div>\n\n      <Footer/>\n    </div>\n  );\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport * as serviceWorker from './serviceWorker';\nimport Page from \"./Page\"\n\nReactDOM.render(\n  <React.StrictMode>\n    <Page/>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}