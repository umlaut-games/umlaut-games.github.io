{"version":3,"sources":["game/config.ts","engine/index.ts","engine/objects/animation-base.ts","engine/tools/animation-helper.ts","engine/tools/math-helper.ts","engine/tools/sort.ts","engine/objects/object-base.ts","engine/actors/actor-base.ts","engine/actors/player=base.ts","engine/actors/enemy-base.ts","engine/tools/pixi/index.ts","engine/objects/components/text-bubble.ts","engine/objects/components/text-with-background.ts","engine/objects/weapon-base.ts","engine/objects/components/fps-counter.ts","engine/objects/components/loading-bar.ts","engine/objects/particle-base.ts","engine/input/gamepads.ts","engine/input/keyboard.ts","engine/maps/map-base.ts","engine/ui/hud-base.ts","engine/interfaces/index.ts","engine/game-base.ts","engine/tools/pixi/pixi.ts","serviceWorker.ts","components/Header.tsx","components/Footer.tsx","components/About.tsx","game/objects/decales/impact.ts","game/objects/decales/blood.ts","game/objects/door.ts","game/objects/crosshair.ts","game/objects/beacon.ts","game/objects/decales/lightning.ts","game/objects/dialogbox.ts","game/objects/arm.ts","game/objects/weapons/accessory/muzzle.ts","game/objects/weapons/accessory/shell.ts","game/objects/weapons/weapon.ts","game/objects/weapons/shotgun.ts","game/objects/weapons/beretta.ts","game/objects/weapons/flashlight.ts","game/actors/player.ts","game/maps/maension-outside.ts","game/actors/enemies/bat.ts","game/maps/loading.ts","game/filters/rain.ts","game/maps/title.ts","game/maps/cut-scene.ts","game/ui/hud.ts","game/game.ts","game/assets.ts","game/maension.ts","components/MaensionComponent.tsx","components/HowToPlay.tsx","Page.tsx","index.tsx"],"names":["Config","outlineObjects","process","lockTitleScreen","showObjectCoordinates","showFPS","logActorCoordinates","logCollisions","highlightBeacons","constants","black","white","width","height","initialDelay","lineDelay","letterDelay","fadeDuration","styling","fontFamily","bigText","fontSize","fontWeight","fill","dropShadow","dropShadowColor","align","AnimationBase","_onDone","_clips","_currentClip","this","isFacingRight","_isFacingRight","_adaptScaleBasedOnOrientation","which","loop","dontRemove","removeChild","undefined","Promise","resolve","clipToPlay","console","log","zIndex","addChild","gotoAndPlay","children","sort","byzIndex","onComplete","stop","onDone","ObjectBase","AnimationHelper","resources","sheet","animation","speed","scale","spritesheet","Error","animations","clip","AnimatedSprite","animationSpeed","x","y","anchor","MathHelper","min","max","Math","floor","random","v1","v2","atan2","sqrt","distanceToSq","dx","dy","a","b","_outlineContainer","_map","_baseScale","_resources","_vx","_vy","_vr","delta","vx","vy","vr","rotation","actor","actorBounds","getBounds","thisBounds","collides","scaleOffset","abs","parent","Container","lb","toLocal","coordinates","Text","toFixed","outline","Graphics","lineStyle","drawRect","endFill","map","ActorStates","idle","Symbol","for","walking","fire","died","ActorBase","skin","_text","_lastFlip","_skin","_speed","_health","_power","_state","_canGetHitAgain","state","constructor","name","_setState","_playClip","objectTookDamage","power","_died","then","_idle","direction","_setIsFacingRight","target","distanceTo","position","angleToTarget","angleBetweenRad","sin","cos","_canFlipAgain","flip","canFlip","Date","now","realx","_logActorCoordinates","text","TextBubble","maxHeight","maxWidth","PlayerBase","_name","_weapon","WeaponBase","EnemyBase","loadClip","pivot","set","PI","setTimeout","enemyMoved","adaptScale","PIXI","display","duration","done","TextWithBackground","settings","SCALE_MODE","SCALE_MODES","NEAREST","fontColor","background","style","t","isNaN","bg","Sprite","Texture","WHITE","tint","rounds","_reloadTime","_isReloading","_maxRounds","_rounds","_sprite","_roundsSprite","_shellSprites","tick","isReloading","FpsCounter","_fpsCount","_fpsTimer","_fps","LoadingBar","lHeight","lWidth","pct","beginFill","length","removeChildren","ParticleContainer","Gamepads","events","_events","scanGamepads","_gamepads","event","addGamepad","gamepad","index","removeGamepad","gamepadIndex","hasOwnProperty","axes","buttons","buttonIndex","button","pressed","isPressed","pressEvent","releaseEvent","gamepads","navigator","getGamepads","webkitGetGamepads","window","addEventListener","connectHandler","disconnectHandler","Keyboard","_key","_ignoreKeyup","_isDown","_isUp","_downHandler","bind","_upHandler","key","preventDefault","MapBase","stage","mapToLoad","_explorationOffset","_textures","_bgm","_backgroundContainer","_actorContainer","_foregroundContainer","_stage","withHud","withCrosshair","withPlayer","withMouse","withDarkness","textures","fade","playerX","scrollAmount","tween","from","volume","to","ease","easing","linear","start","complete","update","v","fadeOut","alpha","createExpoIn","options","HUDBase","_gameOverSign","_player","GameBase","_isRunning","_hud","_elapsedSeconds","_startOffset","elapsed","updateStatus","_attachGamepad","_attachKeyboard","renderGameOver","global","isLocalhost","Boolean","location","hostname","match","registerValidSW","swUrl","config","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","catch","error","Header","Footer","className","href","rel","About","Impact","resource","impact","Blood","Door","filters","BlurFilter","Crosshair","Beacon","EMPTY","Lightning","interval1","interval2","sprite","setInterval","shine","getRandomInt","clearInterval","chain","easeOut","Dialogbox","_textObject","reverse","avatarTexture","texture","avatar","border","play","line","split","lineInterval","char","pop","sound","printLine","Muzzle","Shell","bounceOut","Weapon","fired","muzzleFlash","shell","p","push","splice","findIndex","s","Shotgun","Beretta","fireSound","reloadSound","f","didReload","Flashlight","lightCone","SimpleLightmapFilter","blendMode","BLEND_MODES","ADD","NoiseFilter","weapons","Player","flashlight","shotgun","beretta","relax","reload","weapon","toggleFlashlight","foregroundContainer","find","c","crosshairPosition","angle","weaponLocation","_canBeControlled","speak","playerMoved","moved","toGlobal","MaensionOutside","starryNight","maension","tree","tree1","tree_dead","tree2","darkness","MULTIPLY","_setup","RainFilter","data","Filter","Title","rainFilter","godFilter","count","brand","isInteractive","search","endsWith","pressStart","enterText","Infinity","easeInOut","god","GodrayFilter","gain","lacunarity","rain","uniforms","dimensions","time","u_mouse","u_frame","interactive","wireEvents","on","all","fadeMusic","CutScene","dialogBox","HUD","player","smallTextConfig","playerName","healthBorder","roundsBorder","weaponBorder","roundSprite","roundsSprite","health","_renderRounds","_renderWeapon","Game","_beacon","_enemies","_mouseLocation","_mouseLine","_crosshair","_init","newMap","destroy","baseTexture","actorContainer","cursor","_updateHud","_attachMouse","_updateMouseLocation","Point","switchMap","e","_fire","updateCrosshairPosition","impactLocation","backgroundContainer","moveRight","moveLeft","moveUp","moveDown","stopMoveVertically","stopMoveHorizontally","enemy","playerHit","hitBy","_drawBlood","_end","i","blood","moveTowards","move","shallScroll","_updateCrosshair","clear","lineTo","switchWeapon","mouseLocation","left","up","right","down","w","r","enter","_switchWeapon","_reload","_moveRight","isDown","_stopMoveHorizontally","_moveLeft","_moveUp","_stopMoveVertically","_moveDown","init","0","1","15","14","12","13","9","elapsedSeconds","parseInt","toString","correctedElapsedSeconds","_detectCollisions","_updateKI","_moveActors","ab","bb","_outlineMouse","assets","taro","arm","bat","monster","things","hud","lightmap","extracts","id","Maension","container","_lastFrame","_game","_fpsCounter","_container","_app","_root","_loadingBar","Application","backgroundColor","appendChild","view","clientWidth","clientHeight","resize","_tick","nvw","nvh","vpw","innerWidth","vph","innerHeight","renderer","crossOrigin","loader","Loader","Object","keys","forEach","add","once","_assetsLoaded","load","onProgress","progress","extractTextures","render","requestAnimationFrame","frame","pixels","plugins","extract","fromBuffer","removeFromCache","addToCache","MaensionComponent","useRef","useState","setMaension","useEffect","current","m","run","ref","HowToPlay","textAlign","Page","ReactDOM","StrictMode","document","getElementById","URL","origin","fetch","headers","response","contentType","get","status","indexOf","ready","unregister","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.6875b40d.chunk.js","sourcesContent":["import { TextStyle } from \"pixi.js\"\n\nexport const Config = {\n  /**\n   * shall the objects be outlined in renderer or not\n   */\n  outlineObjects:\n    process.env.NODE_ENV !== \"production\" && false,\n\n  /**\n   * Shall the title screen be locked and only allow access with the magic phrase\n   */\n  lockTitleScreen: true,\n\n  /**\n   * show actor coordinates inside the outlines\n   */\n  showObjectCoordinates:\n    process.env.NODE_ENV !== \"production\" && false,\n\n  /**\n   * shall we show the fps or not?\n   */\n  showFPS: process.env.NODE_ENV !== \"production\" && true,\n\n  /**\n   * shall we log the actor coordinates to the console?\n   */\n  logActorCoordinates:\n    process.env.NODE_ENV !== \"production\" && false,\n\n  /**\n   * shall we log actor collisions?\n   */\n  logCollisions:\n    process.env.NODE_ENV !== \"production\" && false,\n\n  /**\n   * highlight beacons\n   */\n  highlightBeacons:\n    process.env.NODE_ENV !== \"production\" && false,\n\n  constants: {\n    black: 0x000000,\n    white: 0xffffff,\n    width: 800,\n    height: 600,\n    initialDelay:\n      process.env.NODE_ENV !== \"production\" ? 0 : 500,\n    lineDelay:\n      process.env.NODE_ENV !== \"production\" ? 0 : 1000,\n    letterDelay:\n      process.env.NODE_ENV !== \"production\" ? 0 : 40,\n    fadeDuration:\n      process.env.NODE_ENV !== \"production\" ? 0 : 1000\n  },\n\n  styling: {\n    fontFamily: \"Press Start 2P\",\n    bigText: {\n      fontFamily: \"Arial Black\",\n      fontSize: \"48px\",\n      fontWeight: \"bold\",\n      fill: \"#fff\",\n      dropShadow: true,\n      dropShadowColor: \"#000\",\n      align: \"center\"\n    } as TextStyle\n  }\n}\n","export * from \"./actors\"\nexport * from \"./input\"\nexport * from \"./interfaces\"\nexport * from \"./maps\"\nexport * from \"./objects\"\nexport * from \"./tools\"\nexport * from \"./ui\"\nexport * from \"./game-base\"\n","import { ObjectBase } from \"./object-base\"\nimport { AnimatedSprite } from \"pixi.js\"\nimport { IDictionary } from \"../interfaces\"\nimport { byzIndex } from \"../tools\"\n\n/**\n *\n */\nexport class AnimationBase extends ObjectBase {\n  protected _onDone?: () => void\n\n  /**\n   * array for animations\n   * @type {{}}\n   * @protected\n   */\n  protected _clips: IDictionary<AnimatedSprite> = {}\n\n  /**\n   * current clip that is beeing played\n   * @type {null}\n   * @private\n   */\n  protected _currentClip?: AnimatedSprite\n\n  set onDone(onDone: () => void) {\n    this._onDone = onDone\n  }\n\n  protected done() {\n    if (this._onDone) {\n      this._onDone()\n    }\n  }\n\n  /**\n   *\n   * @param isFacingRight\n   * @protected\n   */\n  protected _setIsFacingRight(isFacingRight: boolean) {\n    this._isFacingRight = isFacingRight\n    this._adaptScaleBasedOnOrientation()\n  }\n\n  protected _playClip(\n    which: string,\n    loop: boolean,\n    dontRemove?: boolean\n  ) {\n    if (this._currentClip) {\n      this.removeChild(this._currentClip)\n      this._currentClip = undefined\n    }\n\n    return new Promise((resolve) => {\n      // load punch clip\n      const clipToPlay = this._clips[which]\n\n      if (!clipToPlay) {\n        console.log(\n          `AnimationBase: failed to load clip: ${which}`,\n          this._clips\n        )\n        return resolve(false)\n      }\n\n      clipToPlay.zIndex = 1\n\n      // play clip\n      this.addChild(clipToPlay)\n\n      // set the current playing clip\n      this._currentClip = clipToPlay\n\n      this._adaptScaleBasedOnOrientation()\n\n      this._currentClip.loop = loop\n      this._currentClip.gotoAndPlay(0)\n\n      this.children.sort(byzIndex)\n\n      if (!loop) {\n        clipToPlay.onComplete = () => {\n          clipToPlay.stop()\n\n          if (!dontRemove) {\n            this.removeChild(clipToPlay)\n          }\n\n          return resolve(true)\n        }\n      }\n    })\n  }\n}\n","import {\n  AnimatedSprite,\n  IResourceDictionary\n} from \"pixi.js\"\n\n/**\n * @class\n */\nexport class AnimationHelper {\n  static loadClip(\n    resources: IResourceDictionary,\n    sheet: string,\n    animation: string,\n    speed: number,\n    scale: number\n  ): AnimatedSprite {\n    if (\n      !resources[sheet] ||\n      !resources[sheet].spritesheet\n    ) {\n      throw new Error(`spritesheet ${sheet} not found!`)\n    }\n\n    if (\n      !resources[sheet].spritesheet!.animations[animation]\n    ) {\n      throw new Error(`Animation ${animation} not found|`)\n    }\n\n    const clip = new AnimatedSprite(\n      resources[sheet].spritesheet!.animations[animation]\n    )\n\n    clip.animationSpeed = speed\n    clip.scale.x = scale\n    clip.scale.y = scale\n    clip.anchor.x = 0.5\n\n    return clip\n  }\n}\n","import { Point } from \"pixi.js\"\n\nexport class MathHelper {\n  /**\n   *\n   * @param min\n   * @param max\n   * @returns {number}\n   * @public\n   */\n  static getRandomInt(min: number, max: number) {\n    return Math.floor(Math.random() * (max - min)) + min\n  }\n\n  /**\n   *\n   * @param v2\n   * @param v1\n   * @returns {number}\n   */\n  static angleBetweenRad(v1: Point, v2: Point) {\n    return Math.atan2(v2.y - v1.y, v2.x - v1.x)\n  }\n\n  /**\n   *\n   * @param v1\n   * @param v2\n   * @returns {number}\n   */\n  static distanceTo(v1: Point, v2: Point) {\n    return Math.sqrt(MathHelper.distanceToSq(v1, v2))\n  }\n\n  /**\n   *\n   * @param v2\n   * @param v1\n   * @returns {number}\n   */\n  static distanceToSq(v1: Point, v2: Point) {\n    let dx = v1.x - v2.x,\n      dy = v1.y - v2.y\n\n    return dx * dx + dy * dy\n  }\n}\n","import { DisplayObject } from \"pixi.js\"\n\nexport const byzIndex = (\n  a: DisplayObject,\n  b: DisplayObject\n) => a.zIndex - b.zIndex\n","import { Config } from \"../../game/config\"\nimport {\n  Text,\n  Container,\n  Graphics,\n  IResourceDictionary,\n  TextStyle\n} from \"pixi.js\"\nimport { MapBase } from \"../maps\"\nimport { ITickable } from \"../interfaces\"\n\n/**\n *\n */\nexport class ObjectBase\n  extends Container\n  implements ITickable {\n  protected _outlineContainer?: Container\n  protected _map?: MapBase\n\n  protected _baseScale: number = 1\n\n  /**\n   *\n   * @type {Object}\n   * @protected\n   */\n  protected _resources: IResourceDictionary\n\n  /**\n   * Is the this one facing right?\n   * @type {boolean}\n   * @protected\n   */\n  protected _isFacingRight: boolean = true\n\n  /**\n   * the object velocity x\n   * @type {number}\n   * @protected\n   */\n  protected _vx = 0\n\n  /**\n   * the object velocity y\n   * @type {number}\n   * @protected\n   */\n  protected _vy = 0\n\n  /**\n   * the objects rotation velocity\n   * @type {number}\n   * @private\n   */\n  protected _vr = 0\n\n  /**\n   *\n   * @param resources\n   */\n  constructor(resources: IResourceDictionary) {\n    super()\n\n    this._resources = resources\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get vx() {\n    return this._vx\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get vy() {\n    return this._vy\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get vr() {\n    return this._vr\n  }\n\n  /**\n   *\n   * @returns {Number}\n   */\n  get realx() {\n    return this.x - Math.abs(this.width) / 2\n  }\n\n  set map(map: MapBase) {\n    this._map = map\n  }\n\n  public tick(delta: number) {\n    if (this.vx !== 0 || this.vy !== 0 || this.vr !== 0) {\n      this.x += this.vx\n      this.y += this.vy\n      this.rotation += this.vr\n    }\n  }\n\n  /**\n   *\n   * @param actor\n   * @public\n   */\n  public collides(actor: ObjectBase) {\n    const actorBounds = actor.getBounds()\n    const thisBounds = this.getBounds()\n\n    const collides =\n      actorBounds.x + actorBounds.width > thisBounds.x &&\n      actorBounds.x < thisBounds.x + thisBounds.width &&\n      actorBounds.y + actorBounds.height > thisBounds.y &&\n      actorBounds.y < thisBounds.y + thisBounds.height\n\n    if (collides && Config.logCollisions) {\n      console.log(\"this\", thisBounds)\n      console.log(\"actor\", actorBounds)\n    }\n\n    return collides\n  }\n\n  public adaptScale(y: number, height: number) {\n    const scaleOffset = height - y\n    let scale = this._baseScale - scaleOffset / 1000\n\n    this.scale.x = scale\n    this.scale.y = scale\n\n    this._adaptScaleBasedOnOrientation()\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _adaptScaleBasedOnOrientation() {\n    let scale = this.scale.x\n    if (!this._isFacingRight && scale > 0) {\n      this.scale.x = -scale\n    }\n\n    if (this._isFacingRight && scale < 0) {\n      this.scale.x = Math.abs(scale)\n    }\n  }\n\n  public outline() {\n    // do we have a outline?\n    if (this._outlineContainer) {\n      // yep remove if from child\n      this.parent\n        ? this.parent.removeChild(this._outlineContainer)\n        : this.removeChild(this._outlineContainer)\n      // delete it\n      delete this._outlineContainer\n    }\n\n    this._adaptScaleBasedOnOrientation()\n\n    this._outlineContainer = new Container()\n    const b = this.getBounds()\n    const lb = this.parent ? this.parent.toLocal(b) : b\n\n    if (Config.showObjectCoordinates) {\n      const coordinates = new Text(\n        `x: ${b.x.toFixed(0)} y: ${b.y.toFixed(\n          0\n        )}\\nw: ${b.width.toFixed(0)} h: ${b.height.toFixed(\n          0\n        )}`,\n        {\n          fontSize: \"10px\",\n          fill: \"#fff\"\n        } as TextStyle\n      )\n\n      coordinates.x = lb.x\n      coordinates.y = lb.y\n\n      this._outlineContainer.addChild(coordinates)\n    }\n\n    // create new\n    const outline = new Graphics()\n    outline.lineStyle(1, 0x000)\n\n    outline.drawRect(lb.x, lb.y, b.width, b.height)\n\n    outline.endFill()\n\n    // attach to object\n    this._outlineContainer.addChild(outline)\n\n    this.parent\n      ? this.parent.addChild(this._outlineContainer)\n      : this.addChild(this._outlineContainer)\n  }\n}\n","import { IResourceDictionary, Point } from \"pixi.js\"\nimport { MathHelper } from \"../tools\"\nimport { TextBubble } from \"../objects/components/text-bubble\"\nimport { Config } from \"../../game/config\"\nimport { AnimationBase } from \"../objects/animation-base\"\n\nexport const ActorStates = {\n  idle: Symbol.for(\"Idle\"),\n  walking: Symbol.for(\"Walking\"),\n  fire: Symbol.for(\"Fire\"),\n  died: Symbol.for(\"Died\")\n}\n\n/**\n * @class\n */\nexport class ActorBase extends AnimationBase {\n  protected _text?: TextBubble\n\n  // time delta of last sprite flip\n  private _lastFlip = 0\n\n  /**\n   *\n   * @type {null}\n   * @protected\n   */\n  protected _skin?: string\n\n  /**\n   *\n   * @type {number}\n   * @protected\n   */\n  protected _speed = 1\n\n  /**\n   * the objects health\n   * @type {number}\n   * @protected\n   */\n  protected _health = 100\n\n  /**\n   * the objects striking power\n   * @type {number}\n   * @protected\n   */\n  protected _power = 12\n\n  /**\n   * @type {Symbol}\n   * @protected\n   */\n  protected _state: Symbol = ActorStates.idle\n\n  /**\n   * can we get git again helper\n   * @type {boolean}\n   * @protected\n   */\n  protected _canGetHitAgain = true\n\n  /**\n   * @constructor\n   */\n  constructor(\n    resources: IResourceDictionary,\n    skin: string,\n    speed: number\n  ) {\n    super(resources)\n\n    /**\n     * set the actor skin\n     * @type {String}\n     * @protected\n     */\n    this._skin = skin\n\n    /**\n     * the objects speed\n     * @type {number}\n     * @protected\n     */\n    this._speed = speed\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get power() {\n    return this._power\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get health() {\n    return this._health\n  }\n\n  /**\n   *\n   * @returns {Symbol}\n   */\n  public get state() {\n    return this._state\n  }\n\n  /**\n   *\n   * @param state\n   * @protected\n   */\n  protected _setState(state: Symbol) {\n    console.log(this.constructor.name, \"New state:\", state)\n    this._state = state\n  }\n\n  /**\n   *\n   * @protected\n   */\n  protected _idle(clip: string = \".idle\") {\n    // dont go to idle if we are dead\n    if (this._state !== ActorStates.died) {\n      this._setState(ActorStates.idle)\n\n      this._playClip(this._skin + clip, true)\n    }\n  }\n\n  /**\n   *\n   * @protected\n   */\n  protected _died() {\n    this._setState(ActorStates.died)\n\n    // remove all velocity\n    this._vy = 0\n    this._vx = 0\n    this._vr = 0\n\n    // play died clip\n    this._playClip(this._skin + \".died\", false, true)\n  }\n\n  /**\n   * @public\n   * @param actor\n   * @returns {boolean}\n   */\n  public hitBy(actor: ActorBase) {\n    let died = false\n    let objectTookDamage = false\n\n    if (this._canGetHitAgain) {\n      // lower the heal\n      this._health -= actor.power\n\n      objectTookDamage = true\n\n      // after we got hit we cannot get hit again\n      this._canGetHitAgain = false\n\n      // are we death?\n      if (this._health < 0) {\n        this._health = 0\n\n        // yep\n        died = true\n\n        this._died()\n      }\n      // not died\n      else {\n        // force the player a little bit back on hit\n        this._vx = actor._isFacingRight ? 5 : -5\n\n        // play the gothit clip\n        this._playClip(this._skin + \".gothit\", false).then(\n          () => {\n            // animation ended!\n\n            // remove the velocity\n            this._vx = 0\n\n            // yep we can get hit again\n            this._canGetHitAgain = true\n\n            // stand up and idle afterwards\n            this._idle()\n          }\n        )\n      }\n    }\n\n    return {\n      died,\n      objectTookDamage\n    }\n  }\n\n  public flip(direction?: boolean) {\n    this._setIsFacingRight(\n      direction !== undefined\n        ? direction\n        : !this._isFacingRight\n    )\n  }\n\n  /**\n   *\n   * @param target\n   */\n  public moveTowards(target: Point) {\n    const dist = MathHelper.distanceTo(\n      this.position,\n      target\n    )\n\n    let vx = 0\n    let vy = 0\n\n    if (dist > 1) {\n      let angleToTarget = MathHelper.angleBetweenRad(\n        this.position,\n        target\n      )\n\n      vy = Math.sin(angleToTarget) * this._speed\n      vx = Math.cos(angleToTarget) * this._speed\n\n      // flip player over\n      if (\n        vx > 0 &&\n        !this._isFacingRight &&\n        this._canFlipAgain()\n      ) {\n        //console.log(\"Enemy:\", \"flip left\");\n        this.flip()\n      }\n      // flip player over\n      else if (\n        vx < 0 &&\n        this._isFacingRight &&\n        this._canFlipAgain()\n      ) {\n        //console.log(\"Enemy:\", \"flip right\");\n        this.flip()\n      }\n    }\n\n    this._vy = vy\n    this._vx = vx\n  }\n\n  /**\n   *\n   * @returns {boolean}\n   * @private\n   */\n  private _canFlipAgain() {\n    let canFlip = true\n    if (Date.now() - this._lastFlip > 200) {\n      canFlip = true\n      this._lastFlip = Date.now()\n    }\n\n    return canFlip\n  }\n\n  private _logActorCoordinates() {\n    if (Config.logActorCoordinates) {\n      console.log(\n        \"x\",\n        this.x,\n        \"real x\",\n        this.realx,\n        \"y\",\n        this.y,\n        \"width\",\n        this.width,\n        \"height\",\n        this.height\n      )\n    }\n  }\n\n  protected moved() {\n    this._logActorCoordinates()\n    if (this._text) {\n      this._text.x = this.x - this._text.width / 2\n      this._text.y = this.y - 25\n    }\n  }\n\n  public speak(text: string) {\n    if (this.parent && !this._text) {\n      this._text = new TextBubble(\n        this._resources,\n        text,\n        3,\n        () => {\n          this.parent.removeChild(this._text!)\n          delete this._text\n        }\n      )\n      this._text.zIndex = 80\n      this._text.x = this.x - this._text.width / 2\n      this._text.y = this.y - 25\n      this.parent.addChild(this._text)\n    }\n  }\n\n  public move(\n    maxHeight: number,\n    maxWidth: number\n  ): boolean {\n    return false\n  }\n}\n","import { ActorBase } from \"./actor-base\"\nimport { IResourceDictionary } from \"pixi.js\"\nimport { WeaponBase } from \"../objects/weapon-base\"\n\n/**\n *\n */\nexport class PlayerBase extends ActorBase {\n  protected _name: string = \"Unplayed Namer\"\n  protected _weapon: WeaponBase\n\n  get weapon(): WeaponBase {\n    return this._weapon\n  }\n\n  get playerName() {\n    return this._name\n  }\n\n  constructor(\n    resources: IResourceDictionary,\n    skin: string,\n    speed: number\n  ) {\n    super(resources, skin, speed)\n\n    this._weapon = new WeaponBase(resources, 0, 0)\n  }\n}\n","import { ActorBase, ActorStates } from \"./actor-base\"\nimport { AnimationHelper } from \"../tools\"\nimport { IResourceDictionary } from \"pixi.js\"\n\n/**\n *\n */\nexport class EnemyBase extends ActorBase {\n  constructor(\n    resources: IResourceDictionary,\n    skin: string,\n    speed: number = 2\n  ) {\n    super(resources, skin, speed)\n\n    this._isFacingRight = false\n\n    // load the clips for this object\n    this._clips[\n      this._skin + \".walk\"\n    ] = AnimationHelper.loadClip(\n      resources,\n      skin,\n      \"walk\",\n      0.2,\n      1\n    )\n    this._clips[this._skin + \".gothit\"] = this._clips[\n      this._skin + \".walk\"\n    ]\n    this._clips[this._skin + \".died\"] = this._clips[\n      this._skin + \".walk\"\n    ]\n\n    // go to idle\n    this._idle()\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _idle() {\n    this._setState(ActorStates.idle)\n    this._playClip(this._skin + \".walk\", true)\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _died() {\n    super._died()\n\n    // set proper death location\n    this.y += this.height / 2\n    this.pivot.set(Math.abs(this.width) / 2, this.height)\n    this.rotation = (90 * Math.PI) / 180\n\n    setTimeout(() => {\n      this.parent.removeChild(this)\n    }, 10 * 1000)\n  }\n\n  move(maxHeight: number, maxWidth: number): boolean {\n    let enemyMoved = false\n\n    if (this.vx !== 0 || this.vy !== 0 || this.vr !== 0) {\n      this.x += this.vx\n      this.y += this.vy\n      this.rotation += this.vr\n\n      enemyMoved = true\n\n      this.adaptScale(this.y, maxHeight)\n    }\n\n    return enemyMoved\n  }\n}\n","import PIXI from \"./pixi\"\nimport \"pixi-layers\"\nimport sound from \"pixi-sound\"\nimport * as particles from \"pixi-particles\"\n\nconst display = PIXI.display\n\nexport { sound, particles, display }\n","import { AnimationBase } from \"../animation-base\"\nimport { TextWithBackground } from \"./text-with-background\"\nimport { IResourceDictionary } from \"pixi.js\"\nimport { Config } from \"../../../game/config\"\n\n/**\n *\n */\nexport class TextBubble extends AnimationBase {\n  constructor(\n    resources: IResourceDictionary,\n    text: string,\n    duration: number,\n    done: () => void\n  ) {\n    super(resources)\n\n    this.addChild(\n      new TextWithBackground(\n        resources,\n        text,\n        \"8px\",\n        \"#fff\",\n        Config.constants.black\n      )\n    )\n\n    setTimeout(() => {\n      done()\n    }, duration * 1000)\n  }\n}\n","import { AnimationBase } from \"../animation-base\"\nimport {\n  Text,\n  IResourceDictionary,\n  SCALE_MODES,\n  Sprite,\n  TextStyle,\n  Texture,\n  settings\n} from \"pixi.js\"\nimport { Config } from \"../../../game/config\"\n\nsettings.SCALE_MODE = SCALE_MODES.NEAREST\n\n/**\n *\n */\nexport class TextWithBackground extends AnimationBase {\n  constructor(\n    resources: IResourceDictionary,\n    text: string,\n    fontSize: string = \"8px\",\n    fontColor: string = \"#fff\",\n    background?: number,\n    dropShadowColor?: string\n  ) {\n    super(resources)\n\n    const style: TextStyle = {\n      fontSize,\n      fill: fontColor,\n      fontFamily: Config.styling.fontFamily\n    } as TextStyle\n\n    if (dropShadowColor) {\n      style.dropShadow = true\n      style.dropShadowColor = dropShadowColor\n    }\n\n    const t = new Text(text, style)\n\n    if (!isNaN(background!)) {\n      const bg = new Sprite(Texture.WHITE)\n\n      bg.width = t.width\n      bg.height = t.height\n      bg.tint = background!\n\n      this.addChild(bg)\n    }\n\n    this.addChild(t)\n  }\n}\n","import { ObjectBase } from \"./object-base\"\nimport { IResourceDictionary, Sprite } from \"pixi.js\"\nimport { AnimationBase } from \"./animation-base\"\n\nexport class WeaponBase extends ObjectBase {\n  protected _reloadTime: number\n  protected _isReloading: boolean = false\n\n  protected _power: number\n  protected _maxRounds: number\n  protected _rounds: number\n  protected _sprite?: Sprite\n  protected _roundsSprite?: Sprite\n  protected _shellSprites: AnimationBase[] = []\n\n  get rounds() {\n    return this._rounds\n  }\n\n  get sprite() {\n    return this._sprite\n  }\n\n  get roundsSprite() {\n    return this._roundsSprite\n  }\n\n  get isReloading() {\n    return this._isReloading\n  }\n\n  constructor(\n    resources: IResourceDictionary,\n    power: number,\n    rounds: number\n  ) {\n    super(resources)\n\n    this._power = power\n    this._rounds = rounds\n    this._maxRounds = rounds\n    this._reloadTime = 5\n\n    this.zIndex = 100\n\n    this.x = 4\n    this.y = -10\n  }\n\n  public fire(): boolean {\n    if (this._rounds > 0 && !this._isReloading) {\n      this._rounds--\n      return true\n    }\n\n    // todo: add empty clips sound\n\n    return false\n  }\n\n  public tick(delta: number) {\n    for (const shellSprite of this._shellSprites) {\n      shellSprite.tick(delta)\n    }\n  }\n\n  public reload(): boolean {\n    if (this.isReloading) {\n      return false\n    }\n\n    this._isReloading = true\n    setTimeout(() => {\n      this._rounds = this._maxRounds\n      this._isReloading = false\n    }, this._reloadTime * 1000)\n\n    console.log(\"reload\")\n    return true\n  }\n}\n","import { Container, Text, TextStyle } from \"pixi.js\"\n\nexport class FpsCounter extends Container {\n  private _fpsCount: number = 0\n  private _fpsTimer: number = 0\n  private readonly _fps?: Text\n\n  constructor() {\n    super()\n\n    this._fps = new Text(\"FPS: \", {\n      fontWeight: \"16px\",\n      fill: \"#fff\"\n    } as TextStyle)\n\n    this._fps.x = 10\n    this._fps.y = 10\n\n    this.addChild(this._fps)\n  }\n\n  tick(delta: number) {\n    if (this._fps) {\n      this._fpsCount++\n      this._fpsTimer += delta\n\n      // reset after 1 second\n      if (this._fpsTimer > 1000) {\n        // update text\n        this._fps.text = \"FPS: \" + this._fpsCount\n\n        this._fpsCount = 0\n        this._fpsTimer = 0\n      }\n    }\n  }\n}\n","import { Container, Graphics } from \"pixi.js\"\nimport { Config } from \"../../../game/config\"\n\nexport class LoadingBar extends Container {\n  // bar dimensions\n  private readonly lHeight = 50\n  private readonly lWidth = 300\n\n  constructor() {\n    super()\n\n    const outline = new Graphics()\n    outline.lineStyle(5, Config.constants.white)\n\n    outline.drawRect(\n      Config.constants.width / 2 - this.lWidth / 2,\n      Config.constants.height / 2 - this.lHeight / 2,\n      this.lWidth,\n      this.lHeight\n    )\n\n    this.addChild(outline)\n  }\n\n  public update(pct: number) {\n    const fill = new Graphics()\n    fill.lineStyle(5, Config.constants.white)\n    fill.beginFill(Config.constants.white)\n\n    fill.drawRect(\n      Config.constants.width / 2 - this.lWidth / 2,\n      Config.constants.height / 2 - this.lHeight / 2,\n      (this.lWidth / 100) * pct,\n      this.lHeight\n    )\n\n    if (this.children.length > 1) {\n      // remove all childs except the first (the outline)\n      this.removeChildren(1)\n    }\n    this.addChild(fill)\n  }\n}\n","import { ParticleContainer, Texture } from \"pixi.js\"\nimport {\n  EmitterConfig,\n  OldEmitterConfig\n} from \"pixi-particles\"\nimport { ITickable } from \"../interfaces\"\nimport { particles } from \"../tools/pixi\"\n\n/**\n *\n */\nexport class ParticleBase\n  extends ParticleContainer\n  implements ITickable {\n  private emitter\n\n  constructor(\n    images: Texture[],\n    config: EmitterConfig | OldEmitterConfig\n  ) {\n    super()\n\n    this.emitter = new particles.Emitter(\n      // The PIXI.Container to put the emitter in\n      // if using blend modes, it's important to put this\n      // on top of a bitmap, and not use the root stage Container\n      this,\n\n      // The collection of particle images to use\n      images,\n\n      // Emitter configuration, edit this to change the look\n      // of the emitter\n      config\n    )\n\n    // Start emitting\n    this.emitter.emit = true\n  }\n\n  public tick(delta: number) {\n    this.emitter.update(delta * 0.001)\n  }\n}\n","import { IDictionary } from \"../interfaces/IDictionary\"\n\ntype d<T> = IDictionary<IDictionary<T>>\n\ninterface Event {\n  pressEvent?: () => void\n  releaseEvent?: () => void\n}\n\ntype Events = d<Event>\n\ninterface State {\n  isPressed: boolean\n}\n\ntype States = d<State>\n\nexport class Gamepads {\n  static _gamepads: IDictionary<Gamepad> = {}\n  static _state: States = {}\n  static _events: Events = {}\n\n  static init(events: Events) {\n    Gamepads._events = events\n\n    Gamepads.scanGamepads()\n\n    return Gamepads._gamepads[0] || null\n  }\n\n  static connectHandler(event: GamepadEvent) {\n    console.log(\"gamepad connected\")\n\n    Gamepads.addGamepad(event.gamepad)\n  }\n\n  static addGamepad(gamepad: Gamepad) {\n    console.log(\"adding gamepad\", gamepad)\n\n    Gamepads._gamepads[gamepad.index] = gamepad\n    Gamepads._state[gamepad.index] = {}\n  }\n\n  static disconnectHandler(event: GamepadEvent) {\n    console.log(\"gamepad disconnected\")\n\n    Gamepads.removeGamepad(event.gamepad)\n  }\n\n  static removeGamepad(gamepad: Gamepad) {\n    console.log(\"removing gamepad\")\n    delete Gamepads._gamepads[gamepad.index]\n    delete Gamepads._state[gamepad.index]\n  }\n\n  static updateStatus() {\n    Gamepads.scanGamepads()\n    for (const gamepadIndex in Gamepads._gamepads) {\n      if (Gamepads._gamepads.hasOwnProperty(gamepadIndex)) {\n        const gamepad: Gamepad =\n          Gamepads._gamepads[gamepadIndex]\n\n        if (gamepad.axes) {\n          //console.log(gamepad.axes)\n        }\n\n        // sometimes controllers dont have buttons\n        if (gamepad.buttons) {\n          for (const buttonIndex in gamepad.buttons) {\n            if (\n              gamepad.buttons.hasOwnProperty(buttonIndex)\n            ) {\n              const button: GamepadButton =\n                gamepad.buttons[buttonIndex]\n\n              Gamepads._state[gamepadIndex][buttonIndex] =\n                Gamepads._state[gamepadIndex][\n                  buttonIndex\n                ] || {}\n              Gamepads._events[gamepadIndex][buttonIndex] =\n                Gamepads._events[gamepadIndex][\n                  buttonIndex\n                ] || {}\n\n              const state: State =\n                Gamepads._state[gamepadIndex][buttonIndex]\n              const event: Event =\n                Gamepads._events[gamepadIndex][buttonIndex]\n\n              if (button.pressed && !state.isPressed) {\n                console.log(\n                  \"button pressed\",\n                  gamepadIndex,\n                  buttonIndex\n                )\n\n                state.isPressed = true\n\n                if (event.pressEvent) {\n                  event.pressEvent()\n                }\n              }\n\n              if (!button.pressed && state.isPressed) {\n                console.log(\n                  \"button released\",\n                  gamepadIndex,\n                  buttonIndex\n                )\n\n                state.isPressed = false\n\n                if (event.releaseEvent) {\n                  event.releaseEvent()\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  static scanGamepads() {\n    const gamepads: Gamepad[] = navigator.getGamepads\n      ? navigator.getGamepads()\n      : // @ts-ignore\n      navigator.webkitGetGamepads\n      ? // @ts-ignore\n        navigator.webkitGetGamepads()\n      : []\n\n    for (const gamepad of gamepads) {\n      // sometimes gamepad is undefined?!\n      if (gamepad) {\n        const gamepadIndex = gamepad.index\n\n        // do we have this already in records?\n        if (gamepadIndex in Gamepads._gamepads) {\n          Gamepads._gamepads[gamepadIndex] = gamepad\n        } else {\n          console.log(\n            \"found new gamepad during scan, adding\",\n            gamepadIndex\n          )\n\n          Gamepads.addGamepad(gamepad)\n        }\n      }\n    }\n  }\n}\n\n// register events\n// @ts-ignore\nwindow.addEventListener(\n  \"gamepadconnected\",\n  Gamepads.connectHandler\n)\n// @ts-ignore\nwindow.addEventListener(\n  \"gamepaddisconnected\",\n  Gamepads.disconnectHandler\n)\n","/**\n * @class\n */\nexport class Keyboard {\n  /**\n   *\n   * @type {boolean}\n   * @private\n   */\n  private _isDown = false\n  /**\n   *\n   * @type {boolean}\n   * @private\n   */\n  private _isUp = true\n\n  // events\n  /**\n   *\n   * @type {KeyboardEvent}\n   */\n  public pressEvent: (() => void) | null = null\n  /**\n   *\n   * @type {KeyboardEvent}\n   */\n  public releaseEvent: (() => void) | null = null\n\n  constructor(\n    private readonly _key: string,\n    private readonly _ignoreKeyup: boolean\n  ) {\n    //Attach event listeners\n    window.addEventListener(\n      \"keydown\",\n      this._downHandler.bind(this),\n      false\n    )\n    window.addEventListener(\n      \"keyup\",\n      this._upHandler.bind(this),\n      false\n    )\n  }\n\n  get isDown() {\n    return this._isDown\n  }\n\n  /**\n   *\n   * @param event\n   * @private\n   */\n  private _downHandler(event: KeyboardEvent) {\n    if (event.key === this._key) {\n      event.preventDefault()\n\n      // if the key is up and we have a press handler\n      if (this._isUp && this.pressEvent) {\n        this.pressEvent()\n      }\n\n      this._isDown = true\n      this._isUp = false\n    }\n  }\n\n  /**\n   *\n   * @param event\n   * @private\n   */\n  private _upHandler(event: KeyboardEvent) {\n    if (event.key === this._key) {\n      event.preventDefault()\n\n      // if the key is down and we have a press handler\n      if (this._isDown && this.releaseEvent) {\n        this.releaseEvent()\n      }\n\n      this._isDown = false\n      this._isUp = true\n    }\n  }\n}\n","import {\n  Container,\n  IResourceDictionary,\n  ITextureDictionary,\n  Sprite,\n  Texture\n} from \"pixi.js\"\nimport { sound } from \"../tools/pixi\"\nimport { AnimationBase } from \"../objects/animation-base\"\nimport { easing, tween } from \"popmotion\"\nimport { Config } from \"../../game/config\"\n\n/**\n *\n */\nexport class MapBase extends AnimationBase {\n  private readonly _explorationOffset: number\n  protected _textures?: ITextureDictionary\n  protected _bgm?: sound.Sound\n  protected _backgroundContainer: Container\n  protected _actorContainer: Container\n  protected _foregroundContainer: Container\n  protected _stage: Container\n\n  public withHud: boolean = true\n  public withCrosshair: boolean = true\n  public withPlayer: boolean = true\n  public withMouse: boolean = true\n  public withDarkness: boolean = false\n\n  constructor(\n    resources: IResourceDictionary,\n    stage: Container,\n    mapToLoad?: string,\n    onDone?: () => void\n  ) {\n    super(resources)\n\n    this.zIndex = 1\n\n    this._stage = stage\n    this._onDone = onDone\n    this._explorationOffset = Config.constants.width / 3\n\n    if (mapToLoad) {\n      // load the clips for this object\n      this._textures = resources[mapToLoad].textures\n    }\n\n    /**\n     * setup background\n     * @type {Container}\n     * @private\n     */\n    this._backgroundContainer = new Container()\n    this.addChild(this._backgroundContainer)\n\n    /**\n     * setup actors\n     * @type {Container}\n     * @private\n     */\n    this._actorContainer = new Container()\n    this.addChild(this._actorContainer)\n\n    /**\n     * setup foreground\n     * @type {Container}\n     * @private\n     */\n    this._foregroundContainer = new Container()\n    this.addChild(this._foregroundContainer)\n\n    this.fade(false).then()\n  }\n\n  /**\n   *\n   * @returns {Container}\n   */\n  get actorContainer() {\n    return this._actorContainer\n  }\n\n  /**\n   *\n   * @returns {Container}\n   */\n  get backgroundContainer() {\n    return this._backgroundContainer\n  }\n\n  get foregroundContainer() {\n    return this._foregroundContainer\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setup() {\n    // stub\n  }\n\n  /**\n   *\n   * @param playerX\n   * @param scrollAmount\n   */\n  public shallScroll(\n    playerX: number,\n    scrollAmount: number\n  ) {\n    if (\n      // move right\n      (scrollAmount > 0 &&\n        playerX + this._explorationOffset >\n          Config.constants.width) ||\n      // move left\n      (scrollAmount < 0 &&\n        playerX - this._explorationOffset <\n          this._explorationOffset)\n    ) {\n      // move map based on positive or negative scroll amount\n      this.x -= scrollAmount\n\n      // left bound\n      if (this.x > 0) {\n        this.x = 0\n      }\n\n      // right bound\n      if (this.x < Config.constants.width - this.width) {\n        this.x = Config.constants.width - this.width\n      }\n    }\n  }\n\n  protected async fadeMusic() {\n    if (!this._bgm) {\n      return\n    }\n\n    return new Promise((resolve) => {\n      const to = 0\n      tween({\n        from: this._bgm!.volume,\n        to,\n        duration: Config.constants.fadeDuration,\n        ease: [easing.linear]\n      }).start({\n        complete: resolve,\n        update: (v: number) => (this._bgm!.volume = v)\n      })\n    })\n  }\n\n  protected async fade(fadeOut: boolean = true) {\n    const fade = new Sprite(Texture.WHITE)\n\n    fade.alpha = fadeOut ? 0 : 1\n    fade.width = Config.constants.width\n    fade.height = Config.constants.height\n    fade.tint = 0x000000\n    fade.zIndex = 999999\n\n    this._stage.addChild(fade)\n\n    return new Promise((resolve) => {\n      const to = fadeOut ? 1 : 0\n      tween({\n        from: fade.alpha,\n        to,\n        duration: Config.constants.fadeDuration,\n        ease: [easing.createExpoIn(2)]\n      }).start({\n        complete: () => {\n          this._stage.removeChild(fade)\n          return resolve()\n        },\n        update: (v: number) => (fade.alpha = v)\n      })\n    })\n  }\n\n  public destroy(options?: {\n    children?: boolean\n    texture?: boolean\n    baseTexture?: boolean\n  }) {\n    super.destroy(options)\n\n    if (this._bgm) {\n      this._bgm.stop()\n    }\n  }\n}\n","import { IResourceDictionary, Text } from \"pixi.js\"\nimport { Config } from \"../../game/config\"\nimport { ObjectBase } from \"../objects\"\nimport { PlayerBase } from \"../actors\"\n\nexport class HUDBase extends ObjectBase {\n  // change to \"you are dead ...\"\n  protected _gameOverSign?: Text\n  protected _player: PlayerBase\n\n  constructor(resources: IResourceDictionary) {\n    super(resources)\n\n    this.zIndex = 2\n\n    this._player = new PlayerBase(resources, \"none\", 0)\n  }\n\n  public update() {}\n\n  public renderGameOver() {\n    this._gameOverSign = new Text(\n      \"Game Over\\nPress Enter to retry!\",\n      {\n        ...Config.styling.bigText,\n        fill: \"#f00\"\n      }\n    )\n\n    this.addChild(this._gameOverSign)\n\n    // place game over sign in center of screen\n    this._gameOverSign.x =\n      Config.constants.width / 2 -\n      this._gameOverSign.width / 2\n    this._gameOverSign.y =\n      Config.constants.height / 2 -\n      this._gameOverSign.height / 2\n  }\n}\n","export * from \"./IDictionary\"\nexport * from \"./ITickable\"\n","import { Container, IResourceDictionary } from \"pixi.js\"\nimport { Gamepads } from \"./input\"\nimport { MapBase } from \"./maps\"\nimport { HUDBase } from \"./ui\"\nimport { PlayerBase } from \"./actors\"\n\nexport class GameBase {\n  protected _resources: IResourceDictionary\n  protected _stage: Container\n\n  protected _isRunning: boolean = false\n  // current map\n  protected _map?: MapBase\n  // Heads up display\n  protected _hud?: HUDBase\n  // player\n  protected _player?: PlayerBase\n\n  protected _elapsedSeconds = 0\n  protected _startOffset?: number\n\n  constructor(\n    resources: IResourceDictionary,\n    stage: Container\n  ) {\n    this._resources = resources\n    this._stage = stage\n\n    this._map = new MapBase(resources, stage)\n    this._hud = new HUDBase(resources)\n    this._player = new PlayerBase(resources, \"none\", 0)\n  }\n\n  public tick(elapsed: number, delta: number) {\n    Gamepads.updateStatus()\n  }\n\n  protected _init() {\n    // attach the keyboard to player\n    const hasGamepad = this._attachGamepad()\n\n    // no gamepad, go to stinky keyboard\n    if (!hasGamepad) {\n      console.log(\"no gamepad, attaching keyboard\")\n      this._attachKeyboard()\n    }\n\n    // this game is running baby\n    this._isRunning = true\n  }\n\n  /**\n   * this will end the game\n   * @private\n   */\n  protected _end() {\n    // game is not longer running dude\n    this._isRunning = false\n\n    this._hud!.renderGameOver()\n  }\n\n  protected _attachKeyboard() {\n    return false\n  }\n\n  protected _attachGamepad(): boolean {\n    return false\n  }\n}\n","import * as PIXI from \"pixi.js\"\n\nglobal.PIXI = PIXI\n\nexport default PIXI\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n)\n\ntype Config = {\n  onSuccess?: (\n    registration: ServiceWorkerRegistration\n  ) => void\n  onUpdate?: (\n    registration: ServiceWorkerRegistration\n  ) => void\n}\n\nexport function register(config?: Config) {\n  if (\n    process.env.NODE_ENV === \"production\" &&\n    \"serviceWorker\" in navigator\n  ) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    )\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config)\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit https://bit.ly/CRA-PWA\"\n          )\n        })\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config)\n      }\n    })\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing\n        if (installingWorker == null) {\n          return\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === \"installed\") {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                \"New content is available and will be used when all \" +\n                  \"tabs for this page are closed. See https://bit.ly/CRA-PWA.\"\n              )\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration)\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log(\n                \"Content is cached for offline use.\"\n              )\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration)\n              }\n            }\n          }\n        }\n      }\n    })\n    .catch((error) => {\n      console.error(\n        \"Error during service worker registration:\",\n        error\n      )\n    })\n}\n\nfunction checkValidServiceWorker(\n  swUrl: string,\n  config?: Config\n) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { \"Service-Worker\": \"script\" }\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get(\n        \"content-type\"\n      )\n      if (\n        response.status === 404 ||\n        (contentType != null &&\n          contentType.indexOf(\"javascript\") === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(\n          (registration) => {\n            registration.unregister().then(() => {\n              window.location.reload()\n            })\n          }\n        )\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config)\n      }\n    })\n    .catch(() => {\n      console.log(\n        \"No internet connection found. App is running in offline mode.\"\n      )\n    })\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready\n      .then((registration) => {\n        registration.unregister()\n      })\n      .catch((error) => {\n        console.error(error.message)\n      })\n  }\n}\n","import React from \"react\"\nimport \"./Header.css\"\n\nexport default function Header() {\n  return (\n    <header>\n      <h1>Mänsion</h1>\n      <hr />\n    </header>\n  )\n}\n","import React from \"react\"\nimport \"./Footer.css\"\n\nexport default function Footer() {\n  return (\n    <footer>\n      <div>\n        <div className=\"entry inline\">\n          <a\n            href=\"https://twitter.com/umlautgames\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            Twitter\n          </a>{\" \"}\n          |\n        </div>\n        <div className=\"entry inline\">\n          <a\n            href=\"https://www.linkedin.com/company/umlaut-games\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            LinkedIn\n          </a>{\" \"}\n          |\n        </div>\n        <div className=\"entry inline\">\n          <a\n            href=\"https://umlaut-games.itch.io\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            itch.io\n          </a>\n        </div>\n      </div>\n\n      <div className=\"copyright\">\n        © 2020{\" \"}\n        <a\n          href=\"https://umlaut.games\"\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n        >\n          Umlaut Games\n        </a>\n        <span> — All Rights Reserved</span>\n      </div>\n    </footer>\n  )\n}\n","import React from \"react\"\nimport \"./About.css\"\n\nexport default function About() {\n  return (\n    <div className=\"blocks\">\n      <div className=\"block\">\n        <h2>Kickstarter</h2>\n        <p>\n          Lorem ipsum dolor sit amet, consectetur adipiscing\n          elit. Sed mattis sem nunc, vitae consectetur purus\n          volutpat at. Integer at consequat arcu. Curabitur\n          aliquam ex sit amet consectetur bibendum.\n          Phasellus nec metus aliquam, vestibulum est et,\n          efficitur metus. Fusce consectetur vel lectus non\n          feugiat. Nam et ipsum leo. Mauris bibendum semper\n          augue, non dapibus dui vestibulum id. In eget\n          metus nec odio consectetur ultrices ut congue\n          nisi. Vivamus et augue vel risus posuere pulvinar.\n          Vestibulum placerat justo mi, sed aliquam massa\n          lobortis vitae.\n        </p>\n\n        <div className=\"cta\">\n          <button>Preorder Now!</button>\n        </div>\n      </div>\n      <div className=\"block\">\n        <h2>Patreon</h2>\n        <p>\n          Ut vestibulum bibendum enim ut sodales. Nam\n          efficitur, sapien consectetur porttitor dapibus,\n          dolor felis lacinia velit, ut commodo odio leo eu\n          nunc. Curabitur vel libero aliquam, malesuada\n          mauris vel, ornare elit. Sed consectetur mauris eu\n          ante maximus pulvinar. Aliquam arcu metus,\n          pellentesque non nibh id, scelerisque placerat\n          mauris. Cras vel elit metus. Donec pulvinar purus\n          ac ipsum tristique tincidunt. Quisque non placerat\n          sapien. In ut iaculis libero, id dictum sem.\n          Mauris pulvinar vel lorem nec cursus.\n        </p>\n\n        <div className=\"cta\">\n          <button className=\"secondary\">Support us!</button>\n        </div>\n      </div>\n\n      <div className=\"block\">\n        <h2>itch.io</h2>\n        <p>\n          Ut vestibulum bibendum enim ut sodales. Nam\n          efficitur, sapien consectetur porttitor dapibus,\n          dolor felis lacinia velit, ut commodo odio leo eu\n          nunc. Curabitur vel libero aliquam, malesuada\n          mauris vel, ornare elit. Sed consectetur mauris eu\n          ante maximus pulvinar. Aliquam arcu metus,\n          pellentesque non nibh id, scelerisque placerat\n          mauris. Cras vel elit metus. Donec pulvinar purus\n          ac ipsum tristique tincidunt. Quisque non placerat\n          sapien. In ut iaculis libero, id dictum sem.\n          Mauris pulvinar vel lorem nec cursus.\n        </p>\n\n        <div className=\"cta\">\n          <button className=\"secondary\">\n            Get Early Access!\n          </button>\n        </div>\n      </div>\n    </div>\n  )\n}\n","import { IResourceDictionary, Sprite } from \"pixi.js\"\nimport { AnimationBase } from \"../../../engine\"\n\n/**\n *\n */\nexport class Impact extends AnimationBase {\n  constructor(resources: IResourceDictionary) {\n    super(resources)\n\n    const resource = this._resources[\"weapons.effects\"]\n    const impact = new Sprite(\n      resource.textures![\"impact.png\"]\n    )\n\n    this.addChild(impact)\n  }\n}\n","import {\n  AnimationBase,\n  AnimationHelper\n} from \"../../../engine\"\nimport { IResourceDictionary } from \"pixi.js\"\n\n/**\n *\n */\nexport class Blood extends AnimationBase {\n  constructor(\n    resources: IResourceDictionary,\n    speed: number = 0.01\n  ) {\n    super(resources)\n    const sheet = \"things\"\n\n    this._clips = {\n      [sheet]: AnimationHelper.loadClip(\n        this._resources,\n        sheet,\n        \"blood\",\n        speed,\n        1\n      )\n    }\n\n    this._playClip(sheet, false, false)\n  }\n}\n","import { IResourceDictionary, filters } from \"pixi.js\"\nimport {\n  AnimationBase,\n  AnimationHelper\n} from \"../../engine\"\n\n/**\n *\n */\nexport class Door extends AnimationBase {\n  constructor(\n    resources: IResourceDictionary,\n    done?: () => void\n  ) {\n    super(resources)\n\n    const sheet = \"things\"\n\n    this._clips = {\n      [sheet]: AnimationHelper.loadClip(\n        this._resources,\n        sheet,\n        \"door\",\n        0.01,\n        8\n      )\n    }\n\n    this._clips[sheet].filters = [\n      new filters.BlurFilter(0.2)\n    ]\n\n    this._playClip(sheet, false, false).then(() => {\n      if (done) {\n        done()\n      }\n    })\n  }\n}\n","import { ObjectBase } from \"../../engine\"\nimport {\n  Text,\n  IResourceDictionary,\n  TextStyle\n} from \"pixi.js\"\n\nexport class Crosshair extends ObjectBase {\n  constructor(resources: IResourceDictionary) {\n    super(resources)\n\n    this.zIndex = 3\n    this.addChild(\n      new Text(\"x\", {\n        fill: \"#fff\"\n      } as TextStyle)\n    )\n  }\n}\n","import { Config } from \"../config\"\nimport { ObjectBase } from \"../../engine\"\nimport {\n  IResourceDictionary,\n  Sprite,\n  Texture\n} from \"pixi.js\"\n\nexport class Beacon extends ObjectBase {\n  constructor(\n    resources: IResourceDictionary,\n    height: number,\n    width: number\n  ) {\n    super(resources)\n\n    this._isFacingRight = true\n\n    this.height = height\n    this.width = width\n\n    const bg = new Sprite(\n      Config.highlightBeacons\n        ? Texture.WHITE\n        : Texture.EMPTY\n    )\n\n    bg.width = width\n    bg.height = height\n\n    if (Config.highlightBeacons) {\n      bg.tint = 0xff0000\n    }\n\n    this.addChild(bg)\n  }\n}\n","import { MathHelper } from \"../../../engine\"\nimport { Container, Sprite, Texture } from \"pixi.js\"\nimport { tween, chain, easing } from \"popmotion\"\n\n/**\n *\n */\nexport class Lightning extends Container {\n  private interval1\n  private interval2\n\n  constructor() {\n    super()\n\n    this.pivot.x = this.width / 2\n    this.pivot.y = this.height / 2\n\n    const sprite = new Sprite(Texture.WHITE)\n\n    sprite.width = 1000\n    sprite.height = 1000\n    this.alpha = 0\n\n    this.interval1 = setInterval(() => {\n      this.shine()\n    }, MathHelper.getRandomInt(5, 10) * 1000)\n\n    this.interval2 = setInterval(() => {\n      this.shine()\n    }, MathHelper.getRandomInt(10, 20) * 1000)\n\n    this.addChild(sprite)\n  }\n\n  public destroy(options?: {\n    children?: boolean\n    texture?: boolean\n    baseTexture?: boolean\n  }) {\n    super.destroy(options)\n\n    window.clearInterval(this.interval1)\n    window.clearInterval(this.interval2)\n  }\n\n  private shine() {\n    const max = 0.75\n    const min = 0.0\n\n    chain(\n      tween({\n        from: min,\n        to: max,\n        duration: 75,\n        ease: [easing.createExpoIn(3)]\n      }),\n      tween({\n        from: max,\n        to: min,\n        duration: 400,\n        ease: [easing.easeOut]\n      })\n    ).start((alpha: number) => (this.alpha = alpha))\n  }\n}\n","import {\n  IResourceDictionary,\n  Sprite,\n  Graphics,\n  Text,\n  TextStyle\n} from \"pixi.js\"\nimport { Config } from \"../config\"\nimport { AnimationBase } from \"../../engine\"\n\nexport class Dialogbox extends AnimationBase {\n  _text: string[]\n  _textObject\n\n  constructor(\n    resources: IResourceDictionary,\n    text: string[] = [\n      \"Hahhahaha, kid!\",\n      \"You will never stop me\",\n      \"This is the end ... 🍆\"\n    ]\n  ) {\n    super(resources)\n\n    this._text = text.reverse()\n\n    const avatarTexture =\n      resources[\"avatar.dejonghe\"].texture\n    const avatar = new Sprite(avatarTexture)\n    avatar.height = 70\n    avatar.width = 70\n    avatar.y = 2\n    avatar.x = 2\n\n    const border = new Graphics()\n    border.lineStyle(4, 0x111111)\n    border.drawRect(0, 0, 400, 72)\n\n    const style: TextStyle = {\n      fontSize: \"14px\",\n      fill: \"#ccc\",\n      fontFamily: Config.styling.fontFamily,\n      dropShadow: true,\n      dropShadowColor: \"#222\"\n    } as TextStyle\n\n    this._textObject = new Text(\"\", style)\n    this._textObject.x = 80\n    this._textObject.y = 12\n\n    this.addChild(border, avatar, this._textObject)\n  }\n\n  public start() {\n    setTimeout(() => {\n      this.play()\n    }, Config.constants.initialDelay)\n  }\n\n  private printLine(line: string) {\n    return new Promise((resolve) => {\n      const text = line.split(\"\").reverse()\n\n      const lineInterval = setInterval(() => {\n        const char = text.pop()\n        if (char) {\n          this._textObject.text += char\n          if (char !== \" \") {\n            const sound = this._resources[\"sfx.keypress\"]\n              .sound\n            sound.play({\n              start: 0.7,\n              speed: 3.0,\n              volume: 0.2\n            })\n          }\n        } else {\n          clearInterval(lineInterval)\n          return resolve()\n        }\n      }, Config.constants.letterDelay)\n    })\n  }\n\n  private play() {\n    const line = this._text.pop()\n    if (line) {\n      this.printLine(line).then(() => {\n        if (this._text.length > 0) {\n          setTimeout(() => {\n            this._textObject.text += \"\\n\"\n            this.play()\n          }, Config.constants.lineDelay)\n        } else {\n          setTimeout(() => {\n            if (this._onDone) {\n              return this.done()\n            }\n          }, Config.constants.lineDelay)\n        }\n      })\n    }\n  }\n}\n","import { ObjectBase } from \"../../engine\"\nimport {\n  IResourceDictionary,\n  Point,\n  SimpleRope\n} from \"pixi.js\"\n\nexport default class Arm extends ObjectBase {\n  _width\n  _height\n\n  ropeLength\n  pointCount = 3\n  points: Point[] = []\n\n  count = 0\n\n  constructor(resources: IResourceDictionary) {\n    super(resources)\n\n    const arm = resources![\"taro\"].textures![\"arm.png\"]\n\n    this._width = arm.width\n    this._height = arm.height\n\n    this.ropeLength = this._width / this.pointCount\n    for (let i = 0; i < this.pointCount; i++) {\n      this.points.push(new Point(i * this.ropeLength, 0))\n    }\n\n    let rope = new SimpleRope(arm, this.points)\n    rope.x = 200\n    rope.y = 70\n    rope.scale.set(2)\n\n    this.addChild(rope)\n  }\n\n  tick(delta: number) {\n    super.tick(delta)\n\n    this.count += 0.1\n\n    // wobble\n    for (let i = 0; i < this.points.length; i++) {\n      this.points[i].y =\n        Math.sin(i * 0.5 + this.count) * this._height\n      this.points[i].x =\n        i * this.ropeLength +\n        Math.cos(i * 0.3 + this.count) * this._height\n    }\n  }\n}\n","import { IResourceDictionary } from \"pixi.js\"\nimport {\n  AnimationBase,\n  AnimationHelper\n} from \"../../../../engine\"\n\n/**\n *\n */\nexport class Muzzle extends AnimationBase {\n  constructor(\n    resources: IResourceDictionary,\n    speed: number = 0.01\n  ) {\n    super(resources)\n    const sheet = \"weapons.effects\"\n\n    this._clips = {\n      [sheet]: AnimationHelper.loadClip(\n        this._resources,\n        sheet,\n        \"muzzle\",\n        speed,\n        1\n      )\n    }\n\n    this._playClip(sheet, false, false)\n  }\n}\n","import {\n  IResourceDictionary,\n  Sprite,\n  Texture\n} from \"pixi.js\"\nimport { tween, easing } from \"popmotion\"\nimport {\n  AnimationBase,\n  MathHelper\n} from \"../../../../engine\"\n\n/**\n *\n */\nexport class Shell extends AnimationBase {\n  constructor(\n    resources: IResourceDictionary,\n    texture: Texture\n  ) {\n    super(resources)\n\n    this.pivot.x = this.width / 2\n    this.pivot.y = this.height / 2\n\n    const sprite = new Sprite(texture)\n\n    // const t = TweenMax.to(sprite, 2.5, {ease: Back.easeInOut.config(4), y: -200})\n\n    sprite.rotation = MathHelper.getRandomInt(0, 100)\n\n    this.scale.x = 0.1\n    this.scale.y = 0.1\n\n    tween({\n      from: 0,\n      to: -MathHelper.getRandomInt(500, 700),\n      duration: 600\n    }).start((x: number) => (sprite.x = x))\n\n    tween({\n      from: 0,\n      to: MathHelper.getRandomInt(900, 1000),\n      duration: 600,\n      ease: [easing.bounceOut]\n    }).start((y: number) => (sprite.y = y))\n\n    this.addChild(sprite)\n  }\n}\n","import { WeaponBase } from \"../../../engine\"\nimport { Muzzle } from \"./accessory/muzzle\"\nimport { Shell } from \"./accessory/shell\"\n\nexport default class Weapon extends WeaponBase {\n  fire(): boolean {\n    const fired = super.fire()\n\n    if (fired) {\n      // muzzle flash\n      const muzzleFlash = new Muzzle(this._resources, 2)\n\n      muzzleFlash.x = 48\n      muzzleFlash.y = -25\n      this.addChild(muzzleFlash)\n\n      const shell = new Shell(\n        this._resources,\n        this._roundsSprite?.texture!\n      )\n\n      const p = this.parent.parent\n      shell.position = this.parent.position\n\n      // add shell to the parent element because we want to let it fly around\n      p.addChild(shell)\n\n      this._shellSprites.push(shell)\n\n      setTimeout(() => {\n        p.removeChild(shell)\n        this._shellSprites = this._shellSprites.splice(\n          this._shellSprites.findIndex((s) => s === shell)\n        )\n      }, 3 * 1000)\n    }\n\n    return fired\n  }\n}\n","import { IResourceDictionary, Sprite } from \"pixi.js\"\nimport Weapon from \"./weapon\"\n\n/**\n *\n */\nexport class Shotgun extends Weapon {\n  /**\n   *\n   * @param resources\n   */\n  constructor(resources: IResourceDictionary) {\n    super(resources, 55, 6)\n\n    const resource = resources![\"weapons.shotgun\"]\n\n    this._roundsSprite = new Sprite(\n      resource.textures![\"shotgun_shell.png\"]!\n    )\n\n    this._sprite = new Sprite(\n      resource.textures![\"shotgun.png\"]!\n    )\n\n    this._sprite.scale.x = 0.3\n    this._sprite.scale.y = 0.3\n\n    // shotgun should be in the back so add it first\n    this.addChild(this._sprite)\n  }\n}\n","import { IResourceDictionary, Sprite } from \"pixi.js\"\nimport Weapon from \"./weapon\"\n\n/**\n *\n */\nexport class Beretta extends Weapon {\n  fireSound\n  reloadSound\n\n  /**\n   *\n   * @param resources\n   */\n  constructor(resources: IResourceDictionary) {\n    super(resources, 55, 8)\n\n    this.fireSound = resources[\"beretta.fire\"].sound\n    this.reloadSound = resources[\"beretta.reload\"].sound\n\n    this._reloadTime = this.reloadSound.duration\n\n    const resource = resources![\"weapons.beretta\"]\n\n    this._sprite = new Sprite(\n      resource.textures![\"beretta.png\"]!\n    )\n\n    this._sprite.scale.set(0.25, 0.25)\n\n    // sprite should be in the back so add it first\n    this.addChild(this._sprite)\n\n    this._roundsSprite = new Sprite(\n      resource.textures![\"beretta_shell.png\"]!\n    )\n  }\n\n  public fire(): boolean {\n    const f = super.fire()\n    if (f) {\n      this.fireSound.play()\n    }\n    return f\n  }\n\n  reload(): boolean {\n    const didReload = super.reload()\n    if (didReload) {\n      this.reloadSound.play()\n    }\n    return didReload\n  }\n}\n","import {\n  BLEND_MODES,\n  filters,\n  IResourceDictionary,\n  Sprite,\n  Texture\n} from \"pixi.js\"\nimport { SimpleLightmapFilter } from \"@pixi/filter-simple-lightmap\"\nimport { ObjectBase } from \"../../../engine\"\n\n/**\n *\n */\nexport class Flashlight extends ObjectBase {\n  constructor(resources: IResourceDictionary) {\n    super(resources)\n\n    const texture = Texture.from(\"flashlight.png\")\n    const lightCone = new Sprite(texture)\n\n    this.scale.set(2)\n    lightCone.width = 100\n    lightCone.height = 50\n    lightCone.alpha = 0.2\n    lightCone.tint = 0xefebd8\n    lightCone.y = -20\n\n    lightCone.zIndex = 99999\n    const f = new SimpleLightmapFilter(texture)\n\n    f.alpha = 0.01\n    f.blendMode = BLEND_MODES.ADD\n    lightCone.filters = [new filters.NoiseFilter(0.2), f]\n\n    this.zIndex = 9999\n    this.addChild(lightCone)\n  }\n}\n","import { IResourceDictionary, Point } from \"pixi.js\"\nimport {\n  ActorStates,\n  PlayerBase,\n  AnimationHelper,\n  byzIndex,\n  MathHelper\n} from \"../../engine\"\nimport { Beretta, Shotgun } from \"../objects/weapons\"\nimport { Flashlight } from \"../objects/weapons/flashlight\"\n\nconst weapons: {\n  shotgun?: Shotgun\n  beretta?: Beretta\n} = {}\n\n/**\n *\n */\nexport class Player extends PlayerBase {\n  flashlight?: Flashlight\n\n  /**\n   *\n   * @param resources\n   * @param skin\n   */\n  constructor(\n    resources: IResourceDictionary,\n    skin: string\n  ) {\n    super(resources, skin, 3)\n\n    this._baseScale = 2\n    this._name = \"Taro\"\n    this._health = 77\n\n    // load the clips for this object\n    this._clips[\n      this._skin + \".idle\"\n    ] = AnimationHelper.loadClip(\n      resources,\n      skin,\n      \"idle\",\n      0.1,\n      1\n    )\n    this._clips[\n      this._skin + \".idle-handgun\"\n    ] = AnimationHelper.loadClip(\n      resources,\n      skin,\n      \"idle-handgun\",\n      0.1,\n      1\n    )\n    /*    this._clips[this._skin + \".walk\"] =\n          AnimationHelper.loadClip(\n            this._resources, this._skin + \".walk\", 0.2, 1\n          );\n        this._clips[this._skin + \".punch\"] =\n          AnimationHelper.loadClip(\n            this._resources, this._skin + \".punch\", 0.3, 1\n          );\n        this._clips[this._skin + \".kick\"] =\n          AnimationHelper.loadClip(\n            this._resources, this._skin + \".kick\", 0.2, 1\n          );\n        this._clips[this._skin + \".gothit\"] =\n          AnimationHelper.loadClip(\n            this._resources, this._skin + \".gothit\", 0.2, 1\n          );\n        this._clips[this._skin + \".died\"] =\n          AnimationHelper.loadClip(\n            this._resources, this._skin + \".died\", 0.2, 1\n          );*/\n\n    weapons.shotgun = new Shotgun(resources)\n    weapons.beretta = new Beretta(resources)\n\n    this.flashlight = new Flashlight(resources)\n\n    // todo get this from equipment\n    this._weapon = weapons.beretta\n    this.addChild(this._weapon)\n\n    // go to idle\n    this.relax()\n  }\n\n  private relax() {\n    //  this._idle(this._weapon && this._weapon instanceof Beretta ? \".idle_handgun\" : \".idle\")\n    this._idle()\n  }\n\n  public reload() {\n    // todo check equipment for shells\n    this._weapon.reload()\n  }\n\n  public switchWeapon() {\n    if (!this.weapon.isReloading) {\n      this.removeChild(this._weapon)\n\n      if (this._weapon instanceof Shotgun) {\n        this._weapon = weapons.beretta!\n      } else if (this._weapon instanceof Beretta) {\n        this._weapon = weapons.shotgun!\n      }\n\n      this.toggleFlashlight()\n\n      this.addChild(this._weapon)\n    }\n  }\n\n  private toggleFlashlight() {\n    if (this._map && this.flashlight) {\n      if (\n        this._map.foregroundContainer.children.find(\n          (c) => c === this.flashlight\n        )\n      ) {\n        this._map.foregroundContainer.removeChild(\n          this.flashlight\n        )\n      } else {\n        this.flashlight.position.set(this.x, this.y)\n        this._map.foregroundContainer.addChild(\n          this.flashlight\n        )\n\n        this._map.foregroundContainer.children.sort(\n          byzIndex\n        )\n      }\n    }\n  }\n\n  public updateCrosshairPosition(crosshairPosition: Point) {\n    const angle: number = this._isFacingRight\n      ? MathHelper.angleBetweenRad(\n          this.weaponLocation,\n          crosshairPosition\n        )\n      : -MathHelper.angleBetweenRad(\n          crosshairPosition,\n          this.weaponLocation\n        )\n    this._weapon.rotation = angle\n  }\n\n  get weaponLocation(): Point {\n    return this.toGlobal(this._weapon.position)\n  }\n\n  /**\n   *\n   * @returns {boolean}\n   * @private\n   */\n  private _canBeControlled() {\n    if (this._state === ActorStates.died) {\n      console.log(\"Cant be controlled, player is dead\")\n      return false\n    }\n\n    return (\n      this._state === ActorStates.idle ||\n      this._state === ActorStates.walking\n    )\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _died() {\n    super._died()\n\n    // todo: add dying animation\n    // the died animation is way lower so we need to\n    // adjust the hight a bit\n    this.y += this.height / 2\n\n    this.height = this.height / 2\n  }\n\n  /**\n   * @public\n   */\n  public fire(): boolean {\n    if (!this._canBeControlled()) {\n      return false\n    }\n\n    // try to fires\n    const fire = this._weapon.fire()\n    if (fire) {\n      // we fired, announce\n      this.speak(\"Päng!\")\n\n      // set state, remove velo\n      this._setState(ActorStates.fire)\n      this._vx = 0\n      this._vy = 0\n\n      // play fire animation\n      this._playClip(this._skin + \".punch\", false).then(\n        () => {\n          // once done, go back to idle\n          this.relax()\n        }\n      )\n      return true\n    } else {\n      this.relax()\n      return false\n    }\n  }\n\n  /**\n   * @public\n   */\n  public moveRight() {\n    if (this._canBeControlled()) {\n      this._vx = this._speed\n      this._playClip(this._skin + \".walk\", true)\n      this._setState(ActorStates.walking)\n    }\n  }\n\n  /**\n   * @public\n   */\n  public moveLeft() {\n    if (this._canBeControlled()) {\n      this._vx = -this._speed\n      this._playClip(this._skin + \".walk\", true)\n      this._setState(ActorStates.walking)\n      this._adaptScaleBasedOnOrientation()\n    }\n  }\n\n  /**\n   * @public\n   */\n  public stopMoveHorizontally() {\n    this._vx = 0\n    if (this._vy === 0 && this._canBeControlled()) {\n      this.relax()\n    }\n  }\n\n  /**\n   * @public\n   */\n  public moveUp() {\n    if (this._canBeControlled()) {\n      this._vy = -this._speed\n      this._playClip(this._skin + \".walk\", true)\n      this._setState(ActorStates.walking)\n    }\n  }\n\n  /**\n   * @public\n   */\n  public moveDown() {\n    if (this._canBeControlled()) {\n      this._vy = this._speed\n      this._playClip(this._skin + \".walk\", true)\n      this._setState(ActorStates.walking)\n    }\n  }\n\n  /**\n   * @public\n   */\n  public stopMoveVertically() {\n    this._vy = 0\n    if (this._vx === 0 && this._canBeControlled()) {\n      this.relax()\n    }\n  }\n\n  public speak(text: string) {\n    super.speak(`${this._name}: ${text}`)\n  }\n\n  public move(\n    maxHeight: number,\n    maxWidth: number\n  ): boolean {\n    let playerMoved = false\n\n    if (\n      // do we have velocity?\n      this.vy !== 0 &&\n      this.y + this.vy > 0 &&\n      // dont move lower than the bottom\n      this.y + this.height + this.vy < maxHeight\n    ) {\n      this.y += this.vy\n      playerMoved = true\n    }\n\n    // move right\n    if (this.vx > 0) {\n      // dont walk further than the right border of the map\n      if (\n        this.realx + Math.abs(this.width) + 7 + this.vx <\n        maxWidth\n      ) {\n        this.x += this.vx\n        playerMoved = true\n      }\n    }\n    // move left\n    else if (this.vx < 0) {\n      // detect left col\n      if (this.realx + this.vx >= 0) {\n        this.x += this.vx\n        playerMoved = true\n      }\n    }\n\n    if (playerMoved) {\n      this.adaptScale(this.y, maxHeight)\n      this.flashlight?.position.set(this.x, this.y)\n      this.moved()\n    }\n\n    return playerMoved\n  }\n\n  public tick(delta: number) {\n    this.weapon.tick(delta)\n  }\n}\n","import { MapBase } from \"../../engine\"\nimport {\n  BLEND_MODES,\n  Container,\n  IResourceDictionary,\n  Sprite,\n  Texture\n} from \"pixi.js\"\nimport { Config } from \"../config\"\n\n/**\n *\n */\nexport class MaensionOutside extends MapBase {\n  constructor(\n    resources: IResourceDictionary,\n    stage: Container\n  ) {\n    super(resources, stage, \"maps.maension\")\n\n    this._bgm = resources[\"bgm.outside\"].sound\n    this._bgm.volume = 0.3\n    this._bgm.loop = true\n    this._bgm.play()\n\n    this.withDarkness = true\n\n    let starryNight = new Sprite(this._textures![\"sky.png\"])\n    starryNight.scale.x = 2.56\n    starryNight.scale.y = 2.56\n\n    this._backgroundContainer.addChild(starryNight)\n\n    let maension = new Sprite(\n      this._textures![\"Maension_WIP.png\"]\n    )\n\n    maension.y = -40\n    maension.scale.x = 2\n    maension.scale.y = 2\n\n    this._backgroundContainer.addChild(maension)\n\n    const tree = this._textures![\"tree.png\"]\n    const tree1 = new Sprite(tree)\n    tree1.x = 100\n    tree1.y = 350\n    tree1.scale.x = 0.4\n    tree1.scale.y = 0.4\n\n    this._actorContainer.addChild(tree1)\n\n    const tree_dead = this._textures![\"tree_dead.png\"]\n    const tree2 = new Sprite(tree_dead)\n    tree2.x = 50\n    tree2.y = 180\n    tree2.scale.x = 0.4\n    tree2.scale.y = 0.4\n\n    this._backgroundContainer.addChild(tree2)\n\n    if (this.withDarkness) {\n      const darkness = new Sprite(Texture.WHITE)\n\n      darkness.width = Config.constants.width\n      darkness.height = this.height\n      darkness.tint = 0x000000\n      darkness.alpha = 0.8\n      darkness.blendMode = BLEND_MODES.MULTIPLY\n      darkness.zIndex = 1\n      this._foregroundContainer.addChild(darkness)\n    }\n\n    this._setup()\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setup() {\n    setInterval(() => {\n      //z1.play();\n    }, 30 * 1000)\n\n    setInterval(() => {\n      //z2.play();\n    }, 67 * 1000)\n  }\n}\n","import { IResourceDictionary } from \"pixi.js\"\nimport { EnemyBase } from \"../../../engine\"\n\n/**\n *\n */\nexport class Bat extends EnemyBase {\n  /**\n   *\n   * @param resources\n   * @param skin\n   */\n  constructor(\n    resources: IResourceDictionary,\n    skin: string\n  ) {\n    super(resources, skin, 1)\n  }\n}\n","import { Door } from \"../objects\"\nimport { Config } from \"../config\"\nimport {\n  Container,\n  IResourceDictionary,\n  Sprite,\n  Texture\n} from \"pixi.js\"\nimport { MapBase } from \"../../engine\"\n\n/**\n *\n */\nexport class Loading extends MapBase {\n  private readonly _door: Door\n\n  constructor(\n    resources: IResourceDictionary,\n    stage: Container,\n    done?: () => void\n  ) {\n    super(resources, stage)\n\n    const bg = new Sprite(Texture.WHITE)\n\n    this._door = new Door(resources, done)\n    this._door.x = Config.constants.width / 2\n    this._door.y = 30\n\n    bg.width = Config.constants.width\n    bg.height = 800\n    bg.tint = Config.constants.black\n\n    this._backgroundContainer.addChild(bg)\n\n    this._setup()\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setup() {\n    this._foregroundContainer.addChild(this._door)\n  }\n\n  public tick(delta: number) {\n    this._door.y += delta / 100\n\n    const scale = this._door.scale.x + delta / 20000\n    this._door.scale.set(scale)\n  }\n}\n","import { Filter, IResourceDictionary } from \"pixi.js\"\n\nexport class RainFilter extends Filter {\n  constructor(resources: IResourceDictionary) {\n    super(undefined, resources[\"shaders.frag-rain\"].data)\n  }\n}\n","import {\n  Container,\n  IResourceDictionary,\n  Sprite,\n  Texture,\n  BLEND_MODES\n} from \"pixi.js\"\nimport {\n  Keyboard,\n  MapBase,\n  TextWithBackground\n} from \"../../engine\"\nimport { Config } from \"../config\"\nimport { GodrayFilter } from \"@pixi/filter-godray\"\nimport { Lightning } from \"../objects\"\nimport { RainFilter } from \"../filters/rain\"\nimport { easing, tween } from \"popmotion\"\n\n/**\n *\n */\nexport class Title extends MapBase {\n  constructor(\n    resources: IResourceDictionary,\n    stage: Container\n  ) {\n    super(resources, stage, \"maps.maension\")\n\n    this._bgm = resources[\"bgm.title\"].sound\n    this._bgm.volume = 0.3\n    this._bgm.loop = true\n    this._bgm.play()\n\n    this.withHud = false\n    this.withCrosshair = false\n    this.withPlayer = false\n    this.withMouse = false\n\n    const brand = new TextWithBackground(\n      resources,\n      \"Mänsion\",\n      \"54px\",\n      \"#EFB775\",\n      undefined,\n      \"#111\"\n    )\n    brand.x = Config.constants.width / 2 - brand.width / 2\n    brand.y = Config.constants.height / 3 - brand.height / 2\n\n    const isInteractive =\n      window.location.search.endsWith(\"interactive\") ||\n      !Config.lockTitleScreen\n\n    let pressStart = \"Press Enter to play\"\n    if (!isInteractive) {\n      pressStart = \"coming soon ...\"\n    }\n\n    const enterText = new TextWithBackground(\n      resources,\n      pressStart,\n      \"24px\"\n    )\n\n    tween({\n      from: 1.0,\n      to: 0.2,\n      loop: Infinity,\n      duration: 1500,\n      ease: [easing.easeInOut]\n    }).start((v: number) => (enterText.alpha = v))\n\n    enterText.x =\n      Config.constants.width / 2 - enterText.width / 2\n    enterText.y =\n      Config.constants.height / 2 - enterText.height / 2\n\n    const maension = new Sprite(\n      this._textures![\"Maension_WIP.png\"]\n    )\n\n    maension.alpha = 0.6\n    const scale = 2\n    maension.scale.x = scale\n    maension.scale.y = scale\n\n    maension.y = Config.constants.height - maension.height\n    maension.x =\n      Config.constants.width / 2 - maension.width / 2\n\n    this._foregroundContainer.addChild(\n      new Lightning(),\n      maension,\n      enterText,\n      brand\n    )\n\n    {\n      const god = new Sprite(Texture.WHITE)\n\n      god.width = Config.constants.width\n      god.height = Config.constants.height\n      god.tint = Config.constants.black\n\n      this.godFilter = new GodrayFilter()\n      this.godFilter.angle = -35\n      this.godFilter.gain = 0.5\n      this.godFilter.lacunarity = 2.5\n      god.filters = [this.godFilter]\n\n      this._backgroundContainer.addChild(god)\n    }\n\n    {\n      const rain = new Sprite(Texture.WHITE)\n\n      rain.width = Config.constants.width\n      rain.height = Config.constants.height\n      rain.tint = Config.constants.black\n\n      this.rainFilter = new RainFilter(resources)\n      this.rainFilter.uniforms.dimensions = [\n        Config.constants.width,\n        Config.constants.height\n      ]\n      this.rainFilter.uniforms.time = 1\n      this.rainFilter.uniforms.u_mouse = [\n        Config.constants.width,\n        Config.constants.height\n      ]\n      this.rainFilter.uniforms.u_frame = 0\n      this.rainFilter.blendMode = BLEND_MODES.ADD\n\n      rain.filters = [this.rainFilter]\n\n      this._backgroundContainer.addChild(rain)\n    }\n\n    this._foregroundContainer.interactive = true\n\n    if (isInteractive) {\n      this.wireEvents()\n    }\n  }\n\n  private wireEvents() {\n    const enter = new Keyboard(\"Enter\", true)\n    enter.pressEvent = () => this.done()\n\n    this._foregroundContainer.on(\n      \"touchstart\",\n      this.done.bind(this)\n    )\n  }\n\n  protected done() {\n    Promise.all([this.fade(), this.fadeMusic()]).then(\n      () => {\n        super.done()\n      }\n    )\n  }\n\n  rainFilter\n  godFilter\n\n  count = 0\n\n  public tick(delta: number) {\n    this.count += delta * 0.001\n    this.godFilter.time = this.count\n    this.rainFilter.uniforms.time = this.count\n  }\n}\n","import { Container, IResourceDictionary } from \"pixi.js\"\nimport { Dialogbox } from \"../objects\"\nimport { Config } from \"../config\"\nimport { MapBase } from \"../../engine\"\n\n/**\n *\n */\nexport class CutScene extends MapBase {\n  dialogBox\n\n  constructor(\n    resources: IResourceDictionary,\n    stage: Container\n  ) {\n    super(resources, stage, \"maps.maension\")\n\n    this.withHud = false\n    this.withCrosshair = false\n    this.withPlayer = false\n    this.withMouse = false\n\n    this.dialogBox = new Dialogbox(resources)\n\n    this.dialogBox.x =\n      Config.constants.width / 2 - this.dialogBox.width / 2\n    this.dialogBox.y =\n      Config.constants.height / 3 -\n      this.dialogBox.height / 2\n\n    this.foregroundContainer.addChild(this.dialogBox)\n\n    this.dialogBox.start()\n    this.dialogBox.onDone = () => this.done()\n  }\n\n  protected done() {\n    this.fade().then(() => {\n      super.done()\n    })\n  }\n\n  public tick(delta: number) {}\n}\n","import {\n  Text,\n  Container,\n  Sprite,\n  IResourceDictionary\n} from \"pixi.js\"\nimport { Config } from \"../config\"\nimport { HUDBase, PlayerBase } from \"../../engine\"\n\nexport class HUD extends HUDBase {\n  private readonly _health: Text\n  // round icons\n  private readonly _rounds: Container\n  // weapon icon\n  private _weapon?: Sprite\n\n  constructor(\n    resources: IResourceDictionary,\n    player: PlayerBase\n  ) {\n    super(resources)\n\n    const sheet = \"hud\"\n    const resource = resources[sheet]\n\n    console.log(\n      \"Setting up HUD\",\n      \"width:\",\n      Config.constants.width,\n      \"height:\",\n      Config.constants.height\n    )\n\n    this._player = player\n\n    const smallTextConfig = {\n      ...Config.styling.bigText,\n      fontSize: \"12px\"\n    }\n\n    {\n      const playerName = new Text(player.playerName, {\n        ...smallTextConfig,\n        fill: \"#ffff30\"\n      })\n      playerName.x =\n        Config.constants.width / 3 - playerName.width / 2\n      playerName.y = Config.constants.height - 47\n      this.addChild(playerName)\n\n      this._health = new Text(\"\", smallTextConfig)\n      this._health.x = playerName.x\n      this._health.y = Config.constants.height - 23\n      this.addChild(this._health)\n    }\n\n    this._rounds = new Container()\n    this._rounds.x = Config.constants.width / 3 + 77\n    this._rounds.y = Config.constants.height - 33\n    this.addChild(this._rounds)\n\n    {\n      const healthBorder = new Sprite(\n        resource.textures![\"side.png\"]\n      )\n\n      healthBorder.x =\n        Config.constants.width / 2 -\n        (healthBorder.width + healthBorder.width / 2) +\n        2\n      healthBorder.y =\n        Config.constants.height - healthBorder.height - 2\n\n      this.addChild(healthBorder)\n    }\n\n    {\n      const roundsBorder = new Sprite(\n        resource.textures![\"center.png\"]\n      )\n      roundsBorder.x =\n        Config.constants.width / 2 -\n        roundsBorder.width / 2 +\n        1\n      roundsBorder.y =\n        Config.constants.height - roundsBorder.height - 2\n\n      this.addChild(roundsBorder)\n    }\n\n    {\n      const weaponBorder = new Sprite(\n        resource.textures![\"side.png\"]\n      )\n\n      weaponBorder.x =\n        Config.constants.width / 2 +\n        (weaponBorder.width + weaponBorder.width / 2) -\n        2\n      weaponBorder.y =\n        Config.constants.height - weaponBorder.height - 2\n\n      weaponBorder.scale.x = -1\n\n      this.addChild(weaponBorder)\n    }\n\n    this.update()\n  }\n\n  private _renderWeapon() {\n    this.removeChild(this._weapon!)\n\n    this._weapon = new Sprite(\n      this._player.weapon.sprite!.texture\n    )\n    this._weapon.scale.x =\n      this._player.weapon.sprite!.scale.x * 3\n    this._weapon.scale.y =\n      this._player.weapon.sprite!.scale.y * 3\n\n    this._weapon.x =\n      Config.constants.width / 2 + (this._weapon.width + 50)\n    this._weapon.y = Config.constants.height - 60\n\n    this.addChild(this._weapon)\n  }\n\n  private _renderRounds() {\n    this._rounds.removeChildren()\n\n    for (let x = 0; x < this._player.weapon.rounds; x++) {\n      const roundSprite = new Sprite(\n        this._player.weapon.roundsSprite?.texture\n      )\n      roundSprite.scale.x = 0.25\n      roundSprite.scale.y = 0.25\n      roundSprite.x = 12 * x\n      roundSprite.y = 10\n\n      this._rounds.addChild(roundSprite)\n    }\n  }\n\n  public update() {\n    super.update()\n\n    this._health.text = this._player.health + \" HP\"\n\n    this._renderRounds()\n    this._renderWeapon()\n  }\n\n  public tick(delta: number) {\n    if (this._gameOverSign) {\n      this._gameOverSign.alpha += delta / 1000\n      if (this._gameOverSign.alpha > 1) {\n        this._gameOverSign.alpha = 0.2\n      }\n    }\n  }\n}\n","import {\n  Container,\n  DisplayObject,\n  Graphics,\n  InteractionEvent,\n  IResourceDictionary,\n  Point\n} from \"pixi.js\"\nimport {\n  ActorBase,\n  ActorStates,\n  byzIndex,\n  EnemyBase,\n  GameBase,\n  Gamepads,\n  Keyboard,\n  MapBase,\n  MathHelper\n} from \"../engine\"\nimport { Config } from \"./config\"\nimport { Beacon, Blood, Crosshair, Impact } from \"./objects\"\nimport { Player } from \"./actors\"\nimport { CutScene, MaensionOutside, Title } from \"./maps\"\nimport { HUD } from \"./ui\"\n\n/**\n * @class\n */\nexport default class Game extends GameBase {\n  // special items that are not visible\n  private _beacon?: Beacon\n  // todo refactor to map\n  private _enemies: EnemyBase[] = []\n\n  // mouse\n  private _mouseLocation?: Point\n  private _mouseLine?: Graphics\n  private _crosshair?: Crosshair\n\n  protected _player?: Player\n\n  /**\n   *\n   * @param resources\n   * @param stage\n   */\n  constructor(\n    resources: IResourceDictionary,\n    stage: Container\n  ) {\n    super(resources, stage)\n\n    this._init()\n  }\n\n  private switchMap(newMap: MapBase): MapBase {\n    // remove all the items from the stage\n    this._stage.removeChild(this._map!)\n    this._stage.removeChild(this._hud!)\n\n    // destroy map\n    if (this._map) {\n      this._map.destroy({\n        children: true,\n        baseTexture: true\n      })\n      delete this._map\n    }\n\n    // set map\n    this._map = newMap\n    this._stage.addChild(this._map)\n\n    // wire up player\n    if (this._player && this._map.withPlayer) {\n      this._player.x = 60\n      this._player.y = 400\n\n      this._player.adaptScale(\n        this._player.y,\n        Config.constants.height\n      )\n      this._player.map = this._map\n\n      // add player to stage\n      this._map.actorContainer.addChild(this._player)\n    }\n\n    // wire up crosshair\n    if (this._map.withCrosshair) {\n      this._crosshair = new Crosshair(this._resources)\n      this._crosshair.adaptScale(\n        this._player!.y,\n        Config.constants.height\n      )\n\n      this._stage.cursor = \"none\"\n    }\n\n    // wire up HUD\n    if (this._map.withHud) {\n      this._stage.addChild(this._hud!)\n      this._updateHud()\n    }\n\n    // wire up mouse\n    if (this._map.withMouse) {\n      this._attachMouse()\n      this._updateMouseLocation(\n        new Point(\n          Config.constants.width / 2,\n          Config.constants.height / 2\n        )\n      )\n    }\n\n    // sort stage otherwise stage crossfade will not work\n    this._stage.children.sort(byzIndex)\n\n    return newMap!\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _init() {\n    super._init()\n\n    // create player\n    this._player = new Player(this._resources, \"taro\")\n\n    this._hud = new HUD(this._resources, this._player)\n\n    const map = this.switchMap(\n      new Title(this._resources, this._stage)\n    )\n\n    // todo change this\n    map.onDone = () => {\n      const cutscene = this.switchMap(\n        new CutScene(this._resources, this._stage)\n      )\n\n      cutscene.onDone = () =>\n        this.switchMap(\n          new MaensionOutside(this._resources, this._stage)\n        )\n    }\n\n    // for testing\n    // todo remove\n    this._beacon = new Beacon(this._resources, 80, 5)\n\n    // init enemies\n    // todo let map handle this\n    this._enemies = []\n\n    console.log(\"Game:\", \"Game init done!\")\n  }\n\n  private _attachMouse() {\n    this._mouseLine = new Graphics()\n    this._mouseLine.zIndex = 5\n\n    this._stage.addChild(this._mouseLine!)\n\n    if (this._crosshair) {\n      this._stage.addChild(this._crosshair)\n    }\n\n    this._stage.interactive = true\n    this._stage.on(\"mousemove\", (e: InteractionEvent) => {\n      this._updateMouseLocation(e.data.global)\n    })\n\n    this._stage.on(\"mousedown\", () => this._fire())\n\n    this._stage.on(\n      \"mouseout\",\n      () => (this._isRunning = false)\n    )\n\n    this._stage.on(\n      \"mouseover\",\n      () =>\n        (this._isRunning =\n          this._player!.state !== ActorStates.died)\n    )\n  }\n\n  private _updateCrosshair() {\n    if (\n      this._player &&\n      this._player.state !== ActorStates.died &&\n      this._crosshair &&\n      this._mouseLocation &&\n      this._isRunning\n    ) {\n      this._crosshair.x =\n        this._mouseLocation.x - this._crosshair.width / 2\n      this._crosshair.y =\n        this._mouseLocation.y - this._crosshair.height / 2\n\n      // flip player based on crosshair position\n      if (\n        this._crosshair!.x <\n        this._player!.toGlobal(this._stage).x\n      ) {\n        this._player.flip(false)\n      } else {\n        this._player.flip(true)\n      }\n\n      // update player based on crosshair\n      this._player.updateCrosshairPosition(\n        this._stage.toGlobal(this._crosshair?.position!)\n      )\n\n      // adapt crosshair scale based on player location\n      this._crosshair.adaptScale(\n        this._player!.y,\n        Config.constants.height\n      )\n    }\n  }\n\n  private _fire() {\n    if (this._isRunning) {\n      if (this._player?.fire()) {\n        // hit location\n        const impact = new Impact(this._resources)\n        impact.scale.x = 0.1\n        impact.scale.y = 0.1\n\n        const impactLocation = this._map!.toLocal(\n          this._crosshair!\n        )\n        impact.x =\n          impactLocation.x +\n          this._crosshair!.width / 2 -\n          impact.width / 2\n        impact.y =\n          impactLocation.y +\n          this._crosshair!.height / 2 -\n          impact.height / 2\n\n        this._map?.backgroundContainer.addChild(impact)\n\n        this._updateHud()\n      }\n    }\n  }\n\n  private _moveRight() {\n    if (this._isRunning && this._player) {\n      this._player.moveRight()\n    }\n  }\n\n  private _moveLeft() {\n    if (this._isRunning && this._player) {\n      this._player.moveLeft()\n    }\n  }\n\n  private _moveUp() {\n    if (this._isRunning && this._player) {\n      this._player.moveUp()\n    }\n  }\n\n  private _moveDown() {\n    if (this._isRunning && this._player) {\n      this._player.moveDown()\n    }\n  }\n\n  private _stopMoveVertically() {\n    if (this._isRunning) {\n      this._player?.stopMoveVertically()\n    }\n  }\n\n  private _stopMoveHorizontally() {\n    if (this._isRunning) {\n      this._player?.stopMoveHorizontally()\n    }\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _detectCollisions() {\n    if (this._player!.collides(this._beacon!)) {\n      this._player!.speak(\"It's locked!\")\n    }\n\n    /*    if (\n          this._crosshair &&\n          this._crosshair!.collides(this._beacon!)\n        ) {\n          this._beacon = new Beacon(this._resources, 80, 5)\n\n          this._stage.removeChild(this._map!)\n          this._map = new Loading(\n            this._resources,\n            this._stage,\n            () => {\n              this.switchMap(\n                new MaensionOutside(\n                  this._resources,\n                  this._stage\n                )\n              )\n            }\n          )\n          this._stage.addChild(this._map!)\n        }*/\n\n    for (const enemy of this._enemies) {\n      if (\n        ActorStates.died !== enemy.state &&\n        ActorStates.died !== this._player!.state\n      ) {\n        // does the player collide the enemy?\n        if (this._player!.collides(enemy)) {\n          const playerHit = this._player!.hitBy(enemy)\n\n          if (playerHit.objectTookDamage) {\n            this._drawBlood(this._player!)\n            this._updateHud()\n          }\n\n          // we died and now lives left :(\n          if (playerHit.died) {\n            // end the game\n            this._end()\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   *\n   * @param actor: the bleeding actor\n   * @private\n   */\n  private _drawBlood(actor: ActorBase) {\n    for (let i = 0; i < 5; i++) {\n      const blood = new Blood(this._resources)\n\n      blood.x = actor.x + MathHelper.getRandomInt(-20, 20)\n      blood.y =\n        actor.y +\n        actor.height +\n        MathHelper.getRandomInt(-20, 20)\n      blood.rotation = MathHelper.getRandomInt(0, 10)\n\n      this._map?.backgroundContainer.addChild(blood)\n    }\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _updateHud() {\n    this._hud!.update()\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _updateKI() {\n    for (const enemy of this._enemies) {\n      if (ActorStates.died !== enemy.state) {\n        enemy.moveTowards(this._player!.position)\n      }\n    }\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _moveActors() {\n    const { _player } = this\n    let playerMoved = _player!.move(\n      Config.constants.height,\n      this._map!.width\n    )\n\n    if (playerMoved) {\n      // yep, so try to scroll the map\n      this._map?.shallScroll(_player!.realx, _player!.vx)\n      this._updateCrosshair()\n    }\n\n    // move the enemies\n    for (const enemy of this._enemies) {\n      enemy.move(Config.constants.height, this._map!.width)\n    }\n  }\n\n  private _outlineMouse() {\n    if (\n      this._mouseLine &&\n      this._mouseLocation &&\n      this._player &&\n      this._map\n    ) {\n      this._mouseLine.clear()\n      this._mouseLine.lineStyle(1, Config.constants.white)\n\n      // from\n      this._mouseLine.position = this._player.weaponLocation\n\n      // to\n      const { x, y } = this._mouseLine.toLocal(\n        this._mouseLocation\n      )\n      this._mouseLine.lineTo(x, y)\n\n      this._mouseLine.endFill()\n    }\n  }\n\n  private _switchWeapon() {\n    if (this._isRunning) {\n      this._player!.switchWeapon()\n      this._updateHud()\n    }\n  }\n\n  private _reload() {\n    if (this._isRunning) {\n      this._player!.reload()\n      this._updateHud()\n    }\n  }\n\n  private _updateMouseLocation(mouseLocation: Point) {\n    if (this._isRunning) {\n      this._mouseLocation = mouseLocation\n      this._updateCrosshair()\n    }\n  }\n\n  protected _attachKeyboard() {\n    const left = new Keyboard(\"ArrowLeft\", true),\n      up = new Keyboard(\"ArrowUp\", true),\n      right = new Keyboard(\"ArrowRight\", true),\n      down = new Keyboard(\"ArrowDown\", true),\n      w = new Keyboard(\"w\", false),\n      r = new Keyboard(\"r\", false),\n      enter = new Keyboard(\"Enter\", false)\n\n    w.pressEvent = () => this._switchWeapon()\n    r.pressEvent = () => this._reload()\n\n    right.pressEvent = () => this._moveRight()\n    right.releaseEvent = () => {\n      if (!left.isDown) {\n        this._stopMoveHorizontally()\n      }\n    }\n\n    left.pressEvent = () => this._moveLeft()\n    left.releaseEvent = () => {\n      if (!right.isDown) {\n        this._stopMoveHorizontally()\n      }\n    }\n\n    up.pressEvent = () => this._moveUp()\n    up.releaseEvent = () => {\n      if (!down.isDown) {\n        this._stopMoveVertically()\n      }\n    }\n\n    down.pressEvent = () => this._moveDown()\n    down.releaseEvent = () => {\n      if (!up.isDown) {\n        this._stopMoveVertically()\n      }\n    }\n\n    enter.pressEvent = () => {\n      if (!this._isRunning) {\n        this._init()\n      }\n    }\n\n    return true\n  }\n\n  protected _attachGamepad(): boolean {\n    return !!Gamepads.init({\n      // first gamepad\n      0: {\n        // button 1 pressed\n        1: {\n          pressEvent: () => {\n            this._fire()\n          }\n        },\n        // button 15 pressed\n        15: {\n          pressEvent: () => this._moveRight(),\n          releaseEvent: () => this._stopMoveHorizontally()\n        },\n        // button 14 pressed\n        14: {\n          pressEvent: () => this._moveLeft(),\n          releaseEvent: () => this._stopMoveHorizontally()\n        },\n        // button 12 pressed\n        12: {\n          pressEvent: () => this._moveUp(),\n          releaseEvent: () => this._stopMoveVertically()\n        },\n        // button 13 pressed\n        13: {\n          pressEvent: () => this._moveDown(),\n          releaseEvent: () => this._stopMoveVertically()\n        },\n        // button 9 pressed\n        9: {\n          pressEvent: () => {\n            if (!this._isRunning) {\n              this._init()\n            }\n          }\n        }\n      }\n    })\n  }\n\n  /**\n   *\n   * @param elapsed\n   * @param delta\n   * @public\n   */\n  public tick(elapsed: number, delta: number) {\n    super.tick(elapsed, delta)\n\n    this._hud!.tick(delta)\n\n    if (this._isRunning) {\n      this._player!.tick(delta)\n      this._map!.tick(delta)\n\n      const elapsedSeconds = parseInt(\n        (elapsed / 1000).toString()\n      )\n\n      // game has not started\n      if (!this._startOffset) {\n        this._startOffset = elapsedSeconds\n      }\n\n      const correctedElapsedSeconds =\n        elapsedSeconds - this._startOffset\n\n      if (\n        correctedElapsedSeconds !== this._elapsedSeconds\n      ) {\n        this._elapsedSeconds = correctedElapsedSeconds\n        this._updateHud()\n      }\n\n      this._detectCollisions()\n      this._updateKI()\n      this._moveActors()\n\n      // sort by y\n      const sort = (a: DisplayObject, b: DisplayObject) => {\n        const ab = a.getBounds()\n        const bb = b.getBounds()\n\n        if (a.y + ab.height < b.y + bb.height - 5) {\n          return -1\n        }\n\n        if (a.y + ab.height > b.y + bb.height - 5) {\n          return 1\n        }\n\n        return 0\n      }\n\n      // ensure z index for actors\n      this._map?.actorContainer.children.sort(sort)\n\n      if (Config.outlineObjects) {\n        // outline player\n        this._player!.outline()\n\n        // outline enemies\n        for (const enemy of this._enemies) {\n          enemy.outline()\n        }\n\n        // outline mouse line\n        this._outlineMouse()\n      }\n    }\n  }\n}\n","import { IDictionary } from \"../engine\"\n\nexport const assets: IDictionary<string> = {\n  // maps\n  \"maps.maension\": \"maps/maension.json\",\n  // taro\n  taro: \"taro/taro.json\",\n  // taros arm\n  // todo move\n  arm: \"taro/arm.png\",\n  // enemy\n  // todo remove!\n  bat: \"enemies/bat/bat.json\",\n  monster: \"enemies/monster/monster.json\",\n  \"avatar.dejonghe\": \"enemies/dejonghe/avatar_dejonghe.png\",\n  // weapons\n  \"weapons.shotgun\": \"weapons/shotgun.json\",\n  \"weapons.beretta\": \"weapons/beretta.json\",\n  // weapon sounds\n  \"beretta.fire\":\n    \"sounds/beretta/mansion_sfx_gun_berreta_outside.wav\",\n  \"beretta.reload\":\n    \"sounds/beretta/mansion_sfx_gun_berreta_reload.wav\",\n  // weapon effects\n  \"weapons.effects\": \"weapons/effects.json\",\n  // BGM\n  \"bgm.title\": \"sounds/mansion_bgm_menu.mp3\",\n  \"bgm.outside\": \"sounds/mansion_bgm_outside_v3.mp3\",\n  // SFX\n  \"sfx.keypress\": \"sounds/sfx/keypress.mp3\",\n  // shaders\n  \"shaders.frag-smoke\": \"shaders/frag-smoke.glsl\",\n  \"shaders.frag-smoke2\": \"shaders/frag-smoke2.glsl\",\n  \"shaders.vert-spot\": \"shaders/vert-spot.glsl\",\n  \"shaders.frag-spot\": \"shaders/frag-spot.glsl\",\n  \"shaders.vert-2d\": \"shaders/vert-2d.glsl\",\n  \"shaders.frag-rain\": \"shaders/frag-rain.glsl\",\n  \"shaders.vert-light\": \"shaders/vert-light.glsl\",\n  \"shaders.frag-light\": \"shaders/frag-light.glsl\",\n  // common things\n  things: \"things/things.json\",\n  // HUD\n  hud: \"things/hud.json\",\n  flashlight: \"things/flashlight.png\",\n  lightmap: \"things/lightmap.png\"\n}\n\nexport const extracts = [\n  { sheet: \"things\", id: \"flashlight.png\" }\n]\n","import {\n  Application,\n  Container,\n  ILoaderOptions,\n  IResourceDictionary,\n  Loader,\n  Sprite,\n  Texture\n} from \"pixi.js\"\nimport { FpsCounter, LoadingBar } from \"../engine\"\nimport Game from \"./game\"\nimport { Config } from \"./config\"\nimport { assets, extracts } from \"./assets\"\n\nexport default class Maension {\n  private _lastFrame: number = 0\n  private _game?: Game\n\n  private readonly _fpsCounter?\n  private readonly _container: HTMLDivElement\n  private readonly _app: Application\n  private readonly _root: Container\n\n  private readonly _loadingBar: LoadingBar\n\n  constructor(container: HTMLDivElement) {\n    this._container = container\n\n    this._app = new Application({\n      width: Config.constants.width,\n      height: Config.constants.height,\n      backgroundColor: Config.constants.black\n    })\n\n    this._container.appendChild(this._app.view)\n\n    console.log(\n      \"Viewport\",\n      this._container.clientWidth,\n      this._container.clientHeight\n    )\n\n    // create the root of the scene graph\n    // @ts-ignore\n    this._root = new Container()\n\n    // @ts-ignore\n    this._app.stage.addChild(this._root)\n\n    this.resize()\n\n    if (Config.showFPS) {\n      this._fpsCounter = new FpsCounter()\n\n      this._app.stage.addChild(this._fpsCounter)\n    }\n\n    this._loadingBar = new LoadingBar()\n    this._app.stage.addChild(this._loadingBar)\n\n    window.addEventListener(\n      \"resize\",\n      this.resize.bind(this)\n    )\n\n    // start ticking\n    this._tick(0)\n  }\n\n  resize() {\n    const vpw = window.innerWidth - 50 // Width of the viewport\n    const vph = window.innerHeight // Height of the viewport\n    let nvw // New game width\n    let nvh // New game height\n\n    // The aspect ratio is the ratio of the screen's sizes in different dimensions.\n    // The height-to-width aspect ratio of the game is HEIGHT / WIDTH.\n\n    if (\n      vph / vpw <\n      Config.constants.height / Config.constants.width\n    ) {\n      // If height-to-width ratio of the viewport is less than the height-to-width ratio\n      // of the game, then the height will be equal to the height of the viewport, and\n      // the width will be scaled.\n      nvh = vph\n      nvw =\n        (nvh * Config.constants.width) /\n        Config.constants.height\n    } else {\n      // In the else case, the opposite is happening.\n      nvw = vpw\n      nvh =\n        (nvw * Config.constants.height) /\n        Config.constants.width\n    }\n\n    if (nvw > Config.constants.width) {\n      nvw = Config.constants.width\n    }\n\n    if (nvh > Config.constants.height) {\n      nvh = Config.constants.height\n    }\n\n    // Set the game screen size to the new values.\n    // This command only makes the screen bigger --- it does not scale the contents of the game.\n    // There will be a lot of extra room --- or missing room --- if we don't scale the stage.\n    this._app.renderer.resize(nvw, nvh)\n\n    // This command scales the stage to fit the new size of the game.\n    this._app.stage.scale.set(\n      nvw / Config.constants.width,\n      nvh / Config.constants.height\n    )\n  }\n\n  /**\n   *\n   */\n  public run() {\n    const options = {\n      crossOrigin: true\n    } as ILoaderOptions\n\n    const assetPath = \"assets\"\n\n    const loader = new Loader()\n\n    Object.keys(assets).forEach((id) => {\n      loader.add(id, `${assetPath}/${assets[id]}`, options)\n    })\n\n    loader.onComplete.once(this._assetsLoaded.bind(this))\n\n    // resources loaded\n    loader.load()\n\n    loader.onProgress.add((event: any) => {\n      this._loadingBar.update(event.progress)\n    })\n  }\n\n  private _assetsLoaded(loader: Loader) {\n    this._app.stage.removeChild(this._loadingBar)\n\n    this.extractTextures(loader.resources)\n\n    // loading done, start game\n    this._game = new Game(loader.resources, this._root)\n\n    console.log(\"Mänsion:\", \"Init done, ready to scare!\")\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _tick(elapsed: number) {\n    // calculate frame delta\n    let delta = elapsed - this._lastFrame\n    this._lastFrame = elapsed\n\n    if (this._fpsCounter) {\n      this._fpsCounter.tick(delta)\n    }\n\n    // update game\n    if (this._game) {\n      this._game.tick(elapsed, delta)\n    }\n\n    // render the container\n    this._app.render()\n\n    // loop\n    requestAnimationFrame(this._tick.bind(this))\n  }\n\n  private extractTextures(resources: IResourceDictionary) {\n    extracts.forEach((e) => {\n      const frame = resources![e.sheet].textures![e.id]\n\n      const sprite = new Sprite(frame)\n      const pixels = this._app.renderer.plugins.extract.pixels(\n        sprite\n      )\n\n      const texture = Texture.fromBuffer(\n        pixels,\n        frame.width,\n        frame.height\n      )\n\n      Texture.removeFromCache(frame)\n      Texture.addToCache(texture, e.id)\n    })\n  }\n}\n","import React, { useEffect, useRef, useState } from \"react\"\nimport \"./MaensionComponent.css\"\nimport Maension from \"../game/maension\"\n\nexport default function MaensionComponent() {\n  const stage = useRef(null)\n  const [maension, setMaension] = useState<Maension>()\n\n  useEffect(() => {\n    if (!maension && stage.current) {\n      const m = new Maension(stage.current!)\n      m.run()\n      setMaension(m)\n    }\n  }, [stage, maension])\n\n  return <div className=\"maension\" ref={stage} />\n}\n","import React from \"react\"\nimport \"./HowToPlay.css\"\n\nexport default function HowToPlay() {\n  return (\n    <div className=\"blocks\">\n      <div className=\"block\">\n        <h2>How to Play</h2>\n        <p>\n          Lorem ipsum dolor sit amet, consectetur adipiscing\n          elit. Sed mattis sem nunc, vitae consectetur purus\n          volutpat at. Integer at consequat arcu. Curabitur\n          aliquam ex sit amet consectetur bibendum.\n          Phasellus nec metus aliquam, vestibulum est et,\n          efficitur metus. Fusce consectetur vel lectus non\n          feugiat. Nam et ipsum leo. Mauris bibendum semper\n          augue, non dapibus dui vestibulum id. In eget\n          metus nec odio consectetur ultrices ut congue\n          nisi. Vivamus et augue vel risus posuere pulvinar.\n          Vestibulum placerat justo mi, sed aliquam massa\n          lobortis vitae.\n        </p>\n      </div>\n      <div\n        className=\"block\"\n        style={{ textAlign: \"center\" }}\n      >\n        <div className=\"controls\">\n          <div className=\"control\">\n            <div className=\"space center\">\n              <div className=\"button\">\n                <i className=\"fas fa-arrow-up\"></i>\n              </div>\n            </div>\n            <span className=\"label\">: Move Up</span>\n          </div>\n          <div className=\"control\">\n            <div className=\"space\">\n              <div className=\"button\">\n                <i className=\"fas fa-arrow-left\"></i>\n              </div>\n              <div className=\"button\">\n                <i className=\"fas fa-arrow-right\"></i>\n              </div>\n            </div>\n            <span className=\"label\">: Move Left/Right</span>\n          </div>\n          <div className=\"control\">\n            <div className=\"space center\">\n              <div className=\"button\">\n                <i className=\"fas fa-arrow-down\"></i>\n              </div>\n            </div>\n            <span className=\"label\">: Move Down</span>\n          </div>\n          <div className=\"control\">\n            <div className=\"space center\">\n              <div className=\"button\">\n                <i className=\"fas fa-mouse-pointer\"></i>\n              </div>\n              <div className=\"button\">\n                <i className=\"fas fa-mouse\"></i>\n              </div>\n            </div>\n            <span className=\"label\">: Aim/Fire</span>\n          </div>\n          <div className=\"control\">\n            <div className=\"space center\">\n              <div className=\"button\">R</div>\n            </div>\n            <span className=\"label\">: Reload</span>\n          </div>\n          <div className=\"control\">\n            <div className=\"space center\">\n              <div className=\"button\">W</div>\n            </div>\n            <span className=\"label\">: Switch Weapon</span>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n","import React from \"react\"\nimport \"./Page.css\"\nimport Header from \"./components/Header\"\nimport Footer from \"./components/Footer\"\nimport About from \"./components/About\"\nimport MaensionComponent from \"./components/MaensionComponent\"\nimport HowToPlay from \"./components/HowToPlay\"\n\nexport default function Page() {\n  return (\n    <div>\n      <Header />\n\n      <MaensionComponent />\n\n      <hr />\n\n      <div className=\"page\">\n        <HowToPlay />\n        <About />\n      </div>\n\n      <Footer />\n    </div>\n  )\n}\n","import React from \"react\"\nimport ReactDOM from \"react-dom\"\nimport * as serviceWorker from \"./serviceWorker\"\nimport \"./index.css\"\nimport \"@fortawesome/fontawesome-free/css/all.min.css\"\nimport Page from \"./Page\"\n\nReactDOM.render(\n  <React.StrictMode>\n    <Page />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n)\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.register()\n"],"sourceRoot":""}