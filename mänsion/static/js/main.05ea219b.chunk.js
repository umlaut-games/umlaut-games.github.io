(this.webpackJsonpmaension=this.webpackJsonpmaension||[]).push([[0],{31:function(t,e,i){t.exports=i(47)},36:function(t,e,i){},37:function(t,e,i){},47:function(t,e,i){"use strict";i.r(e);var n=i(13),s=i.n(n),a=i(28),o=i.n(a),r=(i(36),i(30)),h=(i(37),i(6)),l=i(9),d=i(4),u=i(16),c=!1,_=!1,p=!1,v=!1,f=!1,g=!1,y=i(8),w=i(7),m=function(t){Object(y.a)(i,t);var e=Object(w.a)(i);function i(t){var n;return Object(h.a)(this,i),(n=e.call(this))._outlineContainer=void 0,n._baseScale=1,n._resources=void 0,n._isFacingRight=!0,n._vx=0,n._vy=0,n._vr=0,n._resources=t,n}return Object(l.a)(i,[{key:"collides",value:function(t){var e=t.getBounds(),i=this.getBounds(),n=e.x+e.width>i.x&&e.x<i.x+i.width&&e.y+e.height>i.y&&e.y<i.y+i.height;return n&&f&&(console.log("this",i),console.log("actor",e)),n}},{key:"adaptScale",value:function(t,e){var i=e-t,n=this._baseScale-i/1e3;this.scale.x=n,this.scale.y=n,this._adaptScaleBasedOnOrientation()}},{key:"_adaptScaleBasedOnOrientation",value:function(){var t=this.scale.x;!this._isFacingRight&&t>0&&(this.scale.x=-t),this._isFacingRight&&t<0&&(this.scale.x=Math.abs(t))}},{key:"outline",value:function(){this._outlineContainer&&(this.parent.removeChild(this._outlineContainer),delete this._outlineContainer),this._adaptScaleBasedOnOrientation(),this._outlineContainer=new d.b;var t=this.getBounds(),e=this.parent.toLocal(t);if(_){var i=new d.h("x: ".concat(t.x.toFixed(0)," y: ").concat(t.y.toFixed(0),"\nw: ").concat(t.width.toFixed(0)," h: ").concat(t.height.toFixed(0)),{fontSize:"10px",fill:"#fff"});i.x=e.x,i.y=e.y,this._outlineContainer.addChild(i)}var n=new d.c;n.lineStyle(1,0),n.drawRect(e.x,e.y,t.width,t.height),n.endFill(),this._outlineContainer.addChild(n),this.parent.addChild(this._outlineContainer)}},{key:"vx",get:function(){return this._vx}},{key:"vy",get:function(){return this._vy}},{key:"vr",get:function(){return this._vr}},{key:"realx",get:function(){return this.x-Math.abs(this.width)/2}}]),i}(d.b),b=function(t){Object(y.a)(i,t);var e=Object(w.a)(i);function i(t){var n;return Object(h.a)(this,i),(n=e.call(this,t))._clips={},n._currentClip=void 0,n._resources=t,n}return Object(l.a)(i,[{key:"_setIsFacingRight",value:function(t){this._isFacingRight=t,this._adaptScaleBasedOnOrientation()}},{key:"animate",value:function(t){}},{key:"_playClip",value:function(t,e,i){var n=this;return this._currentClip&&(this.removeChild(this._currentClip),this._currentClip=void 0),new Promise((function(s,a){var o=n._clips[t];if(!o){var r="AnimationBase: failed to load clip: "+t;console.log(r,n._clips),a(r)}o.zIndex=1,n.addChild(o),n._currentClip=o,n._adaptScaleBasedOnOrientation(),n._currentClip.loop=e,n._currentClip.gotoAndPlay(0),n.children.sort((function(t,e){return t.zIndex-e.zIndex})),e||(o.onComplete=function(){o.stop(),i||n.removeChild(o),s()})}))}}]),i}(m),k=function(t){Object(y.a)(i,t);var e=Object(w.a)(i);function i(t,n){var s;Object(h.a)(this,i);var a=(s=e.call(this,t))._resources["things.decals"],o=new d.g(a.textures[n]);return s.addChild(o),s}return i}(b),x=i(18),C=function(){function t(){Object(h.a)(this,t)}return Object(l.a)(t,null,[{key:"loadClip",value:function(t,e,i,n){var s=[];for(var a in t[e].textures){var o=t[e].textures[a];s.push(o)}var r=new d.a(s);return r.animationSpeed=i,r.scale.x=n,r.scale.y=n,r.anchor.x=.5,r}}]),t}(),O=function(){function t(){Object(h.a)(this,t)}return Object(l.a)(t,null,[{key:"init",value:function(e){return t._events=e,t.scanGamepads(),t._gamepads[0]||null}},{key:"connectHandler",value:function(e){console.log("gamepad connected"),t.addGamepad(e.gamepad)}},{key:"addGamepad",value:function(e){console.log("adding gamepad",e),t._gamepads[e.index]=e,t._state[e.index]={}}},{key:"disconnectHandler",value:function(e){console.log("gamepad disconnected"),t.removeGamepad(e.gamepad)}},{key:"removeGamepad",value:function(e){console.log("removing gamepad"),delete t._gamepads[e.index],delete t._state[e.index]}},{key:"updateStatus",value:function(){for(var e in t.scanGamepads(),t._gamepads)if(t._gamepads.hasOwnProperty(e)){var i=t._gamepads[e];if(i.axes,i.buttons)for(var n in i.buttons)if(i.buttons.hasOwnProperty(n)){var s=i.buttons[n];t._state[e][n]=t._state[e][n]||{},t._events[e][n]=t._events[e][n]||{};var a=t._state[e][n],o=t._events[e][n];s.pressed&&!a.isPressed&&(console.log("button pressed",e,n),a.isPressed=!0,o.pressEvent&&o.pressEvent()),!s.pressed&&a.isPressed&&(console.log("button released",e,n),a.isPressed=!1,o.releaseEvent&&o.releaseEvent())}}}},{key:"scanGamepads",value:function(){var e,i=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],n=Object(u.a)(i);try{for(n.s();!(e=n.n()).done;){var s=e.value;if(s){var a=s.index;a in t._gamepads?t._gamepads[a]=s:(console.log("found new gamepad during scan, adding",a),t.addGamepad(s))}}}catch(o){n.e(o)}finally{n.f()}}}]),t}();O._gamepads={},O._state={},O._events={},window.addEventListener("gamepadconnected",O.connectHandler),window.addEventListener("gamepaddisconnected",O.disconnectHandler);var j=function(){function t(e,i){Object(h.a)(this,t),this._key=e,this._ignoreKeyup=i,this._isDown=!1,this._isUp=!0,this.pressEvent=null,this.releaseEvent=null,window.addEventListener("keydown",this._downHandler.bind(this),!1),window.addEventListener("keyup",this._upHandler.bind(this),!1)}return Object(l.a)(t,[{key:"_downHandler",value:function(t){t.key===this._key&&(t.preventDefault(),this._isUp&&this.pressEvent&&this.pressEvent(),this._isDown=!0,this._isUp=!1)}},{key:"_upHandler",value:function(t){t.key===this._key&&(t.preventDefault(),this._isDown&&this.releaseEvent&&this.releaseEvent(),this._isDown=!1,this._isUp=!0)}},{key:"isDown",get:function(){return this._isDown}}]),t}(),S=function(){function t(){Object(h.a)(this,t)}return Object(l.a)(t,null,[{key:"getRandomInt",value:function(t,e){return Math.floor(Math.random()*(e-t))+t}},{key:"angleBetweenRad",value:function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)}},{key:"distanceTo",value:function(e,i){return Math.sqrt(t.distanceToSq(e,i))}},{key:"distanceToSq",value:function(t,e){var i=t.x-e.x,n=t.y-e.y;return i*i+n*n}}]),t}(),R={idle:Symbol.for("Idle"),walking:Symbol.for("Walking"),fire:Symbol.for("Fire"),died:Symbol.for("Died")},E=(Symbol.for("Head"),Symbol.for("Feet"),Symbol.for("Front"),Symbol.for("Back"),function(t){Object(y.a)(i,t);var e=Object(w.a)(i);function i(t,n){var s;Object(h.a)(this,i);var a="things.door";return(s=e.call(this,t))._clips=Object(x.a)({},a,C.loadClip(s._resources,a,.01,8)),s._clips[a].filters=[new d.l.BlurFilter(.2)],s._playClip(a,!1,!1).then((function(){n&&n()})),s}return i}(b)),L=function(t){Object(y.a)(i,t);var e=Object(w.a)(i);function i(t){var n;return Object(h.a)(this,i),(n=e.call(this,t)).addChild(new d.h("x",{fill:"#fff"})),n}return i}(m),M=function(t){Object(y.a)(i,t);var e=Object(w.a)(i);function i(t){var n,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01;Object(h.a)(this,i);var a="things.blood";return(n=e.call(this,t))._clips=Object(x.a)({},a,C.loadClip(n._resources,a,s,1)),n._playClip(a,!1,!1),n}return i}(b),F=function(t){Object(y.a)(i,t);var e=Object(w.a)(i);function i(t,n,s){var a;Object(h.a)(this,i),(a=e.call(this,t))._isFacingRight=!0,a.height=s,a.width=n;var o=new d.g(g?d.i.WHITE:d.i.EMPTY);return o.width=n,o.height=s,g&&(o.tint=16711680),a.addChild(o),a}return i}(m);d.m.SCALE_MODE=d.f.NEAREST;var B=function(t){Object(y.a)(i,t);var e=Object(w.a)(i);function i(t,n,s,a){var o;Object(h.a)(this,i),o=e.call(this,t);var r=new d.h(n,{fontSize:"12px",fill:"#fff"}),l=new d.g(d.i.WHITE);return l.width=r.width,l.height=r.height,l.tint=0,o.addChild(l),o.addChild(r),setTimeout((function(){a()}),1e3*s),o}return i}(b),H=function(t){Object(y.a)(i,t);var e=Object(w.a)(i);function i(t,n,s){var a;return Object(h.a)(this,i),(a=e.call(this,t))._text=void 0,a._lastFlip=0,a._skin=void 0,a._speed=1,a._health=100,a._power=12,a._state=R.idle,a._canGetHitAgain=!0,a._skin=n,a._speed=s,a}return Object(l.a)(i,[{key:"_setState",value:function(t){console.log(this.constructor.name,"New state:",t),this._state=t}},{key:"_idle",value:function(){this._state!==R.died&&(this._setState(R.idle),this._playClip(this._skin+".stance",!0))}},{key:"_died",value:function(){this._setState(R.died),this._vy=0,this._vx=0,this._vr=0,this._playClip(this._skin+".died",!1,!0)}},{key:"hitBy",value:function(t){var e=this,i=!1,n=!1;return this._canGetHitAgain&&(this._health-=t.power,n=!0,this._canGetHitAgain=!1,this._health<0?(this._health=0,i=!0,this._died()):(this._vx=t._isFacingRight?5:-5,this._playClip(this._skin+".gothit",!1).then((function(){e._vx=0,e._canGetHitAgain=!0,e._idle()})))),{died:i,objectTookDamage:n}}},{key:"flip",value:function(t){this._setIsFacingRight(void 0!==t?t:!this._isFacingRight)}},{key:"moveTowards",value:function(t){var e=0,i=0;if(S.distanceTo(this.position,t)>1){var n=S.angleBetweenRad(this.position,t);i=Math.sin(n)*this._speed,((e=Math.cos(n)*this._speed)>0&&!this._isFacingRight&&this._canFlipAgain()||e<0&&this._isFacingRight&&this._canFlipAgain())&&this.flip()}this._vy=i,this._vx=e}},{key:"_canFlipAgain",value:function(){var t=!0;return Date.now()-this._lastFlip>200&&(t=!0,this._lastFlip=Date.now()),t}},{key:"_logActorCoordinates",value:function(){v&&console.log("x",this.x,"real x",this.realx,"y",this.y,"width",this.width,"height",this.height)}},{key:"moved",value:function(){this._logActorCoordinates(),this._text&&(this._text.x=this.x-this._text.width/2,this._text.y=this.y-25)}},{key:"speak",value:function(t){var e=this;this._text||(this._text=new B(this._resources,t,3,(function(){e.parent.removeChild(e._text),delete e._text})),this._text.zIndex=80,this._text.x=this.x-this._text.width/2,this._text.y=this.y-25,this.parent.addChild(this._text))}},{key:"move",value:function(t,e){return!1}},{key:"power",get:function(){return this._power}},{key:"health",get:function(){return this._health}},{key:"state",get:function(){return this._state}}]),i}(b),G=i(19),T=i(14),I=function(t){Object(y.a)(i,t);var e=Object(w.a)(i);function i(t,n,s){var a;return Object(h.a)(this,i),(a=e.call(this,t))._reloadTime=void 0,a._isReloading=!1,a._power=void 0,a._maxRounds=void 0,a._rounds=void 0,a._sprite=void 0,a._roundsSprite=void 0,a._power=n,a._rounds=s,a._maxRounds=s,a._reloadTime=5,a.zIndex=100,a.x=-5,a.y=20,a}return Object(l.a)(i,[{key:"rounds",get:function(){return this._rounds}},{key:"sprite",get:function(){return this._sprite}},{key:"roundsSprite",get:function(){return this._roundsSprite}},{key:"isReloading",get:function(){return this._isReloading}}]),Object(l.a)(i,[{key:"fire",value:function(){if(this._rounds>0&&!this._isReloading){var t=new M(this._resources,2);return t.x=80,this.addChild(t),this._rounds--,!0}return!1}},{key:"reload",value:function(){var t=this;return this._isReloading=!0,setTimeout((function(){t._rounds=t._maxRounds,t._isReloading=!1}),1e3*this._reloadTime),console.log("reload"),!0}}]),i}(m),D=function(t){Object(y.a)(i,t);var e=Object(w.a)(i);function i(t){var n;Object(h.a)(this,i),n=e.call(this,t,55,6);var s=t["weapons.shotgun"];return n._roundsSprite=new d.g(s.textures["shell.png"]),n._sprite=new d.g(s.textures["shotgun.png"]),n._sprite.scale.x=.1,n._sprite.scale.y=.1,n.addChild(n._sprite),n}return i}(I),A=function(t){Object(y.a)(i,t);var e=Object(w.a)(i);function i(t){var n;Object(h.a)(this,i),n=e.call(this,t,55,8);var s=t["weapons.beretta"];return n._sprite=new d.g(s.textures["beretta.png"]),n._sprite.scale.x=.1,n._sprite.scale.y=.1,n.addChild(n._sprite),n._roundsSprite=new d.g(s.textures["shell.png"]),n}return i}(I),W={},z=function(t){Object(y.a)(i,t);var e=Object(w.a)(i);function i(t,n){var s;return Object(h.a)(this,i),(s=e.call(this,t,n,3))._weapon=void 0,s._name="Gordon",s._baseScale=1.1,s._health=77,s._clips[s._skin+".stance"]=C.loadClip(s._resources,s._skin+".stance",.1,1),s._clips[s._skin+".walk"]=C.loadClip(s._resources,s._skin+".walk",.2,1),s._clips[s._skin+".punch"]=C.loadClip(s._resources,s._skin+".punch",.3,1),s._clips[s._skin+".kick"]=C.loadClip(s._resources,s._skin+".kick",.2,1),s._clips[s._skin+".gothit"]=C.loadClip(s._resources,s._skin+".gothit",.2,1),s._clips[s._skin+".died"]=C.loadClip(s._resources,s._skin+".died",.2,1),W.shotgun=new D(t),W.beretta=new A(t),s._weapon=W.beretta,s.addChild(s._weapon),s._idle(),s}return Object(l.a)(i,[{key:"weapon",get:function(){return this._weapon}},{key:"name",get:function(){return this._name}}]),Object(l.a)(i,[{key:"reload",value:function(){this._weapon.reload()}},{key:"switchWeapon",value:function(){this.weapon.isReloading||(this.removeChild(this._weapon),this._weapon instanceof D?this._weapon=W.beretta:this._weapon=W.shotgun,this.addChild(this._weapon))}},{key:"updateCrosshairPosition",value:function(t){var e=this._isFacingRight?S.angleBetweenRad(this.weaponLocation,t):-S.angleBetweenRad(t,this.weaponLocation);this._weapon.rotation=e}},{key:"_canBeControlled",value:function(){return this._state===R.died?(console.log("Cant be controlled, player is dead"),!1):this._state===R.idle||this._state===R.walking}},{key:"_died",value:function(){Object(G.a)(Object(T.a)(i.prototype),"_died",this).call(this),this.y+=this.height/2,this.height=this.height/2}},{key:"fire",value:function(){var t=this;if(!this._canBeControlled())return!1;var e=this._weapon.fire();return e?(this.speak("P\xe4ng!"),this._setState(R.fire),this._vx=0,this._vy=0,this._playClip(this._skin+".punch",!1).then((function(){t._idle()})),!0):(this._idle(),!1)}},{key:"moveRight",value:function(){this._canBeControlled()&&(this._vx=this._speed,this._playClip(this._skin+".walk",!0),this._setState(R.walking))}},{key:"moveLeft",value:function(){this._canBeControlled()&&(this._vx=-this._speed,this._playClip(this._skin+".walk",!0),this._setState(R.walking),this._adaptScaleBasedOnOrientation())}},{key:"stopMoveHorizontally",value:function(){this._vx=0,0===this._vy&&this._canBeControlled()&&this._idle()}},{key:"moveUp",value:function(){this._canBeControlled()&&(this._vy=-this._speed,this._playClip(this._skin+".walk",!0),this._setState(R.walking))}},{key:"moveDown",value:function(){this._canBeControlled()&&(this._vy=this._speed,this._playClip(this._skin+".walk",!0),this._setState(R.walking))}},{key:"stopMoveVertically",value:function(){this._vy=0,0===this._vx&&this._canBeControlled()&&this._idle()}},{key:"speak",value:function(t){Object(G.a)(Object(T.a)(i.prototype),"speak",this).call(this,"".concat(this._name,": ").concat(t))}},{key:"move",value:function(t,e){var i=!1;return 0!==this.vy&&this.y+this.vy>0&&this.y+this.height+this.vy<t&&(this.y+=this.vy,i=!0),this.vx>0?this.realx+Math.abs(this.width)+7+this.vx<e&&(this.x+=this.vx,i=!0):this.vx<0&&this.realx+this.vx>=0&&(this.x+=this.vx,i=!0),i&&(this.adaptScale(this.y,t),this.moved()),i}},{key:"weaponLocation",get:function(){return this.toGlobal(this._weapon.position)}}]),i}(H),P=function(t){Object(y.a)(i,t);var e=Object(w.a)(i);function i(t,n){return Object(h.a)(this,i),e.call(this,t,n,1)}return i}(function(t){Object(y.a)(i,t);var e=Object(w.a)(i);function i(t,n){var s,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return Object(h.a)(this,i),(s=e.call(this,t,n,a))._isFacingRight=!1,s._clips[s._skin+".walk"]=C.loadClip(s._resources,s._skin+".walk",.2,1),s._clips[s._skin+".gothit"]=s._clips[s._skin+".walk"],s._clips[s._skin+".died"]=s._clips[s._skin+".walk"],s._idle(),s}return Object(l.a)(i,[{key:"_idle",value:function(){this._setState(R.idle),this._playClip(this._skin+".walk",!0)}},{key:"_died",value:function(){var t=this;Object(G.a)(Object(T.a)(i.prototype),"_died",this).call(this),this.y+=this.height/2,this.pivot.set(Math.abs(this.width)/2,this.height),this.rotation=90*Math.PI/180,setTimeout((function(){t.parent.removeChild(t)}),1e4)}},{key:"move",value:function(t,e){var i=!1;return 0===this.vx&&0===this.vy&&0===this.vr||(this.x+=this.vx,this.y+=this.vy,this.rotation+=this.vr,i=!0,this.adaptScale(this.y,t)),i}}]),i}(H)),U=function(t){Object(y.a)(i,t);var e=Object(w.a)(i);function i(t,n){var s;Object(h.a)(this,i),(s=e.call(this,t,n))._baseScale=2.5;var a=new d.l.ColorMatrixFilter;return a.lsd(!1),s.filters=[a],s.scale.x=s._baseScale,s.scale.y=s._baseScale,s}return i}(P),V=function(t){Object(y.a)(i,t);var e=Object(w.a)(i);function i(t,n,s){var a;return Object(h.a)(this,i),(a=e.call(this,t))._width=n,a._explorationOffset=void 0,a._textures=void 0,a._backgroundContainer=void 0,a._actorContainer=void 0,a._foregroundContainer=void 0,a._explorationOffset=a._width/3,s&&(a._textures=t[s].textures),a._backgroundContainer=new d.b,a.addChild(a._backgroundContainer),a._actorContainer=new d.b,a.addChild(a._actorContainer),a._foregroundContainer=new d.b,a.addChild(a._foregroundContainer),a}return Object(l.a)(i,[{key:"_setup",value:function(){}},{key:"shallScroll",value:function(t,e){(e>0&&t+this._explorationOffset>this._width||e<0&&t-this._explorationOffset<this._explorationOffset)&&(this.x-=e,this.x>0&&(this.x=0),this.x<this._width-this.width&&(this.x=this._width-this.width))}},{key:"actorContainer",get:function(){return this._actorContainer}},{key:"backgroundContainer",get:function(){return this._backgroundContainer}}]),i}(b),q=i(27).default.Sound,K=function(t){Object(y.a)(i,t);var e=Object(w.a)(i);function i(t,n){var s;Object(h.a)(this,i),s=e.call(this,t,n,"maps.maension");var a=new d.g(s._textures["tumblr_inline_n258q4r8c01qhwjx8.png"]);a.scale.x=2.56,a.scale.y=2.56,s._backgroundContainer.addChild(a);var o=new d.g(s._textures["Maension_WIP.png"]);o.y=-40,o.scale.x=2,o.scale.y=2,s._backgroundContainer.addChild(o);var r=s._textures["tree.png"],l=new d.g(r);l.x=100,l.y=350,l.scale.x=.4,l.scale.y=.4,s._actorContainer.addChild(l);var u=s._textures["tree_dead.png"],c=new d.g(u);return c.x=50,c.y=180,c.scale.x=.4,c.scale.y=.4,s._backgroundContainer.addChild(c),s._setup(),s}return Object(l.a)(i,[{key:"_setup",value:function(){var t=q.from("assets/sounds/zombie1.mp3"),e=q.from("assets/sounds/zombie1.mp3");setInterval((function(){t.play()}),15e3),setInterval((function(){e.play()}),8e3)}}]),i}(V),N=i(27).default.Sound,J=function(t){Object(y.a)(i,t);var e=Object(w.a)(i);function i(t,n){var s;return Object(h.a)(this,i),(s=e.call(this,t,n,"maps.house"))._setup(),s}return Object(l.a)(i,[{key:"_setup",value:function(){var t=new d.g(this._textures["house.png"]);t.scale.x=1.3,t.scale.y=1.3,this._backgroundContainer.addChild(t);var e=N.from("assets/sounds/zombie1.mp3"),i=N.from("assets/sounds/zombie1.mp3");setInterval((function(){e.play()}),15e3),setInterval((function(){i.play()}),8e3)}}]),i}(V),Y=function(t){Object(y.a)(i,t);var e=Object(w.a)(i);function i(t,n){var s;return Object(h.a)(this,i),(s=e.call(this,t,n,"maps.street"))._setup(),s}return Object(l.a)(i,[{key:"_setup",value:function(){var t=new d.g(this._textures["city01.png"]),e=t.width;t.scale.x=2,t.scale.y=2.1,t.y=-100;var i=new d.j(this._textures["concret.png"]);i.width=e,i.height=300,i.scale.x=2,i.scale.y=1.44,i.y=330,this._backgroundContainer.addChild(i),this._backgroundContainer.addChild(t);var n=new d.g(this._textures["police.png"]);n.scale.x=2,n.scale.y=2,n.y=this.height-2*n.height,n.x=300,this._foregroundContainer.addChild(n)}}]),i}(V),$=function(t){Object(y.a)(i,t);var e=Object(w.a)(i);function i(t,n,s){var a;Object(h.a)(this,i),(a=e.call(this,t,n))._door=void 0;var o=new d.g(d.i.WHITE);return a._door=new E(t,s),a._door.x=n/2,a._door.y=30,o.width=n,o.height=800,o.tint=0,a._backgroundContainer.addChild(o),a._setup(),a}return Object(l.a)(i,[{key:"_setup",value:function(){this._foregroundContainer.addChild(this._door)}},{key:"animate",value:function(t){this._door.y+=t/100;var e=this._door.scale.x+t/2e4;this._door.scale.x=e,this._door.scale.y=e}}]),i}(V),Q=i(17),X=function(t){Object(y.a)(i,t);var e=Object(w.a)(i);function i(t,n,s,a){var o;Object(h.a)(this,i),(o=e.call(this,t))._player=void 0,o._health=void 0,o._rounds=void 0,o._weapon=void 0,o._gameOverSign=void 0,o._width=void 0,o._height=void 0;var r=t["things.hud"];o._width=s,o._height=a,console.log("Setting up HUD","width:",o._width,"height:",o._height),o._player=n;var l=Object(Q.a)(Object(Q.a)({},i.bigText),{},{fontSize:"12px"}),u=new d.h(n.name,Object(Q.a)(Object(Q.a)({},l),{},{fill:"#ffff30"}));u.x=o._width/3-u.width/2,u.y=o._height-47,o.addChild(u),o._health=new d.h("",l),o._health.x=u.x,o._health.y=o._height-23,o.addChild(o._health),o._rounds=new d.b,o._rounds.x=o._width/3+77,o._rounds.y=o._height-33,o.addChild(o._rounds);var c=new d.g(r.textures["side.png"]);c.x=o._width/2-(c.width+c.width/2)+2,c.y=o._height-c.height-2,o.addChild(c);var _=new d.g(r.textures["center.png"]);_.x=o._width/2-_.width/2+1,_.y=o._height-_.height-2,o.addChild(_);var p=new d.g(r.textures["side.png"]);return p.x=o._width/2+(_.width+p.width/2)-2,p.y=o._height-p.height-2,p.scale.x=-1,o.addChild(p),o.update(),o}return Object(l.a)(i,[{key:"_renderWeapon",value:function(){this.removeChild(this._weapon),this._weapon=new d.g(this._player.weapon.sprite.texture),this._weapon.scale.x=2*this._player.weapon.sprite.scale.x,this._weapon.scale.y=2*this._player.weapon.sprite.scale.y,this._weapon.x=this._width/2+(this._weapon.width+27),this._weapon.y=this._height-40,this.addChild(this._weapon)}},{key:"_renderRounds",value:function(){this._rounds.removeChildren();for(var t=0;t<this._player.weapon.rounds;t++){var e,i=new d.g(null===(e=this._player.weapon.roundsSprite)||void 0===e?void 0:e.texture);i.scale.x=.1,i.scale.y=.1,i.x=10*t,i.y=10,this._rounds.addChild(i)}}},{key:"update",value:function(){this._health.text=this._player.health+" HP",this._renderRounds(),this._renderWeapon()}},{key:"renderGameOver",value:function(){this._gameOverSign=new d.h("Game Over\nPress Enter to retry!",Object(Q.a)(Object(Q.a)({},i.bigText),{},{fill:"#f00"})),this.addChild(this._gameOverSign),this._gameOverSign.x=this._width/2-this._gameOverSign.width/2,this._gameOverSign.y=this._height/2-this._gameOverSign.height/2}},{key:"animate",value:function(t){this._gameOverSign&&(this._gameOverSign.alpha+=t/1e3,this._gameOverSign.alpha>1&&(this._gameOverSign.alpha=.2))}}]),i}(b);X.bigText={fontFamily:"Arial Black",fontSize:"48px",fontWeight:"bold",fill:"#fff",dropShadow:!0,dropShadowColor:"#000",align:"center"};var Z={},tt=function(){function t(e,i,n,s){Object(h.a)(this,t),this._stage=void 0,this._hud=void 0,this._map=void 0,this._player=void 0,this._beacon=void 0,this._enemies=[],this._mouseLocation=void 0,this._isRunning=!0,this._startOffset=void 0,this._elapsedSeconds=0,this._resources=void 0,this._width=void 0,this._height=void 0,this._mouseLine=void 0,this._crosshair=void 0,this._stage=i,this._resources=e,this._width=n,this._height=s,Z.street=new Y(this._resources,this._width),Z.house=new J(this._resources,this._width),Z.maension=new K(this._resources,this._width),Z.loading=new $(this._resources,this._width),this._init()}return Object(l.a)(t,[{key:"_init",value:function(){this._mouseLine=new d.c,this._crosshair=new L(this._resources),this._map=Z.maension,this._stage.addChild(this._map),this._stage.cursor="none",this._player=new z(this._resources,"ryu"),this._player.x=60,this._player.y=400,this._player.adaptScale(this._player.y,this._height),this._crosshair.adaptScale(this._player.y,this._height),this._map.actorContainer.addChild(this._player),this._beacon=new F(this._resources,80,5);var t=new P(this._resources,"bat"),e=new U(this._resources,"bat");this._beacon.position.x=580,this._beacon.position.y=250,t.position.x=920,t.position.y=220,e.position.x=880,e.position.y=240,this._map.actorContainer.addChild(this._beacon),this._map.actorContainer.addChild(t),this._map.actorContainer.addChild(e),this._attachGamepad()||(console.log("no gamepad, attaching stinky keyboard"),this._attachKeyboard()),this._enemies=[],this._hud=new X(this._resources,this._player,this._width,this._height),this._stage.addChild(this._hud),this._updateHud(),this._attachMouse(),this._updateMouseLocation(new d.e(this._width/2,this._height/2)),this._startOffset=void 0,this._isRunning=!0,console.log("Game:","Game init done!")}},{key:"_attachMouse",value:function(){var t=this;this._stage.addChild(this._mouseLine),this._stage.addChild(this._crosshair),this._stage.interactive=!0,this._stage.on("mousemove",(function(e){t._updateMouseLocation(e.data.global)})),this._stage.on("mousedown",(function(){return t._fire()})),this._stage.on("mouseout",(function(){return t._isRunning=!1})),this._stage.on("mouseover",(function(){return t._isRunning=t._player.state!==R.died}))}},{key:"_updateCrosshair",value:function(){var t,e;this._mouseLocation&&this._isRunning&&(null===(t=this._player)||void 0===t?void 0:t.state)!==R.died&&(this._crosshair.x=this._mouseLocation.x-this._crosshair.width/2,this._crosshair.y=this._mouseLocation.y-this._crosshair.height/2,this._crosshair.x<this._player.toGlobal(this._stage).x?this._player.flip(!1):this._player.flip(!0),this._player.updateCrosshairPosition(this._stage.toGlobal(null===(e=this._crosshair)||void 0===e?void 0:e.position)),this._crosshair.adaptScale(this._player.y,this._height))}},{key:"_fire",value:function(){var t;if(this._isRunning&&(null===(t=this._player)||void 0===t?void 0:t.fire())){var e,i=new k(this._resources,"impact.png");i.scale.x=.1,i.scale.y=.1;var n=this._map.toLocal(this._crosshair);i.x=n.x+this._crosshair.width/2-i.width/2,i.y=n.y+this._crosshair.height/2-i.height/2,null===(e=this._map)||void 0===e||e.backgroundContainer.addChild(i),this._updateHud()}}},{key:"_moveRight",value:function(){this._isRunning&&this._player&&this._player.moveRight()}},{key:"_moveLeft",value:function(){this._isRunning&&this._player&&this._player.moveLeft()}},{key:"_moveUp",value:function(){this._isRunning&&this._player&&this._player.moveUp()}},{key:"_moveDown",value:function(){this._isRunning&&this._player&&this._player.moveDown()}},{key:"_stopMoveVertically",value:function(){var t;this._isRunning&&(null===(t=this._player)||void 0===t||t.stopMoveVertically())}},{key:"_stopMoveHorizontally",value:function(){var t;this._isRunning&&(null===(t=this._player)||void 0===t||t.stopMoveHorizontally())}},{key:"_attachKeyboard",value:function(){var t=this,e=new j("ArrowLeft",!0),i=new j("ArrowUp",!0),n=new j("ArrowRight",!0),s=new j("ArrowDown",!0),a=new j("k",!1),o=new j("w",!1),r=new j("r",!1),h=new j("Enter",!1);a.pressEvent=function(){return t._fire()},o.pressEvent=function(){return t._switchWeapon()},r.pressEvent=function(){return t._reload()},n.pressEvent=function(){return t._moveRight()},n.releaseEvent=function(){e.isDown||t._stopMoveHorizontally()},e.pressEvent=function(){return t._moveLeft()},e.releaseEvent=function(){n.isDown||t._stopMoveHorizontally()},i.pressEvent=function(){return t._moveUp()},i.releaseEvent=function(){s.isDown||t._stopMoveVertically()},s.pressEvent=function(){return t._moveDown()},s.releaseEvent=function(){i.isDown||t._stopMoveVertically()},h.pressEvent=function(){t._isRunning||t._init()}}},{key:"_attachGamepad",value:function(){var t=this;return!!O.init({0:{1:{pressEvent:function(){t._fire()}},15:{pressEvent:function(){return t._moveRight()},releaseEvent:function(){return t._stopMoveHorizontally()}},14:{pressEvent:function(){return t._moveLeft()},releaseEvent:function(){return t._stopMoveHorizontally()}},12:{pressEvent:function(){return t._moveUp()},releaseEvent:function(){return t._stopMoveVertically()}},13:{pressEvent:function(){return t._moveDown()},releaseEvent:function(){return t._stopMoveVertically()}},9:{pressEvent:function(){t._isRunning||t._init()}}}})}},{key:"_end",value:function(){this._isRunning=!1,this._hud.renderGameOver()}},{key:"_detectCollisions",value:function(){var t=this;this._player.collides(this._beacon)&&this._player.speak("It's locked!"),this._crosshair.collides(this._beacon)&&(this._beacon=new F(this._resources,this._height,this._width),this._stage.removeChild(this._map),this._map=new $(this._resources,this._width,(function(){t._map=new K(t._resources,t._width)})),this._stage.addChild(this._map));var e,i=Object(u.a)(this._enemies);try{for(i.s();!(e=i.n()).done;){var n=e.value;if(R.died!==n.state&&R.died!==this._player.state&&this._player.collides(n)){var s=this._player.hitBy(n);s.objectTookDamage&&(this._drawBlood(this._player),this._updateHud()),s.died&&this._end()}}}catch(a){i.e(a)}finally{i.f()}}},{key:"_drawBlood",value:function(t){for(var e=0;e<5;e++){var i,n=new M(this._resources);n.x=t.x+S.getRandomInt(-20,20),n.y=t.y+t.height+S.getRandomInt(-20,20),n.rotation=S.getRandomInt(0,10),null===(i=this._map)||void 0===i||i.backgroundContainer.addChild(n)}}},{key:"_updateHud",value:function(){this._hud.update()}},{key:"_updateKI",value:function(){var t,e=Object(u.a)(this._enemies);try{for(e.s();!(t=e.n()).done;){var i=t.value;R.died!==i.state&&i.moveTowards(this._player.position)}}catch(n){e.e(n)}finally{e.f()}}},{key:"_moveActors",value:function(){var t,e=this._player;e.move(this._height,this._map.width)&&(null===(t=this._map)||void 0===t||t.shallScroll(e.realx,e.vx),this._updateCrosshair());var i,n=Object(u.a)(this._enemies);try{for(n.s();!(i=n.n()).done;){i.value.move(this._height,this._map.width)}}catch(s){n.e(s)}finally{n.f()}}},{key:"_outlineMouse",value:function(){if(this._mouseLine&&this._mouseLocation&&this._player&&this._map){this._mouseLine.clear(),this._mouseLine.lineStyle(1,16777215),this._mouseLine.position=this._player.weaponLocation;var t=this._mouseLine.toLocal(this._mouseLocation),e=t.x,i=t.y;this._mouseLine.lineTo(e,i),this._mouseLine.endFill()}}},{key:"_switchWeapon",value:function(){this._isRunning&&(this._player.switchWeapon(),this._updateHud())}},{key:"_reload",value:function(){this._isRunning&&(this._player.reload(),this._updateHud())}},{key:"_updateMouseLocation",value:function(t){this._isRunning&&(this._mouseLocation=t,this._updateCrosshair())}},{key:"update",value:function(e,i){if(O.updateStatus(),this._hud.animate(i),this._isRunning){var n;this._map.animate(i);var s=parseInt((e/1e3).toString());this._startOffset||(this._startOffset=s);var a=s-this._startOffset;a!==this._elapsedSeconds&&(this._elapsedSeconds=a,this._updateHud()),t.timeout-a<=0&&(console.log("Time is up, dude!"),this._end()),this._detectCollisions(),this._updateKI(),this._moveActors();if(null===(n=this._map)||void 0===n||n.actorContainer.children.sort((function(t,e){var i=t.getBounds(),n=e.getBounds();return t.y+i.height<e.y+n.height-5?-1:t.y+i.height>e.y+n.height-5?1:0})),c){this._player.outline(),this._beacon.outline(),this._crosshair.outline();var o,r=Object(u.a)(this._enemies);try{for(r.s();!(o=r.n()).done;){o.value.outline()}}catch(h){r.e(h)}finally{r.f()}this._outlineMouse()}}}}]),t}();tt.timeout=300;var et=function(){function t(e){Object(h.a)(this,t),this._lastFrame=0,this._fpsCount=0,this._fpsTimer=0,this._game=void 0,this._renderer=void 0,this._stage=void 0,this._stageWrapper=void 0,this._fps=void 0,this._renderer=d.k({width:800,height:600,backgroundColor:1087931}),e.appendChild(this._renderer.view),console.log("Viewport",window.innerWidth,window.innerHeight),this._stage=new d.b,this._stageWrapper=new d.b,this._stageWrapper.addChild(this._stage),p&&(this._fps=new d.h("FPS: ",{fontWeight:"16px",fill:"#fff"}),this._fps.x=10,this._fps.y=10,this._stageWrapper.addChild(this._fps)),this._animate.bind(this),this._assetsLoaded.bind(this)}return Object(l.a)(t,[{key:"run",value:function(){var t={crossOrigin:!0},e=new d.d;e.add("maps.house","assets/maps/house.json",t),e.add("maps.street","assets/maps/street.json",t),e.add("maps.maension","assets/maps/maension.json",t),e.add("ryu.stance","assets/ryu/stance.json",t),e.add("ryu.punch","assets/ryu/punch.json",t),e.add("ryu.kick","assets/ryu/kick.json",t),e.add("ryu.walk","assets/ryu/walk.json",t),e.add("ryu.gothit","assets/ryu/gothit.json",t),e.add("ryu.died","assets/ryu/died.json",t),e.add("bat.walk","assets/enemys/bat/walk.json",t),e.add("weapons.shotgun","assets/weapons/shotgun.json",t),e.add("weapons.beretta","assets/weapons/beretta.json",t),e.add("things.blood","assets/things/blood.json",t),e.add("things.door","assets/things/door.json",t),e.add("things.hud","assets/things/hud.json",t),e.add("things.decals","assets/things/decals.json",t),e.onComplete.once(this._assetsLoaded.bind(this)),e.load()}},{key:"_assetsLoaded",value:function(t,e){this._game=new tt(e,this._stage,this._renderer.width,this._renderer.height),console.log("M\xe4nsion:","Init done, ready to scare!"),requestAnimationFrame(this._animate.bind(this))}},{key:"_animate",value:function(t){var e=t-this._lastFrame;this._lastFrame=t,this._fps&&(this._fpsCount++,this._fpsTimer+=e,this._fpsTimer>1e3&&(this._fps.text="FPS: "+this._fpsCount,this._fpsCount=0,this._fpsTimer=0)),this._game&&this._game.update(t,e),this._renderer.render(this._stageWrapper),requestAnimationFrame(this._animate.bind(this))}}]),t}();function it(){var t=Object(n.useRef)(null),e=Object(n.useState)(),i=Object(r.a)(e,2),a=i[0],o=i[1];return Object(n.useEffect)((function(){if(!a&&t.current){var e=new et(t.current);e.run(),o(e)}}),[t,a]),s.a.createElement("div",{className:"maension"},s.a.createElement("h1",null,"M\xe4nsion"),s.a.createElement("div",{ref:t}),s.a.createElement("div",null,s.a.createElement("div",null,"Donate"),s.a.createElement("div",null,"Patreon")))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(it,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[31,1,2]]]);
//# sourceMappingURL=main.05ea219b.chunk.js.map