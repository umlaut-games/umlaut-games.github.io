{"version":3,"sources":["game/config.ts","game/objects/object-base.ts","game/objects/animation-base.ts","game/tools/animation-helper.ts","game/tools/gamepads.ts","game/tools/keyboard.ts","game/tools/math-helper.ts","game/tools/enums.ts","game/objects/door.ts","game/objects/crosshair.ts","game/objects/blood.ts","game/actors/actor-base.ts","game/objects/weapons/weapon-base.ts","game/objects/weapons/shotgun.ts","game/objects/weapons/beretta.ts","game/actors/player.ts","game/actors/enemies/bat.ts","game/actors/enemies/enemy-base.ts","game/actors/enemies/bat.infected.ts","game/maps/map-base.ts","game/maps/maension-outside.ts","game/maps/house-outside.ts","game/maps/street.ts","game/maps/loading.ts","game/ui/hud.ts","game/game.ts","game/maension.ts","Maension.tsx","serviceWorker.ts","index.tsx"],"names":["Config","ObjectBase","resources","_resources","_isFacingRight","_vx","_vy","_vr","actor","collides","x","this","realx","Math","abs","width","y","height","PIXI","AnimationBase","_clips","_currentClip","isFacingRight","_setOrientation","scale","which","loop","dontRemove","removeChild","undefined","Promise","resolve","reject","clipToPlay","err","console","log","zIndex","addChild","gotoAndPlay","children","sort","a","b","onComplete","stop","AnimationHelper","speed","frames","textureId","textures","texture","push","clip","animationSpeed","anchor","outline","lineStyle","drawRect","pivot","endFill","Gamepads","events","_events","scanGamepads","_gamepads","e","addGamepad","gamepad","index","_state","removeGamepad","j","buttons","i","button","pressed","isPressed","pressEvent","releaseEvent","gamepads","navigator","getGamepads","webkitGetGamepads","gamepadIndex","window","addEventListener","connectHandler","disconnectHandler","Keyboard","_key","_ignoreKeyup","_isDown","_isUp","_downHandler","bind","_upHandler","event","key","preventDefault","MathHelper","min","max","floor","random","v1","v2","atan2","sqrt","distanceToSq","dx","dy","ActorStates","idle","Symbol","for","walking","fire","died","Door","loadClip","filters","NoiseFilter","_playClip","Crosshair","fill","Blood","ActorBase","skin","_baseScale","_skin","_speed","_health","_power","_canGetHitAgain","state","objectTookDamage","power","_died","then","_idle","direction","_setIsFacingRight","scaleOffset","constructor","name","WeaponBase","rounds","_maxRounds","_rounds","_sprite","_roundsSprite","muzzleFlash","Shotgun","res","Beretta","weapons","Player","_weapon","_name","shotgun","beretta","reload","crosshairPosition","angle","angleBetweenRad","weaponLocation","rotation","_canBeControlled","_logPlayerCoordinates","toGlobal","position","Bat","_lastFlip","set","PI","setTimeout","parent","canFlip","Date","now","target","vx","vy","distanceTo","angleToTarget","sin","cos","_canFlipAgain","flip","BatInfected","f","ColorMatrixFilter","lsd","MapBase","_width","mapToLoad","_explorationOffset","_textures","_backgroundContainer","_actorContainer","_foregroundContainer","playerX","scrollAmount","Sound","require","default","MaensionOutside","starryNight","maension","tree","tree1","tree_dead","tree2","_setup","z1","from","z2","setInterval","play","HouseOutside","city","Street","cityWidth","concret","police","Loading","_door","HUD","player","_player","_gameOverSign","_height","smallTextConfig","bigText","fontSize","playerName","weaponBorder","shellsBorder","sw","lineSize","healthBorder","w","update","weapon","sprite","removeChildren","roundSprite","roundsSprite","text","health","_renderRounds","_renderWeapon","delta","alpha","fontFamily","fontWeight","dropShadow","dropShadowColor","align","maps","Game","stage","_stage","_hud","_map","_enemies","_mouseLocation","_isRunning","_startOffset","_elapsedSeconds","_mouseLine","_crosshair","street","house","loading","_init","cursor","adaptScale","actorContainer","bat1","bat2","bat3","_attachGamepad","_attachKeyboard","_updateHud","_attachMouse","_updateMouseLocation","interactive","on","data","global","_fire","updateCrosshairPosition","impact","impactLocation","toLocal","backgroundContainer","moveRight","moveLeft","moveUp","moveDown","stopMoveVertically","stopMoveHorizontally","left","up","right","down","k","r","enter","_switchWeapon","_reload","_moveRight","isDown","_stopMoveHorizontally","_moveLeft","_moveUp","_stopMoveVertically","_moveDown","init","0","1","15","14","12","13","9","renderGameOver","enemy","playerHit","hitBy","_drawBlood","_end","blood","getRandomInt","moveTowards","playerMoved","shallScroll","_updateCrosshair","vr","clear","lineTo","switchWeapon","mouseLocation","elapsed","updateStatus","animate","elapsedSeconds","parseInt","toString","correctedElapsedSeconds","timeout","_detectCollisions","_updateKI","_moveActors","outlineContainer","_outlineMouse","Maension","container","_lastFrame","_fpsCount","_fpsTimer","_game","_renderer","_stageWrapper","_fps","backgroundColor","appendChild","view","innerWidth","innerHeight","_animate","_assetsLoaded","options","crossOrigin","loader","add","assetPath","once","load","requestAnimationFrame","render","MaensionComponent","useRef","useState","setMaension","useEffect","current","m","run","className","ref","Boolean","location","hostname","match","ReactDOM","StrictMode","document","getElementById","serviceWorker","ready","registration","unregister","catch","error","message"],"mappings":"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","file":"static/js/main.8b6d9a26.chunk.js","sourcesContent":["export const Config = {\n  /**\n   * shall the actors be outlined in renderer or not\n   */\n  outlineActors: false,\n\n\n  /**\n   * shall we show the fps or not?\n   */\n  showFPS: false,\n\n  /**\n   * shall we log the player coordinates to the console?\n   */\n  logPlayerCoordinates: false\n};","import * as PIXI from \"pixi.js\";\n\n/**\n *\n */\nexport class ObjectBase extends PIXI.Container {\n\n  /**\n   *\n   * @type {Object}\n   * @protected\n   */\n  protected _resources: PIXI.IResourceDictionary\n\n  /**\n   * Is the this one facing right?\n   * @type {boolean}\n   * @protected\n   */\n  protected _isFacingRight: boolean = true;\n\n  /**\n   * the object velocity x\n   * @type {number}\n   * @protected\n   */\n  protected _vx = 0;\n\n  /**\n   * the object velocity y\n   * @type {number}\n   * @protected\n   */\n  protected _vy = 0;\n\n  /**\n   * the objects rotation velocity\n   * @type {number}\n   * @private\n   */\n  protected _vr = 0;\n\n  /**\n   *\n   * @param resources\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary\n  ) {\n    super();\n\n    this._resources = resources;\n  }\n\n  get isFacingRight(): boolean {\n    return this._isFacingRight\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get vx() {\n    return this._vx;\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get vy() {\n    return this._vy;\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get vr() {\n    return this._vr;\n  }\n\n  /**\n   *\n   * @returns {Number}\n   */\n  get realx() {\n    return this.x - (Math.abs(this.width) / 2);\n  }\n\n  /**\n   *\n   * @param actor\n   * @public\n   */\n  public collides(actor: ObjectBase) {\n\n    const collides = !(\n      actor.x > (this.realx + Math.abs(this.width)) ||\n      (actor.x + Math.abs(actor.width)) < this.realx ||\n      actor.y > (this.y + Math.abs(this.height)) ||\n      (actor.y + Math.abs(actor.height)) < this.y\n    );\n\n    if (collides) {\n      //console.log(\"p width\", this.width);\n      //console.log(\"actor width\", actor.width);\n    }\n\n    return collides;\n  }\n}","import * as PIXI from \"pixi.js\";\nimport { IDictionary } from \"../tools/IDictionary\"\nimport { ObjectBase } from \"./object-base\"\n\n/**\n *\n */\nexport class AnimationBase extends ObjectBase {\n\n  /**\n   * array for animations\n   * @type {{}}\n   * @protected\n   */\n  protected _clips: IDictionary<PIXI.AnimatedSprite> = {};\n\n  /**\n   * current clip that is beeing played\n   * @type {null}\n   * @private\n   */\n  protected _currentClip?: PIXI.AnimatedSprite;\n\n  /**\n   *\n   * @param resources\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary\n  ) {\n    super(resources);\n\n    this._resources = resources;\n  }\n\n  /**\n   *\n   * @param isFacingRight\n   * @protected\n   */\n  protected _setIsFacingRight(isFacingRight: boolean) {\n    this._isFacingRight = isFacingRight;\n\n    //console.log(\"is facing right\", isFacingRight);\n    this._setOrientation();\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setOrientation() {\n    if (this._currentClip) {\n      let scale = this.scale.x;\n\n      // everything fine no need to change anything\n      if (this._isFacingRight && scale > 0) {\n        return;\n      }\n\n      // everything fine no need to change anything\n      if (!this._isFacingRight && scale < 0) {\n        return;\n      }\n\n      // scale is negative\n      if (!this._isFacingRight && scale < 0) {\n        // make positive\n        this.scale.x = Math.abs(scale);\n      }\n      // scale is positive\n      else {\n        // make negative\n        this.scale.x = scale * -1;\n      }\n    }\n  }\n\n  /**\n   *\n   * @param which\n   * @param loop\n   * @param dontRemove\n   * @returns {Promise}\n   * @protected\n   */\n  protected _playClip(\n    which: string,\n    loop: boolean,\n    dontRemove?: boolean\n  ) {\n\n    if (this._currentClip) {\n      this.removeChild(this._currentClip);\n      this._currentClip = undefined;\n    }\n\n    return new Promise((resolve: Function, reject: Function) => {\n      // load punch clip\n      const clipToPlay = this._clips[which];\n\n      if (!clipToPlay) {\n\n        const err = \"AnimationBase: failed to load clip: \" + which;\n        console.log(err, this._clips);\n        reject(err);\n      }\n\n      clipToPlay.zIndex = 1\n\n      // play clip\n      this.addChild(clipToPlay);\n\n      // set the current playing clip\n      this._currentClip = clipToPlay;\n\n      this._setOrientation();\n\n      this._currentClip.loop = loop;\n      this._currentClip.gotoAndPlay(0);\n\n      this.children.sort((a, b) => a.zIndex - b.zIndex)\n\n      if (!loop) {\n\n        clipToPlay.onComplete = () => {\n\n          clipToPlay.stop();\n\n          if (!dontRemove) {\n            this.removeChild(clipToPlay);\n          }\n\n          resolve();\n        };\n\n      }\n    })\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { ActorBase } from \"../actors\"\n\n/**\n * @class\n */\nexport class AnimationHelper {\n\n  static loadClip(\n    resources: PIXI.IResourceDictionary,\n    which: string,\n    speed: number,\n    scale: number\n  ): PIXI.AnimatedSprite {\n    const frames: PIXI.Texture[] = [];\n    for (const textureId in resources[which].textures) {\n      let texture = resources[which]!.textures![textureId];\n      frames.push(texture);\n    }\n\n    const clip = new PIXI.AnimatedSprite(frames);\n\n    clip.animationSpeed = speed;\n    clip.scale.x = scale;\n    clip.scale.y = scale;\n    clip.anchor.x = 0.5;\n\n    return clip;\n  }\n\n  static outlineContainer(actor: ActorBase) {\n\n    // do we have a filling\n    if (actor.outline) {\n      // yep remove if from child\n      actor.removeChild(actor.outline);\n      // delete it\n      delete actor.outline;\n    }\n\n    // create new\n    const outline = new PIXI.Graphics();\n    outline.lineStyle(1, 0x000000);\n    outline.drawRect(0, 0, actor.width, actor.height);\n    outline.pivot.x = actor.width / 2;\n    outline.endFill();\n\n    actor.outline = outline;\n    actor.addChild(outline);\n  }\n}","import { IDictionary } from \"./IDictionary\"\n\nexport class Gamepads {\n\n  static _gamepads: IDictionary<Gamepad> = {};\n  static _state: any = {};\n  static _events: any = {};\n\n  static init(events: object) {\n    Gamepads._events = events;\n\n    Gamepads.scanGamepads();\n\n    return Gamepads._gamepads[0] || null;\n  }\n\n  static connectHandler(e: GamepadEvent) {\n    console.log(\"gamepad connected\");\n\n    Gamepads.addGamepad(e.gamepad);\n  }\n\n  static addGamepad(gamepad: Gamepad) {\n    console.log(\"adding gamepad\", gamepad);\n\n    Gamepads._gamepads[gamepad.index] = gamepad;\n    Gamepads._state[gamepad.index] = {};\n  }\n\n  static disconnectHandler(e: GamepadEvent) {\n    console.log(\"gamepad disconnected\");\n\n    Gamepads.removeGamepad(e.gamepad);\n  }\n\n  static removeGamepad(gamepad: Gamepad) {\n    console.log(\"removing gamepad\");\n    delete Gamepads._gamepads[gamepad.index];\n    delete Gamepads._state[gamepad.index];\n  }\n\n  static updateStatus() {\n\n    Gamepads.scanGamepads();\n\n    for (const j in Gamepads._gamepads) {\n      const gamepad = Gamepads._gamepads[j];\n\n      // sometimes controllers dont have buttpns\n      if (gamepad.buttons) {\n        for (const i in gamepad.buttons) {\n          const button: GamepadButton = gamepad.buttons[i];\n\n          Gamepads._state[j][i] = Gamepads._state[j][i] || {};\n          Gamepads._events[j][i] = Gamepads._events[j][i] || {};\n\n          if (button.pressed && !Gamepads._state[j][i].isPressed) {\n            console.log(\"button pressed\", j, i);\n\n            Gamepads._state[j][i].isPressed = true;\n\n            if (Gamepads._events[j][i].pressEvent) {\n              Gamepads._events[j][i].pressEvent()\n            }\n          }\n\n          if (!button.pressed && Gamepads._state[j][i].isPressed) {\n            console.log(\"button released\", j, i);\n\n            Gamepads._state[j][i].isPressed = false;\n\n            if (Gamepads._events[j][i].releaseEvent) {\n              Gamepads._events[j][i].releaseEvent()\n            }\n          }\n        }\n      }\n    }\n\n  }\n\n  static scanGamepads() {\n    const gamepads: Gamepad[] =\n      navigator.getGamepads ? navigator.getGamepads()\n        // @ts-ignore\n        : (navigator.webkitGetGamepads ? navigator.webkitGetGamepads() : []);\n\n    for (const gamepad of gamepads) {\n      // sometimes gamepad is undefined?!\n      if (gamepad) {\n        const gamepadIndex = gamepad.index;\n\n        // do we have this already in records?\n        if (gamepadIndex in Gamepads._gamepads) {\n          Gamepads._gamepads[gamepadIndex] = gamepad;\n        } else {\n          console.log(\"found new gamepad during scan, adding\", gamepadIndex);\n\n          Gamepads.addGamepad(gamepad);\n        }\n      }\n    }\n  }\n}\n\n// register events\n// @ts-ignore\nwindow.addEventListener(\n  \"gamepadconnected\",\n  Gamepads.connectHandler\n);\n// @ts-ignore\nwindow.addEventListener(\n  \"gamepaddisconnected\",\n  Gamepads.disconnectHandler\n);","/**\n * @class\n */\nexport class Keyboard {\n\n  /**\n   *\n   * @type {boolean}\n   * @private\n   */\n  private _isDown = false;\n  /**\n   *\n   * @type {boolean}\n   * @private\n   */\n  private _isUp = true;\n\n  // events\n  /**\n   *\n   * @type {KeyboardEvent}\n   */\n  public pressEvent: any = null;\n  /**\n   *\n   * @type {KeyboardEvent}\n   */\n  public releaseEvent: any = null;\n\n  constructor(\n    private readonly _key: string,\n    private readonly _ignoreKeyup: boolean\n  ) {\n    //Attach event listeners\n    window.addEventListener(\n      \"keydown\",\n      this._downHandler.bind(this),\n      false\n    );\n    window.addEventListener(\n      \"keyup\",\n      this._upHandler.bind(this),\n      false\n    );\n  }\n\n  get isDown() {\n    return this._isDown;\n  }\n\n  /**\n   *\n   * @param event\n   * @private\n   */\n  private _downHandler(\n    event: KeyboardEvent\n  ) {\n    if (event.key === this._key) {\n      event.preventDefault();\n\n      // if the key is up and we have a press handler\n      if (this._isUp && this.pressEvent) {\n        this.pressEvent();\n      }\n\n      this._isDown = true;\n      this._isUp = false;\n    }\n  }\n\n  /**\n   *\n   * @param event\n   * @private\n   */\n  private _upHandler(event: KeyboardEvent) {\n    if (event.key === this._key) {\n      event.preventDefault();\n\n      // if the key is down and we have a press handler\n      if (this._isDown && this.releaseEvent) {\n        this.releaseEvent();\n      }\n\n      this._isDown = false;\n      this._isUp = true;\n    }\n  }\n}","import * as PIXI from \"pixi.js\";\n\nexport class MathHelper {\n\n  /**\n   *\n   * @param min\n   * @param max\n   * @returns {number}\n   * @public\n   */\n  static getRandomInt(min: number, max: number) {\n    return Math.floor(Math.random() * (max - min)) + min;\n  }\n\n  /**\n   *\n   * @param v2\n   * @param v1\n   * @returns {number}\n   */\n  static angleBetweenRad(\n    v1: PIXI.Point,\n    v2: PIXI.Point\n  ) {\n    return Math.atan2(v2.y - v1.y, v2.x - v1.x);\n  }\n\n  /**\n   *\n   * @param v1\n   * @param v2\n   * @returns {number}\n   */\n  static distanceTo(v1: PIXI.Point, v2: PIXI.Point) {\n    return Math.sqrt(MathHelper.distanceToSq(v1, v2));\n  }\n\n  /**\n   *\n   * @param v2\n   * @param v1\n   * @returns {number}\n   */\n  static distanceToSq(v1: PIXI.Point, v2: PIXI.Point) {\n    let dx = v1.x - v2.x,\n      dy = v1.y - v2.y;\n\n    return dx * dx + dy * dy;\n  }\n}","export const ActorStates = {\n  idle: Symbol.for(\"Idle\"),\n  walking: Symbol.for(\"Walking\"),\n  fire: Symbol.for(\"Fire\"),\n  died: Symbol.for(\"Died\")\n};\n\nexport const HitLocations = {\n  Head: Symbol.for(\"Head\"),\n  Feet: Symbol.for(\"Feet\"),\n  Front: Symbol.for(\"Front\"),\n  Back: Symbol.for(\"Back\")\n};","import * as PIXI from \"pixi.js\"\nimport { AnimationBase } from \"./animation-base\"\nimport { AnimationHelper } from \"../tools\"\n\n/**\n *\n */\nexport class Door extends AnimationBase {\n\n  /**\n   *\n   * @param resources\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary\n  ) {\n    super(resources);\n\n    const which = \"things.door\"\n\n    this._clips = {\n      [which]: AnimationHelper.loadClip(\n        this._resources,\n        which,\n        0.01,\n        10\n      )\n    };\n\n\n    this._clips[which].filters = [new PIXI.filters.NoiseFilter(0.2)]\n\n    this._playClip(which, false, false);\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { ObjectBase } from \"./object-base\"\n\nexport class Crosshair extends ObjectBase {\n\n  constructor(\n    resources: PIXI.IResourceDictionary\n  ) {\n    super(resources);\n\n    this.addChild(new PIXI.Text(\"x\", {\n      fill: \"#fff\"\n    }))\n  }\n\n\n}","import { AnimationBase } from \"./animation-base\"\nimport { AnimationHelper } from \"../tools\"\n\n/**\n *\n */\nexport class Blood extends AnimationBase {\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    speed: number = 0.01\n  ) {\n    super(resources);\n    const which = \"things.blood\"\n\n    this._clips = {\n      [which]: AnimationHelper.loadClip(\n        this._resources,\n        which,\n        speed,\n        1\n      )\n    };\n\n    this._playClip(which, false, false);\n  }\n}","import PIXI from \"pixi.js\"\nimport { ActorStates } from \"../tools\";\nimport { AnimationBase } from \"../objects\"\n\n/**\n * @class\n */\nexport class ActorBase extends AnimationBase {\n\n  public outline?: PIXI.Graphics\n  protected _baseScale: number = 1\n\n  /**\n   *\n   * @type {null}\n   * @protected\n   */\n  protected _skin?: string;\n\n  /**\n   *\n   * @type {number}\n   * @protected\n   */\n  protected _speed = 1;\n\n  /**\n   * the objects health\n   * @type {number}\n   * @protected\n   */\n  protected _health = 100;\n\n  /**\n   * the objects striking power\n   * @type {number}\n   * @protected\n   */\n  protected _power = 12;\n\n  /**\n   * @type {Symbol}\n   * @protected\n   */\n  protected _state: Symbol = ActorStates.idle;\n\n  /**\n   * can we get git again helper\n   * @type {boolean}\n   * @protected\n   */\n  protected _canGetHitAgain = true;\n\n  /**\n   * @constructor\n   */\n  constructor(\n    speed: number,\n    resources: PIXI.IResourceDictionary,\n    skin: string\n  ) {\n\n    super(resources);\n\n    /**\n     * set the actor skin\n     * @type {String}\n     * @protected\n     */\n    this._skin = skin;\n\n    /**\n     * the objects speed\n     * @type {number}\n     * @protected\n     */\n    this._speed = speed;\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get power() {\n    return this._power;\n  }\n\n  /**\n   *\n   * @returns {Symbol}\n   */\n  get state() {\n    return this._state;\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get health() {\n    return this._health;\n  }\n\n\n  /**\n   *\n   * @param state\n   * @protected\n   */\n  set state(state: Symbol) {\n    console.log(this.constructor.name, \"New state:\", state);\n    this._state = state;\n  }\n\n  /**\n   *\n   * @protected\n   */\n  protected _idle() {\n    // dont go to idle if we are dead\n    if (this._state !== ActorStates.died) {\n\n      this.state = ActorStates.idle;\n\n      this._playClip(this._skin + \".stance\", true);\n    }\n  }\n\n  /**\n   *\n   * @protected\n   */\n  protected _died() {\n    this.state = ActorStates.died;\n\n    // remove all velocity\n    this._vy = 0;\n    this._vx = 0;\n    this._vr = 0;\n\n    // play died clip\n    this._playClip(this._skin + \".died\", false, true)\n  }\n\n  /**\n   * @public\n   * @param actor\n   * @returns {boolean}\n   */\n  public hitBy(actor: ActorBase) {\n\n    let died = false;\n    let objectTookDamage = false;\n\n    if (this._canGetHitAgain) {\n\n      // lower the heal\n      this._health -= actor.power;\n\n      objectTookDamage = true;\n\n      // after we got hit we cannot get hit again\n      this._canGetHitAgain = false;\n\n      // are we death?\n      if (this._health < 0) {\n\n        this._health = 0;\n\n        // yep\n        died = true;\n\n        this._died();\n      }\n      // not died\n      else {\n\n        // force the player a little bit back on hit\n        this._vx = actor._isFacingRight ? 5 : -5;\n\n        // play the gothit clip\n        this._playClip(this._skin + \".gothit\", false)\n          .then(() => {\n\n            // animatiion ended!\n\n            // remove the velo\n            this._vx = 0;\n\n            // yep we can get hit again\n            this._canGetHitAgain = true;\n\n            // stand up and idle afterwards\n            this._idle();\n          });\n      }\n    }\n\n    return {\n      died,\n      objectTookDamage\n    };\n  }\n\n  public flip(direction?: boolean) {\n    this._setIsFacingRight(\n      direction !== undefined ? direction : !this._isFacingRight\n    )\n  }\n\n  public adaptScale(height: number) {\n    const scaleOffset = height - this.y\n    const scale = this._baseScale - scaleOffset / 1000\n    this.scale.x = scale\n    this.scale.y = scale\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { ObjectBase } from \"../object-base\"\nimport { Blood } from \"../blood\"\n\nexport class WeaponBase extends ObjectBase {\n  protected _power: number\n  protected _maxRounds: number\n  protected _rounds: number\n  protected _sprite?: PIXI.Sprite\n  protected _roundsSprite?: PIXI.Sprite\n\n  get rounds() {\n    return this._rounds\n  }\n\n  get sprite() {\n    return this._sprite\n  }\n\n  get roundsSprite() {\n    return this._roundsSprite\n  }\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    power: number,\n    rounds: number\n  ) {\n    super(resources);\n\n    this._power = power\n    this._rounds = rounds\n    this._maxRounds = rounds\n  }\n\n  public fire(): boolean {\n\n    if (this._rounds > 0) {\n      // muzzle flash\n      const muzzleFlash = new Blood(this._resources, 2)\n\n      muzzleFlash.x = 80\n      this.addChild(muzzleFlash);\n\n      this._rounds--;\n\n      return true\n    }\n\n    return false\n  }\n\n  public reload(): boolean {\n    this._rounds = this._maxRounds\n\n    console.log(\"reload\")\n    return true\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { WeaponBase } from \"./weapon-base\"\n\n/**\n *\n */\nexport class Shotgun extends WeaponBase {\n\n  /**\n   *\n   * @param resources\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary\n  ) {\n    super(resources, 55, 6);\n\n    const which = \"weapons.shotgun\"\n\n    const res = resources![which]\n\n    this._sprite = new PIXI.Sprite(\n      res.textures![\"shotgun.png\"]!\n    );\n\n    this._roundsSprite = new PIXI.Sprite(\n      res.textures![\"shell.png\"]!\n    );\n\n    this._sprite.scale.x = 0.2\n    this._sprite.scale.y = 0.2\n\n    this.x = -10\n    this.y = 40\n\n    // shotgun should be in the back so add it first\n    this.addChild(this._sprite);\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { WeaponBase } from \"./weapon-base\"\n\n/**\n *\n */\nexport class Beretta extends WeaponBase {\n\n  /**\n   *\n   * @param resources\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary\n  ) {\n    super(resources, 55, 8);\n\n    const which = \"weapons.beretta\"\n\n    const res = resources![which]\n\n    // todo: replace with correct skin\n    this._sprite = new PIXI.Sprite(\n      res.textures![\"beretta.png\"]!\n    );\n\n    this._roundsSprite = new PIXI.Sprite(\n      res.textures![\"shell.png\"]!\n    );\n\n    this._sprite.scale.x = 0.2\n    this._sprite.scale.y = 0.2\n\n    this.x = -10\n    this.y = 40\n\n    // sprite should be in the back so add it first\n    this.addChild(this._sprite);\n  }\n}","import * as PIXI from \"pixi.js\"\nimport {\n  Beretta,\n  Shotgun,\n  WeaponBase\n} from \"../objects/weapons\"\nimport { ActorBase } from \"./actor-base\"\nimport {\n  ActorStates,\n  AnimationHelper,\n  MathHelper\n} from \"../tools\"\nimport { Config } from \"../config\"\n\n\nconst weapons: {\n  shotgun?: Shotgun,\n  beretta?: Beretta\n} = {}\n\n/**\n *\n */\nexport class Player extends ActorBase {\n\n  private _weapon: WeaponBase\n  private _name: string = \"Gordon\"\n\n  get weapon(): WeaponBase {\n    return this._weapon\n  }\n\n  get name() {\n    return this._name\n  }\n\n  /**\n   *\n   * @param resources\n   * @param skin\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    skin: string\n  ) {\n    super(\n      3,\n      resources,\n      skin\n    );\n\n    this._baseScale = 0.7\n\n    this._health = 77;\n\n    // load the clips for this object\n    this._clips[this._skin + \".stance\"] = AnimationHelper.loadClip(this._resources, this._skin + \".stance\", 0.1, 2);\n    this._clips[this._skin + \".walk\"] = AnimationHelper.loadClip(this._resources, this._skin + \".walk\", 0.2, 2);\n    this._clips[this._skin + \".punch\"] = AnimationHelper.loadClip(this._resources, this._skin + \".punch\", 0.3, 2);\n    this._clips[this._skin + \".kick\"] = AnimationHelper.loadClip(this._resources, this._skin + \".kick\", 0.2, 2);\n    this._clips[this._skin + \".gothit\"] = AnimationHelper.loadClip(this._resources, this._skin + \".gothit\", 0.2, 2);\n    this._clips[this._skin + \".died\"] = AnimationHelper.loadClip(this._resources, this._skin + \".died\", 0.2, 2);\n\n    weapons.shotgun = new Shotgun(resources)\n    weapons.shotgun.zIndex = 100\n\n    weapons.beretta = new Beretta(resources)\n    weapons.beretta.zIndex = 100\n\n    // todo get this from equipment\n    this._weapon = weapons.shotgun\n    this.addChild(this._weapon)\n\n    // go to idle\n    this._idle();\n  }\n\n  public reload() {\n    // todo check equipment for shells\n    this._weapon.reload()\n  }\n\n  public switchWeapon() {\n    this.removeChild(this._weapon)\n\n    if (this._weapon instanceof Shotgun) {\n      this._weapon = weapons.beretta!\n    } else {\n      this._weapon = weapons.shotgun!\n    }\n\n    this.addChild(this._weapon)\n  }\n\n  public updateCrosshairPosition(\n    crosshairPosition: PIXI.Point\n  ) {\n    const angle: number = this._isFacingRight ?\n      MathHelper.angleBetweenRad(this.weaponLocation, crosshairPosition) :\n      -1 * MathHelper.angleBetweenRad(crosshairPosition, this.weaponLocation)\n    this._weapon.rotation = angle\n  }\n\n  get weaponLocation(): PIXI.Point {\n    return this.toGlobal(\n      this._weapon.position\n    )\n  }\n\n  /**\n   *\n   * @returns {boolean}\n   * @private\n   */\n  private _canBeControlled() {\n    if (this._state === ActorStates.died) {\n      console.log(\"Cant be controlled, player is dead\");\n      return false\n    }\n\n    return (\n      this._state === ActorStates.idle ||\n      this._state === ActorStates.walking\n    );\n  }\n\n  private _logPlayerCoordinates() {\n    if (Config.logPlayerCoordinates) {\n      console.log(\n        \"x\", this.x,\n        \"real x\", this.realx,\n        \"y\", this.y,\n        \"width\", this.width,\n        \"height\", this.height\n      )\n    }\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _died() {\n    super._died();\n\n    // todo: add dying animation\n    // the died animation is way lower so we need to\n    // adjust the hight a bit\n    this.y += this.height / 2;\n  }\n\n  /**\n   * @public\n   */\n  public fire(): boolean {\n    if (this._canBeControlled()) {\n      console.log(\"Png!\");\n      this.state = ActorStates.fire;\n\n      this._vx = 0;\n      this._vy = 0;\n\n      const fire = this._weapon.fire()\n      if (fire) {\n        this._playClip(this._skin + \".punch\", false)\n          .then(() => {\n            this._idle();\n          });\n        return true\n      } else {\n        this._idle()\n      }\n    }\n\n    return false\n  }\n\n  /**\n   * @public\n   */\n  public moveRight() {\n    if (this._canBeControlled()) {\n      this._vx = this._speed;\n      this._playClip(this._skin + \".walk\", true);\n      this.state = ActorStates.walking;\n\n      this._logPlayerCoordinates();\n    }\n  }\n\n  /**\n   * @public\n   */\n  public moveLeft() {\n    if (this._canBeControlled()) {\n      this._vx = -this._speed;\n      this._playClip(this._skin + \".walk\", true);\n      this.state = ActorStates.walking;\n\n      this._logPlayerCoordinates();\n    }\n  }\n\n  /**\n   * @public\n   */\n  public stopMoveHorizontally() {\n    this._vx = 0;\n    if (this._vy === 0 && this._canBeControlled()) {\n      this._idle();\n    }\n  }\n\n  /**\n   * @public\n   */\n  public moveUp() {\n    if (this._canBeControlled()) {\n      this._vy = -this._speed;\n      this._playClip(this._skin + \".walk\", true);\n      this.state = ActorStates.walking;\n\n      this._logPlayerCoordinates();\n    }\n  }\n\n  /**\n   * @public\n   */\n  public moveDown() {\n    if (this._canBeControlled()) {\n      this._vy = this._speed;\n      this._playClip(this._skin + \".walk\", true);\n      this.state = ActorStates.walking;\n\n      this._logPlayerCoordinates();\n    }\n  }\n\n  /**\n   * @public\n   */\n  public stopMoveVertically() {\n    this._vy = 0;\n    if (this._vx === 0 && this._canBeControlled()) {\n      this._idle();\n    }\n  }\n}","import * as PIXI from \"pixi.js\";\nimport { EnemyBase } from \"./enemy-base\"\n\n/**\n *\n */\nexport class Bat extends EnemyBase {\n\n  /**\n   *\n   * @param resources\n   * @param skin\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    skin: string\n  ) {\n    super(resources, skin, 1);\n  }\n}","import * as PIXI from \"pixi.js\";\nimport { ActorStates } from \"../../tools/enums\";\nimport { ActorBase } from \"../actor-base\"\nimport { AnimationHelper, MathHelper } from \"../../tools\"\n\n/**\n *\n */\nexport class EnemyBase extends ActorBase {\n\n  // time delta of last sprite flip\n  private _lastFlip = 0;\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    skin: string,\n    speed: number = 2\n  ) {\n\n    super(speed, resources, skin);\n\n    this._isFacingRight = false;\n\n    // load the clips for this object\n    this._clips[this._skin + \".walk\"] =\n      AnimationHelper.loadClip(this._resources, this._skin + \".walk\", 0.2, 2.2);\n    this._clips[this._skin + \".gothit\"] = this._clips[this._skin + \".walk\"];\n    this._clips[this._skin + \".died\"] = this._clips[this._skin + \".walk\"];\n\n    // go to idle\n    this._idle();\n\n//\t\tthis._vr = 0.1;\n//\t\tthis.pivot.set(Math.abs(this.width) / 2, this.height);\n\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _idle() {\n    this.state = ActorStates.idle;\n    this._playClip(this._skin + \".walk\", true);\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _died() {\n\n    super._died();\n\n    this.y += this.height / 2;\n    this.pivot.set(Math.abs(this.width) / 2, this.height);\n    this.rotation = 90 * Math.PI / 180;\n\n    //console.log(\"pivot\", this.pivot);\n\n    setTimeout(() => {\n\n      this.parent.removeChild(this);\n\n    }, 10 * 1000);\n  }\n\n  /**\n   *\n   * @returns {boolean}\n   * @private\n   */\n  private _canFlipAgain() {\n\n    let canFlip = true;\n\n    if (Date.now() - this._lastFlip > 200) {\n      canFlip = true;\n      this._lastFlip = Date.now();\n    }\n\n    return canFlip;\n  }\n\n  /**\n   *\n   * @param target\n   */\n  public moveTowards(target: PIXI.Point) {\n\n    /*\n     this.pivot.set(this.width / 2, this.height);\n     this.rotation += 0.1;\n\n     return;*/\n\n    const dist = MathHelper.distanceTo(this.position, target);\n\n    let vx = 0;\n    let vy = 0;\n\n    if (dist > 1) {\n      let angleToTarget = MathHelper.angleBetweenRad(this.position, target);\n\n      vy = Math.sin(angleToTarget) * this._speed;\n      vx = Math.cos(angleToTarget) * this._speed;\n\n      // flip player over\n      if (vx > 0 && !this._isFacingRight && this._canFlipAgain()) {\n\n        //console.log(\"Enemy:\", \"flip left\");\n        this.flip();\n      }\n      // flip player over\n      else if (vx < 0 && this._isFacingRight && this._canFlipAgain()) {\n\n        //console.log(\"Enemy:\", \"flip right\");\n        this.flip();\n      }\n    }\n\n    this._vy = vy;\n    this._vx = vx;\n  }\n}","import * as PIXI from \"pixi.js\";\nimport { Bat } from \"./bat\"\n\n/**\n *\n */\nexport class BatInfected extends Bat {\n\n\n  /**\n   *\n   * @param resources\n   * @param skin\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    skin: string\n  ) {\n    super(resources, skin);\n\n    // todo make this a red'isch filter\n    const f = new PIXI.filters.ColorMatrixFilter()\n    f.lsd(false)\n    this.filters = [f]\n\n    this.scale.x = 2\n    this.scale.y = 2\n  }\n}","import * as PIXI from \"pixi.js\"\n\n/**\n *\n */\nexport class MapBase extends PIXI.Container {\n\n  private readonly _explorationOffset: number\n  protected _textures?: PIXI.ITextureDictionary\n  protected _backgroundContainer: PIXI.Container\n  protected _actorContainer: PIXI.Container\n  protected _foregroundContainer: PIXI.Container\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    protected _width: number,\n    mapToLoad?: string\n  ) {\n    super();\n\n    this._explorationOffset = this._width / 3;\n\n    if (mapToLoad) {\n      // load the clips for this object\n      this._textures = resources[mapToLoad].textures;\n    }\n\n    /**\n     * setup background\n     * @type {PIXI.Container}\n     * @private\n     */\n    this._backgroundContainer = new PIXI.Container();\n    this.addChild(this._backgroundContainer);\n\n    /**\n     * setup actors\n     * @type {PIXI.Container}\n     * @private\n     */\n    this._actorContainer = new PIXI.Container();\n    this.addChild(this._actorContainer);\n\n    /**\n     * setup foreground\n     * @type {PIXI.Container}\n     * @private\n     */\n    this._foregroundContainer = new PIXI.Container();\n    this.addChild(this._foregroundContainer);\n  }\n\n  /**\n   *\n   * @returns {PIXI.Container}\n   */\n  get actorContainer() {\n    return this._actorContainer;\n  }\n\n  /**\n   *\n   * @returns {PIXI.Container}\n   */\n  get backgroundContainer() {\n    return this._backgroundContainer;\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setup() {\n    // stub\n  }\n\n  /**\n   *\n   * @param playerX\n   * @param scrollAmount\n   */\n  public shallScroll(\n    playerX: number,\n    scrollAmount: number\n  ) {\n    if (\n      // move right\n      (scrollAmount > 0 && playerX + this._explorationOffset > this._width) ||\n      // move left\n      (scrollAmount < 0 && playerX - this._explorationOffset < this._explorationOffset)\n    ) {\n      // move map based on positive or negative scroll amount\n      this.x -= scrollAmount\n\n      // left bound\n      if (this.x > 0) {\n        this.x = 0\n      }\n\n      // right bound\n      if (this.x < this._width - this.width) {\n        this.x = this._width - this.width\n      }\n    }\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { MapBase } from \"./map-base\"\n\nconst {Sound} = require(\"pixi-sound\").default\n\n/**\n *\n */\nexport class MaensionOutside extends MapBase {\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    width: number\n  ) {\n    super(resources, width, \"maps.maension\")\n\n    let starryNight = new PIXI.Sprite(\n      this._textures![\"tumblr_inline_n258q4r8c01qhwjx8.png\"]\n    );\n    starryNight.scale.x = 2.56;\n    starryNight.scale.y = 2.56;\n\n    this._backgroundContainer.addChild(starryNight);\n\n    let maension = new PIXI.Sprite(\n      this._textures![\"Maension_WIP.png\"]\n    );\n\n    maension.y = -40\n    maension.scale.x = 2;\n    maension.scale.y = 2;\n\n    this._backgroundContainer.addChild(maension);\n\n    const tree = this._textures![\"tree.png\"]\n    const tree1 = new PIXI.Sprite(tree);\n    tree1.x = 100\n    tree1.y = 350\n    tree1.scale.x = 0.4\n    tree1.scale.y = 0.4\n\n    this._foregroundContainer.addChild(tree1)\n\n    const tree_dead = this._textures![\"tree_dead.png\"]\n    const tree2 = new PIXI.Sprite(tree_dead);\n    tree2.x = 50\n    tree2.y = 180\n    tree2.scale.x = 0.4\n    tree2.scale.y = 0.4\n\n    this._backgroundContainer.addChild(tree2)\n\n    this._setup()\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setup() {\n    const z1 = Sound.from('assets/sounds/zombie1.mp3');\n    const z2 = Sound.from('assets/sounds/zombie1.mp3');\n\n    setInterval(() => {\n      z1.play();\n    }, 15 * 1000)\n\n    setInterval(() => {\n      z2.play();\n    }, 8 * 1000)\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { MapBase } from \"./map-base\"\n\nconst {Sound} = require(\"pixi-sound\").default\n\n/**\n *\n */\nexport class HouseOutside extends MapBase {\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    width: number\n  ) {\n    super(resources, width, \"maps.house\")\n\n    this._setup()\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setup() {\n    let city = new PIXI.Sprite(\n      // @ts-ignore\n      this._textures[\"house.png\"]\n    );\n\n    city.scale.x = 1.3;\n    city.scale.y = 1.3;\n\n    this._backgroundContainer.addChild(city);\n\n    const z1 = Sound.from('assets/sounds/zombie1.mp3');\n    const z2 = Sound.from('assets/sounds/zombie1.mp3');\n\n    setInterval(() => {\n      z1.play();\n    }, 15 * 1000)\n\n    setInterval(() => {\n      z2.play();\n    }, 8 * 1000)\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { MapBase } from \"./map-base\"\n\n/**\n *\n */\nexport class Street extends MapBase {\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    width: number,\n  ) {\n    super(resources, width, \"maps.street\")\n\n    this._setup()\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setup() {\n\n    // background\n\n    // load city first because we need the width\n    // @ts-ignore\n    let city = new PIXI.Sprite(this._textures[\"city01.png\"]);\n    let cityWidth = city.width;\n    city.scale.x = 2;\n    city.scale.y = 2.1;\n    city.y = -100;\n\n    let concret = new PIXI.TilingSprite(\n      // @ts-ignore\n      this._textures[\"concret.png\"]\n    );\n    concret.width = cityWidth;\n    concret.height = 300;\n    concret.scale.x = 2;\n    concret.scale.y = 1.44;\n    concret.y = 330;\n\n    // concret should be in the back so add it first\n    this._backgroundContainer.addChild(concret);\n\n    this._backgroundContainer.addChild(city);\n\n    // foreground\n    // @ts-ignore\n    let police = new PIXI.Sprite(this._textures[\"police.png\"]);\n    police.scale.x = 2;\n    police.scale.y = 2;\n\n    police.y = this.height - police.height * 2;\n    police.x = 300;\n    this._foregroundContainer.addChild(police);\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { Door } from \"../objects\"\nimport { MapBase } from \"./map-base\"\n\n/**\n *\n */\nexport class Loading extends MapBase {\n\n  private readonly _door: Door\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    width: number\n  ) {\n    super(resources, width);\n\n    this._door = new Door(resources)\n    this._door.position.x = (width / 2) - (this._door.width / 2)\n\n    this._setup()\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setup() {\n    this._foregroundContainer.addChild(this._door);\n  }\n}","import * as PIXI from \"pixi.js\";\nimport { Player } from \"../actors\"\n\nconst lineSize = 4;\n\nexport class HUD extends PIXI.Container {\n\n  private _player: Player\n  private _health: PIXI.Text\n\n  // round icons\n  private _rounds: PIXI.Container\n  // weapon icon\n  private _weapon?: PIXI.Sprite\n\n  // change to \"you are dead ...\"\n  private _gameOverSign?: PIXI.Text\n\n  private _width: number\n  private _height: number\n\n  static bigText: PIXI.TextStyle = {\n    fontFamily: \"Arial Black\",\n    fontSize: \"48px\",\n    fontWeight: \"bold\",\n    fill: \"#fff\",\n    dropShadow: true,\n    dropShadowColor: \"#000\",\n    align: \"center\"\n  } as PIXI.TextStyle\n\n  constructor(\n    player: Player,\n    width: number,\n    height: number\n  ) {\n    super();\n\n    this._width = width;\n    this._height = height;\n\n    console.log(\n      \"Setting up HUD\",\n      \"width:\", this._width,\n      \"height:\", this._height\n    );\n\n    this._player = player;\n\n    const smallTextConfig = {\n      ...HUD.bigText,\n      fontSize: \"12px\"\n    }\n\n    const playerName = new PIXI.Text(\n      player.name,\n      {\n        ...smallTextConfig,\n        fill: \"#ffff30\",\n      }\n    );\n    playerName.x = 20;\n    playerName.y = 20;\n    this.addChild(playerName);\n\n    this._health = new PIXI.Text(\"100\", smallTextConfig);\n    this._health.x = 20;\n    this._health.y = 50;\n    this.addChild(this._health);\n\n    this._rounds = new PIXI.Container()\n    this._rounds.x = (this._width / 4) + 40\n    this._rounds.y = 30\n\n    this.addChild(this._rounds)\n\n    const weaponBorder = new PIXI.Graphics();\n    weaponBorder.lineStyle(lineSize, 0x777777);\n    weaponBorder.drawRect(\n      1,\n      10 - lineSize,\n      this._width / 4 - lineSize,\n      60\n    );\n\n    this.addChild(weaponBorder);\n\n    const shellsBorder = new PIXI.Graphics();\n    const sw = this._width / 2 - lineSize\n    shellsBorder.lineStyle(lineSize, 0x777777);\n    shellsBorder.drawRect(\n      weaponBorder.width + lineSize / 2,\n      40 - lineSize,\n      sw,\n      30\n    );\n\n    this.addChild(shellsBorder);\n\n    const healthBorder = new PIXI.Graphics();\n    const w = this._width / 4 - lineSize\n    healthBorder.lineStyle(lineSize, 0x777777);\n    healthBorder.drawRect(\n      this._width - w,\n      10 - lineSize,\n      w,\n      60\n    );\n\n    this.addChild(healthBorder);\n\n    this.update();\n  }\n\n  private _renderWeapon() {\n    this.removeChild(this._weapon!)\n\n    this._weapon = new PIXI.Sprite(this._player.weapon.sprite!.texture)\n    this._weapon.scale.x = this._player.weapon.sprite!.scale.x\n    this._weapon.scale.y = this._player.weapon.sprite!.scale.y\n\n    this._weapon.x = this._width - (this._weapon.width + 40)\n    this._weapon.y = 40\n\n    this.addChild(this._weapon)\n  }\n\n  private _renderRounds() {\n\n    this._rounds.removeChildren()\n\n    for (let x = 0; x < this._player.weapon.rounds; x++) {\n\n      const roundSprite = new PIXI.Sprite(this._player.weapon.roundsSprite?.texture)\n      roundSprite.scale.x = 0.1\n      roundSprite.scale.y = 0.1\n      roundSprite.x = 20 * x\n      roundSprite.y = 10\n\n      this._rounds.addChild(roundSprite)\n    }\n\n  }\n\n  public update() {\n    this._health.text = this._player.health + \" HP\";\n\n    this._renderRounds()\n    this._renderWeapon()\n  }\n\n  public renderGameOver() {\n    this._gameOverSign = new PIXI.Text(\n      \"Game Over\\nPress Enter to retry!\",\n      HUD.bigText\n    );\n\n    this.addChild(this._gameOverSign);\n\n    // place game over sign in center of screen\n    this._gameOverSign.x = (this._width / 2) - (this._gameOverSign.width / 2);\n    this._gameOverSign.y = (this._height / 2) - (this._gameOverSign.height / 2);\n  }\n\n  public animate(delta: number) {\n\n    if (this._gameOverSign) {\n      this._gameOverSign.alpha += delta / 1000;\n      if (this._gameOverSign.alpha > 1) {\n        this._gameOverSign.alpha = 0.2;\n      }\n    }\n  }\n}","import * as PIXI from \"pixi.js\";\nimport { Config } from \"./config\";\nimport {\n  Blood,\n  Crosshair\n} from \"./objects\"\nimport {\n  ActorBase,\n  Bat,\n  BatInfected,\n  EnemyBase,\n  Player\n} from \"./actors\"\nimport {\n  HouseOutside,\n  Loading,\n  MaensionOutside,\n  MapBase,\n  Street\n} from \"./maps\"\nimport {\n  ActorStates,\n  AnimationHelper,\n  Gamepads,\n  Keyboard,\n  MathHelper\n} from \"./tools\"\nimport {\n  HUD\n} from \"./ui\"\nimport { IDictionary } from \"./tools/IDictionary\"\n\nlet maps: IDictionary<MapBase> = {}\n\n/**\n * @class\n */\nexport default class Game {\n  private _stage: PIXI.Container\n\n  private _hud?: HUD\n  private _map?: MapBase\n  private _player?: Player\n  private _enemies: EnemyBase[] = [];\n  private _mouseLocation?: PIXI.Point\n\n  private _isRunning: boolean = true;\n\n  private _startOffset?: number\n  private _elapsedSeconds = 0;\n  private readonly _resources: PIXI.IResourceDictionary\n\n  private readonly _width: number\n  private readonly _height: number\n\n  private _mouseLine?: PIXI.Graphics\n  private _crosshair?: Crosshair\n\n  private static timeout: number = 300;\n\n  /**\n   *\n   * @param resources\n   * @param stage\n   * @param width\n   * @param height\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    stage: PIXI.Container,\n    width: number, height: number\n  ) {\n    this._stage = stage;\n\n    this._resources = resources;\n    this._width = width;\n    this._height = height;\n\n    maps.street = new Street(\n      this._resources,\n      this._width,\n    );\n\n    maps.house = new HouseOutside(\n      this._resources,\n      this._width,\n    );\n\n    maps.maension = new MaensionOutside(\n      this._resources,\n      this._width\n    );\n\n    maps.loading = new Loading(\n      this._resources,\n      this._width\n    );\n\n    this._init();\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _init() {\n    this._mouseLine = new PIXI.Graphics();\n    this._crosshair = new Crosshair(this._resources)\n\n    this._map = maps.maension!\n    this._map.zIndex = 1\n    this._stage.addChild(this._map);\n    this._stage.cursor = \"none\"\n\n    // create player\n    this._player = new Player(this._resources, \"ryu\");\n\n    this._player.x = 60\n    this._player.y = 400\n\n    this._player!.adaptScale(this._height)\n\n    // add player to stage\n    this._map.actorContainer.addChild(this._player);\n\n    const bat1 = new Bat(this._resources, \"bat\")\n    bat1.flip()\n\n    const bat2 = new Bat(this._resources, \"bat\")\n    const bat3 = new BatInfected(this._resources, \"bat\")\n\n    bat1.position.x = 900\n    bat1.position.y = 200\n\n    bat2.position.x = 920\n    bat2.position.y = 220\n\n    bat3.position.x = 880\n    bat3.position.y = 240\n\n    this._map.actorContainer.addChild(bat1);\n    this._map.actorContainer.addChild(bat2);\n    this._map.actorContainer.addChild(bat3);\n\n    // attach the keyboard to player\n    const gamepad = this._attachGamepad();\n\n    // no gamepad, go to stinky keyboard\n    if (!gamepad) {\n\n      console.log(\"no gamepad, attaching stinky keyboard\");\n      this._attachKeyboard()\n    }\n\n    // init enemies\n    this._enemies = [];\n\n    this._hud = new HUD(\n      this._player,\n      this._width,\n      this._height\n    );\n\n    // move hud to bottom\n    this._hud.y = this._height - this._hud.height\n\n    this._stage.addChild(this._hud);\n\n    this._updateHud();\n\n    this._attachMouse()\n\n    this._updateMouseLocation(new PIXI.Point(this._width / 2, this._height / 2))\n\n    this._startOffset = undefined;\n\n    // this game is running baby\n    this._isRunning = true;\n\n    console.log(\n      \"Game:\",\n      \"Game init done!\"\n    );\n  }\n\n  private _attachMouse() {\n    this._stage.addChild(this._mouseLine!)\n    this._stage.addChild(this._crosshair!)\n\n    this._stage.interactive = true\n    this._stage.on(\n      \"mousemove\",\n      (e: PIXI.InteractionEvent) => {\n        this._updateMouseLocation(e.data.global)\n      })\n\n    this._stage.on(\n      \"mousedown\",\n      () =>\n        this._fire()\n    )\n\n    this._stage.on(\n      \"mouseout\",\n      () => this._isRunning = false\n    )\n\n    this._stage.on(\n      \"mouseover\",\n      () => this._isRunning = true\n    )\n  }\n\n  private _updateCrosshair() {\n    if (\n      this._mouseLocation &&\n      this._isRunning &&\n      this._player?.state !== ActorStates.died\n    ) {\n      this._crosshair!.x = this._mouseLocation!.x - this._crosshair!.width / 2\n      this._crosshair!.y = this._mouseLocation!.y - this._crosshair!.height / 2\n\n      if (this._crosshair!.x < this._player!.toGlobal(this._stage).x) {\n        this._player!.flip(false)\n      } else {\n        this._player!.flip(true)\n      }\n\n      this._player?.updateCrosshairPosition(\n        this._stage.toGlobal(this._crosshair?.position!)\n      )\n    }\n  }\n\n  private _fire() {\n    if (this._isRunning) {\n      if (this._player?.fire()) {\n        // hit location\n        const impact = new Blood(this._resources, 2)\n        const impactLocation = this._map!.toLocal(this._crosshair!)\n        impact.x = impactLocation.x\n        impact.y = impactLocation.y\n\n        this._map?.backgroundContainer.addChild(impact);\n\n        this._updateHud()\n      }\n    }\n  }\n\n  private _moveRight() {\n    if (this._isRunning && this._player) {\n      this._player.moveRight();\n    }\n  }\n\n  private _moveLeft() {\n    if (this._isRunning && this._player) {\n      this._player.moveLeft();\n    }\n  }\n\n  private _moveUp() {\n    if (this._isRunning && this._player) {\n      this._player.moveUp();\n    }\n  }\n\n  private _moveDown() {\n    if (this._isRunning && this._player) {\n      this._player.moveDown();\n    }\n  }\n\n  private _stopMoveVertically() {\n    if (this._isRunning) {\n      this._player?.stopMoveVertically();\n    }\n  }\n\n  private _stopMoveHorizontally() {\n    if (this._isRunning) {\n      this._player?.stopMoveHorizontally();\n    }\n  }\n\n  private _attachKeyboard() {\n    const\n      left = new Keyboard(\"ArrowLeft\", true),\n      up = new Keyboard(\"ArrowUp\", true),\n      right = new Keyboard(\"ArrowRight\", true),\n      down = new Keyboard(\"ArrowDown\", true),\n\n      k = new Keyboard(\"k\", false),\n      w = new Keyboard(\"w\", false),\n      r = new Keyboard(\"r\", false),\n\n      enter = new Keyboard(\"Enter\", false);\n\n    k.pressEvent = () => this._fire()\n    w.pressEvent = () => this._switchWeapon()\n    r.pressEvent = () => this._reload()\n\n    right.pressEvent = () => this._moveRight()\n    right.releaseEvent = () => {\n      if (!left.isDown) {\n        this._stopMoveHorizontally()\n      }\n    };\n\n    left.pressEvent = () => this._moveLeft()\n    left.releaseEvent = () => {\n      if (!right.isDown) {\n        this._stopMoveHorizontally()\n      }\n    };\n\n    up.pressEvent = () => this._moveUp()\n    up.releaseEvent = () => {\n      if (!down.isDown) {\n        this._stopMoveVertically()\n      }\n    };\n\n    down.pressEvent = () => this._moveDown()\n    down.releaseEvent = () => {\n      if (!up.isDown) {\n        this._stopMoveVertically()\n      }\n    };\n\n    enter.pressEvent = () => {\n      if (!this._isRunning) {\n        this._init();\n      }\n    }\n  }\n\n  private _attachGamepad(): boolean {\n    return !!Gamepads.init({\n      0: {\n        1: {\n          pressEvent: () => {\n            this._fire()\n          }\n        },\n        15: {\n          pressEvent: () => this._moveRight(),\n          releaseEvent: () => this._stopMoveHorizontally()\n        },\n        14: {\n          pressEvent: () => this._moveLeft(),\n          releaseEvent: () => this._stopMoveHorizontally()\n        },\n        12: {\n          pressEvent: () => this._moveUp(),\n          releaseEvent: () => this._stopMoveVertically()\n        },\n        13: {\n          pressEvent: () => this._moveDown(),\n          releaseEvent: () => this._stopMoveVertically()\n        },\n        9: {\n          pressEvent: () => {\n            if (!this._isRunning) {\n              this._init();\n            }\n          }\n        }\n      }\n    })\n  }\n\n  /**\n   * this will end the game\n   * @private\n   */\n  private _end() {\n    // game is not longer running dude\n    this._isRunning = false;\n\n    this._hud!.renderGameOver();\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _detectCollisions() {\n    for (const enemy of this._enemies) {\n      if (ActorStates.died !== enemy.state &&\n        ActorStates.died !== this._player!.state) {\n\n        // does the player collide the enemy?\n        if (this._player!.collides(enemy)) {\n          const playerHit = this._player!.hitBy(enemy);\n\n          if (playerHit.objectTookDamage) {\n            this._drawBlood(this._player!);\n            this._updateHud();\n          }\n\n          // we died and now lives left :(\n          if (playerHit.died) {\n            // end the game\n            this._end();\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   *\n   * @param actor: the bleeding actor\n   * @private\n   */\n  private _drawBlood(\n    actor: ActorBase\n  ) {\n    for (let i = 0; i < 100; i++) {\n      const blood = new Blood(this._resources);\n\n      blood.x = actor.x + MathHelper.getRandomInt(-100, 100);\n      blood.y = actor.y + actor.height + MathHelper.getRandomInt(-100, 100);\n      blood.rotation = MathHelper.getRandomInt(0, 10);\n\n      this._map?.backgroundContainer.addChild(blood);\n    }\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _updateHud() {\n    this._hud!.update();\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _updateKI() {\n    for (const enemy of this._enemies) {\n      if (ActorStates.died !== enemy.state) {\n        enemy.moveTowards(this._player!.position);\n      }\n    }\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _moveActors() {\n\n    const {_player} = this\n    let playerMoved = false\n\n    if (\n      // do we have velocity?\n      _player!.vy !== 0 &&\n      _player!.y + _player!.vy > 0 &&\n      // dont move lower than the bottom\n      _player!.y + _player!.height + _player!.vy < this._height\n    ) {\n      _player!.y += _player!.vy;\n      playerMoved = true\n    }\n\n    // move right\n    if (_player!.vx > 0) {\n      // dont walk further than the right border of the map\n      if (\n        _player!.realx +\n        Math.abs(_player!.width) + 7 +\n        _player!.vx < this._map!.width\n      ) {\n        _player!.x += _player!.vx;\n        playerMoved = true\n      }\n    }\n    // move left\n    else if (_player!.vx < 0) {\n      // detect left col\n      if (\n        _player!.realx + _player!.vx >= 0\n      ) {\n        _player!.x += _player!.vx;\n        playerMoved = true\n      }\n    }\n\n    if (playerMoved) {\n      // yep, so try to scroll the map\n      this._map?.shallScroll(\n        _player!.realx,\n        _player!.vx\n      );\n      this._updateCrosshair()\n\n      this._player!.adaptScale(this._height)\n    }\n\n    // move the enemies\n    for (const enemy of this._enemies) {\n      enemy.x += enemy.vx;\n      enemy.y += enemy.vy;\n\n      enemy.rotation += enemy.vr;\n    }\n\n  }\n\n  private _outlineMouse() {\n    if (\n      this._mouseLine && this._mouseLocation &&\n      this._player && this._map\n    ) {\n      this._mouseLine.clear()\n      this._mouseLine.lineStyle(1, 0xffffff);\n\n      // from\n      this._mouseLine.position =\n        this._player.weaponLocation\n\n      // to\n      const {x, y} = this._mouseLine.toLocal(this._mouseLocation)\n      this._mouseLine.lineTo(\n        x, y\n      );\n\n      this._mouseLine.endFill();\n    }\n  }\n\n  private _switchWeapon() {\n    if (this._isRunning) {\n      this._player!.switchWeapon()\n      this._updateHud()\n    }\n  }\n\n  private _reload() {\n    if (this._isRunning) {\n      this._player!.reload()\n      this._updateHud()\n    }\n  }\n\n  private _updateMouseLocation(\n    mouseLocation: PIXI.Point\n  ) {\n    this._mouseLocation = mouseLocation\n    this._updateCrosshair()\n  }\n\n  /**\n   *\n   * @param elapsed\n   * @param delta\n   * @public\n   */\n  public update(\n    elapsed: number,\n    delta: number\n  ) {\n    Gamepads.updateStatus();\n\n    this._hud!.animate(delta);\n\n    if (this._isRunning) {\n      const elapsedSeconds = parseInt((elapsed / 1000).toString());\n\n      // game has not started\n      if (!this._startOffset) {\n        this._startOffset = elapsedSeconds;\n      }\n\n      const correctedElapsedSeconds = (elapsedSeconds - this._startOffset);\n\n      if (correctedElapsedSeconds !== this._elapsedSeconds) {\n        this._elapsedSeconds = correctedElapsedSeconds;\n        this._updateHud();\n      }\n\n      if (Game.timeout - correctedElapsedSeconds <= 0) {\n        // times up!\n        console.log(\"Time is up, dude!\");\n        this._end();\n      }\n\n      this._detectCollisions();\n      this._updateKI();\n      this._moveActors();\n\n      const sort = (a: PIXI.DisplayObject, b: PIXI.DisplayObject) => {\n        if (a.position.y < b.position.y) {\n          return 1;\n        }\n\n        if (a.position.y > b.position.y) {\n          return -1;\n        }\n\n        return 0;\n      }\n\n      // ensure z index for actors\n      this._map?.actorContainer.children\n        .sort(sort);\n\n      if (Config.outlineActors) {\n        // outline player\n        AnimationHelper.outlineContainer(this._player!);\n\n        // outline enemies\n        for (const enemy of this._enemies) {\n          AnimationHelper.outlineContainer(enemy);\n        }\n\n        // outline mouse line\n        this._outlineMouse()\n      }\n    }\n  }\n}","import * as PIXI from \"pixi.js\";\nimport Game from \"./game\";\nimport { Config } from \"./config\"\n\nexport default class Maension {\n\n  private _lastFrame: number = 0\n  private _fpsCount: number = 0\n  private _fpsTimer: number = 0\n  private _game?: Game\n  private readonly _renderer: PIXI.Renderer\n  private readonly _stage: PIXI.Container\n  private readonly _stageWrapper: PIXI.Container\n  private readonly _fps?: PIXI.Text\n\n  constructor(container: HTMLDivElement) {\n\n    this._renderer = PIXI.autoDetectRenderer({\n      width: 800,\n      height: 600,\n      backgroundColor: 0x1099bb\n    });\n\n    container.appendChild(this._renderer.view);\n\n    console.log(\"Viewport\", window.innerWidth, window.innerHeight);\n\n    // create the root of the scene graph\n    this._stage = new PIXI.Container();\n\n    this._stageWrapper = new PIXI.Container();\n    this._stageWrapper.addChild(this._stage)\n\n    if (Config.showFPS) {\n      this._fps = new PIXI.Text(\"FPS: \", {\n        fontWeight: \"16px\",\n        fill: \"#fff\"\n      } as PIXI.TextStyle);\n      this._fps.x = 10\n      this._fps.y = 10\n      this._stageWrapper.addChild(this._fps)\n    }\n\n    this._animate.bind(this);\n    this._assetsLoaded.bind(this);\n  }\n\n  /**\n   *\n   */\n  public run() {\n    const options = {\n      crossOrigin: true\n    };\n\n    const assetPath = \"assets\";\n\n    const loader = new PIXI.Loader()\n\n    // load map\n    loader.add(\"maps.house\", assetPath + \"/maps/house.json\", options)\n    loader.add(\"maps.street\", assetPath + \"/maps/street.json\", options)\n    loader.add(\"maps.maension\", assetPath + \"/maps/maension.json\", options)\n\n    // load player\n    loader.add(\"ryu.stance\", assetPath + \"/ryu/stance.json\", options)\n    loader.add(\"ryu.punch\", assetPath + \"/ryu/punch.json\", options)\n    loader.add(\"ryu.kick\", assetPath + \"/ryu/kick.json\", options)\n    loader.add(\"ryu.walk\", assetPath + \"/ryu/walk.json\", options)\n    loader.add(\"ryu.gothit\", assetPath + \"/ryu/gothit.json\", options)\n    loader.add(\"ryu.died\", assetPath + \"/ryu/died.json\", options)\n\n    // enemies\n    loader.add(\"bat.walk\", assetPath + \"/enemys/bat/walk.json\", options)\n\n    // weapons\n    loader.add(\"weapons.shotgun\", assetPath + \"/weapons/shotgun.json\", options)\n    loader.add(\"weapons.beretta\", assetPath + \"/weapons/beretta.json\", options)\n\n    // load things, like decals heads and so on\n    loader.add(\"things.blood\", assetPath + \"/things/blood.json\", options)\n    loader.add(\"things.door\", assetPath + \"/things/door.json\", options)\n\n    loader.onComplete.once(this._assetsLoaded.bind(this))\n\n    // resources loaded\n    loader.load();\n  }\n\n  /**\n   *\n   * @param loader\n   * @param resources\n   * @private\n   */\n  private _assetsLoaded(\n    loader: PIXI.Loader,\n    resources: PIXI.IResourceDictionary\n  ) {\n\n    // loading done, start game\n    this._game = new Game(\n      resources,\n      this._stage,\n      this._renderer.width,\n      this._renderer.height\n    );\n\n    console.log(\"Mnsion:\", \"Init done, ready to scare!\");\n\n    requestAnimationFrame(this._animate.bind(this));\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _animate(elapsed: number) {\n    // calculate frame delta\n    let delta = elapsed - this._lastFrame;\n    this._lastFrame = elapsed;\n\n    if (this._fps) {\n      this._fpsCount++\n      this._fpsTimer += delta;\n\n      // reset after 1 second\n      if (this._fpsTimer > 1000) {\n        // update text\n        this._fps.text = \"FPS: \" + this._fpsCount;\n\n        this._fpsCount = 0;\n        this._fpsTimer = 0;\n      }\n    }\n\n    // update game\n    if (this._game) {\n      this._game.update(elapsed, delta);\n    }\n\n    // render the container\n    this._renderer.render(this._stageWrapper);\n\n    requestAnimationFrame(this._animate.bind(this));\n  }\n}\n","import React, { useEffect, useRef, useState } from 'react';\nimport './Maension.css';\nimport Maension from \"./game/maension\"\n\nexport default function MaensionComponent() {\n\n  const stage = useRef(null)\n  const [maension, setMaension] = useState<Maension>()\n\n  useEffect(() => {\n    if (!maension && stage.current) {\n      const m = new Maension(stage.current!)\n      m.run()\n      setMaension(m)\n    }\n  }, [stage, maension])\n\n  return (\n    <div className=\"maension\">\n      <h1>Mnsion</h1>\n\n      <div ref={stage}/>\n\n      <div>\n        <div>\n          Donate\n        </div>\n        <div>\n          Patreon\n        </div>\n      </div>\n\n    </div>\n  );\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport Maension from './Maension';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <Maension/>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}