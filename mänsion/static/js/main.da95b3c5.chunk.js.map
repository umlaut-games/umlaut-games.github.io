{"version":3,"sources":["game/config.ts","game/objects/object-base.ts","game/objects/animation-base.ts","game/tools/animation-helper.ts","game/tools/gamepads.ts","game/tools/keyboard.ts","game/tools/math-helper.ts","game/tools/enums.ts","game/objects/door.ts","game/objects/crosshair.ts","game/objects/blood.ts","game/actors/actor-base.ts","game/objects/weapons/weapon-base.ts","game/objects/weapons/shotgun.ts","game/objects/weapons/beretta.ts","game/actors/player.ts","game/actors/enemies/bat.ts","game/actors/enemies/enemy-base.ts","game/actors/enemies/bat.infected.ts","game/maps/map-base.ts","game/maps/maension-outside.ts","game/maps/house-outside.ts","game/maps/street.ts","game/maps/loading.ts","game/ui/hud.ts","game/game.ts","game/maension.ts","Maension.tsx","serviceWorker.ts","index.tsx"],"names":["Config","process","ObjectBase","resources","_baseScale","_resources","_isFacingRight","_vx","_vy","_vr","actor","thisW","Math","abs","this","width","actW","thisH","height","actH","collides","realx","y","console","log","scaleOffset","scale","x","_adaptScaleBasedOnOrientation","PIXI","AnimationBase","_clips","_currentClip","isFacingRight","which","loop","dontRemove","removeChild","undefined","Promise","resolve","reject","clipToPlay","err","zIndex","addChild","gotoAndPlay","children","sort","a","b","onComplete","stop","AnimationHelper","speed","frames","textureId","textures","texture","push","clip","animationSpeed","anchor","outline","lineStyle","drawRect","pivot","endFill","Gamepads","events","_events","scanGamepads","_gamepads","event","addGamepad","gamepad","index","_state","removeGamepad","gamepadIndex","hasOwnProperty","axes","buttons","buttonIndex","button","state","pressed","isPressed","pressEvent","releaseEvent","gamepads","navigator","getGamepads","webkitGetGamepads","window","addEventListener","connectHandler","disconnectHandler","Keyboard","_key","_ignoreKeyup","_isDown","_isUp","_downHandler","bind","_upHandler","key","preventDefault","MathHelper","min","max","floor","random","v1","v2","atan2","sqrt","distanceToSq","dx","dy","ActorStates","idle","Symbol","for","walking","fire","died","Door","loadClip","filters","NoiseFilter","_playClip","Crosshair","fill","Blood","ActorBase","skin","_skin","_speed","_health","_power","_canGetHitAgain","objectTookDamage","power","_died","then","_idle","direction","_setIsFacingRight","constructor","name","WeaponBase","rounds","_maxRounds","_rounds","_sprite","_roundsSprite","muzzleFlash","Shotgun","res","Beretta","weapons","Player","_weapon","_name","shotgun","beretta","reload","crosshairPosition","angle","angleBetweenRad","weaponLocation","rotation","_canBeControlled","_logPlayerCoordinates","toGlobal","position","Bat","_lastFlip","set","PI","setTimeout","parent","canFlip","Date","now","target","vx","vy","distanceTo","angleToTarget","sin","cos","_canFlipAgain","flip","BatInfected","f","ColorMatrixFilter","lsd","MapBase","_width","mapToLoad","_explorationOffset","_textures","_backgroundContainer","_actorContainer","_foregroundContainer","playerX","scrollAmount","Sound","require","default","MaensionOutside","starryNight","maension","tree","tree1","tree_dead","tree2","_setup","z1","from","z2","setInterval","play","HouseOutside","city","Street","cityWidth","concret","police","Loading","_door","HUD","player","_player","_gameOverSign","_height","smallTextConfig","bigText","fontSize","playerName","healthBorder","roundsBorder","weaponBorder","update","weapon","sprite","removeChildren","roundSprite","roundsSprite","text","health","_renderRounds","_renderWeapon","delta","alpha","fontFamily","fontWeight","dropShadow","dropShadowColor","align","maps","Game","stage","_stage","_hud","_map","_enemies","_mouseLocation","_isRunning","_startOffset","_elapsedSeconds","_mouseLine","_crosshair","street","house","loading","_init","cursor","adaptScale","actorContainer","bat1","bat2","bat3","_attachGamepad","_attachKeyboard","_updateHud","_attachMouse","_updateMouseLocation","interactive","on","e","data","global","_fire","updateCrosshairPosition","impact","impactLocation","toLocal","backgroundContainer","moveRight","moveLeft","moveUp","moveDown","stopMoveVertically","stopMoveHorizontally","left","up","right","down","k","w","r","enter","_switchWeapon","_reload","_moveRight","isDown","_stopMoveHorizontally","_moveLeft","_moveUp","_stopMoveVertically","_moveDown","init","0","1","15","14","12","13","9","renderGameOver","enemy","playerHit","hitBy","_drawBlood","_end","i","blood","getRandomInt","moveTowards","playerMoved","shallScroll","_updateCrosshair","vr","clear","lineTo","switchWeapon","mouseLocation","elapsed","updateStatus","animate","elapsedSeconds","parseInt","toString","correctedElapsedSeconds","timeout","_detectCollisions","_updateKI","_moveActors","outlineContainer","_outlineMouse","Maension","container","_lastFrame","_fpsCount","_fpsTimer","_game","_renderer","_stageWrapper","_fps","backgroundColor","appendChild","view","innerWidth","innerHeight","_animate","_assetsLoaded","options","crossOrigin","loader","add","assetPath","once","load","requestAnimationFrame","render","MaensionComponent","useRef","useState","setMaension","useEffect","current","m","run","className","ref","Boolean","location","hostname","match","ReactDOM","StrictMode","document","getElementById","serviceWorker","ready","registration","unregister","catch","error","message"],"mappings":"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","file":"static/js/main.da95b3c5.chunk.js","sourcesContent":["export const Config = {\n  /**\n   * shall the actors be outlined in renderer or not\n   */\n  outlineActors: process.env.NODE_ENV !== \"production\" && false,\n\n  /**\n   * shall we show the fps or not?\n   */\n  showFPS: process.env.NODE_ENV !== \"production\" && true,\n\n  /**\n   * shall we log the player coordinates to the console?\n   */\n  logPlayerCoordinates: process.env.NODE_ENV !== \"production\" && false,\n\n  /**\n   * shall we log actor collisions?\n   */\n  logCollisions: process.env.NODE_ENV !== \"production\" && false\n}\n","import * as PIXI from \"pixi.js\";\nimport { Config } from \"../config\"\n\n/**\n *\n */\nexport class ObjectBase extends PIXI.Container {\n\n  protected _baseScale: number = 1\n\n  /**\n   *\n   * @type {Object}\n   * @protected\n   */\n  protected _resources: PIXI.IResourceDictionary\n\n  /**\n   * Is the this one facing right?\n   * @type {boolean}\n   * @protected\n   */\n  protected _isFacingRight: boolean = true;\n\n  /**\n   * the object velocity x\n   * @type {number}\n   * @protected\n   */\n  protected _vx = 0;\n\n  /**\n   * the object velocity y\n   * @type {number}\n   * @protected\n   */\n  protected _vy = 0;\n\n  /**\n   * the objects rotation velocity\n   * @type {number}\n   * @private\n   */\n  protected _vr = 0;\n\n  /**\n   *\n   * @param resources\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary\n  ) {\n    super();\n\n    this._resources = resources;\n  }\n\n  get isFacingRight(): boolean {\n    return this._isFacingRight\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get vx() {\n    return this._vx;\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get vy() {\n    return this._vy;\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get vr() {\n    return this._vr;\n  }\n\n  /**\n   *\n   * @returns {Number}\n   */\n  get realx() {\n    return this.x - (Math.abs(this.width) / 2);\n  }\n\n  /**\n   *\n   * @param actor\n   * @public\n   */\n  public collides(\n    actor: ObjectBase\n  ) {\n    const thisW = Math.abs(this.width)\n    const actW = Math.abs(actor.width)\n    const thisH = Math.abs(this.height)\n    const actH = Math.abs(actor.height)\n\n    const collides = !(\n      actor.realx > (this.realx + thisW) ||\n      this.realx > (actor.realx + actW) ||\n      actor.y > (this.y + thisH) ||\n      this.y > (actor.y + actH)\n    )\n\n    if (collides && Config.logCollisions) {\n      console.log(\"this width/height\", thisW, thisH);\n      console.log(\"actor width/height\", actW, actH);\n    }\n\n    return collides;\n  }\n\n  public adaptScale(\n    y: number,\n    height: number\n  ) {\n    const scaleOffset = height - y\n    let scale = this._baseScale - scaleOffset / 1000\n\n    this.scale.x = scale\n    this.scale.y = scale\n\n    this._adaptScaleBasedOnOrientation()\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _adaptScaleBasedOnOrientation() {\n    let scale = this.scale.x;\n    if (!this._isFacingRight && scale > 0) {\n      this.scale.x = scale * -1;\n    }\n\n    if (this._isFacingRight && scale < 0) {\n      this.scale.x = Math.abs(scale);\n    }\n  }\n}","import * as PIXI from \"pixi.js\";\nimport { IDictionary } from \"../tools/IDictionary\"\nimport { ObjectBase } from \"./object-base\"\n\n/**\n *\n */\nexport class AnimationBase extends ObjectBase {\n\n  /**\n   * array for animations\n   * @type {{}}\n   * @protected\n   */\n  protected _clips: IDictionary<PIXI.AnimatedSprite> = {};\n\n  /**\n   * current clip that is beeing played\n   * @type {null}\n   * @private\n   */\n  protected _currentClip?: PIXI.AnimatedSprite;\n\n  /**\n   *\n   * @param resources\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary\n  ) {\n    super(resources);\n\n    this._resources = resources;\n  }\n\n  /**\n   *\n   * @param isFacingRight\n   * @protected\n   */\n  protected _setIsFacingRight(\n    isFacingRight: boolean\n  ) {\n    this._isFacingRight = isFacingRight;\n    this._adaptScaleBasedOnOrientation()\n  }\n\n  protected _playClip(\n    which: string,\n    loop: boolean,\n    dontRemove?: boolean\n  ) {\n\n    if (this._currentClip) {\n      this.removeChild(this._currentClip);\n      this._currentClip = undefined;\n    }\n\n    return new Promise((resolve: Function, reject: Function) => {\n      // load punch clip\n      const clipToPlay = this._clips[which];\n\n      if (!clipToPlay) {\n\n        const err = \"AnimationBase: failed to load clip: \" + which;\n        console.log(err, this._clips);\n        reject(err);\n      }\n\n      clipToPlay.zIndex = 1\n\n      // play clip\n      this.addChild(clipToPlay);\n\n      // set the current playing clip\n      this._currentClip = clipToPlay;\n\n      this._adaptScaleBasedOnOrientation();\n\n      this._currentClip.loop = loop;\n      this._currentClip.gotoAndPlay(0);\n\n      this.children.sort((a, b) => a.zIndex - b.zIndex)\n\n      if (!loop) {\n\n        clipToPlay.onComplete = () => {\n\n          clipToPlay.stop();\n\n          if (!dontRemove) {\n            this.removeChild(clipToPlay);\n          }\n\n          resolve();\n        };\n\n      }\n    })\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { ActorBase } from \"../actors\"\n\n/**\n * @class\n */\nexport class AnimationHelper {\n\n  static loadClip(\n    resources: PIXI.IResourceDictionary,\n    which: string,\n    speed: number,\n    scale: number\n  ): PIXI.AnimatedSprite {\n    const frames: PIXI.Texture[] = [];\n    for (const textureId in resources[which].textures) {\n      let texture = resources[which]!.textures![textureId];\n      frames.push(texture);\n    }\n\n    const clip = new PIXI.AnimatedSprite(frames);\n\n    clip.animationSpeed = speed;\n    clip.scale.x = scale;\n    clip.scale.y = scale;\n    clip.anchor.x = 0.5;\n\n    return clip;\n  }\n\n  static outlineContainer(actor: ActorBase) {\n\n    // do we have a filling\n    if (actor.outline) {\n      // yep remove if from child\n      actor.removeChild(actor.outline);\n      // delete it\n      delete actor.outline;\n    }\n\n    // create new\n    const outline = new PIXI.Graphics();\n    outline.lineStyle(1, 0x000000);\n    outline.drawRect(0, 0, actor.width, actor.height);\n    outline.pivot.x = actor.width / 2;\n    outline.endFill();\n\n    actor.outline = outline;\n    actor.addChild(outline);\n  }\n}","import { IDictionary } from \"./IDictionary\"\n\ntype d<T> = IDictionary<IDictionary<T>>\n\ninterface Event {\n  pressEvent?: (() => void),\n  releaseEvent?: (() => void)\n}\n\ntype Events = d<Event>\n\ninterface State {\n  isPressed: boolean\n}\n\ntype States = d<State>\n\nexport class Gamepads {\n  static _gamepads: IDictionary<Gamepad> = {};\n  static _state: States = {};\n  static _events: Events = {};\n\n  static init(events: Events) {\n    Gamepads._events = events;\n\n    Gamepads.scanGamepads();\n\n    return Gamepads._gamepads[0] || null;\n  }\n\n  static connectHandler(event: GamepadEvent) {\n    console.log(\"gamepad connected\");\n\n    Gamepads.addGamepad(event.gamepad);\n  }\n\n  static addGamepad(gamepad: Gamepad) {\n    console.log(\"adding gamepad\", gamepad);\n\n    Gamepads._gamepads[gamepad.index] = gamepad;\n    Gamepads._state[gamepad.index] = {};\n  }\n\n  static disconnectHandler(event: GamepadEvent) {\n    console.log(\"gamepad disconnected\");\n\n    Gamepads.removeGamepad(event.gamepad);\n  }\n\n  static removeGamepad(gamepad: Gamepad) {\n    console.log(\"removing gamepad\");\n    delete Gamepads._gamepads[gamepad.index];\n    delete Gamepads._state[gamepad.index];\n  }\n\n  static updateStatus() {\n    Gamepads.scanGamepads();\n    for (const gamepadIndex in Gamepads._gamepads) {\n      if (Gamepads._gamepads.hasOwnProperty(gamepadIndex)) {\n        const gamepad: Gamepad = Gamepads._gamepads[gamepadIndex];\n\n        if (gamepad.axes) {\n          //console.log(gamepad.axes)\n        }\n\n        // sometimes controllers dont have buttons\n        if (gamepad.buttons) {\n          for (const buttonIndex in gamepad.buttons) {\n            if (gamepad.buttons.hasOwnProperty(buttonIndex)) {\n              const button: GamepadButton = gamepad.buttons[buttonIndex];\n\n              Gamepads._state[gamepadIndex][buttonIndex] =\n                Gamepads._state[gamepadIndex][buttonIndex] || {};\n              Gamepads._events[gamepadIndex][buttonIndex] =\n                Gamepads._events[gamepadIndex][buttonIndex] || {};\n\n              const state: State = Gamepads._state[gamepadIndex][buttonIndex]\n              const event: Event = Gamepads._events[gamepadIndex][buttonIndex]\n\n              if (button.pressed && !state.isPressed) {\n                console.log(\"button pressed\", gamepadIndex, buttonIndex);\n\n                state.isPressed = true;\n\n                if (event.pressEvent) {\n                  event.pressEvent()\n                }\n              }\n\n              if (!button.pressed && state.isPressed) {\n                console.log(\"button released\", gamepadIndex, buttonIndex);\n\n                state.isPressed = false;\n\n                if (event.releaseEvent) {\n                  event.releaseEvent()\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  static scanGamepads() {\n    const gamepads: Gamepad[] =\n      navigator.getGamepads ? navigator.getGamepads()\n        // @ts-ignore\n        : (navigator.webkitGetGamepads ? navigator.webkitGetGamepads() : []);\n\n    for (const gamepad of gamepads) {\n      // sometimes gamepad is undefined?!\n      if (gamepad) {\n        const gamepadIndex = gamepad.index;\n\n        // do we have this already in records?\n        if (gamepadIndex in Gamepads._gamepads) {\n          Gamepads._gamepads[gamepadIndex] = gamepad;\n        } else {\n          console.log(\"found new gamepad during scan, adding\", gamepadIndex);\n\n          Gamepads.addGamepad(gamepad);\n        }\n      }\n    }\n  }\n}\n\n// register events\n// @ts-ignore\nwindow.addEventListener(\n  \"gamepadconnected\",\n  Gamepads.connectHandler\n);\n// @ts-ignore\nwindow.addEventListener(\n  \"gamepaddisconnected\",\n  Gamepads.disconnectHandler\n);","/**\n * @class\n */\nexport class Keyboard {\n\n  /**\n   *\n   * @type {boolean}\n   * @private\n   */\n  private _isDown = false;\n  /**\n   *\n   * @type {boolean}\n   * @private\n   */\n  private _isUp = true;\n\n  // events\n  /**\n   *\n   * @type {KeyboardEvent}\n   */\n  public pressEvent: (() => void) | null = null;\n  /**\n   *\n   * @type {KeyboardEvent}\n   */\n  public releaseEvent: (() => void) | null = null;\n\n  constructor(\n    private readonly _key: string,\n    private readonly _ignoreKeyup: boolean\n  ) {\n    //Attach event listeners\n    window.addEventListener(\n      \"keydown\",\n      this._downHandler.bind(this),\n      false\n    );\n    window.addEventListener(\n      \"keyup\",\n      this._upHandler.bind(this),\n      false\n    );\n  }\n\n  get isDown() {\n    return this._isDown;\n  }\n\n  /**\n   *\n   * @param event\n   * @private\n   */\n  private _downHandler(\n    event: KeyboardEvent\n  ) {\n    if (event.key === this._key) {\n      event.preventDefault();\n\n      // if the key is up and we have a press handler\n      if (this._isUp && this.pressEvent) {\n        this.pressEvent();\n      }\n\n      this._isDown = true;\n      this._isUp = false;\n    }\n  }\n\n  /**\n   *\n   * @param event\n   * @private\n   */\n  private _upHandler(event: KeyboardEvent) {\n    if (event.key === this._key) {\n      event.preventDefault();\n\n      // if the key is down and we have a press handler\n      if (this._isDown && this.releaseEvent) {\n        this.releaseEvent();\n      }\n\n      this._isDown = false;\n      this._isUp = true;\n    }\n  }\n}","import * as PIXI from \"pixi.js\";\n\nexport class MathHelper {\n\n  /**\n   *\n   * @param min\n   * @param max\n   * @returns {number}\n   * @public\n   */\n  static getRandomInt(min: number, max: number) {\n    return Math.floor(Math.random() * (max - min)) + min;\n  }\n\n  /**\n   *\n   * @param v2\n   * @param v1\n   * @returns {number}\n   */\n  static angleBetweenRad(\n    v1: PIXI.Point,\n    v2: PIXI.Point\n  ) {\n    return Math.atan2(v2.y - v1.y, v2.x - v1.x);\n  }\n\n  /**\n   *\n   * @param v1\n   * @param v2\n   * @returns {number}\n   */\n  static distanceTo(v1: PIXI.Point, v2: PIXI.Point) {\n    return Math.sqrt(MathHelper.distanceToSq(v1, v2));\n  }\n\n  /**\n   *\n   * @param v2\n   * @param v1\n   * @returns {number}\n   */\n  static distanceToSq(v1: PIXI.Point, v2: PIXI.Point) {\n    let dx = v1.x - v2.x,\n      dy = v1.y - v2.y;\n\n    return dx * dx + dy * dy;\n  }\n}","export const ActorStates = {\n  idle: Symbol.for(\"Idle\"),\n  walking: Symbol.for(\"Walking\"),\n  fire: Symbol.for(\"Fire\"),\n  died: Symbol.for(\"Died\")\n};\n\nexport const HitLocations = {\n  Head: Symbol.for(\"Head\"),\n  Feet: Symbol.for(\"Feet\"),\n  Front: Symbol.for(\"Front\"),\n  Back: Symbol.for(\"Back\")\n};","import * as PIXI from \"pixi.js\"\nimport { AnimationBase } from \"./animation-base\"\nimport { AnimationHelper } from \"../tools\"\n\n/**\n *\n */\nexport class Door extends AnimationBase {\n\n  /**\n   *\n   * @param resources\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary\n  ) {\n    super(resources);\n\n    const which = \"things.door\"\n\n    this._clips = {\n      [which]: AnimationHelper.loadClip(\n        this._resources,\n        which,\n        0.01,\n        10\n      )\n    };\n\n\n    this._clips[which].filters = [new PIXI.filters.NoiseFilter(0.2)]\n\n    this._playClip(\n      which,\n      false,\n      false\n    );\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { ObjectBase } from \"./object-base\"\n\nexport class Crosshair extends ObjectBase {\n\n  constructor(\n    resources: PIXI.IResourceDictionary\n  ) {\n    super(resources);\n\n    this.addChild(\n      new PIXI.Text(\"x\", {\n        fill: \"#fff\"\n      })\n    )\n  }\n}\n","import { AnimationBase } from \"./animation-base\"\nimport { AnimationHelper } from \"../tools\"\n\n/**\n *\n */\nexport class Blood extends AnimationBase {\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    speed: number = 0.01\n  ) {\n    super(resources);\n    const which = \"things.blood\"\n\n    this._clips = {\n      [which]: AnimationHelper.loadClip(\n        this._resources,\n        which,\n        speed,\n        1\n      )\n    };\n\n    this._playClip(which, false, false);\n  }\n}","import PIXI from \"pixi.js\"\nimport { ActorStates } from \"../tools\";\nimport { AnimationBase } from \"../objects\"\n\n/**\n * @class\n */\nexport class ActorBase extends AnimationBase {\n\n  public outline?: PIXI.Graphics\n\n  /**\n   *\n   * @type {null}\n   * @protected\n   */\n  protected _skin?: string;\n\n  /**\n   *\n   * @type {number}\n   * @protected\n   */\n  protected _speed = 1;\n\n  /**\n   * the objects health\n   * @type {number}\n   * @protected\n   */\n  protected _health = 100;\n\n  /**\n   * the objects striking power\n   * @type {number}\n   * @protected\n   */\n  protected _power = 12;\n\n  /**\n   * @type {Symbol}\n   * @protected\n   */\n  protected _state: Symbol = ActorStates.idle;\n\n  /**\n   * can we get git again helper\n   * @type {boolean}\n   * @protected\n   */\n  protected _canGetHitAgain = true;\n\n  /**\n   * @constructor\n   */\n  constructor(\n    speed: number,\n    resources: PIXI.IResourceDictionary,\n    skin: string\n  ) {\n    super(resources);\n\n    /**\n     * set the actor skin\n     * @type {String}\n     * @protected\n     */\n    this._skin = skin;\n\n    /**\n     * the objects speed\n     * @type {number}\n     * @protected\n     */\n    this._speed = speed;\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get power() {\n    return this._power;\n  }\n\n  /**\n   *\n   * @returns {Symbol}\n   */\n  get state() {\n    return this._state;\n  }\n\n  /**\n   *\n   * @returns {number}\n   */\n  get health() {\n    return this._health;\n  }\n\n\n  /**\n   *\n   * @param state\n   * @protected\n   */\n  set state(state: Symbol) {\n    console.log(this.constructor.name, \"New state:\", state);\n    this._state = state;\n  }\n\n  /**\n   *\n   * @protected\n   */\n  protected _idle() {\n    // dont go to idle if we are dead\n    if (this._state !== ActorStates.died) {\n\n      this.state = ActorStates.idle;\n\n      this._playClip(\n        this._skin + \".stance\",\n        true\n      );\n    }\n  }\n\n  /**\n   *\n   * @protected\n   */\n  protected _died() {\n    this.state = ActorStates.died;\n\n    // remove all velocity\n    this._vy = 0;\n    this._vx = 0;\n    this._vr = 0;\n\n    // play died clip\n    this._playClip(\n      this._skin + \".died\",\n      false,\n      true\n    )\n  }\n\n  /**\n   * @public\n   * @param actor\n   * @returns {boolean}\n   */\n  public hitBy(\n    actor: ActorBase\n  ) {\n\n    let died = false;\n    let objectTookDamage = false;\n\n    if (this._canGetHitAgain) {\n\n      // lower the heal\n      this._health -= actor.power;\n\n      objectTookDamage = true;\n\n      // after we got hit we cannot get hit again\n      this._canGetHitAgain = false;\n\n      // are we death?\n      if (this._health < 0) {\n\n        this._health = 0;\n\n        // yep\n        died = true;\n\n        this._died();\n      }\n      // not died\n      else {\n\n        // force the player a little bit back on hit\n        this._vx = actor._isFacingRight ? 5 : -5;\n\n        // play the gothit clip\n        this._playClip(\n          this._skin + \".gothit\",\n          false\n        )\n          .then(() => {\n\n            // animation ended!\n\n            // remove the velocity\n            this._vx = 0;\n\n            // yep we can get hit again\n            this._canGetHitAgain = true;\n\n            // stand up and idle afterwards\n            this._idle();\n          });\n      }\n    }\n\n    return {\n      died,\n      objectTookDamage\n    };\n  }\n\n  public flip(\n    direction?: boolean\n  ) {\n    this._setIsFacingRight(\n      direction !== undefined ? direction : !this._isFacingRight\n    )\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { ObjectBase } from \"../object-base\"\nimport { Blood } from \"../blood\"\n\nexport class WeaponBase extends ObjectBase {\n  protected _power: number\n  protected _maxRounds: number\n  protected _rounds: number\n  protected _sprite?: PIXI.Sprite\n  protected _roundsSprite?: PIXI.Sprite\n\n  get rounds() {\n    return this._rounds\n  }\n\n  get sprite() {\n    return this._sprite\n  }\n\n  get roundsSprite() {\n    return this._roundsSprite\n  }\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    power: number,\n    rounds: number\n  ) {\n    super(resources);\n\n    this._power = power\n    this._rounds = rounds\n    this._maxRounds = rounds\n\n    this.zIndex = 100\n  }\n\n  public fire(): boolean {\n\n    if (this._rounds > 0) {\n      // muzzle flash\n      const muzzleFlash = new Blood(this._resources, 2)\n\n      muzzleFlash.x = 80\n      this.addChild(muzzleFlash);\n\n      this._rounds--;\n\n      return true\n    }\n\n    return false\n  }\n\n  public reload(): boolean {\n    this._rounds = this._maxRounds\n\n    console.log(\"reload\")\n    return true\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { WeaponBase } from \"./weapon-base\"\n\n/**\n *\n */\nexport class Shotgun extends WeaponBase {\n\n  /**\n   *\n   * @param resources\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary\n  ) {\n    super(resources, 55, 6);\n\n    const which = \"weapons.shotgun\"\n\n    const res = resources![which]\n\n    this._sprite = new PIXI.Sprite(\n      res.textures![\"shotgun.png\"]!\n    );\n\n    this._roundsSprite = new PIXI.Sprite(\n      res.textures![\"shell.png\"]!\n    );\n\n    this._sprite.scale.x = 0.2\n    this._sprite.scale.y = 0.2\n\n    this.x = -10\n    this.y = 40\n\n    // shotgun should be in the back so add it first\n    this.addChild(this._sprite);\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { WeaponBase } from \"./weapon-base\"\n\n/**\n *\n */\nexport class Beretta extends WeaponBase {\n\n  /**\n   *\n   * @param resources\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary\n  ) {\n    super(resources, 55, 8);\n\n    const which = \"weapons.beretta\"\n\n    const res = resources![which]\n\n    // todo: replace with correct skin\n    this._sprite = new PIXI.Sprite(\n      res.textures![\"beretta.png\"]!\n    );\n\n    this._roundsSprite = new PIXI.Sprite(\n      res.textures![\"shell.png\"]!\n    );\n\n    this._sprite.scale.x = 0.2\n    this._sprite.scale.y = 0.2\n\n    this.x = -10\n    this.y = 40\n\n    // sprite should be in the back so add it first\n    this.addChild(this._sprite);\n  }\n}","import * as PIXI from \"pixi.js\"\nimport {\n  Beretta,\n  Shotgun,\n  WeaponBase\n} from \"../objects/weapons\"\nimport { ActorBase } from \"./actor-base\"\nimport {\n  ActorStates,\n  AnimationHelper,\n  MathHelper\n} from \"../tools\"\nimport { Config } from \"../config\"\n\n\nconst weapons: {\n  shotgun?: Shotgun,\n  beretta?: Beretta\n} = {}\n\n/**\n *\n */\nexport class Player extends ActorBase {\n\n  private _weapon: WeaponBase\n  private _name: string = \"Gordon\"\n\n  get weapon(): WeaponBase {\n    return this._weapon\n  }\n\n  get name() {\n    return this._name\n  }\n\n  /**\n   *\n   * @param resources\n   * @param skin\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    skin: string\n  ) {\n    super(\n      3,\n      resources,\n      skin\n    );\n\n    this._baseScale = 0.7\n\n    this._health = 77;\n\n    // load the clips for this object\n    this._clips[this._skin + \".stance\"] = AnimationHelper.loadClip(this._resources, this._skin + \".stance\", 0.1, 2);\n    this._clips[this._skin + \".walk\"] = AnimationHelper.loadClip(this._resources, this._skin + \".walk\", 0.2, 2);\n    this._clips[this._skin + \".punch\"] = AnimationHelper.loadClip(this._resources, this._skin + \".punch\", 0.3, 2);\n    this._clips[this._skin + \".kick\"] = AnimationHelper.loadClip(this._resources, this._skin + \".kick\", 0.2, 2);\n    this._clips[this._skin + \".gothit\"] = AnimationHelper.loadClip(this._resources, this._skin + \".gothit\", 0.2, 2);\n    this._clips[this._skin + \".died\"] = AnimationHelper.loadClip(this._resources, this._skin + \".died\", 0.2, 2);\n\n    weapons.shotgun = new Shotgun(resources)\n    weapons.beretta = new Beretta(resources)\n\n    // todo get this from equipment\n    this._weapon = weapons.beretta\n    this.addChild(this._weapon)\n\n    // go to idle\n    this._idle();\n  }\n\n  public reload() {\n    // todo check equipment for shells\n    this._weapon.reload()\n  }\n\n  public switchWeapon() {\n    this.removeChild(this._weapon)\n\n    if (this._weapon instanceof Shotgun) {\n      this._weapon = weapons.beretta!\n    } else {\n      this._weapon = weapons.shotgun!\n    }\n\n    this.addChild(this._weapon)\n  }\n\n  public updateCrosshairPosition(\n    crosshairPosition: PIXI.Point\n  ) {\n    const angle: number = this._isFacingRight ?\n      MathHelper.angleBetweenRad(this.weaponLocation, crosshairPosition) :\n      -1 * MathHelper.angleBetweenRad(crosshairPosition, this.weaponLocation)\n    this._weapon.rotation = angle\n  }\n\n  get weaponLocation(): PIXI.Point {\n    return this.toGlobal(\n      this._weapon.position\n    )\n  }\n\n  /**\n   *\n   * @returns {boolean}\n   * @private\n   */\n  private _canBeControlled() {\n    if (this._state === ActorStates.died) {\n      console.log(\"Cant be controlled, player is dead\");\n      return false\n    }\n\n    return (\n      this._state === ActorStates.idle ||\n      this._state === ActorStates.walking\n    );\n  }\n\n  private _logPlayerCoordinates() {\n    if (Config.logPlayerCoordinates) {\n      console.log(\n        \"x\", this.x,\n        \"real x\", this.realx,\n        \"y\", this.y,\n        \"width\", this.width,\n        \"height\", this.height\n      )\n    }\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _died() {\n    super._died();\n\n    // todo: add dying animation\n    // the died animation is way lower so we need to\n    // adjust the hight a bit\n    this.y += this.height / 2;\n  }\n\n  /**\n   * @public\n   */\n  public fire(): boolean {\n    if (this._canBeControlled()) {\n      console.log(\"Päng!\");\n      this.state = ActorStates.fire;\n\n      this._vx = 0;\n      this._vy = 0;\n\n      const fire = this._weapon.fire()\n      if (fire) {\n        this._playClip(\n          this._skin + \".punch\",\n          false\n        )\n          .then(() => {\n            this._idle();\n          });\n        return true\n      } else {\n        this._idle()\n      }\n    }\n\n    return false\n  }\n\n  /**\n   * @public\n   */\n  public moveRight() {\n    if (this._canBeControlled()) {\n      this._vx = this._speed;\n      this._playClip(\n        this._skin + \".walk\",\n        true\n      );\n      this.state = ActorStates.walking;\n\n      this._adaptScaleBasedOnOrientation();\n\n      this._logPlayerCoordinates();\n    }\n  }\n\n  /**\n   * @public\n   */\n  public moveLeft() {\n    if (this._canBeControlled()) {\n      this._vx = -this._speed;\n      this._playClip(\n        this._skin + \".walk\",\n        true\n      );\n      this.state = ActorStates.walking;\n      this._adaptScaleBasedOnOrientation();\n\n      this._logPlayerCoordinates();\n    }\n  }\n\n  /**\n   * @public\n   */\n  public stopMoveHorizontally() {\n    this._vx = 0;\n    if (this._vy === 0 && this._canBeControlled()) {\n      this._idle();\n    }\n  }\n\n  /**\n   * @public\n   */\n  public moveUp() {\n    if (this._canBeControlled()) {\n      this._vy = -this._speed;\n      this._playClip(\n        this._skin + \".walk\",\n        true\n      );\n      this.state = ActorStates.walking;\n\n      this._logPlayerCoordinates();\n    }\n  }\n\n  /**\n   * @public\n   */\n  public moveDown() {\n    if (this._canBeControlled()) {\n      this._vy = this._speed;\n      this._playClip(\n        this._skin + \".walk\",\n        true\n      );\n      this.state = ActorStates.walking;\n\n      this._logPlayerCoordinates();\n    }\n  }\n\n  /**\n   * @public\n   */\n  public stopMoveVertically() {\n    this._vy = 0;\n    if (this._vx === 0 && this._canBeControlled()) {\n      this._idle();\n    }\n  }\n}","import * as PIXI from \"pixi.js\";\nimport { EnemyBase } from \"./enemy-base\"\n\n/**\n *\n */\nexport class Bat extends EnemyBase {\n\n  /**\n   *\n   * @param resources\n   * @param skin\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    skin: string\n  ) {\n    super(resources, skin, 1);\n  }\n}","import * as PIXI from \"pixi.js\";\nimport { ActorStates } from \"../../tools/enums\";\nimport { ActorBase } from \"../actor-base\"\nimport { AnimationHelper, MathHelper } from \"../../tools\"\n\n/**\n *\n */\nexport class EnemyBase extends ActorBase {\n\n  // time delta of last sprite flip\n  private _lastFlip = 0;\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    skin: string,\n    speed: number = 2\n  ) {\n\n    super(speed, resources, skin);\n\n    this._isFacingRight = false;\n\n    // load the clips for this object\n    this._clips[this._skin + \".walk\"] =\n      AnimationHelper.loadClip(this._resources, this._skin + \".walk\", 0.2, 2.2);\n    this._clips[this._skin + \".gothit\"] = this._clips[this._skin + \".walk\"];\n    this._clips[this._skin + \".died\"] = this._clips[this._skin + \".walk\"];\n\n    // go to idle\n    this._idle();\n\n//\t\tthis._vr = 0.1;\n//\t\tthis.pivot.set(Math.abs(this.width) / 2, this.height);\n\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _idle() {\n    this.state = ActorStates.idle;\n    this._playClip(\n      this._skin + \".walk\",\n      true\n    );\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _died() {\n    super._died();\n\n    // set proper death location\n    this.y += this.height / 2;\n    this.pivot.set(Math.abs(this.width) / 2, this.height);\n    this.rotation = 90 * Math.PI / 180;\n\n    //console.log(\"pivot\", this.pivot);\n\n    setTimeout(() => {\n      this.parent.removeChild(this);\n    }, 10 * 1000);\n  }\n\n  /**\n   *\n   * @returns {boolean}\n   * @private\n   */\n  private _canFlipAgain() {\n    let canFlip = true;\n    if (Date.now() - this._lastFlip > 200) {\n      canFlip = true;\n      this._lastFlip = Date.now();\n    }\n\n    return canFlip;\n  }\n\n  /**\n   *\n   * @param target\n   */\n  public moveTowards(target: PIXI.Point) {\n\n    /*\n     this.pivot.set(this.width / 2, this.height);\n     this.rotation += 0.1;\n\n     return;*/\n\n    const dist = MathHelper.distanceTo(this.position, target);\n\n    let vx = 0;\n    let vy = 0;\n\n    if (dist > 1) {\n      let angleToTarget = MathHelper.angleBetweenRad(this.position, target);\n\n      vy = Math.sin(angleToTarget) * this._speed;\n      vx = Math.cos(angleToTarget) * this._speed;\n\n      // flip player over\n      if (vx > 0 && !this._isFacingRight && this._canFlipAgain()) {\n\n        //console.log(\"Enemy:\", \"flip left\");\n        this.flip();\n      }\n      // flip player over\n      else if (vx < 0 && this._isFacingRight && this._canFlipAgain()) {\n\n        //console.log(\"Enemy:\", \"flip right\");\n        this.flip();\n      }\n    }\n\n    this._vy = vy;\n    this._vx = vx;\n  }\n}","import * as PIXI from \"pixi.js\";\nimport { Bat } from \"./bat\"\n\n/**\n *\n */\nexport class BatInfected extends Bat {\n\n\n  /**\n   *\n   * @param resources\n   * @param skin\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    skin: string\n  ) {\n    super(resources, skin);\n\n    this._baseScale = 2.5\n\n    // todo make this a red'isch filter\n    const f = new PIXI.filters.ColorMatrixFilter()\n    f.lsd(false)\n    this.filters = [f]\n\n    this.scale.x = this._baseScale\n    this.scale.y = this._baseScale\n  }\n}","import * as PIXI from \"pixi.js\"\n\n/**\n *\n */\nexport class MapBase extends PIXI.Container {\n\n  private readonly _explorationOffset: number\n  protected _textures?: PIXI.ITextureDictionary\n  protected _backgroundContainer: PIXI.Container\n  protected _actorContainer: PIXI.Container\n  protected _foregroundContainer: PIXI.Container\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    protected _width: number,\n    mapToLoad?: string\n  ) {\n    super();\n\n    this._explorationOffset = this._width / 3;\n\n    if (mapToLoad) {\n      // load the clips for this object\n      this._textures = resources[mapToLoad].textures;\n    }\n\n    /**\n     * setup background\n     * @type {PIXI.Container}\n     * @private\n     */\n    this._backgroundContainer = new PIXI.Container();\n    this.addChild(this._backgroundContainer);\n\n    /**\n     * setup actors\n     * @type {PIXI.Container}\n     * @private\n     */\n    this._actorContainer = new PIXI.Container();\n    this.addChild(this._actorContainer);\n\n    /**\n     * setup foreground\n     * @type {PIXI.Container}\n     * @private\n     */\n    this._foregroundContainer = new PIXI.Container();\n    this.addChild(this._foregroundContainer);\n  }\n\n  /**\n   *\n   * @returns {PIXI.Container}\n   */\n  get actorContainer() {\n    return this._actorContainer;\n  }\n\n  /**\n   *\n   * @returns {PIXI.Container}\n   */\n  get backgroundContainer() {\n    return this._backgroundContainer;\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setup() {\n    // stub\n  }\n\n  /**\n   *\n   * @param playerX\n   * @param scrollAmount\n   */\n  public shallScroll(\n    playerX: number,\n    scrollAmount: number\n  ) {\n    if (\n      // move right\n      (scrollAmount > 0 && playerX + this._explorationOffset > this._width) ||\n      // move left\n      (scrollAmount < 0 && playerX - this._explorationOffset < this._explorationOffset)\n    ) {\n      // move map based on positive or negative scroll amount\n      this.x -= scrollAmount\n\n      // left bound\n      if (this.x > 0) {\n        this.x = 0\n      }\n\n      // right bound\n      if (this.x < this._width - this.width) {\n        this.x = this._width - this.width\n      }\n    }\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { MapBase } from \"./map-base\"\n\nconst {Sound} = require(\"pixi-sound\").default\n\n/**\n *\n */\nexport class MaensionOutside extends MapBase {\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    width: number\n  ) {\n    super(resources, width, \"maps.maension\")\n\n    let starryNight = new PIXI.Sprite(\n      this._textures![\"tumblr_inline_n258q4r8c01qhwjx8.png\"]\n    );\n    starryNight.scale.x = 2.56;\n    starryNight.scale.y = 2.56;\n\n    this._backgroundContainer.addChild(starryNight);\n\n    let maension = new PIXI.Sprite(\n      this._textures![\"Maension_WIP.png\"]\n    );\n\n    maension.y = -40\n    maension.scale.x = 2;\n    maension.scale.y = 2;\n\n    this._backgroundContainer.addChild(maension);\n\n    const tree = this._textures![\"tree.png\"]\n    const tree1 = new PIXI.Sprite(tree);\n    tree1.x = 100\n    tree1.y = 350\n    tree1.scale.x = 0.4\n    tree1.scale.y = 0.4\n\n    this._foregroundContainer.addChild(tree1)\n\n    const tree_dead = this._textures![\"tree_dead.png\"]\n    const tree2 = new PIXI.Sprite(tree_dead);\n    tree2.x = 50\n    tree2.y = 180\n    tree2.scale.x = 0.4\n    tree2.scale.y = 0.4\n\n    this._backgroundContainer.addChild(tree2)\n\n    this._setup()\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setup() {\n    const z1 = Sound.from('assets/sounds/zombie1.mp3');\n    const z2 = Sound.from('assets/sounds/zombie1.mp3');\n\n    setInterval(() => {\n      z1.play();\n    }, 15 * 1000)\n\n    setInterval(() => {\n      z2.play();\n    }, 8 * 1000)\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { MapBase } from \"./map-base\"\n\nconst {Sound} = require(\"pixi-sound\").default\n\n/**\n *\n */\nexport class HouseOutside extends MapBase {\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    width: number\n  ) {\n    super(resources, width, \"maps.house\")\n\n    this._setup()\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setup() {\n    let city = new PIXI.Sprite(\n      // @ts-ignore\n      this._textures[\"house.png\"]\n    );\n\n    city.scale.x = 1.3;\n    city.scale.y = 1.3;\n\n    this._backgroundContainer.addChild(city);\n\n    const z1 = Sound.from('assets/sounds/zombie1.mp3');\n    const z2 = Sound.from('assets/sounds/zombie1.mp3');\n\n    setInterval(() => {\n      z1.play();\n    }, 15 * 1000)\n\n    setInterval(() => {\n      z2.play();\n    }, 8 * 1000)\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { MapBase } from \"./map-base\"\n\n/**\n *\n */\nexport class Street extends MapBase {\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    width: number,\n  ) {\n    super(resources, width, \"maps.street\")\n\n    this._setup()\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setup() {\n\n    // background\n\n    // load city first because we need the width\n    // @ts-ignore\n    let city = new PIXI.Sprite(this._textures[\"city01.png\"]);\n    let cityWidth = city.width;\n    city.scale.x = 2;\n    city.scale.y = 2.1;\n    city.y = -100;\n\n    let concret = new PIXI.TilingSprite(\n      // @ts-ignore\n      this._textures[\"concret.png\"]\n    );\n    concret.width = cityWidth;\n    concret.height = 300;\n    concret.scale.x = 2;\n    concret.scale.y = 1.44;\n    concret.y = 330;\n\n    // concret should be in the back so add it first\n    this._backgroundContainer.addChild(concret);\n\n    this._backgroundContainer.addChild(city);\n\n    // foreground\n    // @ts-ignore\n    let police = new PIXI.Sprite(this._textures[\"police.png\"]);\n    police.scale.x = 2;\n    police.scale.y = 2;\n\n    police.y = this.height - police.height * 2;\n    police.x = 300;\n    this._foregroundContainer.addChild(police);\n  }\n}","import * as PIXI from \"pixi.js\"\nimport { Door } from \"../objects\"\nimport { MapBase } from \"./map-base\"\n\n/**\n *\n */\nexport class Loading extends MapBase {\n\n  private readonly _door: Door\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    width: number\n  ) {\n    super(resources, width);\n\n    this._door = new Door(resources)\n    this._door.position.x = (width / 2) - (this._door.width / 2)\n\n    this._setup()\n  }\n\n  /**\n   *\n   * @private\n   */\n  protected _setup() {\n    this._foregroundContainer.addChild(this._door);\n  }\n}","import * as PIXI from \"pixi.js\";\nimport { Player } from \"../actors\"\n\nexport class HUD extends PIXI.Container {\n\n  private _player: Player\n  private _health: PIXI.Text\n\n  // round icons\n  private _rounds: PIXI.Container\n  // weapon icon\n  private _weapon?: PIXI.Sprite\n\n  // change to \"you are dead ...\"\n  private _gameOverSign?: PIXI.Text\n\n  private _width: number\n  private _height: number\n\n  static bigText: PIXI.TextStyle = {\n    fontFamily: \"Arial Black\",\n    fontSize: \"48px\",\n    fontWeight: \"bold\",\n    fill: \"#fff\",\n    dropShadow: true,\n    dropShadowColor: \"#000\",\n    align: \"center\"\n  } as PIXI.TextStyle\n\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    player: Player,\n    width: number,\n    height: number\n  ) {\n    super();\n\n    const which = \"things.hud\"\n\n    const res = resources[which]\n\n    this._width = width;\n    this._height = height;\n\n    console.log(\n      \"Setting up HUD\",\n      \"width:\", this._width,\n      \"height:\", this._height\n    );\n\n    this._player = player;\n\n    const smallTextConfig = {\n      ...HUD.bigText,\n      fontSize: \"12px\"\n    }\n\n    const playerName = new PIXI.Text(\n      player.name,\n      {\n        ...smallTextConfig,\n        fill: \"#ffff30\",\n      }\n    );\n    playerName.x = this._width / 3 - playerName.width / 2;\n    playerName.y = this._height - 47;\n    this.addChild(playerName);\n\n    this._health = new PIXI.Text(\n      \"\",\n      smallTextConfig\n    );\n\n    this._health.x = playerName.x;\n    this._health.y = this._height - 23;\n    this.addChild(this._health);\n\n    this._rounds = new PIXI.Container()\n    this._rounds.x = (this._width / 3) + 77\n    this._rounds.y = this._height - 33\n\n    this.addChild(this._rounds)\n\n    const healthBorder = new PIXI.Sprite(\n      res.textures![\"side.png\"]\n    );\n\n    healthBorder.x = this._width / 2 - (healthBorder.width + healthBorder.width / 2)\n    healthBorder.y = this._height - healthBorder.height\n\n    this.addChild(healthBorder);\n\n    const roundsBorder = new PIXI.Sprite(\n      res.textures![\"center.png\"]\n    );\n    roundsBorder.x = this._width / 2 - roundsBorder.width / 2\n    roundsBorder.y = this._height - roundsBorder.height\n\n    this.addChild(roundsBorder);\n\n    const weaponBorder = new PIXI.Sprite(\n      res.textures![\"side.png\"]\n    );\n\n    weaponBorder.x = this._width / 2 + roundsBorder.width + weaponBorder.width / 2\n    weaponBorder.y = this._height - weaponBorder.height\n\n    weaponBorder.scale.x = -1\n\n    this.addChild(weaponBorder);\n\n    this.update();\n  }\n\n  private _renderWeapon() {\n    this.removeChild(this._weapon!)\n\n    this._weapon = new PIXI.Sprite(this._player.weapon.sprite!.texture)\n    this._weapon.scale.x = this._player.weapon.sprite!.scale.x\n    this._weapon.scale.y = this._player.weapon.sprite!.scale.y\n\n    this._weapon.x = this._width / 2 + (this._weapon.width + 27)\n    this._weapon.y = this._height - 40\n\n    this.addChild(this._weapon)\n  }\n\n  private _renderRounds() {\n\n    this._rounds.removeChildren()\n\n    for (let x = 0; x < this._player.weapon.rounds; x++) {\n\n      const roundSprite = new PIXI.Sprite(this._player.weapon.roundsSprite?.texture)\n      roundSprite.scale.x = 0.1\n      roundSprite.scale.y = 0.1\n      roundSprite.x = 10 * x\n      roundSprite.y = 10\n\n      this._rounds.addChild(roundSprite)\n    }\n\n  }\n\n  public update() {\n    this._health.text = this._player.health + \" HP\";\n\n    this._renderRounds()\n    this._renderWeapon()\n  }\n\n  public renderGameOver() {\n    this._gameOverSign = new PIXI.Text(\n      \"Game Over\\nPress Enter to retry!\",\n      {\n        ...HUD.bigText,\n        fill: \"#f00\"\n      }\n    );\n\n    this.addChild(this._gameOverSign);\n\n    // place game over sign in center of screen\n    this._gameOverSign.x = (this._width / 2) - (this._gameOverSign.width / 2)\n    this._gameOverSign.y = (this._height / 2) - (this._gameOverSign.height / 2)\n  }\n\n  public animate(delta: number) {\n    if (this._gameOverSign) {\n      this._gameOverSign.alpha += delta / 1000;\n      if (this._gameOverSign.alpha > 1) {\n        this._gameOverSign.alpha = 0.2;\n      }\n    }\n  }\n}","import * as PIXI from \"pixi.js\";\nimport { Config } from \"./config\";\nimport {\n  Blood,\n  Crosshair\n} from \"./objects\"\nimport {\n  ActorBase,\n  Bat,\n  BatInfected,\n  EnemyBase,\n  Player\n} from \"./actors\"\nimport {\n  HouseOutside,\n  Loading,\n  MaensionOutside,\n  MapBase,\n  Street\n} from \"./maps\"\nimport {\n  ActorStates,\n  AnimationHelper,\n  Gamepads,\n  Keyboard,\n  MathHelper\n} from \"./tools\"\nimport {\n  HUD\n} from \"./ui\"\nimport { IDictionary } from \"./tools/IDictionary\"\n\nlet maps: IDictionary<MapBase> = {}\n\n/**\n * @class\n */\nexport default class Game {\n  private _stage: PIXI.Container\n\n  private _hud?: HUD\n  private _map?: MapBase\n  private _player?: Player\n  private _enemies: EnemyBase[] = [];\n  private _mouseLocation?: PIXI.Point\n\n  private _isRunning: boolean = true;\n\n  private _startOffset?: number\n  private _elapsedSeconds = 0;\n  private readonly _resources: PIXI.IResourceDictionary\n\n  private readonly _width: number\n  private readonly _height: number\n\n  private _mouseLine?: PIXI.Graphics\n  private _crosshair?: Crosshair\n\n  private static timeout: number = 300;\n\n  /**\n   *\n   * @param resources\n   * @param stage\n   * @param width\n   * @param height\n   */\n  constructor(\n    resources: PIXI.IResourceDictionary,\n    stage: PIXI.Container,\n    width: number, height: number\n  ) {\n    this._stage = stage;\n\n    this._resources = resources;\n    this._width = width;\n    this._height = height;\n\n    maps.street = new Street(\n      this._resources,\n      this._width,\n    );\n\n    maps.house = new HouseOutside(\n      this._resources,\n      this._width,\n    );\n\n    maps.maension = new MaensionOutside(\n      this._resources,\n      this._width\n    );\n\n    maps.loading = new Loading(\n      this._resources,\n      this._width\n    );\n\n    this._init();\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _init() {\n    this._mouseLine = new PIXI.Graphics();\n    this._crosshair = new Crosshair(this._resources)\n\n    this._map = maps.maension!\n    this._stage.addChild(this._map);\n    this._stage.cursor = \"none\"\n\n    // create player\n    this._player = new Player(this._resources, \"ryu\");\n\n    this._player.x = 60\n    this._player.y = 400\n\n    this._player!.adaptScale(this._player!.y, this._height)\n    this._crosshair!.adaptScale(this._player!.y, this._height)\n\n    // add player to stage\n    this._map.actorContainer.addChild(this._player);\n\n    const bat1 = new Bat(this._resources, \"bat\")\n    bat1.flip()\n\n    const bat2 = new Bat(this._resources, \"bat\")\n    const bat3 = new BatInfected(this._resources, \"bat\")\n\n    bat1.position.x = 900\n    bat1.position.y = 200\n\n    bat2.position.x = 920\n    bat2.position.y = 220\n\n    bat3.position.x = 880\n    bat3.position.y = 240\n\n    this._map.actorContainer.addChild(bat1);\n    this._map.actorContainer.addChild(bat2);\n    this._map.actorContainer.addChild(bat3);\n\n    // attach the keyboard to player\n    const gamepad = this._attachGamepad();\n\n    // no gamepad, go to stinky keyboard\n    if (!gamepad) {\n\n      console.log(\"no gamepad, attaching stinky keyboard\");\n      this._attachKeyboard()\n    }\n\n    // init enemies\n    this._enemies = [\n      bat3\n    ];\n\n    this._hud = new HUD(\n      this._resources,\n      this._player,\n      this._width,\n      this._height\n    );\n\n    this._stage.addChild(this._hud);\n\n    this._updateHud();\n\n    this._attachMouse()\n\n    this._updateMouseLocation(new PIXI.Point(this._width / 2, this._height / 2))\n\n    this._startOffset = undefined;\n\n    // this game is running baby\n    this._isRunning = true;\n\n    console.log(\n      \"Game:\",\n      \"Game init done!\"\n    );\n  }\n\n  private _attachMouse() {\n    this._stage.addChild(this._mouseLine!)\n    this._stage.addChild(this._crosshair!)\n\n    this._stage.interactive = true\n    this._stage.on(\n      \"mousemove\",\n      (e: PIXI.InteractionEvent) => {\n        this._updateMouseLocation(e.data.global)\n      })\n\n    this._stage.on(\n      \"mousedown\",\n      () =>\n        this._fire()\n    )\n\n    this._stage.on(\n      \"mouseout\",\n      () => this._isRunning = false\n    )\n\n    this._stage.on(\n      \"mouseover\",\n      () => this._isRunning = this._player!.state !== ActorStates.died\n    )\n  }\n\n  private _updateCrosshair() {\n    if (\n      this._mouseLocation &&\n      this._isRunning &&\n      this._player?.state !== ActorStates.died\n    ) {\n      this._crosshair!.x = this._mouseLocation!.x - this._crosshair!.width / 2\n      this._crosshair!.y = this._mouseLocation!.y - this._crosshair!.height / 2\n\n      // flip player based on crosshair position\n      if (this._crosshair!.x < this._player!.toGlobal(this._stage).x) {\n        this._player!.flip(false)\n      } else {\n        this._player!.flip(true)\n      }\n\n      // update player based on crosshair\n      this._player!.updateCrosshairPosition(\n        this._stage.toGlobal(this._crosshair?.position!)\n      )\n\n      // adapt crosshair scale based on player location\n      this._crosshair!.adaptScale(this._player!.y, this._height)\n    }\n  }\n\n  private _fire() {\n    if (this._isRunning) {\n      if (this._player?.fire()) {\n        // hit location\n        const impact = new Blood(this._resources, 2)\n        const impactLocation = this._map!.toLocal(this._crosshair!)\n        impact.x = impactLocation.x\n        impact.y = impactLocation.y\n\n        this._map?.backgroundContainer.addChild(impact);\n\n        this._updateHud()\n      }\n    }\n  }\n\n  private _moveRight() {\n    if (this._isRunning && this._player) {\n      this._player.moveRight();\n    }\n  }\n\n  private _moveLeft() {\n    if (this._isRunning && this._player) {\n      this._player.moveLeft();\n    }\n  }\n\n  private _moveUp() {\n    if (this._isRunning && this._player) {\n      this._player.moveUp();\n    }\n  }\n\n  private _moveDown() {\n    if (this._isRunning && this._player) {\n      this._player.moveDown();\n    }\n  }\n\n  private _stopMoveVertically() {\n    if (this._isRunning) {\n      this._player?.stopMoveVertically();\n    }\n  }\n\n  private _stopMoveHorizontally() {\n    if (this._isRunning) {\n      this._player?.stopMoveHorizontally();\n    }\n  }\n\n  private _attachKeyboard() {\n    const\n      left = new Keyboard(\"ArrowLeft\", true),\n      up = new Keyboard(\"ArrowUp\", true),\n      right = new Keyboard(\"ArrowRight\", true),\n      down = new Keyboard(\"ArrowDown\", true),\n\n      k = new Keyboard(\"k\", false),\n      w = new Keyboard(\"w\", false),\n      r = new Keyboard(\"r\", false),\n\n      enter = new Keyboard(\"Enter\", false);\n\n    k.pressEvent = () => this._fire()\n    w.pressEvent = () => this._switchWeapon()\n    r.pressEvent = () => this._reload()\n\n    right.pressEvent = () => this._moveRight()\n    right.releaseEvent = () => {\n      if (!left.isDown) {\n        this._stopMoveHorizontally()\n      }\n    };\n\n    left.pressEvent = () => this._moveLeft()\n    left.releaseEvent = () => {\n      if (!right.isDown) {\n        this._stopMoveHorizontally()\n      }\n    };\n\n    up.pressEvent = () => this._moveUp()\n    up.releaseEvent = () => {\n      if (!down.isDown) {\n        this._stopMoveVertically()\n      }\n    };\n\n    down.pressEvent = () => this._moveDown()\n    down.releaseEvent = () => {\n      if (!up.isDown) {\n        this._stopMoveVertically()\n      }\n    };\n\n    enter.pressEvent = () => {\n      if (!this._isRunning) {\n        this._init();\n      }\n    }\n  }\n\n  private _attachGamepad(): boolean {\n    return !!Gamepads.init({\n      // first gamepad\n      0: {\n        // button 1 pressed\n        1: {\n          pressEvent: () => {\n            this._fire()\n          }\n        },\n        // button 15 pressed\n        15: {\n          pressEvent: () => this._moveRight(),\n          releaseEvent: () => this._stopMoveHorizontally()\n        },\n        // button 14 pressed\n        14: {\n          pressEvent: () => this._moveLeft(),\n          releaseEvent: () => this._stopMoveHorizontally()\n        },\n        // button 12 pressed\n        12: {\n          pressEvent: () => this._moveUp(),\n          releaseEvent: () => this._stopMoveVertically()\n        },\n        // button 13 pressed\n        13: {\n          pressEvent: () => this._moveDown(),\n          releaseEvent: () => this._stopMoveVertically()\n        },\n        // button 9 pressed\n        9: {\n          pressEvent: () => {\n            if (!this._isRunning) {\n              this._init();\n            }\n          }\n        }\n      }\n    })\n  }\n\n  /**\n   * this will end the game\n   * @private\n   */\n  private _end() {\n    // game is not longer running dude\n    this._isRunning = false;\n\n    this._hud!.renderGameOver();\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _detectCollisions() {\n    for (const enemy of this._enemies) {\n      if (ActorStates.died !== enemy.state &&\n        ActorStates.died !== this._player!.state) {\n        // does the player collide the enemy?\n        if (this._player!.collides(enemy)) {\n          const playerHit = this._player!.hitBy(enemy);\n\n          if (playerHit.objectTookDamage) {\n            this._drawBlood(this._player!);\n            this._updateHud();\n          }\n\n          // we died and now lives left :(\n          if (playerHit.died) {\n            // end the game\n            this._end();\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   *\n   * @param actor: the bleeding actor\n   * @private\n   */\n  private _drawBlood(\n    actor: ActorBase\n  ) {\n    for (let i = 0; i < 5; i++) {\n      const blood = new Blood(this._resources);\n\n      blood.x = actor.x + MathHelper.getRandomInt(-20, 20);\n      blood.y = actor.y + actor.height + MathHelper.getRandomInt(-20, 20);\n      blood.rotation = MathHelper.getRandomInt(0, 10);\n\n      this._map?.backgroundContainer.addChild(blood);\n    }\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _updateHud() {\n    this._hud!.update();\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _updateKI() {\n    for (const enemy of this._enemies) {\n      if (ActorStates.died !== enemy.state) {\n        enemy.moveTowards(this._player!.position);\n      }\n    }\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _moveActors() {\n\n    const {_player} = this\n    let playerMoved = false\n\n    if (\n      // do we have velocity?\n      _player!.vy !== 0 &&\n      _player!.y + _player!.vy > 0 &&\n      // dont move lower than the bottom\n      _player!.y + _player!.height + _player!.vy < this._height\n    ) {\n      _player!.y += _player!.vy;\n      playerMoved = true\n    }\n\n    // move right\n    if (_player!.vx > 0) {\n      // dont walk further than the right border of the map\n      if (\n        _player!.realx +\n        Math.abs(_player!.width) + 7 +\n        _player!.vx < this._map!.width\n      ) {\n        _player!.x += _player!.vx;\n        playerMoved = true\n      }\n    }\n    // move left\n    else if (_player!.vx < 0) {\n      // detect left col\n      if (\n        _player!.realx + _player!.vx >= 0\n      ) {\n        _player!.x += _player!.vx;\n        playerMoved = true\n      }\n    }\n\n    if (playerMoved) {\n      // yep, so try to scroll the map\n      this._map?.shallScroll(\n        _player!.realx,\n        _player!.vx\n      );\n      this._updateCrosshair()\n\n      this._player!.adaptScale(this._player!.y, this._height)\n    }\n\n    // move the enemies\n    for (const enemy of this._enemies) {\n\n      if (\n        enemy.vx !== 0 ||\n        enemy.vy !== 0 ||\n        enemy.vr !== 0\n      ) {\n        enemy.x += enemy.vx;\n        enemy.y += enemy.vy;\n        enemy.rotation += enemy.vr;\n\n        enemy.adaptScale(enemy.y, this._height)\n      }\n    }\n\n  }\n\n  private _outlineMouse() {\n    if (\n      this._mouseLine && this._mouseLocation &&\n      this._player && this._map\n    ) {\n      this._mouseLine.clear()\n      this._mouseLine.lineStyle(1, 0xffffff);\n\n      // from\n      this._mouseLine.position =\n        this._player.weaponLocation\n\n      // to\n      const {x, y} = this._mouseLine.toLocal(this._mouseLocation)\n      this._mouseLine.lineTo(\n        x, y\n      );\n\n      this._mouseLine.endFill();\n    }\n  }\n\n  private _switchWeapon() {\n    if (this._isRunning) {\n      this._player!.switchWeapon()\n      this._updateHud()\n    }\n  }\n\n  private _reload() {\n    if (this._isRunning) {\n      this._player!.reload()\n      this._updateHud()\n    }\n  }\n\n  private _updateMouseLocation(\n    mouseLocation: PIXI.Point\n  ) {\n    if (this._isRunning) {\n      this._mouseLocation = mouseLocation\n      this._updateCrosshair()\n    }\n  }\n\n  /**\n   *\n   * @param elapsed\n   * @param delta\n   * @public\n   */\n  public update(\n    elapsed: number,\n    delta: number\n  ) {\n    Gamepads.updateStatus();\n\n    this._hud!.animate(delta);\n\n    if (this._isRunning) {\n      const elapsedSeconds = parseInt((elapsed / 1000).toString());\n\n      // game has not started\n      if (!this._startOffset) {\n        this._startOffset = elapsedSeconds;\n      }\n\n      const correctedElapsedSeconds = (elapsedSeconds - this._startOffset);\n\n      if (correctedElapsedSeconds !== this._elapsedSeconds) {\n        this._elapsedSeconds = correctedElapsedSeconds;\n        this._updateHud();\n      }\n\n      if (Game.timeout - correctedElapsedSeconds <= 0) {\n        // times up!\n        console.log(\"Time is up, dude!\");\n        this._end();\n      }\n\n      this._detectCollisions();\n      this._updateKI();\n      this._moveActors();\n\n      const sort = (a: PIXI.DisplayObject, b: PIXI.DisplayObject) => {\n        if (a.position.y < b.position.y) {\n          return 1;\n        }\n\n        if (a.position.y > b.position.y) {\n          return -1;\n        }\n\n        return 0;\n      }\n\n      // ensure z index for actors\n      this._map?.actorContainer.children\n        .sort(sort);\n\n      if (Config.outlineActors) {\n        // outline player\n        AnimationHelper.outlineContainer(this._player!);\n\n        // outline enemies\n        for (const enemy of this._enemies) {\n          AnimationHelper.outlineContainer(enemy);\n        }\n\n        // outline mouse line\n        this._outlineMouse()\n      }\n    }\n  }\n}","import * as PIXI from \"pixi.js\";\nimport Game from \"./game\";\nimport { Config } from \"./config\"\n\nexport default class Maension {\n\n  private _lastFrame: number = 0\n  private _fpsCount: number = 0\n  private _fpsTimer: number = 0\n  private _game?: Game\n  private readonly _renderer: PIXI.Renderer\n  private readonly _stage: PIXI.Container\n  private readonly _stageWrapper: PIXI.Container\n  private readonly _fps?: PIXI.Text\n\n  constructor(container: HTMLDivElement) {\n\n    this._renderer = PIXI.autoDetectRenderer({\n      width: 800,\n      height: 600,\n      backgroundColor: 0x1099bb\n    });\n\n    container.appendChild(this._renderer.view);\n\n    console.log(\"Viewport\", window.innerWidth, window.innerHeight);\n\n    // create the root of the scene graph\n    this._stage = new PIXI.Container();\n\n    this._stageWrapper = new PIXI.Container();\n    this._stageWrapper.addChild(this._stage)\n\n    if (Config.showFPS) {\n      this._fps = new PIXI.Text(\"FPS: \", {\n        fontWeight: \"16px\",\n        fill: \"#fff\"\n      } as PIXI.TextStyle);\n      this._fps.x = 10\n      this._fps.y = 10\n      this._stageWrapper.addChild(this._fps)\n    }\n\n    this._animate.bind(this);\n    this._assetsLoaded.bind(this);\n  }\n\n  /**\n   *\n   */\n  public run() {\n    const options = {\n      crossOrigin: true\n    } as PIXI.ILoaderOptions\n\n    const assetPath = \"assets\";\n\n    const loader = new PIXI.Loader()\n\n    // load map\n    loader.add(\"maps.house\", assetPath + \"/maps/house.json\", options)\n    loader.add(\"maps.street\", assetPath + \"/maps/street.json\", options)\n    loader.add(\"maps.maension\", assetPath + \"/maps/maension.json\", options)\n\n    // load player\n    loader.add(\"ryu.stance\", assetPath + \"/ryu/stance.json\", options)\n    loader.add(\"ryu.punch\", assetPath + \"/ryu/punch.json\", options)\n    loader.add(\"ryu.kick\", assetPath + \"/ryu/kick.json\", options)\n    loader.add(\"ryu.walk\", assetPath + \"/ryu/walk.json\", options)\n    loader.add(\"ryu.gothit\", assetPath + \"/ryu/gothit.json\", options)\n    loader.add(\"ryu.died\", assetPath + \"/ryu/died.json\", options)\n\n    // enemies\n    loader.add(\"bat.walk\", assetPath + \"/enemys/bat/walk.json\", options)\n\n    // weapons\n    loader.add(\"weapons.shotgun\", assetPath + \"/weapons/shotgun.json\", options)\n    loader.add(\"weapons.beretta\", assetPath + \"/weapons/beretta.json\", options)\n\n    // load things, like decals heads and so on\n    loader.add(\"things.blood\", assetPath + \"/things/blood.json\", options)\n    loader.add(\"things.door\", assetPath + \"/things/door.json\", options)\n    loader.add(\"things.hud\", assetPath + \"/things/hud.json\", options)\n\n    loader.onComplete.once(this._assetsLoaded.bind(this))\n\n    // resources loaded\n    loader.load();\n  }\n\n  /**\n   *\n   * @param loader\n   * @param resources\n   * @private\n   */\n  private _assetsLoaded(\n    loader: PIXI.Loader,\n    resources: PIXI.IResourceDictionary\n  ) {\n\n    // loading done, start game\n    this._game = new Game(\n      resources,\n      this._stage,\n      this._renderer.width,\n      this._renderer.height\n    );\n\n    console.log(\"Mänsion:\", \"Init done, ready to scare!\");\n\n    requestAnimationFrame(this._animate.bind(this));\n  }\n\n  /**\n   *\n   * @private\n   */\n  private _animate(elapsed: number) {\n    // calculate frame delta\n    let delta = elapsed - this._lastFrame;\n    this._lastFrame = elapsed;\n\n    if (this._fps) {\n      this._fpsCount++\n      this._fpsTimer += delta;\n\n      // reset after 1 second\n      if (this._fpsTimer > 1000) {\n        // update text\n        this._fps.text = \"FPS: \" + this._fpsCount;\n\n        this._fpsCount = 0;\n        this._fpsTimer = 0;\n      }\n    }\n\n    // update game\n    if (this._game) {\n      this._game.update(elapsed, delta);\n    }\n\n    // render the container\n    this._renderer.render(this._stageWrapper);\n\n    requestAnimationFrame(this._animate.bind(this));\n  }\n}\n","import React, { useEffect, useRef, useState } from 'react';\nimport './Maension.css';\nimport Maension from \"./game/maension\"\n\nexport default function MaensionComponent() {\n\n  const stage = useRef(null)\n  const [maension, setMaension] = useState<Maension>()\n\n  useEffect(() => {\n    if (!maension && stage.current) {\n      const m = new Maension(stage.current!)\n      m.run()\n      setMaension(m)\n    }\n  }, [stage, maension])\n\n  return (\n    <div className=\"maension\">\n      <h1>Mänsion</h1>\n\n      <div ref={stage}/>\n\n      <div>\n        <div>\n          Donate\n        </div>\n        <div>\n          Patreon\n        </div>\n      </div>\n\n    </div>\n  );\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport Maension from './Maension';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <Maension/>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}