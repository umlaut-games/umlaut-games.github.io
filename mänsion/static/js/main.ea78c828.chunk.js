(this.webpackJsonpmaension=this.webpackJsonpmaension||[]).push([[0],{31:function(e,t,i){e.exports=i(47)},36:function(e,t,i){},37:function(e,t,i){},47:function(e,t,i){"use strict";i.r(t);var n=i(13),s=i.n(n),a=i(28),o=i.n(a),r=(i(36),i(30)),h=(i(37),i(6)),l=i(9),u=i(5),d=i(16),_=!0,c=!0,p=!1,v=i(8),f=i(7),y=function(e){Object(v.a)(i,e);var t=Object(f.a)(i);function i(e){var n;return Object(h.a)(this,i),(n=t.call(this))._resources=void 0,n._isFacingRight=!0,n._vx=0,n._vy=0,n._vr=0,n._resources=e,n}return Object(l.a)(i,[{key:"collides",value:function(e){var t=!(e.x>this.realx+Math.abs(this.width)||e.x+Math.abs(e.width)<this.realx||e.y>this.y+Math.abs(this.height)||e.y+Math.abs(e.height)<this.y);return t}},{key:"isFacingRight",get:function(){return this._isFacingRight}},{key:"vx",get:function(){return this._vx}},{key:"vy",get:function(){return this._vy}},{key:"vr",get:function(){return this._vr}},{key:"realx",get:function(){return this.x-Math.abs(this.width)/2}}]),i}(u.b),g=function(e){Object(v.a)(i,e);var t=Object(f.a)(i);function i(e){var n;return Object(h.a)(this,i),(n=t.call(this,e))._clips={},n._currentClip=void 0,n._resources=e,n}return Object(l.a)(i,[{key:"_setIsFacingRight",value:function(e){this._isFacingRight=e,this._setOrientation()}},{key:"_setOrientation",value:function(){if(this._currentClip){var e=this.scale.x;if(this._isFacingRight&&e>0)return;if(!this._isFacingRight&&e<0)return;!this._isFacingRight&&e<0?this.scale.x=Math.abs(e):this.scale.x=-1*e}}},{key:"_playClip",value:function(e,t,i){var n=this;return this._currentClip&&(this.removeChild(this._currentClip),this._currentClip=void 0),new Promise((function(s,a){var o=n._clips[e];if(!o){var r="AnimationBase: failed to load clip: "+e;console.log(r,n._clips),a(r)}o.zIndex=1,n.addChild(o),n._currentClip=o,n._setOrientation(),n._currentClip.loop=t,n._currentClip.gotoAndPlay(0),n.children.sort((function(e,t){return e.zIndex-t.zIndex})),t||(o.onComplete=function(){o.stop(),i||n.removeChild(o),s()})}))}}]),i}(y),w=function(){function e(){Object(h.a)(this,e)}return Object(l.a)(e,null,[{key:"loadClip",value:function(e,t,i,n){var s=[];for(var a in e[t].textures){var o=e[t].textures[a];s.push(o)}var r=new u.a(s);return r.animationSpeed=i,r.scale.x=n,r.scale.y=n,r.anchor.x=.5,r}},{key:"outlineContainer",value:function(e){e.outline&&(e.removeChild(e.outline),delete e.outline);var t=new u.c;t.lineStyle(1,0),t.drawRect(0,0,e.width,e.height),t.pivot.x=e.width/2,t.endFill(),e.outline=t,e.addChild(t)}}]),e}(),m=function(){function e(){Object(h.a)(this,e)}return Object(l.a)(e,null,[{key:"init",value:function(t){return e._events=t,e.scanGamepads(),e._gamepads[0]||null}},{key:"connectHandler",value:function(t){console.log("gamepad connected"),e.addGamepad(t.gamepad)}},{key:"addGamepad",value:function(t){console.log("adding gamepad",t),e._gamepads[t.index]=t,e._state[t.index]={}}},{key:"disconnectHandler",value:function(t){console.log("gamepad disconnected"),e.removeGamepad(t.gamepad)}},{key:"removeGamepad",value:function(t){console.log("removing gamepad"),delete e._gamepads[t.index],delete e._state[t.index]}},{key:"updateStatus",value:function(){for(var t in e.scanGamepads(),e._gamepads){var i=e._gamepads[t];if(i.buttons)for(var n in i.buttons){var s=i.buttons[n];e._state[t][n]=e._state[t][n]||{},e._events[t][n]=e._events[t][n]||{},s.pressed&&!e._state[t][n].isPressed&&(console.log("button pressed",t,n),e._state[t][n].isPressed=!0,e._events[t][n].pressEvent&&e._events[t][n].pressEvent()),!s.pressed&&e._state[t][n].isPressed&&(console.log("button released",t,n),e._state[t][n].isPressed=!1,e._events[t][n].releaseEvent&&e._events[t][n].releaseEvent())}}}},{key:"scanGamepads",value:function(){var t,i=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],n=Object(d.a)(i);try{for(n.s();!(t=n.n()).done;){var s=t.value;if(s){var a=s.index;a in e._gamepads?e._gamepads[a]=s:(console.log("found new gamepad during scan, adding",a),e.addGamepad(s))}}}catch(o){n.e(o)}finally{n.f()}}}]),e}();m._gamepads={},m._state={},m._events={},window.addEventListener("gamepadconnected",m.connectHandler),window.addEventListener("gamepaddisconnected",m.disconnectHandler);var b=function(){function e(t,i){Object(h.a)(this,e),this._key=t,this._ignoreKeyup=i,this._isDown=!1,this._isUp=!0,this.pressEvent=null,this.releaseEvent=null,window.addEventListener("keydown",this._downHandler.bind(this),!1),window.addEventListener("keyup",this._upHandler.bind(this),!1)}return Object(l.a)(e,[{key:"_downHandler",value:function(e){e.key===this._key&&(e.preventDefault(),this._isUp&&this.pressEvent&&this.pressEvent(),this._isDown=!0,this._isUp=!1)}},{key:"_upHandler",value:function(e){e.key===this._key&&(e.preventDefault(),this._isDown&&this.releaseEvent&&this.releaseEvent(),this._isDown=!1,this._isUp=!0)}},{key:"isDown",get:function(){return this._isDown}}]),e}(),k=function(){function e(){Object(h.a)(this,e)}return Object(l.a)(e,null,[{key:"getRandomInt",value:function(e,t){return Math.floor(Math.random()*(t-e))+e}},{key:"angleBetweenRad",value:function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}},{key:"distanceTo",value:function(t,i){return Math.sqrt(e.distanceToSq(t,i))}},{key:"distanceToSq",value:function(e,t){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n}}]),e}(),x={idle:Symbol.for("Idle"),walking:Symbol.for("Walking"),fire:Symbol.for("Fire"),died:Symbol.for("Died")},C=(Symbol.for("Head"),Symbol.for("Feet"),Symbol.for("Front"),Symbol.for("Back"),i(17)),O=function(e){Object(v.a)(i,e);var t=Object(f.a)(i);function i(e){var n;Object(h.a)(this,i);var s="things.door";return(n=t.call(this,e))._clips=Object(C.a)({},s,w.loadClip(n._resources,s,.01,10)),n._clips[s].filters=[new u.j.NoiseFilter(.2)],n._playClip(s,!1,!1),n}return i}(g),j=function(e){Object(v.a)(i,e);var t=Object(f.a)(i);function i(e){var n;return Object(h.a)(this,i),(n=t.call(this,e)).addChild(new u.g("x",{fill:"#fff"})),n}return i}(y),S=function(e){Object(v.a)(i,e);var t=Object(f.a)(i);function i(e){var n,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01;Object(h.a)(this,i);var a="things.blood";return(n=t.call(this,e))._clips=Object(C.a)({},a,w.loadClip(n._resources,a,s,1)),n._playClip(a,!1,!1),n}return i}(g),R=function(e){Object(v.a)(i,e);var t=Object(f.a)(i);function i(e,n,s){var a;return Object(h.a)(this,i),(a=t.call(this,n)).outline=void 0,a._baseScale=1,a._skin=void 0,a._speed=1,a._health=100,a._power=12,a._state=x.idle,a._canGetHitAgain=!0,a._skin=s,a._speed=e,a}return Object(l.a)(i,[{key:"_idle",value:function(){this._state!==x.died&&(this.state=x.idle,this._playClip(this._skin+".stance",!0))}},{key:"_died",value:function(){this.state=x.died,this._vy=0,this._vx=0,this._vr=0,this._playClip(this._skin+".died",!1,!0)}},{key:"hitBy",value:function(e){var t=this,i=!1,n=!1;return this._canGetHitAgain&&(this._health-=e.power,n=!0,this._canGetHitAgain=!1,this._health<0?(this._health=0,i=!0,this._died()):(this._vx=e._isFacingRight?5:-5,this._playClip(this._skin+".gothit",!1).then((function(){t._vx=0,t._canGetHitAgain=!0,t._idle()})))),{died:i,objectTookDamage:n}}},{key:"flip",value:function(e){this._setIsFacingRight(void 0!==e?e:!this._isFacingRight)}},{key:"adaptScale",value:function(e){var t=e-this.y,i=this._baseScale-t/1e3;this.scale.x=i,this.scale.y=i}},{key:"power",get:function(){return this._power}},{key:"state",get:function(){return this._state},set:function(e){console.log(this.constructor.name,"New state:",e),this._state=e}},{key:"health",get:function(){return this._health}}]),i}(g),E=i(23),M=i(15),L=function(e){Object(v.a)(i,e);var t=Object(f.a)(i);function i(e,n,s){var a;return Object(h.a)(this,i),(a=t.call(this,e))._power=void 0,a._maxRounds=void 0,a._rounds=void 0,a._sprite=void 0,a._roundsSprite=void 0,a._power=n,a._rounds=s,a._maxRounds=s,a}return Object(l.a)(i,[{key:"rounds",get:function(){return this._rounds}},{key:"sprite",get:function(){return this._sprite}},{key:"roundsSprite",get:function(){return this._roundsSprite}}]),Object(l.a)(i,[{key:"fire",value:function(){if(this._rounds>0){var e=new S(this._resources,2);return e.x=80,this.addChild(e),this._rounds--,!0}return!1}},{key:"reload",value:function(){return this._rounds=this._maxRounds,console.log("reload"),!0}}]),i}(y),F=function(e){Object(v.a)(i,e);var t=Object(f.a)(i);function i(e){var n;Object(h.a)(this,i),n=t.call(this,e,55,6);var s=e["weapons.shotgun"];return n._sprite=new u.f(s.textures["shotgun.png"]),n._roundsSprite=new u.f(s.textures["shell.png"]),n._sprite.scale.x=.2,n._sprite.scale.y=.2,n.x=-10,n.y=40,n.addChild(n._sprite),n}return i}(L),H=function(e){Object(v.a)(i,e);var t=Object(f.a)(i);function i(e){var n;Object(h.a)(this,i),n=t.call(this,e,55,8);var s=e["weapons.beretta"];return n._sprite=new u.f(s.textures["beretta.png"]),n._roundsSprite=new u.f(s.textures["shell.png"]),n._sprite.scale.x=.2,n._sprite.scale.y=.2,n.x=-10,n.y=40,n.addChild(n._sprite),n}return i}(L),G={},D=function(e){Object(v.a)(i,e);var t=Object(f.a)(i);function i(e,n){var s;return Object(h.a)(this,i),(s=t.call(this,3,e,n))._weapon=void 0,s._name="Gordon",s._baseScale=.7,s._health=77,s._clips[s._skin+".stance"]=w.loadClip(s._resources,s._skin+".stance",.1,2),s._clips[s._skin+".walk"]=w.loadClip(s._resources,s._skin+".walk",.2,2),s._clips[s._skin+".punch"]=w.loadClip(s._resources,s._skin+".punch",.3,2),s._clips[s._skin+".kick"]=w.loadClip(s._resources,s._skin+".kick",.2,2),s._clips[s._skin+".gothit"]=w.loadClip(s._resources,s._skin+".gothit",.2,2),s._clips[s._skin+".died"]=w.loadClip(s._resources,s._skin+".died",.2,2),G.shotgun=new F(e),G.shotgun.zIndex=100,G.beretta=new H(e),G.beretta.zIndex=100,s._weapon=G.shotgun,s.addChild(s._weapon),s._idle(),s}return Object(l.a)(i,[{key:"weapon",get:function(){return this._weapon}},{key:"name",get:function(){return this._name}}]),Object(l.a)(i,[{key:"reload",value:function(){this._weapon.reload()}},{key:"switchWeapon",value:function(){this.removeChild(this._weapon),this._weapon instanceof F?this._weapon=G.beretta:this._weapon=G.shotgun,this.addChild(this._weapon)}},{key:"updateCrosshairPosition",value:function(e){var t=this._isFacingRight?k.angleBetweenRad(this.weaponLocation,e):-1*k.angleBetweenRad(e,this.weaponLocation);this._weapon.rotation=t}},{key:"_canBeControlled",value:function(){return this._state===x.died?(console.log("Cant be controlled, player is dead"),!1):this._state===x.idle||this._state===x.walking}},{key:"_logPlayerCoordinates",value:function(){p&&console.log("x",this.x,"real x",this.realx,"y",this.y,"width",this.width,"height",this.height)}},{key:"_died",value:function(){Object(E.a)(Object(M.a)(i.prototype),"_died",this).call(this),this.y+=this.height/2}},{key:"fire",value:function(){var e=this;if(this._canBeControlled()){console.log("P\xe4ng!"),this.state=x.fire,this._vx=0,this._vy=0;var t=this._weapon.fire();if(t)return this._playClip(this._skin+".punch",!1).then((function(){e._idle()})),!0;this._idle()}return!1}},{key:"moveRight",value:function(){this._canBeControlled()&&(this._vx=this._speed,this._playClip(this._skin+".walk",!0),this.state=x.walking,this._logPlayerCoordinates())}},{key:"moveLeft",value:function(){this._canBeControlled()&&(this._vx=-this._speed,this._playClip(this._skin+".walk",!0),this.state=x.walking,this._logPlayerCoordinates())}},{key:"stopMoveHorizontally",value:function(){this._vx=0,0===this._vy&&this._canBeControlled()&&this._idle()}},{key:"moveUp",value:function(){this._canBeControlled()&&(this._vy=-this._speed,this._playClip(this._skin+".walk",!0),this.state=x.walking,this._logPlayerCoordinates())}},{key:"moveDown",value:function(){this._canBeControlled()&&(this._vy=this._speed,this._playClip(this._skin+".walk",!0),this.state=x.walking,this._logPlayerCoordinates())}},{key:"stopMoveVertically",value:function(){this._vy=0,0===this._vx&&this._canBeControlled()&&this._idle()}},{key:"weaponLocation",get:function(){return this.toGlobal(this._weapon.position)}}]),i}(R),I=function(e){Object(v.a)(i,e);var t=Object(f.a)(i);function i(e,n){return Object(h.a)(this,i),t.call(this,e,n,1)}return i}(function(e){Object(v.a)(i,e);var t=Object(f.a)(i);function i(e,n){var s,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return Object(h.a)(this,i),(s=t.call(this,a,e,n))._lastFlip=0,s._isFacingRight=!1,s._clips[s._skin+".walk"]=w.loadClip(s._resources,s._skin+".walk",.2,2.2),s._clips[s._skin+".gothit"]=s._clips[s._skin+".walk"],s._clips[s._skin+".died"]=s._clips[s._skin+".walk"],s._idle(),s}return Object(l.a)(i,[{key:"_idle",value:function(){this.state=x.idle,this._playClip(this._skin+".walk",!0)}},{key:"_died",value:function(){var e=this;Object(E.a)(Object(M.a)(i.prototype),"_died",this).call(this),this.y+=this.height/2,this.pivot.set(Math.abs(this.width)/2,this.height),this.rotation=90*Math.PI/180,setTimeout((function(){e.parent.removeChild(e)}),1e4)}},{key:"_canFlipAgain",value:function(){var e=!0;return Date.now()-this._lastFlip>200&&(e=!0,this._lastFlip=Date.now()),e}},{key:"moveTowards",value:function(e){var t=0,i=0;if(k.distanceTo(this.position,e)>1){var n=k.angleBetweenRad(this.position,e);i=Math.sin(n)*this._speed,((t=Math.cos(n)*this._speed)>0&&!this._isFacingRight&&this._canFlipAgain()||t<0&&this._isFacingRight&&this._canFlipAgain())&&this.flip()}this._vy=i,this._vx=t}}]),i}(R)),B=function(e){Object(v.a)(i,e);var t=Object(f.a)(i);function i(e,n){var s;Object(h.a)(this,i),s=t.call(this,e,n);var a=new u.j.ColorMatrixFilter;return a.lsd(!1),s.filters=[a],s.scale.x=2,s.scale.y=2,s}return i}(I),P=function(e){Object(v.a)(i,e);var t=Object(f.a)(i);function i(e,n,s){var a;return Object(h.a)(this,i),(a=t.call(this))._width=n,a._explorationOffset=void 0,a._textures=void 0,a._backgroundContainer=void 0,a._actorContainer=void 0,a._foregroundContainer=void 0,a._explorationOffset=a._width/3,s&&(a._textures=e[s].textures),a._backgroundContainer=new u.b,a.addChild(a._backgroundContainer),a._actorContainer=new u.b,a.addChild(a._actorContainer),a._foregroundContainer=new u.b,a.addChild(a._foregroundContainer),a}return Object(l.a)(i,[{key:"_setup",value:function(){}},{key:"shallScroll",value:function(e,t){(t>0&&e+this._explorationOffset>this._width||t<0&&e-this._explorationOffset<this._explorationOffset)&&(this.x-=t,this.x>0&&(this.x=0),this.x<this._width-this.width&&(this.x=this._width-this.width))}},{key:"actorContainer",get:function(){return this._actorContainer}},{key:"backgroundContainer",get:function(){return this._backgroundContainer}}]),i}(u.b),z=i(27).default.Sound,A=function(e){Object(v.a)(i,e);var t=Object(f.a)(i);function i(e,n){var s;Object(h.a)(this,i),s=t.call(this,e,n,"maps.maension");var a=new u.f(s._textures["tumblr_inline_n258q4r8c01qhwjx8.png"]);a.scale.x=2.56,a.scale.y=2.56,s._backgroundContainer.addChild(a);var o=new u.f(s._textures["Maension_WIP.png"]);o.y=-40,o.scale.x=2,o.scale.y=2,s._backgroundContainer.addChild(o);var r=s._textures["tree.png"],l=new u.f(r);l.x=100,l.y=350,l.scale.x=.4,l.scale.y=.4,s._foregroundContainer.addChild(l);var d=s._textures["tree_dead.png"],_=new u.f(d);return _.x=50,_.y=180,_.scale.x=.4,_.scale.y=.4,s._backgroundContainer.addChild(_),s._setup(),s}return Object(l.a)(i,[{key:"_setup",value:function(){var e=z.from("assets/sounds/zombie1.mp3"),t=z.from("assets/sounds/zombie1.mp3");setInterval((function(){e.play()}),15e3),setInterval((function(){t.play()}),8e3)}}]),i}(P),T=i(27).default.Sound,W=function(e){Object(v.a)(i,e);var t=Object(f.a)(i);function i(e,n){var s;return Object(h.a)(this,i),(s=t.call(this,e,n,"maps.house"))._setup(),s}return Object(l.a)(i,[{key:"_setup",value:function(){var e=new u.f(this._textures["house.png"]);e.scale.x=1.3,e.scale.y=1.3,this._backgroundContainer.addChild(e);var t=T.from("assets/sounds/zombie1.mp3"),i=T.from("assets/sounds/zombie1.mp3");setInterval((function(){t.play()}),15e3),setInterval((function(){i.play()}),8e3)}}]),i}(P),U=function(e){Object(v.a)(i,e);var t=Object(f.a)(i);function i(e,n){var s;return Object(h.a)(this,i),(s=t.call(this,e,n,"maps.street"))._setup(),s}return Object(l.a)(i,[{key:"_setup",value:function(){var e=new u.f(this._textures["city01.png"]),t=e.width;e.scale.x=2,e.scale.y=2.1,e.y=-100;var i=new u.h(this._textures["concret.png"]);i.width=t,i.height=300,i.scale.x=2,i.scale.y=1.44,i.y=330,this._backgroundContainer.addChild(i),this._backgroundContainer.addChild(e);var n=new u.f(this._textures["police.png"]);n.scale.x=2,n.scale.y=2,n.y=this.height-2*n.height,n.x=300,this._foregroundContainer.addChild(n)}}]),i}(P),V=function(e){Object(v.a)(i,e);var t=Object(f.a)(i);function i(e,n){var s;return Object(h.a)(this,i),(s=t.call(this,e,n))._door=void 0,s._door=new O(e),s._door.position.x=n/2-s._door.width/2,s._setup(),s}return Object(l.a)(i,[{key:"_setup",value:function(){this._foregroundContainer.addChild(this._door)}}]),i}(P),q=i(18),K=function(e){Object(v.a)(i,e);var t=Object(f.a)(i);function i(e,n,s){var a;Object(h.a)(this,i),(a=t.call(this))._player=void 0,a._health=void 0,a._rounds=void 0,a._weapon=void 0,a._gameOverSign=void 0,a._width=void 0,a._height=void 0,a._width=n,a._height=s,console.log("Setting up HUD","width:",a._width,"height:",a._height),a._player=e;var o=Object(q.a)(Object(q.a)({},i.bigText),{},{fontSize:"12px"}),r=new u.g(e.name,Object(q.a)(Object(q.a)({},o),{},{fill:"#ffff30"}));r.x=20,r.y=20,a.addChild(r),a._health=new u.g("100",o),a._health.x=20,a._health.y=50,a.addChild(a._health),a._rounds=new u.b,a._rounds.x=a._width/4+40,a._rounds.y=30,a.addChild(a._rounds);var l=new u.c;l.lineStyle(4,7829367),l.drawRect(1,6,a._width/4-4,60),a.addChild(l);var d=new u.c,_=a._width/2-4;d.lineStyle(4,7829367),d.drawRect(l.width+2,36,_,30),a.addChild(d);var c=new u.c,p=a._width/4-4;return c.lineStyle(4,7829367),c.drawRect(a._width-p,6,p,60),a.addChild(c),a.update(),a}return Object(l.a)(i,[{key:"_renderWeapon",value:function(){this.removeChild(this._weapon),this._weapon=new u.f(this._player.weapon.sprite.texture),this._weapon.scale.x=this._player.weapon.sprite.scale.x,this._weapon.scale.y=this._player.weapon.sprite.scale.y,this._weapon.x=this._width-(this._weapon.width+40),this._weapon.y=40,this.addChild(this._weapon)}},{key:"_renderRounds",value:function(){this._rounds.removeChildren();for(var e=0;e<this._player.weapon.rounds;e++){var t,i=new u.f(null===(t=this._player.weapon.roundsSprite)||void 0===t?void 0:t.texture);i.scale.x=.1,i.scale.y=.1,i.x=20*e,i.y=10,this._rounds.addChild(i)}}},{key:"update",value:function(){this._health.text=this._player.health+" HP",this._renderRounds(),this._renderWeapon()}},{key:"renderGameOver",value:function(){this._gameOverSign=new u.g("Game Over\nPress Enter to retry!",i.bigText),this.addChild(this._gameOverSign),this._gameOverSign.x=this._width/2-this._gameOverSign.width/2,this._gameOverSign.y=this._height/2-this._gameOverSign.height/2}},{key:"animate",value:function(e){this._gameOverSign&&(this._gameOverSign.alpha+=e/1e3,this._gameOverSign.alpha>1&&(this._gameOverSign.alpha=.2))}}]),i}(u.b);K.bigText={fontFamily:"Arial Black",fontSize:"48px",fontWeight:"bold",fill:"#fff",dropShadow:!0,dropShadowColor:"#000",align:"center"};var N={},J=function(){function e(t,i,n,s){Object(h.a)(this,e),this._stage=void 0,this._hud=void 0,this._map=void 0,this._player=void 0,this._enemies=[],this._mouseLocation=void 0,this._isRunning=!0,this._startOffset=void 0,this._elapsedSeconds=0,this._resources=void 0,this._width=void 0,this._height=void 0,this._mouseLine=void 0,this._crosshair=void 0,this._stage=i,this._resources=t,this._width=n,this._height=s,N.street=new U(this._resources,this._width),N.house=new W(this._resources,this._width),N.maension=new A(this._resources,this._width),N.loading=new V(this._resources,this._width),this._init()}return Object(l.a)(e,[{key:"_init",value:function(){this._mouseLine=new u.c,this._crosshair=new j(this._resources),this._map=N.maension,this._map.zIndex=1,this._stage.addChild(this._map),this._stage.cursor="none",this._player=new D(this._resources,"ryu"),this._player.x=60,this._player.y=400,this._player.adaptScale(this._height),this._map.actorContainer.addChild(this._player);var e=new I(this._resources,"bat");e.flip();var t=new I(this._resources,"bat"),i=new B(this._resources,"bat");e.position.x=900,e.position.y=200,t.position.x=920,t.position.y=220,i.position.x=880,i.position.y=240,this._map.actorContainer.addChild(e),this._map.actorContainer.addChild(t),this._map.actorContainer.addChild(i),this._attachGamepad()||(console.log("no gamepad, attaching stinky keyboard"),this._attachKeyboard()),this._enemies=[],this._hud=new K(this._player,this._width,this._height),this._hud.y=this._height-this._hud.height,this._stage.addChild(this._hud),this._updateHud(),this._attachMouse(),this._updateMouseLocation(new u.e(this._width/2,this._height/2)),this._startOffset=void 0,this._isRunning=!0,console.log("Game:","Game init done!")}},{key:"_attachMouse",value:function(){var e=this;this._stage.addChild(this._mouseLine),this._stage.addChild(this._crosshair),this._stage.interactive=!0,this._stage.on("mousemove",(function(t){e._updateMouseLocation(t.data.global)})),this._stage.on("mousedown",(function(){return e._fire()})),this._stage.on("mouseout",(function(){return e._isRunning=!1})),this._stage.on("mouseover",(function(){return e._isRunning=!0}))}},{key:"_updateCrosshair",value:function(){var e,t,i;this._mouseLocation&&this._isRunning&&(null===(e=this._player)||void 0===e?void 0:e.state)!==x.died&&(this._crosshair.x=this._mouseLocation.x-this._crosshair.width/2,this._crosshair.y=this._mouseLocation.y-this._crosshair.height/2,this._crosshair.x<this._player.toGlobal(this._stage).x?this._player.flip(!1):this._player.flip(!0),null===(t=this._player)||void 0===t||t.updateCrosshairPosition(this._stage.toGlobal(null===(i=this._crosshair)||void 0===i?void 0:i.position)))}},{key:"_fire",value:function(){var e;if(this._isRunning&&(null===(e=this._player)||void 0===e?void 0:e.fire())){var t,i=new S(this._resources,2),n=this._map.toLocal(this._crosshair);i.x=n.x,i.y=n.y,null===(t=this._map)||void 0===t||t.backgroundContainer.addChild(i),this._updateHud()}}},{key:"_moveRight",value:function(){this._isRunning&&this._player&&this._player.moveRight()}},{key:"_moveLeft",value:function(){this._isRunning&&this._player&&this._player.moveLeft()}},{key:"_moveUp",value:function(){this._isRunning&&this._player&&this._player.moveUp()}},{key:"_moveDown",value:function(){this._isRunning&&this._player&&this._player.moveDown()}},{key:"_stopMoveVertically",value:function(){var e;this._isRunning&&(null===(e=this._player)||void 0===e||e.stopMoveVertically())}},{key:"_stopMoveHorizontally",value:function(){var e;this._isRunning&&(null===(e=this._player)||void 0===e||e.stopMoveHorizontally())}},{key:"_attachKeyboard",value:function(){var e=this,t=new b("ArrowLeft",!0),i=new b("ArrowUp",!0),n=new b("ArrowRight",!0),s=new b("ArrowDown",!0),a=new b("k",!1),o=new b("w",!1),r=new b("r",!1),h=new b("Enter",!1);a.pressEvent=function(){return e._fire()},o.pressEvent=function(){return e._switchWeapon()},r.pressEvent=function(){return e._reload()},n.pressEvent=function(){return e._moveRight()},n.releaseEvent=function(){t.isDown||e._stopMoveHorizontally()},t.pressEvent=function(){return e._moveLeft()},t.releaseEvent=function(){n.isDown||e._stopMoveHorizontally()},i.pressEvent=function(){return e._moveUp()},i.releaseEvent=function(){s.isDown||e._stopMoveVertically()},s.pressEvent=function(){return e._moveDown()},s.releaseEvent=function(){i.isDown||e._stopMoveVertically()},h.pressEvent=function(){e._isRunning||e._init()}}},{key:"_attachGamepad",value:function(){var e=this;return!!m.init({0:{1:{pressEvent:function(){e._fire()}},15:{pressEvent:function(){return e._moveRight()},releaseEvent:function(){return e._stopMoveHorizontally()}},14:{pressEvent:function(){return e._moveLeft()},releaseEvent:function(){return e._stopMoveHorizontally()}},12:{pressEvent:function(){return e._moveUp()},releaseEvent:function(){return e._stopMoveVertically()}},13:{pressEvent:function(){return e._moveDown()},releaseEvent:function(){return e._stopMoveVertically()}},9:{pressEvent:function(){e._isRunning||e._init()}}}})}},{key:"_end",value:function(){this._isRunning=!1,this._hud.renderGameOver()}},{key:"_detectCollisions",value:function(){var e,t=Object(d.a)(this._enemies);try{for(t.s();!(e=t.n()).done;){var i=e.value;if(x.died!==i.state&&x.died!==this._player.state&&this._player.collides(i)){var n=this._player.hitBy(i);n.objectTookDamage&&(this._drawBlood(this._player),this._updateHud()),n.died&&this._end()}}}catch(s){t.e(s)}finally{t.f()}}},{key:"_drawBlood",value:function(e){for(var t=0;t<100;t++){var i,n=new S(this._resources);n.x=e.x+k.getRandomInt(-100,100),n.y=e.y+e.height+k.getRandomInt(-100,100),n.rotation=k.getRandomInt(0,10),null===(i=this._map)||void 0===i||i.backgroundContainer.addChild(n)}}},{key:"_updateHud",value:function(){this._hud.update()}},{key:"_updateKI",value:function(){var e,t=Object(d.a)(this._enemies);try{for(t.s();!(e=t.n()).done;){var i=e.value;x.died!==i.state&&i.moveTowards(this._player.position)}}catch(n){t.e(n)}finally{t.f()}}},{key:"_moveActors",value:function(){var e,t=this._player,i=!1;(0!==t.vy&&t.y+t.vy>0&&t.y+t.height+t.vy<this._height&&(t.y+=t.vy,i=!0),t.vx>0?t.realx+Math.abs(t.width)+7+t.vx<this._map.width&&(t.x+=t.vx,i=!0):t.vx<0&&t.realx+t.vx>=0&&(t.x+=t.vx,i=!0),i)&&(null===(e=this._map)||void 0===e||e.shallScroll(t.realx,t.vx),this._updateCrosshair(),this._player.adaptScale(this._height));var n,s=Object(d.a)(this._enemies);try{for(s.s();!(n=s.n()).done;){var a=n.value;a.x+=a.vx,a.y+=a.vy,a.rotation+=a.vr}}catch(o){s.e(o)}finally{s.f()}}},{key:"_outlineMouse",value:function(){if(this._mouseLine&&this._mouseLocation&&this._player&&this._map){this._mouseLine.clear(),this._mouseLine.lineStyle(1,16777215),this._mouseLine.position=this._player.weaponLocation;var e=this._mouseLine.toLocal(this._mouseLocation),t=e.x,i=e.y;this._mouseLine.lineTo(t,i),this._mouseLine.endFill()}}},{key:"_switchWeapon",value:function(){this._isRunning&&(this._player.switchWeapon(),this._updateHud())}},{key:"_reload",value:function(){this._isRunning&&(this._player.reload(),this._updateHud())}},{key:"_updateMouseLocation",value:function(e){this._mouseLocation=e,this._updateCrosshair()}},{key:"update",value:function(t,i){if(m.updateStatus(),this._hud.animate(i),this._isRunning){var n,s=parseInt((t/1e3).toString());this._startOffset||(this._startOffset=s);var a=s-this._startOffset;a!==this._elapsedSeconds&&(this._elapsedSeconds=a,this._updateHud()),e.timeout-a<=0&&(console.log("Time is up, dude!"),this._end()),this._detectCollisions(),this._updateKI(),this._moveActors();if(null===(n=this._map)||void 0===n||n.actorContainer.children.sort((function(e,t){return e.position.y<t.position.y?1:e.position.y>t.position.y?-1:0})),_){w.outlineContainer(this._player);var o,r=Object(d.a)(this._enemies);try{for(r.s();!(o=r.n()).done;){var h=o.value;w.outlineContainer(h)}}catch(l){r.e(l)}finally{r.f()}this._outlineMouse()}}}}]),e}();J.timeout=300;var $=function(){function e(t){Object(h.a)(this,e),this._lastFrame=0,this._fpsCount=0,this._fpsTimer=0,this._game=void 0,this._renderer=void 0,this._stage=void 0,this._stageWrapper=void 0,this._fps=void 0,this._renderer=u.i({width:800,height:600,backgroundColor:1087931}),t.appendChild(this._renderer.view),console.log("Viewport",window.innerWidth,window.innerHeight),this._stage=new u.b,this._stageWrapper=new u.b,this._stageWrapper.addChild(this._stage),c&&(this._fps=new u.g("FPS: ",{fontWeight:"16px",fill:"#fff"}),this._fps.x=10,this._fps.y=10,this._stageWrapper.addChild(this._fps)),this._animate.bind(this),this._assetsLoaded.bind(this)}return Object(l.a)(e,[{key:"run",value:function(){var e={crossOrigin:!0},t=new u.d;t.add("maps.house","assets/maps/house.json",e),t.add("maps.street","assets/maps/street.json",e),t.add("maps.maension","assets/maps/maension.json",e),t.add("ryu.stance","assets/ryu/stance.json",e),t.add("ryu.punch","assets/ryu/punch.json",e),t.add("ryu.kick","assets/ryu/kick.json",e),t.add("ryu.walk","assets/ryu/walk.json",e),t.add("ryu.gothit","assets/ryu/gothit.json",e),t.add("ryu.died","assets/ryu/died.json",e),t.add("bat.walk","assets/enemys/bat/walk.json",e),t.add("weapons.shotgun","assets/weapons/shotgun.json",e),t.add("weapons.beretta","assets/weapons/beretta.json",e),t.add("things.blood","assets/things/blood.json",e),t.add("things.door","assets/things/door.json",e),t.onComplete.once(this._assetsLoaded.bind(this)),t.load()}},{key:"_assetsLoaded",value:function(e,t){this._game=new J(t,this._stage,this._renderer.width,this._renderer.height),console.log("M\xe4nsion:","Init done, ready to scare!"),requestAnimationFrame(this._animate.bind(this))}},{key:"_animate",value:function(e){var t=e-this._lastFrame;this._lastFrame=e,this._fps&&(this._fpsCount++,this._fpsTimer+=t,this._fpsTimer>1e3&&(this._fps.text="FPS: "+this._fpsCount,this._fpsCount=0,this._fpsTimer=0)),this._game&&this._game.update(e,t),this._renderer.render(this._stageWrapper),requestAnimationFrame(this._animate.bind(this))}}]),e}();function Q(){var e=Object(n.useRef)(null),t=Object(n.useState)(),i=Object(r.a)(t,2),a=i[0],o=i[1];return Object(n.useEffect)((function(){if(!a&&e.current){var t=new $(e.current);t.run(),o(t)}}),[e,a]),s.a.createElement("div",{className:"maension"},s.a.createElement("h1",null,"M\xe4nsion"),s.a.createElement("div",{ref:e}),s.a.createElement("div",null,s.a.createElement("div",null,"Donate"),s.a.createElement("div",null,"Patreon")))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(Q,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[31,1,2]]]);
//# sourceMappingURL=main.ea78c828.chunk.js.map